function vx(t,e){for(var n=0;n<e.length;n++){const s=e[n];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in t)){const i=Object.getOwnPropertyDescriptor(s,r);i&&Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();function Jh(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ef={exports:{}},ia={},tf={exports:{}},J={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gi=Symbol.for("react.element"),wx=Symbol.for("react.portal"),bx=Symbol.for("react.fragment"),kx=Symbol.for("react.strict_mode"),Sx=Symbol.for("react.profiler"),jx=Symbol.for("react.provider"),Nx=Symbol.for("react.context"),Cx=Symbol.for("react.forward_ref"),Tx=Symbol.for("react.suspense"),Mx=Symbol.for("react.memo"),Ex=Symbol.for("react.lazy"),Sd=Symbol.iterator;function Px(t){return t===null||typeof t!="object"?null:(t=Sd&&t[Sd]||t["@@iterator"],typeof t=="function"?t:null)}var nf={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},sf=Object.assign,rf={};function nr(t,e,n){this.props=t,this.context=e,this.refs=rf,this.updater=n||nf}nr.prototype.isReactComponent={};nr.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};nr.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function of(){}of.prototype=nr.prototype;function zc(t,e,n){this.props=t,this.context=e,this.refs=rf,this.updater=n||nf}var Ac=zc.prototype=new of;Ac.constructor=zc;sf(Ac,nr.prototype);Ac.isPureReactComponent=!0;var jd=Array.isArray,af=Object.prototype.hasOwnProperty,Dc={current:null},lf={key:!0,ref:!0,__self:!0,__source:!0};function cf(t,e,n){var s,r={},i=null,a=null;if(e!=null)for(s in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(i=""+e.key),e)af.call(e,s)&&!lf.hasOwnProperty(s)&&(r[s]=e[s]);var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];r.children=c}if(t&&t.defaultProps)for(s in l=t.defaultProps,l)r[s]===void 0&&(r[s]=l[s]);return{$$typeof:gi,type:t,key:i,ref:a,props:r,_owner:Dc.current}}function Lx(t,e){return{$$typeof:gi,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Rc(t){return typeof t=="object"&&t!==null&&t.$$typeof===gi}function _x(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Nd=/\/+/g;function Qa(t,e){return typeof t=="object"&&t!==null&&t.key!=null?_x(""+t.key):e.toString(36)}function yo(t,e,n,s,r){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var a=!1;if(t===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(t.$$typeof){case gi:case wx:a=!0}}if(a)return a=t,r=r(a),t=s===""?"."+Qa(a,0):s,jd(r)?(n="",t!=null&&(n=t.replace(Nd,"$&/")+"/"),yo(r,e,n,"",function(u){return u})):r!=null&&(Rc(r)&&(r=Lx(r,n+(!r.key||a&&a.key===r.key?"":(""+r.key).replace(Nd,"$&/")+"/")+t)),e.push(r)),1;if(a=0,s=s===""?".":s+":",jd(t))for(var l=0;l<t.length;l++){i=t[l];var c=s+Qa(i,l);a+=yo(i,e,n,c,r)}else if(c=Px(t),typeof c=="function")for(t=c.call(t),l=0;!(i=t.next()).done;)i=i.value,c=s+Qa(i,l++),a+=yo(i,e,n,c,r);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function Vi(t,e,n){if(t==null)return t;var s=[],r=0;return yo(t,s,"","",function(i){return e.call(n,i,r++)}),s}function Ix(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var qe={current:null},vo={transition:null},zx={ReactCurrentDispatcher:qe,ReactCurrentBatchConfig:vo,ReactCurrentOwner:Dc};function uf(){throw Error("act(...) is not supported in production builds of React.")}J.Children={map:Vi,forEach:function(t,e,n){Vi(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Vi(t,function(){e++}),e},toArray:function(t){return Vi(t,function(e){return e})||[]},only:function(t){if(!Rc(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};J.Component=nr;J.Fragment=bx;J.Profiler=Sx;J.PureComponent=zc;J.StrictMode=kx;J.Suspense=Tx;J.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=zx;J.act=uf;J.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var s=sf({},t.props),r=t.key,i=t.ref,a=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,a=Dc.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in e)af.call(e,c)&&!lf.hasOwnProperty(c)&&(s[c]=e[c]===void 0&&l!==void 0?l[c]:e[c])}var c=arguments.length-2;if(c===1)s.children=n;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];s.children=l}return{$$typeof:gi,type:t.type,key:r,ref:i,props:s,_owner:a}};J.createContext=function(t){return t={$$typeof:Nx,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:jx,_context:t},t.Consumer=t};J.createElement=cf;J.createFactory=function(t){var e=cf.bind(null,t);return e.type=t,e};J.createRef=function(){return{current:null}};J.forwardRef=function(t){return{$$typeof:Cx,render:t}};J.isValidElement=Rc;J.lazy=function(t){return{$$typeof:Ex,_payload:{_status:-1,_result:t},_init:Ix}};J.memo=function(t,e){return{$$typeof:Mx,type:t,compare:e===void 0?null:e}};J.startTransition=function(t){var e=vo.transition;vo.transition={};try{t()}finally{vo.transition=e}};J.unstable_act=uf;J.useCallback=function(t,e){return qe.current.useCallback(t,e)};J.useContext=function(t){return qe.current.useContext(t)};J.useDebugValue=function(){};J.useDeferredValue=function(t){return qe.current.useDeferredValue(t)};J.useEffect=function(t,e){return qe.current.useEffect(t,e)};J.useId=function(){return qe.current.useId()};J.useImperativeHandle=function(t,e,n){return qe.current.useImperativeHandle(t,e,n)};J.useInsertionEffect=function(t,e){return qe.current.useInsertionEffect(t,e)};J.useLayoutEffect=function(t,e){return qe.current.useLayoutEffect(t,e)};J.useMemo=function(t,e){return qe.current.useMemo(t,e)};J.useReducer=function(t,e,n){return qe.current.useReducer(t,e,n)};J.useRef=function(t){return qe.current.useRef(t)};J.useState=function(t){return qe.current.useState(t)};J.useSyncExternalStore=function(t,e,n){return qe.current.useSyncExternalStore(t,e,n)};J.useTransition=function(){return qe.current.useTransition()};J.version="18.3.1";tf.exports=J;var m=tf.exports;const ye=Jh(m),Ax=vx({__proto__:null,default:ye},[m]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Dx=m,Rx=Symbol.for("react.element"),Ox=Symbol.for("react.fragment"),$x=Object.prototype.hasOwnProperty,Fx=Dx.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Hx={key:!0,ref:!0,__self:!0,__source:!0};function df(t,e,n){var s,r={},i=null,a=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(s in e)$x.call(e,s)&&!Hx.hasOwnProperty(s)&&(r[s]=e[s]);if(t&&t.defaultProps)for(s in e=t.defaultProps,e)r[s]===void 0&&(r[s]=e[s]);return{$$typeof:Rx,type:t,key:i,ref:a,props:r,_owner:Fx.current}}ia.Fragment=Ox;ia.jsx=df;ia.jsxs=df;ef.exports=ia;var o=ef.exports,Il={},hf={exports:{}},gt={},ff={exports:{}},mf={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(z,B){var W=z.length;z.push(B);e:for(;0<W;){var te=W-1>>>1,ne=z[te];if(0<r(ne,B))z[te]=B,z[W]=ne,W=te;else break e}}function n(z){return z.length===0?null:z[0]}function s(z){if(z.length===0)return null;var B=z[0],W=z.pop();if(W!==B){z[0]=W;e:for(var te=0,ne=z.length,ue=ne>>>1;te<ue;){var yt=2*(te+1)-1,ir=z[yt],Ze=yt+1,is=z[Ze];if(0>r(ir,W))Ze<ne&&0>r(is,ir)?(z[te]=is,z[Ze]=W,te=Ze):(z[te]=ir,z[yt]=W,te=yt);else if(Ze<ne&&0>r(is,W))z[te]=is,z[Ze]=W,te=Ze;else break e}}return B}function r(z,B){var W=z.sortIndex-B.sortIndex;return W!==0?W:z.id-B.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var c=[],u=[],f=1,h=null,p=3,b=!1,y=!1,S=!1,j=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,g=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(z){for(var B=n(u);B!==null;){if(B.callback===null)s(u);else if(B.startTime<=z)s(u),B.sortIndex=B.expirationTime,e(c,B);else break;B=n(u)}}function w(z){if(S=!1,x(z),!y)if(n(c)!==null)y=!0,je(N);else{var B=n(u);B!==null&&Qe(w,B.startTime-z)}}function N(z,B){y=!1,S&&(S=!1,v(E),E=-1),b=!0;var W=p;try{for(x(B),h=n(c);h!==null&&(!(h.expirationTime>B)||z&&!G());){var te=h.callback;if(typeof te=="function"){h.callback=null,p=h.priorityLevel;var ne=te(h.expirationTime<=B);B=t.unstable_now(),typeof ne=="function"?h.callback=ne:h===n(c)&&s(c),x(B)}else s(c);h=n(c)}if(h!==null)var ue=!0;else{var yt=n(u);yt!==null&&Qe(w,yt.startTime-B),ue=!1}return ue}finally{h=null,p=W,b=!1}}var T=!1,P=null,E=-1,$=5,D=-1;function G(){return!(t.unstable_now()-D<$)}function q(){if(P!==null){var z=t.unstable_now();D=z;var B=!0;try{B=P(!0,z)}finally{B?re():(T=!1,P=null)}}else T=!1}var re;if(typeof g=="function")re=function(){g(q)};else if(typeof MessageChannel<"u"){var X=new MessageChannel,ae=X.port2;X.port1.onmessage=q,re=function(){ae.postMessage(null)}}else re=function(){j(q,0)};function je(z){P=z,T||(T=!0,re())}function Qe(z,B){E=j(function(){z(t.unstable_now())},B)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(z){z.callback=null},t.unstable_continueExecution=function(){y||b||(y=!0,je(N))},t.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):$=0<z?Math.floor(1e3/z):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(z){switch(p){case 1:case 2:case 3:var B=3;break;default:B=p}var W=p;p=B;try{return z()}finally{p=W}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(z,B){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var W=p;p=z;try{return B()}finally{p=W}},t.unstable_scheduleCallback=function(z,B,W){var te=t.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?te+W:te):W=te,z){case 1:var ne=-1;break;case 2:ne=250;break;case 5:ne=1073741823;break;case 4:ne=1e4;break;default:ne=5e3}return ne=W+ne,z={id:f++,callback:B,priorityLevel:z,startTime:W,expirationTime:ne,sortIndex:-1},W>te?(z.sortIndex=W,e(u,z),n(c)===null&&z===n(u)&&(S?(v(E),E=-1):S=!0,Qe(w,W-te))):(z.sortIndex=ne,e(c,z),y||b||(y=!0,je(N))),z},t.unstable_shouldYield=G,t.unstable_wrapCallback=function(z){var B=p;return function(){var W=p;p=B;try{return z.apply(this,arguments)}finally{p=W}}}})(mf);ff.exports=mf;var Bx=ff.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yx=m,pt=Bx;function L(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var pf=new Set,Zr={};function ns(t,e){qs(t,e),qs(t+"Capture",e)}function qs(t,e){for(Zr[t]=e,t=0;t<e.length;t++)pf.add(e[t])}var tn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),zl=Object.prototype.hasOwnProperty,Wx=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Cd={},Td={};function Xx(t){return zl.call(Td,t)?!0:zl.call(Cd,t)?!1:Wx.test(t)?Td[t]=!0:(Cd[t]=!0,!1)}function Ux(t,e,n,s){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return s?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Vx(t,e,n,s){if(e===null||typeof e>"u"||Ux(t,e,n,s))return!0;if(s)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Ke(t,e,n,s,r,i,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=s,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=a}var Oe={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Oe[t]=new Ke(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Oe[e]=new Ke(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Oe[t]=new Ke(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Oe[t]=new Ke(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Oe[t]=new Ke(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Oe[t]=new Ke(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Oe[t]=new Ke(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Oe[t]=new Ke(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Oe[t]=new Ke(t,5,!1,t.toLowerCase(),null,!1,!1)});var Oc=/[\-:]([a-z])/g;function $c(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Oc,$c);Oe[e]=new Ke(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Oc,$c);Oe[e]=new Ke(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Oc,$c);Oe[e]=new Ke(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Oe[t]=new Ke(t,1,!1,t.toLowerCase(),null,!1,!1)});Oe.xlinkHref=new Ke("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Oe[t]=new Ke(t,1,!1,t.toLowerCase(),null,!0,!0)});function Fc(t,e,n,s){var r=Oe.hasOwnProperty(e)?Oe[e]:null;(r!==null?r.type!==0:s||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Vx(e,n,r,s)&&(n=null),s||r===null?Xx(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,s=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,s?t.setAttributeNS(s,e,n):t.setAttribute(e,n))))}var on=Yx.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Gi=Symbol.for("react.element"),Ls=Symbol.for("react.portal"),_s=Symbol.for("react.fragment"),Hc=Symbol.for("react.strict_mode"),Al=Symbol.for("react.profiler"),gf=Symbol.for("react.provider"),xf=Symbol.for("react.context"),Bc=Symbol.for("react.forward_ref"),Dl=Symbol.for("react.suspense"),Rl=Symbol.for("react.suspense_list"),Yc=Symbol.for("react.memo"),hn=Symbol.for("react.lazy"),yf=Symbol.for("react.offscreen"),Md=Symbol.iterator;function Cr(t){return t===null||typeof t!="object"?null:(t=Md&&t[Md]||t["@@iterator"],typeof t=="function"?t:null)}var be=Object.assign,Za;function Or(t){if(Za===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Za=e&&e[1]||""}return`
`+Za+t}var Ja=!1;function el(t,e){if(!t||Ja)return"";Ja=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var s=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){s=u}t.call(e.prototype)}else{try{throw Error()}catch(u){s=u}t()}}catch(u){if(u&&s&&typeof u.stack=="string"){for(var r=u.stack.split(`
`),i=s.stack.split(`
`),a=r.length-1,l=i.length-1;1<=a&&0<=l&&r[a]!==i[l];)l--;for(;1<=a&&0<=l;a--,l--)if(r[a]!==i[l]){if(a!==1||l!==1)do if(a--,l--,0>l||r[a]!==i[l]){var c=`
`+r[a].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=a&&0<=l);break}}}finally{Ja=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Or(t):""}function Gx(t){switch(t.tag){case 5:return Or(t.type);case 16:return Or("Lazy");case 13:return Or("Suspense");case 19:return Or("SuspenseList");case 0:case 2:case 15:return t=el(t.type,!1),t;case 11:return t=el(t.type.render,!1),t;case 1:return t=el(t.type,!0),t;default:return""}}function Ol(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case _s:return"Fragment";case Ls:return"Portal";case Al:return"Profiler";case Hc:return"StrictMode";case Dl:return"Suspense";case Rl:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case xf:return(t.displayName||"Context")+".Consumer";case gf:return(t._context.displayName||"Context")+".Provider";case Bc:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Yc:return e=t.displayName||null,e!==null?e:Ol(t.type)||"Memo";case hn:e=t._payload,t=t._init;try{return Ol(t(e))}catch{}}return null}function qx(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ol(e);case 8:return e===Hc?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Cn(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function vf(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Kx(t){var e=vf(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),s=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(a){s=""+a,i.call(this,a)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(a){s=""+a},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function qi(t){t._valueTracker||(t._valueTracker=Kx(t))}function wf(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),s="";return t&&(s=vf(t)?t.checked?"true":"false":t.value),t=s,t!==n?(e.setValue(t),!0):!1}function zo(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function $l(t,e){var n=e.checked;return be({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Ed(t,e){var n=e.defaultValue==null?"":e.defaultValue,s=e.checked!=null?e.checked:e.defaultChecked;n=Cn(e.value!=null?e.value:n),t._wrapperState={initialChecked:s,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function bf(t,e){e=e.checked,e!=null&&Fc(t,"checked",e,!1)}function Fl(t,e){bf(t,e);var n=Cn(e.value),s=e.type;if(n!=null)s==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(s==="submit"||s==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Hl(t,e.type,n):e.hasOwnProperty("defaultValue")&&Hl(t,e.type,Cn(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Pd(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var s=e.type;if(!(s!=="submit"&&s!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Hl(t,e,n){(e!=="number"||zo(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var $r=Array.isArray;function Ys(t,e,n,s){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&s&&(t[n].defaultSelected=!0)}else{for(n=""+Cn(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,s&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function Bl(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(L(91));return be({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Ld(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(L(92));if($r(n)){if(1<n.length)throw Error(L(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Cn(n)}}function kf(t,e){var n=Cn(e.value),s=Cn(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),s!=null&&(t.defaultValue=""+s)}function _d(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Sf(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Yl(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Sf(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Ki,jf=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,s,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,s,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Ki=Ki||document.createElement("div"),Ki.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Ki.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Jr(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Br={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Qx=["Webkit","ms","Moz","O"];Object.keys(Br).forEach(function(t){Qx.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Br[e]=Br[t]})});function Nf(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Br.hasOwnProperty(t)&&Br[t]?(""+e).trim():e+"px"}function Cf(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var s=n.indexOf("--")===0,r=Nf(n,e[n],s);n==="float"&&(n="cssFloat"),s?t.setProperty(n,r):t[n]=r}}var Zx=be({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Wl(t,e){if(e){if(Zx[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(L(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(L(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(L(61))}if(e.style!=null&&typeof e.style!="object")throw Error(L(62))}}function Xl(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ul=null;function Wc(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Vl=null,Ws=null,Xs=null;function Id(t){if(t=vi(t)){if(typeof Vl!="function")throw Error(L(280));var e=t.stateNode;e&&(e=ua(e),Vl(t.stateNode,t.type,e))}}function Tf(t){Ws?Xs?Xs.push(t):Xs=[t]:Ws=t}function Mf(){if(Ws){var t=Ws,e=Xs;if(Xs=Ws=null,Id(t),e)for(t=0;t<e.length;t++)Id(e[t])}}function Ef(t,e){return t(e)}function Pf(){}var tl=!1;function Lf(t,e,n){if(tl)return t(e,n);tl=!0;try{return Ef(t,e,n)}finally{tl=!1,(Ws!==null||Xs!==null)&&(Pf(),Mf())}}function ei(t,e){var n=t.stateNode;if(n===null)return null;var s=ua(n);if(s===null)return null;n=s[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(t=t.type,s=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!s;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(L(231,e,typeof n));return n}var Gl=!1;if(tn)try{var Tr={};Object.defineProperty(Tr,"passive",{get:function(){Gl=!0}}),window.addEventListener("test",Tr,Tr),window.removeEventListener("test",Tr,Tr)}catch{Gl=!1}function Jx(t,e,n,s,r,i,a,l,c){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(f){this.onError(f)}}var Yr=!1,Ao=null,Do=!1,ql=null,ey={onError:function(t){Yr=!0,Ao=t}};function ty(t,e,n,s,r,i,a,l,c){Yr=!1,Ao=null,Jx.apply(ey,arguments)}function ny(t,e,n,s,r,i,a,l,c){if(ty.apply(this,arguments),Yr){if(Yr){var u=Ao;Yr=!1,Ao=null}else throw Error(L(198));Do||(Do=!0,ql=u)}}function ss(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function _f(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function zd(t){if(ss(t)!==t)throw Error(L(188))}function sy(t){var e=t.alternate;if(!e){if(e=ss(t),e===null)throw Error(L(188));return e!==t?null:t}for(var n=t,s=e;;){var r=n.return;if(r===null)break;var i=r.alternate;if(i===null){if(s=r.return,s!==null){n=s;continue}break}if(r.child===i.child){for(i=r.child;i;){if(i===n)return zd(r),t;if(i===s)return zd(r),e;i=i.sibling}throw Error(L(188))}if(n.return!==s.return)n=r,s=i;else{for(var a=!1,l=r.child;l;){if(l===n){a=!0,n=r,s=i;break}if(l===s){a=!0,s=r,n=i;break}l=l.sibling}if(!a){for(l=i.child;l;){if(l===n){a=!0,n=i,s=r;break}if(l===s){a=!0,s=i,n=r;break}l=l.sibling}if(!a)throw Error(L(189))}}if(n.alternate!==s)throw Error(L(190))}if(n.tag!==3)throw Error(L(188));return n.stateNode.current===n?t:e}function If(t){return t=sy(t),t!==null?zf(t):null}function zf(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=zf(t);if(e!==null)return e;t=t.sibling}return null}var Af=pt.unstable_scheduleCallback,Ad=pt.unstable_cancelCallback,ry=pt.unstable_shouldYield,iy=pt.unstable_requestPaint,Te=pt.unstable_now,oy=pt.unstable_getCurrentPriorityLevel,Xc=pt.unstable_ImmediatePriority,Df=pt.unstable_UserBlockingPriority,Ro=pt.unstable_NormalPriority,ay=pt.unstable_LowPriority,Rf=pt.unstable_IdlePriority,oa=null,Bt=null;function ly(t){if(Bt&&typeof Bt.onCommitFiberRoot=="function")try{Bt.onCommitFiberRoot(oa,t,void 0,(t.current.flags&128)===128)}catch{}}var _t=Math.clz32?Math.clz32:dy,cy=Math.log,uy=Math.LN2;function dy(t){return t>>>=0,t===0?32:31-(cy(t)/uy|0)|0}var Qi=64,Zi=4194304;function Fr(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Oo(t,e){var n=t.pendingLanes;if(n===0)return 0;var s=0,r=t.suspendedLanes,i=t.pingedLanes,a=n&268435455;if(a!==0){var l=a&~r;l!==0?s=Fr(l):(i&=a,i!==0&&(s=Fr(i)))}else a=n&~r,a!==0?s=Fr(a):i!==0&&(s=Fr(i));if(s===0)return 0;if(e!==0&&e!==s&&!(e&r)&&(r=s&-s,i=e&-e,r>=i||r===16&&(i&4194240)!==0))return e;if(s&4&&(s|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=s;0<e;)n=31-_t(e),r=1<<n,s|=t[n],e&=~r;return s}function hy(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function fy(t,e){for(var n=t.suspendedLanes,s=t.pingedLanes,r=t.expirationTimes,i=t.pendingLanes;0<i;){var a=31-_t(i),l=1<<a,c=r[a];c===-1?(!(l&n)||l&s)&&(r[a]=hy(l,e)):c<=e&&(t.expiredLanes|=l),i&=~l}}function Kl(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Of(){var t=Qi;return Qi<<=1,!(Qi&4194240)&&(Qi=64),t}function nl(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function xi(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-_t(e),t[e]=n}function my(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var s=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-_t(n),i=1<<r;e[r]=0,s[r]=-1,t[r]=-1,n&=~i}}function Uc(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var s=31-_t(n),r=1<<s;r&e|t[s]&e&&(t[s]|=e),n&=~r}}var ce=0;function $f(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Ff,Vc,Hf,Bf,Yf,Ql=!1,Ji=[],yn=null,vn=null,wn=null,ti=new Map,ni=new Map,mn=[],py="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Dd(t,e){switch(t){case"focusin":case"focusout":yn=null;break;case"dragenter":case"dragleave":vn=null;break;case"mouseover":case"mouseout":wn=null;break;case"pointerover":case"pointerout":ti.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ni.delete(e.pointerId)}}function Mr(t,e,n,s,r,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:s,nativeEvent:i,targetContainers:[r]},e!==null&&(e=vi(e),e!==null&&Vc(e)),t):(t.eventSystemFlags|=s,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function gy(t,e,n,s,r){switch(e){case"focusin":return yn=Mr(yn,t,e,n,s,r),!0;case"dragenter":return vn=Mr(vn,t,e,n,s,r),!0;case"mouseover":return wn=Mr(wn,t,e,n,s,r),!0;case"pointerover":var i=r.pointerId;return ti.set(i,Mr(ti.get(i)||null,t,e,n,s,r)),!0;case"gotpointercapture":return i=r.pointerId,ni.set(i,Mr(ni.get(i)||null,t,e,n,s,r)),!0}return!1}function Wf(t){var e=Bn(t.target);if(e!==null){var n=ss(e);if(n!==null){if(e=n.tag,e===13){if(e=_f(n),e!==null){t.blockedOn=e,Yf(t.priority,function(){Hf(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function wo(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Zl(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var s=new n.constructor(n.type,n);Ul=s,n.target.dispatchEvent(s),Ul=null}else return e=vi(n),e!==null&&Vc(e),t.blockedOn=n,!1;e.shift()}return!0}function Rd(t,e,n){wo(t)&&n.delete(e)}function xy(){Ql=!1,yn!==null&&wo(yn)&&(yn=null),vn!==null&&wo(vn)&&(vn=null),wn!==null&&wo(wn)&&(wn=null),ti.forEach(Rd),ni.forEach(Rd)}function Er(t,e){t.blockedOn===e&&(t.blockedOn=null,Ql||(Ql=!0,pt.unstable_scheduleCallback(pt.unstable_NormalPriority,xy)))}function si(t){function e(r){return Er(r,t)}if(0<Ji.length){Er(Ji[0],t);for(var n=1;n<Ji.length;n++){var s=Ji[n];s.blockedOn===t&&(s.blockedOn=null)}}for(yn!==null&&Er(yn,t),vn!==null&&Er(vn,t),wn!==null&&Er(wn,t),ti.forEach(e),ni.forEach(e),n=0;n<mn.length;n++)s=mn[n],s.blockedOn===t&&(s.blockedOn=null);for(;0<mn.length&&(n=mn[0],n.blockedOn===null);)Wf(n),n.blockedOn===null&&mn.shift()}var Us=on.ReactCurrentBatchConfig,$o=!0;function yy(t,e,n,s){var r=ce,i=Us.transition;Us.transition=null;try{ce=1,Gc(t,e,n,s)}finally{ce=r,Us.transition=i}}function vy(t,e,n,s){var r=ce,i=Us.transition;Us.transition=null;try{ce=4,Gc(t,e,n,s)}finally{ce=r,Us.transition=i}}function Gc(t,e,n,s){if($o){var r=Zl(t,e,n,s);if(r===null)hl(t,e,s,Fo,n),Dd(t,s);else if(gy(r,t,e,n,s))s.stopPropagation();else if(Dd(t,s),e&4&&-1<py.indexOf(t)){for(;r!==null;){var i=vi(r);if(i!==null&&Ff(i),i=Zl(t,e,n,s),i===null&&hl(t,e,s,Fo,n),i===r)break;r=i}r!==null&&s.stopPropagation()}else hl(t,e,s,null,n)}}var Fo=null;function Zl(t,e,n,s){if(Fo=null,t=Wc(s),t=Bn(t),t!==null)if(e=ss(t),e===null)t=null;else if(n=e.tag,n===13){if(t=_f(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Fo=t,null}function Xf(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(oy()){case Xc:return 1;case Df:return 4;case Ro:case ay:return 16;case Rf:return 536870912;default:return 16}default:return 16}}var gn=null,qc=null,bo=null;function Uf(){if(bo)return bo;var t,e=qc,n=e.length,s,r="value"in gn?gn.value:gn.textContent,i=r.length;for(t=0;t<n&&e[t]===r[t];t++);var a=n-t;for(s=1;s<=a&&e[n-s]===r[i-s];s++);return bo=r.slice(t,1<s?1-s:void 0)}function ko(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function eo(){return!0}function Od(){return!1}function xt(t){function e(n,s,r,i,a){this._reactName=n,this._targetInst=r,this.type=s,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?eo:Od,this.isPropagationStopped=Od,this}return be(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=eo)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=eo)},persist:function(){},isPersistent:eo}),e}var sr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Kc=xt(sr),yi=be({},sr,{view:0,detail:0}),wy=xt(yi),sl,rl,Pr,aa=be({},yi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Qc,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Pr&&(Pr&&t.type==="mousemove"?(sl=t.screenX-Pr.screenX,rl=t.screenY-Pr.screenY):rl=sl=0,Pr=t),sl)},movementY:function(t){return"movementY"in t?t.movementY:rl}}),$d=xt(aa),by=be({},aa,{dataTransfer:0}),ky=xt(by),Sy=be({},yi,{relatedTarget:0}),il=xt(Sy),jy=be({},sr,{animationName:0,elapsedTime:0,pseudoElement:0}),Ny=xt(jy),Cy=be({},sr,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Ty=xt(Cy),My=be({},sr,{data:0}),Fd=xt(My),Ey={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Py={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ly={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function _y(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Ly[t])?!!e[t]:!1}function Qc(){return _y}var Iy=be({},yi,{key:function(t){if(t.key){var e=Ey[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=ko(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Py[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Qc,charCode:function(t){return t.type==="keypress"?ko(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?ko(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),zy=xt(Iy),Ay=be({},aa,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Hd=xt(Ay),Dy=be({},yi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Qc}),Ry=xt(Dy),Oy=be({},sr,{propertyName:0,elapsedTime:0,pseudoElement:0}),$y=xt(Oy),Fy=be({},aa,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Hy=xt(Fy),By=[9,13,27,32],Zc=tn&&"CompositionEvent"in window,Wr=null;tn&&"documentMode"in document&&(Wr=document.documentMode);var Yy=tn&&"TextEvent"in window&&!Wr,Vf=tn&&(!Zc||Wr&&8<Wr&&11>=Wr),Bd=" ",Yd=!1;function Gf(t,e){switch(t){case"keyup":return By.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function qf(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Is=!1;function Wy(t,e){switch(t){case"compositionend":return qf(e);case"keypress":return e.which!==32?null:(Yd=!0,Bd);case"textInput":return t=e.data,t===Bd&&Yd?null:t;default:return null}}function Xy(t,e){if(Is)return t==="compositionend"||!Zc&&Gf(t,e)?(t=Uf(),bo=qc=gn=null,Is=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Vf&&e.locale!=="ko"?null:e.data;default:return null}}var Uy={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Wd(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!Uy[t.type]:e==="textarea"}function Kf(t,e,n,s){Tf(s),e=Ho(e,"onChange"),0<e.length&&(n=new Kc("onChange","change",null,n,s),t.push({event:n,listeners:e}))}var Xr=null,ri=null;function Vy(t){am(t,0)}function la(t){var e=Ds(t);if(wf(e))return t}function Gy(t,e){if(t==="change")return e}var Qf=!1;if(tn){var ol;if(tn){var al="oninput"in document;if(!al){var Xd=document.createElement("div");Xd.setAttribute("oninput","return;"),al=typeof Xd.oninput=="function"}ol=al}else ol=!1;Qf=ol&&(!document.documentMode||9<document.documentMode)}function Ud(){Xr&&(Xr.detachEvent("onpropertychange",Zf),ri=Xr=null)}function Zf(t){if(t.propertyName==="value"&&la(ri)){var e=[];Kf(e,ri,t,Wc(t)),Lf(Vy,e)}}function qy(t,e,n){t==="focusin"?(Ud(),Xr=e,ri=n,Xr.attachEvent("onpropertychange",Zf)):t==="focusout"&&Ud()}function Ky(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return la(ri)}function Qy(t,e){if(t==="click")return la(e)}function Zy(t,e){if(t==="input"||t==="change")return la(e)}function Jy(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var zt=typeof Object.is=="function"?Object.is:Jy;function ii(t,e){if(zt(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),s=Object.keys(e);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var r=n[s];if(!zl.call(e,r)||!zt(t[r],e[r]))return!1}return!0}function Vd(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Gd(t,e){var n=Vd(t);t=0;for(var s;n;){if(n.nodeType===3){if(s=t+n.textContent.length,t<=e&&s>=e)return{node:n,offset:e-t};t=s}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Vd(n)}}function Jf(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Jf(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function em(){for(var t=window,e=zo();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=zo(t.document)}return e}function Jc(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function ev(t){var e=em(),n=t.focusedElem,s=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&Jf(n.ownerDocument.documentElement,n)){if(s!==null&&Jc(n)){if(e=s.start,t=s.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,i=Math.min(s.start,r);s=s.end===void 0?i:Math.min(s.end,r),!t.extend&&i>s&&(r=s,s=i,i=r),r=Gd(n,i);var a=Gd(n,s);r&&a&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==a.node||t.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),i>s?(t.addRange(e),t.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var tv=tn&&"documentMode"in document&&11>=document.documentMode,zs=null,Jl=null,Ur=null,ec=!1;function qd(t,e,n){var s=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;ec||zs==null||zs!==zo(s)||(s=zs,"selectionStart"in s&&Jc(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),Ur&&ii(Ur,s)||(Ur=s,s=Ho(Jl,"onSelect"),0<s.length&&(e=new Kc("onSelect","select",null,e,n),t.push({event:e,listeners:s}),e.target=zs)))}function to(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var As={animationend:to("Animation","AnimationEnd"),animationiteration:to("Animation","AnimationIteration"),animationstart:to("Animation","AnimationStart"),transitionend:to("Transition","TransitionEnd")},ll={},tm={};tn&&(tm=document.createElement("div").style,"AnimationEvent"in window||(delete As.animationend.animation,delete As.animationiteration.animation,delete As.animationstart.animation),"TransitionEvent"in window||delete As.transitionend.transition);function ca(t){if(ll[t])return ll[t];if(!As[t])return t;var e=As[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in tm)return ll[t]=e[n];return t}var nm=ca("animationend"),sm=ca("animationiteration"),rm=ca("animationstart"),im=ca("transitionend"),om=new Map,Kd="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Mn(t,e){om.set(t,e),ns(e,[t])}for(var cl=0;cl<Kd.length;cl++){var ul=Kd[cl],nv=ul.toLowerCase(),sv=ul[0].toUpperCase()+ul.slice(1);Mn(nv,"on"+sv)}Mn(nm,"onAnimationEnd");Mn(sm,"onAnimationIteration");Mn(rm,"onAnimationStart");Mn("dblclick","onDoubleClick");Mn("focusin","onFocus");Mn("focusout","onBlur");Mn(im,"onTransitionEnd");qs("onMouseEnter",["mouseout","mouseover"]);qs("onMouseLeave",["mouseout","mouseover"]);qs("onPointerEnter",["pointerout","pointerover"]);qs("onPointerLeave",["pointerout","pointerover"]);ns("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ns("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ns("onBeforeInput",["compositionend","keypress","textInput","paste"]);ns("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ns("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ns("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Hr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),rv=new Set("cancel close invalid load scroll toggle".split(" ").concat(Hr));function Qd(t,e,n){var s=t.type||"unknown-event";t.currentTarget=n,ny(s,e,void 0,t),t.currentTarget=null}function am(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var s=t[n],r=s.event;s=s.listeners;e:{var i=void 0;if(e)for(var a=s.length-1;0<=a;a--){var l=s[a],c=l.instance,u=l.currentTarget;if(l=l.listener,c!==i&&r.isPropagationStopped())break e;Qd(r,l,u),i=c}else for(a=0;a<s.length;a++){if(l=s[a],c=l.instance,u=l.currentTarget,l=l.listener,c!==i&&r.isPropagationStopped())break e;Qd(r,l,u),i=c}}}if(Do)throw t=ql,Do=!1,ql=null,t}function me(t,e){var n=e[ic];n===void 0&&(n=e[ic]=new Set);var s=t+"__bubble";n.has(s)||(lm(e,t,2,!1),n.add(s))}function dl(t,e,n){var s=0;e&&(s|=4),lm(n,t,s,e)}var no="_reactListening"+Math.random().toString(36).slice(2);function oi(t){if(!t[no]){t[no]=!0,pf.forEach(function(n){n!=="selectionchange"&&(rv.has(n)||dl(n,!1,t),dl(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[no]||(e[no]=!0,dl("selectionchange",!1,e))}}function lm(t,e,n,s){switch(Xf(e)){case 1:var r=yy;break;case 4:r=vy;break;default:r=Gc}n=r.bind(null,e,n,t),r=void 0,!Gl||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),s?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function hl(t,e,n,s,r){var i=s;if(!(e&1)&&!(e&2)&&s!==null)e:for(;;){if(s===null)return;var a=s.tag;if(a===3||a===4){var l=s.stateNode.containerInfo;if(l===r||l.nodeType===8&&l.parentNode===r)break;if(a===4)for(a=s.return;a!==null;){var c=a.tag;if((c===3||c===4)&&(c=a.stateNode.containerInfo,c===r||c.nodeType===8&&c.parentNode===r))return;a=a.return}for(;l!==null;){if(a=Bn(l),a===null)return;if(c=a.tag,c===5||c===6){s=i=a;continue e}l=l.parentNode}}s=s.return}Lf(function(){var u=i,f=Wc(n),h=[];e:{var p=om.get(t);if(p!==void 0){var b=Kc,y=t;switch(t){case"keypress":if(ko(n)===0)break e;case"keydown":case"keyup":b=zy;break;case"focusin":y="focus",b=il;break;case"focusout":y="blur",b=il;break;case"beforeblur":case"afterblur":b=il;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":b=$d;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":b=ky;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":b=Ry;break;case nm:case sm:case rm:b=Ny;break;case im:b=$y;break;case"scroll":b=wy;break;case"wheel":b=Hy;break;case"copy":case"cut":case"paste":b=Ty;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":b=Hd}var S=(e&4)!==0,j=!S&&t==="scroll",v=S?p!==null?p+"Capture":null:p;S=[];for(var g=u,x;g!==null;){x=g;var w=x.stateNode;if(x.tag===5&&w!==null&&(x=w,v!==null&&(w=ei(g,v),w!=null&&S.push(ai(g,w,x)))),j)break;g=g.return}0<S.length&&(p=new b(p,y,null,n,f),h.push({event:p,listeners:S}))}}if(!(e&7)){e:{if(p=t==="mouseover"||t==="pointerover",b=t==="mouseout"||t==="pointerout",p&&n!==Ul&&(y=n.relatedTarget||n.fromElement)&&(Bn(y)||y[nn]))break e;if((b||p)&&(p=f.window===f?f:(p=f.ownerDocument)?p.defaultView||p.parentWindow:window,b?(y=n.relatedTarget||n.toElement,b=u,y=y?Bn(y):null,y!==null&&(j=ss(y),y!==j||y.tag!==5&&y.tag!==6)&&(y=null)):(b=null,y=u),b!==y)){if(S=$d,w="onMouseLeave",v="onMouseEnter",g="mouse",(t==="pointerout"||t==="pointerover")&&(S=Hd,w="onPointerLeave",v="onPointerEnter",g="pointer"),j=b==null?p:Ds(b),x=y==null?p:Ds(y),p=new S(w,g+"leave",b,n,f),p.target=j,p.relatedTarget=x,w=null,Bn(f)===u&&(S=new S(v,g+"enter",y,n,f),S.target=x,S.relatedTarget=j,w=S),j=w,b&&y)t:{for(S=b,v=y,g=0,x=S;x;x=Ss(x))g++;for(x=0,w=v;w;w=Ss(w))x++;for(;0<g-x;)S=Ss(S),g--;for(;0<x-g;)v=Ss(v),x--;for(;g--;){if(S===v||v!==null&&S===v.alternate)break t;S=Ss(S),v=Ss(v)}S=null}else S=null;b!==null&&Zd(h,p,b,S,!1),y!==null&&j!==null&&Zd(h,j,y,S,!0)}}e:{if(p=u?Ds(u):window,b=p.nodeName&&p.nodeName.toLowerCase(),b==="select"||b==="input"&&p.type==="file")var N=Gy;else if(Wd(p))if(Qf)N=Zy;else{N=Ky;var T=qy}else(b=p.nodeName)&&b.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(N=Qy);if(N&&(N=N(t,u))){Kf(h,N,n,f);break e}T&&T(t,p,u),t==="focusout"&&(T=p._wrapperState)&&T.controlled&&p.type==="number"&&Hl(p,"number",p.value)}switch(T=u?Ds(u):window,t){case"focusin":(Wd(T)||T.contentEditable==="true")&&(zs=T,Jl=u,Ur=null);break;case"focusout":Ur=Jl=zs=null;break;case"mousedown":ec=!0;break;case"contextmenu":case"mouseup":case"dragend":ec=!1,qd(h,n,f);break;case"selectionchange":if(tv)break;case"keydown":case"keyup":qd(h,n,f)}var P;if(Zc)e:{switch(t){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else Is?Gf(t,n)&&(E="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(E="onCompositionStart");E&&(Vf&&n.locale!=="ko"&&(Is||E!=="onCompositionStart"?E==="onCompositionEnd"&&Is&&(P=Uf()):(gn=f,qc="value"in gn?gn.value:gn.textContent,Is=!0)),T=Ho(u,E),0<T.length&&(E=new Fd(E,t,null,n,f),h.push({event:E,listeners:T}),P?E.data=P:(P=qf(n),P!==null&&(E.data=P)))),(P=Yy?Wy(t,n):Xy(t,n))&&(u=Ho(u,"onBeforeInput"),0<u.length&&(f=new Fd("onBeforeInput","beforeinput",null,n,f),h.push({event:f,listeners:u}),f.data=P))}am(h,e)})}function ai(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Ho(t,e){for(var n=e+"Capture",s=[];t!==null;){var r=t,i=r.stateNode;r.tag===5&&i!==null&&(r=i,i=ei(t,n),i!=null&&s.unshift(ai(t,i,r)),i=ei(t,e),i!=null&&s.push(ai(t,i,r))),t=t.return}return s}function Ss(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Zd(t,e,n,s,r){for(var i=e._reactName,a=[];n!==null&&n!==s;){var l=n,c=l.alternate,u=l.stateNode;if(c!==null&&c===s)break;l.tag===5&&u!==null&&(l=u,r?(c=ei(n,i),c!=null&&a.unshift(ai(n,c,l))):r||(c=ei(n,i),c!=null&&a.push(ai(n,c,l)))),n=n.return}a.length!==0&&t.push({event:e,listeners:a})}var iv=/\r\n?/g,ov=/\u0000|\uFFFD/g;function Jd(t){return(typeof t=="string"?t:""+t).replace(iv,`
`).replace(ov,"")}function so(t,e,n){if(e=Jd(e),Jd(t)!==e&&n)throw Error(L(425))}function Bo(){}var tc=null,nc=null;function sc(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var rc=typeof setTimeout=="function"?setTimeout:void 0,av=typeof clearTimeout=="function"?clearTimeout:void 0,eh=typeof Promise=="function"?Promise:void 0,lv=typeof queueMicrotask=="function"?queueMicrotask:typeof eh<"u"?function(t){return eh.resolve(null).then(t).catch(cv)}:rc;function cv(t){setTimeout(function(){throw t})}function fl(t,e){var n=e,s=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(s===0){t.removeChild(r),si(e);return}s--}else n!=="$"&&n!=="$?"&&n!=="$!"||s++;n=r}while(n);si(e)}function bn(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function th(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var rr=Math.random().toString(36).slice(2),Ht="__reactFiber$"+rr,li="__reactProps$"+rr,nn="__reactContainer$"+rr,ic="__reactEvents$"+rr,uv="__reactListeners$"+rr,dv="__reactHandles$"+rr;function Bn(t){var e=t[Ht];if(e)return e;for(var n=t.parentNode;n;){if(e=n[nn]||n[Ht]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=th(t);t!==null;){if(n=t[Ht])return n;t=th(t)}return e}t=n,n=t.parentNode}return null}function vi(t){return t=t[Ht]||t[nn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Ds(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(L(33))}function ua(t){return t[li]||null}var oc=[],Rs=-1;function En(t){return{current:t}}function pe(t){0>Rs||(t.current=oc[Rs],oc[Rs]=null,Rs--)}function de(t,e){Rs++,oc[Rs]=t.current,t.current=e}var Tn={},Be=En(Tn),it=En(!1),Gn=Tn;function Ks(t,e){var n=t.type.contextTypes;if(!n)return Tn;var s=t.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===e)return s.__reactInternalMemoizedMaskedChildContext;var r={},i;for(i in n)r[i]=e[i];return s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function ot(t){return t=t.childContextTypes,t!=null}function Yo(){pe(it),pe(Be)}function nh(t,e,n){if(Be.current!==Tn)throw Error(L(168));de(Be,e),de(it,n)}function cm(t,e,n){var s=t.stateNode;if(e=e.childContextTypes,typeof s.getChildContext!="function")return n;s=s.getChildContext();for(var r in s)if(!(r in e))throw Error(L(108,qx(t)||"Unknown",r));return be({},n,s)}function Wo(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Tn,Gn=Be.current,de(Be,t),de(it,it.current),!0}function sh(t,e,n){var s=t.stateNode;if(!s)throw Error(L(169));n?(t=cm(t,e,Gn),s.__reactInternalMemoizedMergedChildContext=t,pe(it),pe(Be),de(Be,t)):pe(it),de(it,n)}var Qt=null,da=!1,ml=!1;function um(t){Qt===null?Qt=[t]:Qt.push(t)}function hv(t){da=!0,um(t)}function Pn(){if(!ml&&Qt!==null){ml=!0;var t=0,e=ce;try{var n=Qt;for(ce=1;t<n.length;t++){var s=n[t];do s=s(!0);while(s!==null)}Qt=null,da=!1}catch(r){throw Qt!==null&&(Qt=Qt.slice(t+1)),Af(Xc,Pn),r}finally{ce=e,ml=!1}}return null}var Os=[],$s=0,Xo=null,Uo=0,vt=[],wt=0,qn=null,Zt=1,Jt="";function $n(t,e){Os[$s++]=Uo,Os[$s++]=Xo,Xo=t,Uo=e}function dm(t,e,n){vt[wt++]=Zt,vt[wt++]=Jt,vt[wt++]=qn,qn=t;var s=Zt;t=Jt;var r=32-_t(s)-1;s&=~(1<<r),n+=1;var i=32-_t(e)+r;if(30<i){var a=r-r%5;i=(s&(1<<a)-1).toString(32),s>>=a,r-=a,Zt=1<<32-_t(e)+r|n<<r|s,Jt=i+t}else Zt=1<<i|n<<r|s,Jt=t}function eu(t){t.return!==null&&($n(t,1),dm(t,1,0))}function tu(t){for(;t===Xo;)Xo=Os[--$s],Os[$s]=null,Uo=Os[--$s],Os[$s]=null;for(;t===qn;)qn=vt[--wt],vt[wt]=null,Jt=vt[--wt],vt[wt]=null,Zt=vt[--wt],vt[wt]=null}var mt=null,ft=null,ge=!1,Lt=null;function hm(t,e){var n=bt(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function rh(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,mt=t,ft=bn(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,mt=t,ft=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=qn!==null?{id:Zt,overflow:Jt}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=bt(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,mt=t,ft=null,!0):!1;default:return!1}}function ac(t){return(t.mode&1)!==0&&(t.flags&128)===0}function lc(t){if(ge){var e=ft;if(e){var n=e;if(!rh(t,e)){if(ac(t))throw Error(L(418));e=bn(n.nextSibling);var s=mt;e&&rh(t,e)?hm(s,n):(t.flags=t.flags&-4097|2,ge=!1,mt=t)}}else{if(ac(t))throw Error(L(418));t.flags=t.flags&-4097|2,ge=!1,mt=t}}}function ih(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;mt=t}function ro(t){if(t!==mt)return!1;if(!ge)return ih(t),ge=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!sc(t.type,t.memoizedProps)),e&&(e=ft)){if(ac(t))throw fm(),Error(L(418));for(;e;)hm(t,e),e=bn(e.nextSibling)}if(ih(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(L(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){ft=bn(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}ft=null}}else ft=mt?bn(t.stateNode.nextSibling):null;return!0}function fm(){for(var t=ft;t;)t=bn(t.nextSibling)}function Qs(){ft=mt=null,ge=!1}function nu(t){Lt===null?Lt=[t]:Lt.push(t)}var fv=on.ReactCurrentBatchConfig;function Lr(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(L(309));var s=n.stateNode}if(!s)throw Error(L(147,t));var r=s,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(a){var l=r.refs;a===null?delete l[i]:l[i]=a},e._stringRef=i,e)}if(typeof t!="string")throw Error(L(284));if(!n._owner)throw Error(L(290,t))}return t}function io(t,e){throw t=Object.prototype.toString.call(e),Error(L(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function oh(t){var e=t._init;return e(t._payload)}function mm(t){function e(v,g){if(t){var x=v.deletions;x===null?(v.deletions=[g],v.flags|=16):x.push(g)}}function n(v,g){if(!t)return null;for(;g!==null;)e(v,g),g=g.sibling;return null}function s(v,g){for(v=new Map;g!==null;)g.key!==null?v.set(g.key,g):v.set(g.index,g),g=g.sibling;return v}function r(v,g){return v=Nn(v,g),v.index=0,v.sibling=null,v}function i(v,g,x){return v.index=x,t?(x=v.alternate,x!==null?(x=x.index,x<g?(v.flags|=2,g):x):(v.flags|=2,g)):(v.flags|=1048576,g)}function a(v){return t&&v.alternate===null&&(v.flags|=2),v}function l(v,g,x,w){return g===null||g.tag!==6?(g=bl(x,v.mode,w),g.return=v,g):(g=r(g,x),g.return=v,g)}function c(v,g,x,w){var N=x.type;return N===_s?f(v,g,x.props.children,w,x.key):g!==null&&(g.elementType===N||typeof N=="object"&&N!==null&&N.$$typeof===hn&&oh(N)===g.type)?(w=r(g,x.props),w.ref=Lr(v,g,x),w.return=v,w):(w=Eo(x.type,x.key,x.props,null,v.mode,w),w.ref=Lr(v,g,x),w.return=v,w)}function u(v,g,x,w){return g===null||g.tag!==4||g.stateNode.containerInfo!==x.containerInfo||g.stateNode.implementation!==x.implementation?(g=kl(x,v.mode,w),g.return=v,g):(g=r(g,x.children||[]),g.return=v,g)}function f(v,g,x,w,N){return g===null||g.tag!==7?(g=Vn(x,v.mode,w,N),g.return=v,g):(g=r(g,x),g.return=v,g)}function h(v,g,x){if(typeof g=="string"&&g!==""||typeof g=="number")return g=bl(""+g,v.mode,x),g.return=v,g;if(typeof g=="object"&&g!==null){switch(g.$$typeof){case Gi:return x=Eo(g.type,g.key,g.props,null,v.mode,x),x.ref=Lr(v,null,g),x.return=v,x;case Ls:return g=kl(g,v.mode,x),g.return=v,g;case hn:var w=g._init;return h(v,w(g._payload),x)}if($r(g)||Cr(g))return g=Vn(g,v.mode,x,null),g.return=v,g;io(v,g)}return null}function p(v,g,x,w){var N=g!==null?g.key:null;if(typeof x=="string"&&x!==""||typeof x=="number")return N!==null?null:l(v,g,""+x,w);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Gi:return x.key===N?c(v,g,x,w):null;case Ls:return x.key===N?u(v,g,x,w):null;case hn:return N=x._init,p(v,g,N(x._payload),w)}if($r(x)||Cr(x))return N!==null?null:f(v,g,x,w,null);io(v,x)}return null}function b(v,g,x,w,N){if(typeof w=="string"&&w!==""||typeof w=="number")return v=v.get(x)||null,l(g,v,""+w,N);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case Gi:return v=v.get(w.key===null?x:w.key)||null,c(g,v,w,N);case Ls:return v=v.get(w.key===null?x:w.key)||null,u(g,v,w,N);case hn:var T=w._init;return b(v,g,x,T(w._payload),N)}if($r(w)||Cr(w))return v=v.get(x)||null,f(g,v,w,N,null);io(g,w)}return null}function y(v,g,x,w){for(var N=null,T=null,P=g,E=g=0,$=null;P!==null&&E<x.length;E++){P.index>E?($=P,P=null):$=P.sibling;var D=p(v,P,x[E],w);if(D===null){P===null&&(P=$);break}t&&P&&D.alternate===null&&e(v,P),g=i(D,g,E),T===null?N=D:T.sibling=D,T=D,P=$}if(E===x.length)return n(v,P),ge&&$n(v,E),N;if(P===null){for(;E<x.length;E++)P=h(v,x[E],w),P!==null&&(g=i(P,g,E),T===null?N=P:T.sibling=P,T=P);return ge&&$n(v,E),N}for(P=s(v,P);E<x.length;E++)$=b(P,v,E,x[E],w),$!==null&&(t&&$.alternate!==null&&P.delete($.key===null?E:$.key),g=i($,g,E),T===null?N=$:T.sibling=$,T=$);return t&&P.forEach(function(G){return e(v,G)}),ge&&$n(v,E),N}function S(v,g,x,w){var N=Cr(x);if(typeof N!="function")throw Error(L(150));if(x=N.call(x),x==null)throw Error(L(151));for(var T=N=null,P=g,E=g=0,$=null,D=x.next();P!==null&&!D.done;E++,D=x.next()){P.index>E?($=P,P=null):$=P.sibling;var G=p(v,P,D.value,w);if(G===null){P===null&&(P=$);break}t&&P&&G.alternate===null&&e(v,P),g=i(G,g,E),T===null?N=G:T.sibling=G,T=G,P=$}if(D.done)return n(v,P),ge&&$n(v,E),N;if(P===null){for(;!D.done;E++,D=x.next())D=h(v,D.value,w),D!==null&&(g=i(D,g,E),T===null?N=D:T.sibling=D,T=D);return ge&&$n(v,E),N}for(P=s(v,P);!D.done;E++,D=x.next())D=b(P,v,E,D.value,w),D!==null&&(t&&D.alternate!==null&&P.delete(D.key===null?E:D.key),g=i(D,g,E),T===null?N=D:T.sibling=D,T=D);return t&&P.forEach(function(q){return e(v,q)}),ge&&$n(v,E),N}function j(v,g,x,w){if(typeof x=="object"&&x!==null&&x.type===_s&&x.key===null&&(x=x.props.children),typeof x=="object"&&x!==null){switch(x.$$typeof){case Gi:e:{for(var N=x.key,T=g;T!==null;){if(T.key===N){if(N=x.type,N===_s){if(T.tag===7){n(v,T.sibling),g=r(T,x.props.children),g.return=v,v=g;break e}}else if(T.elementType===N||typeof N=="object"&&N!==null&&N.$$typeof===hn&&oh(N)===T.type){n(v,T.sibling),g=r(T,x.props),g.ref=Lr(v,T,x),g.return=v,v=g;break e}n(v,T);break}else e(v,T);T=T.sibling}x.type===_s?(g=Vn(x.props.children,v.mode,w,x.key),g.return=v,v=g):(w=Eo(x.type,x.key,x.props,null,v.mode,w),w.ref=Lr(v,g,x),w.return=v,v=w)}return a(v);case Ls:e:{for(T=x.key;g!==null;){if(g.key===T)if(g.tag===4&&g.stateNode.containerInfo===x.containerInfo&&g.stateNode.implementation===x.implementation){n(v,g.sibling),g=r(g,x.children||[]),g.return=v,v=g;break e}else{n(v,g);break}else e(v,g);g=g.sibling}g=kl(x,v.mode,w),g.return=v,v=g}return a(v);case hn:return T=x._init,j(v,g,T(x._payload),w)}if($r(x))return y(v,g,x,w);if(Cr(x))return S(v,g,x,w);io(v,x)}return typeof x=="string"&&x!==""||typeof x=="number"?(x=""+x,g!==null&&g.tag===6?(n(v,g.sibling),g=r(g,x),g.return=v,v=g):(n(v,g),g=bl(x,v.mode,w),g.return=v,v=g),a(v)):n(v,g)}return j}var Zs=mm(!0),pm=mm(!1),Vo=En(null),Go=null,Fs=null,su=null;function ru(){su=Fs=Go=null}function iu(t){var e=Vo.current;pe(Vo),t._currentValue=e}function cc(t,e,n){for(;t!==null;){var s=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,s!==null&&(s.childLanes|=e)):s!==null&&(s.childLanes&e)!==e&&(s.childLanes|=e),t===n)break;t=t.return}}function Vs(t,e){Go=t,su=Fs=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(rt=!0),t.firstContext=null)}function St(t){var e=t._currentValue;if(su!==t)if(t={context:t,memoizedValue:e,next:null},Fs===null){if(Go===null)throw Error(L(308));Fs=t,Go.dependencies={lanes:0,firstContext:t}}else Fs=Fs.next=t;return e}var Yn=null;function ou(t){Yn===null?Yn=[t]:Yn.push(t)}function gm(t,e,n,s){var r=e.interleaved;return r===null?(n.next=n,ou(e)):(n.next=r.next,r.next=n),e.interleaved=n,sn(t,s)}function sn(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var fn=!1;function au(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function xm(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function en(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function kn(t,e,n){var s=t.updateQueue;if(s===null)return null;if(s=s.shared,se&2){var r=s.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),s.pending=e,sn(t,n)}return r=s.interleaved,r===null?(e.next=e,ou(s)):(e.next=r.next,r.next=e),s.interleaved=e,sn(t,n)}function So(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var s=e.lanes;s&=t.pendingLanes,n|=s,e.lanes=n,Uc(t,n)}}function ah(t,e){var n=t.updateQueue,s=t.alternate;if(s!==null&&(s=s.updateQueue,n===s)){var r=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?r=i=a:i=i.next=a,n=n.next}while(n!==null);i===null?r=i=e:i=i.next=e}else r=i=e;n={baseState:s.baseState,firstBaseUpdate:r,lastBaseUpdate:i,shared:s.shared,effects:s.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function qo(t,e,n,s){var r=t.updateQueue;fn=!1;var i=r.firstBaseUpdate,a=r.lastBaseUpdate,l=r.shared.pending;if(l!==null){r.shared.pending=null;var c=l,u=c.next;c.next=null,a===null?i=u:a.next=u,a=c;var f=t.alternate;f!==null&&(f=f.updateQueue,l=f.lastBaseUpdate,l!==a&&(l===null?f.firstBaseUpdate=u:l.next=u,f.lastBaseUpdate=c))}if(i!==null){var h=r.baseState;a=0,f=u=c=null,l=i;do{var p=l.lane,b=l.eventTime;if((s&p)===p){f!==null&&(f=f.next={eventTime:b,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var y=t,S=l;switch(p=e,b=n,S.tag){case 1:if(y=S.payload,typeof y=="function"){h=y.call(b,h,p);break e}h=y;break e;case 3:y.flags=y.flags&-65537|128;case 0:if(y=S.payload,p=typeof y=="function"?y.call(b,h,p):y,p==null)break e;h=be({},h,p);break e;case 2:fn=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,p=r.effects,p===null?r.effects=[l]:p.push(l))}else b={eventTime:b,lane:p,tag:l.tag,payload:l.payload,callback:l.callback,next:null},f===null?(u=f=b,c=h):f=f.next=b,a|=p;if(l=l.next,l===null){if(l=r.shared.pending,l===null)break;p=l,l=p.next,p.next=null,r.lastBaseUpdate=p,r.shared.pending=null}}while(!0);if(f===null&&(c=h),r.baseState=c,r.firstBaseUpdate=u,r.lastBaseUpdate=f,e=r.shared.interleaved,e!==null){r=e;do a|=r.lane,r=r.next;while(r!==e)}else i===null&&(r.shared.lanes=0);Qn|=a,t.lanes=a,t.memoizedState=h}}function lh(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var s=t[e],r=s.callback;if(r!==null){if(s.callback=null,s=n,typeof r!="function")throw Error(L(191,r));r.call(s)}}}var wi={},Yt=En(wi),ci=En(wi),ui=En(wi);function Wn(t){if(t===wi)throw Error(L(174));return t}function lu(t,e){switch(de(ui,e),de(ci,t),de(Yt,wi),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Yl(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Yl(e,t)}pe(Yt),de(Yt,e)}function Js(){pe(Yt),pe(ci),pe(ui)}function ym(t){Wn(ui.current);var e=Wn(Yt.current),n=Yl(e,t.type);e!==n&&(de(ci,t),de(Yt,n))}function cu(t){ci.current===t&&(pe(Yt),pe(ci))}var ve=En(0);function Ko(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var pl=[];function uu(){for(var t=0;t<pl.length;t++)pl[t]._workInProgressVersionPrimary=null;pl.length=0}var jo=on.ReactCurrentDispatcher,gl=on.ReactCurrentBatchConfig,Kn=0,we=null,Le=null,Ie=null,Qo=!1,Vr=!1,di=0,mv=0;function $e(){throw Error(L(321))}function du(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!zt(t[n],e[n]))return!1;return!0}function hu(t,e,n,s,r,i){if(Kn=i,we=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,jo.current=t===null||t.memoizedState===null?yv:vv,t=n(s,r),Vr){i=0;do{if(Vr=!1,di=0,25<=i)throw Error(L(301));i+=1,Ie=Le=null,e.updateQueue=null,jo.current=wv,t=n(s,r)}while(Vr)}if(jo.current=Zo,e=Le!==null&&Le.next!==null,Kn=0,Ie=Le=we=null,Qo=!1,e)throw Error(L(300));return t}function fu(){var t=di!==0;return di=0,t}function Ft(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ie===null?we.memoizedState=Ie=t:Ie=Ie.next=t,Ie}function jt(){if(Le===null){var t=we.alternate;t=t!==null?t.memoizedState:null}else t=Le.next;var e=Ie===null?we.memoizedState:Ie.next;if(e!==null)Ie=e,Le=t;else{if(t===null)throw Error(L(310));Le=t,t={memoizedState:Le.memoizedState,baseState:Le.baseState,baseQueue:Le.baseQueue,queue:Le.queue,next:null},Ie===null?we.memoizedState=Ie=t:Ie=Ie.next=t}return Ie}function hi(t,e){return typeof e=="function"?e(t):e}function xl(t){var e=jt(),n=e.queue;if(n===null)throw Error(L(311));n.lastRenderedReducer=t;var s=Le,r=s.baseQueue,i=n.pending;if(i!==null){if(r!==null){var a=r.next;r.next=i.next,i.next=a}s.baseQueue=r=i,n.pending=null}if(r!==null){i=r.next,s=s.baseState;var l=a=null,c=null,u=i;do{var f=u.lane;if((Kn&f)===f)c!==null&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),s=u.hasEagerState?u.eagerState:t(s,u.action);else{var h={lane:f,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};c===null?(l=c=h,a=s):c=c.next=h,we.lanes|=f,Qn|=f}u=u.next}while(u!==null&&u!==i);c===null?a=s:c.next=l,zt(s,e.memoizedState)||(rt=!0),e.memoizedState=s,e.baseState=a,e.baseQueue=c,n.lastRenderedState=s}if(t=n.interleaved,t!==null){r=t;do i=r.lane,we.lanes|=i,Qn|=i,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function yl(t){var e=jt(),n=e.queue;if(n===null)throw Error(L(311));n.lastRenderedReducer=t;var s=n.dispatch,r=n.pending,i=e.memoizedState;if(r!==null){n.pending=null;var a=r=r.next;do i=t(i,a.action),a=a.next;while(a!==r);zt(i,e.memoizedState)||(rt=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,s]}function vm(){}function wm(t,e){var n=we,s=jt(),r=e(),i=!zt(s.memoizedState,r);if(i&&(s.memoizedState=r,rt=!0),s=s.queue,mu(Sm.bind(null,n,s,t),[t]),s.getSnapshot!==e||i||Ie!==null&&Ie.memoizedState.tag&1){if(n.flags|=2048,fi(9,km.bind(null,n,s,r,e),void 0,null),ze===null)throw Error(L(349));Kn&30||bm(n,e,r)}return r}function bm(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=we.updateQueue,e===null?(e={lastEffect:null,stores:null},we.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function km(t,e,n,s){e.value=n,e.getSnapshot=s,jm(e)&&Nm(t)}function Sm(t,e,n){return n(function(){jm(e)&&Nm(t)})}function jm(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!zt(t,n)}catch{return!0}}function Nm(t){var e=sn(t,1);e!==null&&It(e,t,1,-1)}function ch(t){var e=Ft();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:hi,lastRenderedState:t},e.queue=t,t=t.dispatch=xv.bind(null,we,t),[e.memoizedState,t]}function fi(t,e,n,s){return t={tag:t,create:e,destroy:n,deps:s,next:null},e=we.updateQueue,e===null?(e={lastEffect:null,stores:null},we.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(s=n.next,n.next=t,t.next=s,e.lastEffect=t)),t}function Cm(){return jt().memoizedState}function No(t,e,n,s){var r=Ft();we.flags|=t,r.memoizedState=fi(1|e,n,void 0,s===void 0?null:s)}function ha(t,e,n,s){var r=jt();s=s===void 0?null:s;var i=void 0;if(Le!==null){var a=Le.memoizedState;if(i=a.destroy,s!==null&&du(s,a.deps)){r.memoizedState=fi(e,n,i,s);return}}we.flags|=t,r.memoizedState=fi(1|e,n,i,s)}function uh(t,e){return No(8390656,8,t,e)}function mu(t,e){return ha(2048,8,t,e)}function Tm(t,e){return ha(4,2,t,e)}function Mm(t,e){return ha(4,4,t,e)}function Em(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Pm(t,e,n){return n=n!=null?n.concat([t]):null,ha(4,4,Em.bind(null,e,t),n)}function pu(){}function Lm(t,e){var n=jt();e=e===void 0?null:e;var s=n.memoizedState;return s!==null&&e!==null&&du(e,s[1])?s[0]:(n.memoizedState=[t,e],t)}function _m(t,e){var n=jt();e=e===void 0?null:e;var s=n.memoizedState;return s!==null&&e!==null&&du(e,s[1])?s[0]:(t=t(),n.memoizedState=[t,e],t)}function Im(t,e,n){return Kn&21?(zt(n,e)||(n=Of(),we.lanes|=n,Qn|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,rt=!0),t.memoizedState=n)}function pv(t,e){var n=ce;ce=n!==0&&4>n?n:4,t(!0);var s=gl.transition;gl.transition={};try{t(!1),e()}finally{ce=n,gl.transition=s}}function zm(){return jt().memoizedState}function gv(t,e,n){var s=jn(t);if(n={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null},Am(t))Dm(e,n);else if(n=gm(t,e,n,s),n!==null){var r=Ge();It(n,t,s,r),Rm(n,e,s)}}function xv(t,e,n){var s=jn(t),r={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null};if(Am(t))Dm(e,r);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var a=e.lastRenderedState,l=i(a,n);if(r.hasEagerState=!0,r.eagerState=l,zt(l,a)){var c=e.interleaved;c===null?(r.next=r,ou(e)):(r.next=c.next,c.next=r),e.interleaved=r;return}}catch{}finally{}n=gm(t,e,r,s),n!==null&&(r=Ge(),It(n,t,s,r),Rm(n,e,s))}}function Am(t){var e=t.alternate;return t===we||e!==null&&e===we}function Dm(t,e){Vr=Qo=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function Rm(t,e,n){if(n&4194240){var s=e.lanes;s&=t.pendingLanes,n|=s,e.lanes=n,Uc(t,n)}}var Zo={readContext:St,useCallback:$e,useContext:$e,useEffect:$e,useImperativeHandle:$e,useInsertionEffect:$e,useLayoutEffect:$e,useMemo:$e,useReducer:$e,useRef:$e,useState:$e,useDebugValue:$e,useDeferredValue:$e,useTransition:$e,useMutableSource:$e,useSyncExternalStore:$e,useId:$e,unstable_isNewReconciler:!1},yv={readContext:St,useCallback:function(t,e){return Ft().memoizedState=[t,e===void 0?null:e],t},useContext:St,useEffect:uh,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,No(4194308,4,Em.bind(null,e,t),n)},useLayoutEffect:function(t,e){return No(4194308,4,t,e)},useInsertionEffect:function(t,e){return No(4,2,t,e)},useMemo:function(t,e){var n=Ft();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var s=Ft();return e=n!==void 0?n(e):e,s.memoizedState=s.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},s.queue=t,t=t.dispatch=gv.bind(null,we,t),[s.memoizedState,t]},useRef:function(t){var e=Ft();return t={current:t},e.memoizedState=t},useState:ch,useDebugValue:pu,useDeferredValue:function(t){return Ft().memoizedState=t},useTransition:function(){var t=ch(!1),e=t[0];return t=pv.bind(null,t[1]),Ft().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var s=we,r=Ft();if(ge){if(n===void 0)throw Error(L(407));n=n()}else{if(n=e(),ze===null)throw Error(L(349));Kn&30||bm(s,e,n)}r.memoizedState=n;var i={value:n,getSnapshot:e};return r.queue=i,uh(Sm.bind(null,s,i,t),[t]),s.flags|=2048,fi(9,km.bind(null,s,i,n,e),void 0,null),n},useId:function(){var t=Ft(),e=ze.identifierPrefix;if(ge){var n=Jt,s=Zt;n=(s&~(1<<32-_t(s)-1)).toString(32)+n,e=":"+e+"R"+n,n=di++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=mv++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},vv={readContext:St,useCallback:Lm,useContext:St,useEffect:mu,useImperativeHandle:Pm,useInsertionEffect:Tm,useLayoutEffect:Mm,useMemo:_m,useReducer:xl,useRef:Cm,useState:function(){return xl(hi)},useDebugValue:pu,useDeferredValue:function(t){var e=jt();return Im(e,Le.memoizedState,t)},useTransition:function(){var t=xl(hi)[0],e=jt().memoizedState;return[t,e]},useMutableSource:vm,useSyncExternalStore:wm,useId:zm,unstable_isNewReconciler:!1},wv={readContext:St,useCallback:Lm,useContext:St,useEffect:mu,useImperativeHandle:Pm,useInsertionEffect:Tm,useLayoutEffect:Mm,useMemo:_m,useReducer:yl,useRef:Cm,useState:function(){return yl(hi)},useDebugValue:pu,useDeferredValue:function(t){var e=jt();return Le===null?e.memoizedState=t:Im(e,Le.memoizedState,t)},useTransition:function(){var t=yl(hi)[0],e=jt().memoizedState;return[t,e]},useMutableSource:vm,useSyncExternalStore:wm,useId:zm,unstable_isNewReconciler:!1};function Et(t,e){if(t&&t.defaultProps){e=be({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function uc(t,e,n,s){e=t.memoizedState,n=n(s,e),n=n==null?e:be({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var fa={isMounted:function(t){return(t=t._reactInternals)?ss(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var s=Ge(),r=jn(t),i=en(s,r);i.payload=e,n!=null&&(i.callback=n),e=kn(t,i,r),e!==null&&(It(e,t,r,s),So(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var s=Ge(),r=jn(t),i=en(s,r);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=kn(t,i,r),e!==null&&(It(e,t,r,s),So(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Ge(),s=jn(t),r=en(n,s);r.tag=2,e!=null&&(r.callback=e),e=kn(t,r,s),e!==null&&(It(e,t,s,n),So(e,t,s))}};function dh(t,e,n,s,r,i,a){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(s,i,a):e.prototype&&e.prototype.isPureReactComponent?!ii(n,s)||!ii(r,i):!0}function Om(t,e,n){var s=!1,r=Tn,i=e.contextType;return typeof i=="object"&&i!==null?i=St(i):(r=ot(e)?Gn:Be.current,s=e.contextTypes,i=(s=s!=null)?Ks(t,r):Tn),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=fa,t.stateNode=e,e._reactInternals=t,s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=i),e}function hh(t,e,n,s){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,s),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,s),e.state!==t&&fa.enqueueReplaceState(e,e.state,null)}function dc(t,e,n,s){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs={},au(t);var i=e.contextType;typeof i=="object"&&i!==null?r.context=St(i):(i=ot(e)?Gn:Be.current,r.context=Ks(t,i)),r.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(uc(t,e,i,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&fa.enqueueReplaceState(r,r.state,null),qo(t,n,r,s),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function er(t,e){try{var n="",s=e;do n+=Gx(s),s=s.return;while(s);var r=n}catch(i){r=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:r,digest:null}}function vl(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function hc(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var bv=typeof WeakMap=="function"?WeakMap:Map;function $m(t,e,n){n=en(-1,n),n.tag=3,n.payload={element:null};var s=e.value;return n.callback=function(){ea||(ea=!0,kc=s),hc(t,e)},n}function Fm(t,e,n){n=en(-1,n),n.tag=3;var s=t.type.getDerivedStateFromError;if(typeof s=="function"){var r=e.value;n.payload=function(){return s(r)},n.callback=function(){hc(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){hc(t,e),typeof s!="function"&&(Sn===null?Sn=new Set([this]):Sn.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),n}function fh(t,e,n){var s=t.pingCache;if(s===null){s=t.pingCache=new bv;var r=new Set;s.set(e,r)}else r=s.get(e),r===void 0&&(r=new Set,s.set(e,r));r.has(n)||(r.add(n),t=Av.bind(null,t,e,n),e.then(t,t))}function mh(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function ph(t,e,n,s,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=en(-1,1),e.tag=2,kn(n,e,1))),n.lanes|=1),t)}var kv=on.ReactCurrentOwner,rt=!1;function Ve(t,e,n,s){e.child=t===null?pm(e,null,n,s):Zs(e,t.child,n,s)}function gh(t,e,n,s,r){n=n.render;var i=e.ref;return Vs(e,r),s=hu(t,e,n,s,i,r),n=fu(),t!==null&&!rt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,rn(t,e,r)):(ge&&n&&eu(e),e.flags|=1,Ve(t,e,s,r),e.child)}function xh(t,e,n,s,r){if(t===null){var i=n.type;return typeof i=="function"&&!Su(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,Hm(t,e,i,s,r)):(t=Eo(n.type,null,s,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&r)){var a=i.memoizedProps;if(n=n.compare,n=n!==null?n:ii,n(a,s)&&t.ref===e.ref)return rn(t,e,r)}return e.flags|=1,t=Nn(i,s),t.ref=e.ref,t.return=e,e.child=t}function Hm(t,e,n,s,r){if(t!==null){var i=t.memoizedProps;if(ii(i,s)&&t.ref===e.ref)if(rt=!1,e.pendingProps=s=i,(t.lanes&r)!==0)t.flags&131072&&(rt=!0);else return e.lanes=t.lanes,rn(t,e,r)}return fc(t,e,n,s,r)}function Bm(t,e,n){var s=e.pendingProps,r=s.children,i=t!==null?t.memoizedState:null;if(s.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},de(Bs,dt),dt|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,de(Bs,dt),dt|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=i!==null?i.baseLanes:n,de(Bs,dt),dt|=s}else i!==null?(s=i.baseLanes|n,e.memoizedState=null):s=n,de(Bs,dt),dt|=s;return Ve(t,e,r,n),e.child}function Ym(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function fc(t,e,n,s,r){var i=ot(n)?Gn:Be.current;return i=Ks(e,i),Vs(e,r),n=hu(t,e,n,s,i,r),s=fu(),t!==null&&!rt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,rn(t,e,r)):(ge&&s&&eu(e),e.flags|=1,Ve(t,e,n,r),e.child)}function yh(t,e,n,s,r){if(ot(n)){var i=!0;Wo(e)}else i=!1;if(Vs(e,r),e.stateNode===null)Co(t,e),Om(e,n,s),dc(e,n,s,r),s=!0;else if(t===null){var a=e.stateNode,l=e.memoizedProps;a.props=l;var c=a.context,u=n.contextType;typeof u=="object"&&u!==null?u=St(u):(u=ot(n)?Gn:Be.current,u=Ks(e,u));var f=n.getDerivedStateFromProps,h=typeof f=="function"||typeof a.getSnapshotBeforeUpdate=="function";h||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==s||c!==u)&&hh(e,a,s,u),fn=!1;var p=e.memoizedState;a.state=p,qo(e,s,a,r),c=e.memoizedState,l!==s||p!==c||it.current||fn?(typeof f=="function"&&(uc(e,n,f,s),c=e.memoizedState),(l=fn||dh(e,n,l,s,p,c,u))?(h||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=s,e.memoizedState=c),a.props=s,a.state=c,a.context=u,s=l):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),s=!1)}else{a=e.stateNode,xm(t,e),l=e.memoizedProps,u=e.type===e.elementType?l:Et(e.type,l),a.props=u,h=e.pendingProps,p=a.context,c=n.contextType,typeof c=="object"&&c!==null?c=St(c):(c=ot(n)?Gn:Be.current,c=Ks(e,c));var b=n.getDerivedStateFromProps;(f=typeof b=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==h||p!==c)&&hh(e,a,s,c),fn=!1,p=e.memoizedState,a.state=p,qo(e,s,a,r);var y=e.memoizedState;l!==h||p!==y||it.current||fn?(typeof b=="function"&&(uc(e,n,b,s),y=e.memoizedState),(u=fn||dh(e,n,u,s,p,y,c)||!1)?(f||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(s,y,c),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(s,y,c)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||l===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),e.memoizedProps=s,e.memoizedState=y),a.props=s,a.state=y,a.context=c,s=u):(typeof a.componentDidUpdate!="function"||l===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),s=!1)}return mc(t,e,n,s,i,r)}function mc(t,e,n,s,r,i){Ym(t,e);var a=(e.flags&128)!==0;if(!s&&!a)return r&&sh(e,n,!1),rn(t,e,i);s=e.stateNode,kv.current=e;var l=a&&typeof n.getDerivedStateFromError!="function"?null:s.render();return e.flags|=1,t!==null&&a?(e.child=Zs(e,t.child,null,i),e.child=Zs(e,null,l,i)):Ve(t,e,l,i),e.memoizedState=s.state,r&&sh(e,n,!0),e.child}function Wm(t){var e=t.stateNode;e.pendingContext?nh(t,e.pendingContext,e.pendingContext!==e.context):e.context&&nh(t,e.context,!1),lu(t,e.containerInfo)}function vh(t,e,n,s,r){return Qs(),nu(r),e.flags|=256,Ve(t,e,n,s),e.child}var pc={dehydrated:null,treeContext:null,retryLane:0};function gc(t){return{baseLanes:t,cachePool:null,transitions:null}}function Xm(t,e,n){var s=e.pendingProps,r=ve.current,i=!1,a=(e.flags&128)!==0,l;if((l=a)||(l=t!==null&&t.memoizedState===null?!1:(r&2)!==0),l?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),de(ve,r&1),t===null)return lc(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=s.children,t=s.fallback,i?(s=e.mode,i=e.child,a={mode:"hidden",children:a},!(s&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=ga(a,s,0,null),t=Vn(t,s,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=gc(n),e.memoizedState=pc,t):gu(e,a));if(r=t.memoizedState,r!==null&&(l=r.dehydrated,l!==null))return Sv(t,e,a,s,l,r,n);if(i){i=s.fallback,a=e.mode,r=t.child,l=r.sibling;var c={mode:"hidden",children:s.children};return!(a&1)&&e.child!==r?(s=e.child,s.childLanes=0,s.pendingProps=c,e.deletions=null):(s=Nn(r,c),s.subtreeFlags=r.subtreeFlags&14680064),l!==null?i=Nn(l,i):(i=Vn(i,a,n,null),i.flags|=2),i.return=e,s.return=e,s.sibling=i,e.child=s,s=i,i=e.child,a=t.child.memoizedState,a=a===null?gc(n):{baseLanes:a.baseLanes|n,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=t.childLanes&~n,e.memoizedState=pc,s}return i=t.child,t=i.sibling,s=Nn(i,{mode:"visible",children:s.children}),!(e.mode&1)&&(s.lanes=n),s.return=e,s.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=s,e.memoizedState=null,s}function gu(t,e){return e=ga({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function oo(t,e,n,s){return s!==null&&nu(s),Zs(e,t.child,null,n),t=gu(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function Sv(t,e,n,s,r,i,a){if(n)return e.flags&256?(e.flags&=-257,s=vl(Error(L(422))),oo(t,e,a,s)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=s.fallback,r=e.mode,s=ga({mode:"visible",children:s.children},r,0,null),i=Vn(i,r,a,null),i.flags|=2,s.return=e,i.return=e,s.sibling=i,e.child=s,e.mode&1&&Zs(e,t.child,null,a),e.child.memoizedState=gc(a),e.memoizedState=pc,i);if(!(e.mode&1))return oo(t,e,a,null);if(r.data==="$!"){if(s=r.nextSibling&&r.nextSibling.dataset,s)var l=s.dgst;return s=l,i=Error(L(419)),s=vl(i,s,void 0),oo(t,e,a,s)}if(l=(a&t.childLanes)!==0,rt||l){if(s=ze,s!==null){switch(a&-a){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(s.suspendedLanes|a)?0:r,r!==0&&r!==i.retryLane&&(i.retryLane=r,sn(t,r),It(s,t,r,-1))}return ku(),s=vl(Error(L(421))),oo(t,e,a,s)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=Dv.bind(null,t),r._reactRetry=e,null):(t=i.treeContext,ft=bn(r.nextSibling),mt=e,ge=!0,Lt=null,t!==null&&(vt[wt++]=Zt,vt[wt++]=Jt,vt[wt++]=qn,Zt=t.id,Jt=t.overflow,qn=e),e=gu(e,s.children),e.flags|=4096,e)}function wh(t,e,n){t.lanes|=e;var s=t.alternate;s!==null&&(s.lanes|=e),cc(t.return,e,n)}function wl(t,e,n,s,r){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:r}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=s,i.tail=n,i.tailMode=r)}function Um(t,e,n){var s=e.pendingProps,r=s.revealOrder,i=s.tail;if(Ve(t,e,s.children,n),s=ve.current,s&2)s=s&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&wh(t,n,e);else if(t.tag===19)wh(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}s&=1}if(de(ve,s),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&Ko(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),wl(e,!1,r,n,i);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&Ko(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}wl(e,!0,n,null,i);break;case"together":wl(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Co(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function rn(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Qn|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(L(153));if(e.child!==null){for(t=e.child,n=Nn(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Nn(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function jv(t,e,n){switch(e.tag){case 3:Wm(e),Qs();break;case 5:ym(e);break;case 1:ot(e.type)&&Wo(e);break;case 4:lu(e,e.stateNode.containerInfo);break;case 10:var s=e.type._context,r=e.memoizedProps.value;de(Vo,s._currentValue),s._currentValue=r;break;case 13:if(s=e.memoizedState,s!==null)return s.dehydrated!==null?(de(ve,ve.current&1),e.flags|=128,null):n&e.child.childLanes?Xm(t,e,n):(de(ve,ve.current&1),t=rn(t,e,n),t!==null?t.sibling:null);de(ve,ve.current&1);break;case 19:if(s=(n&e.childLanes)!==0,t.flags&128){if(s)return Um(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),de(ve,ve.current),s)break;return null;case 22:case 23:return e.lanes=0,Bm(t,e,n)}return rn(t,e,n)}var Vm,xc,Gm,qm;Vm=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};xc=function(){};Gm=function(t,e,n,s){var r=t.memoizedProps;if(r!==s){t=e.stateNode,Wn(Yt.current);var i=null;switch(n){case"input":r=$l(t,r),s=$l(t,s),i=[];break;case"select":r=be({},r,{value:void 0}),s=be({},s,{value:void 0}),i=[];break;case"textarea":r=Bl(t,r),s=Bl(t,s),i=[];break;default:typeof r.onClick!="function"&&typeof s.onClick=="function"&&(t.onclick=Bo)}Wl(n,s);var a;n=null;for(u in r)if(!s.hasOwnProperty(u)&&r.hasOwnProperty(u)&&r[u]!=null)if(u==="style"){var l=r[u];for(a in l)l.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Zr.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in s){var c=s[u];if(l=r!=null?r[u]:void 0,s.hasOwnProperty(u)&&c!==l&&(c!=null||l!=null))if(u==="style")if(l){for(a in l)!l.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in c)c.hasOwnProperty(a)&&l[a]!==c[a]&&(n||(n={}),n[a]=c[a])}else n||(i||(i=[]),i.push(u,n)),n=c;else u==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(i=i||[]).push(u,c)):u==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(u,""+c):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Zr.hasOwnProperty(u)?(c!=null&&u==="onScroll"&&me("scroll",t),i||l===c||(i=[])):(i=i||[]).push(u,c))}n&&(i=i||[]).push("style",n);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};qm=function(t,e,n,s){n!==s&&(e.flags|=4)};function _r(t,e){if(!ge)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:s.sibling=null}}function Fe(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,s=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags&14680064,s|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags,s|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=s,t.childLanes=n,e}function Nv(t,e,n){var s=e.pendingProps;switch(tu(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Fe(e),null;case 1:return ot(e.type)&&Yo(),Fe(e),null;case 3:return s=e.stateNode,Js(),pe(it),pe(Be),uu(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(t===null||t.child===null)&&(ro(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Lt!==null&&(Nc(Lt),Lt=null))),xc(t,e),Fe(e),null;case 5:cu(e);var r=Wn(ui.current);if(n=e.type,t!==null&&e.stateNode!=null)Gm(t,e,n,s,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!s){if(e.stateNode===null)throw Error(L(166));return Fe(e),null}if(t=Wn(Yt.current),ro(e)){s=e.stateNode,n=e.type;var i=e.memoizedProps;switch(s[Ht]=e,s[li]=i,t=(e.mode&1)!==0,n){case"dialog":me("cancel",s),me("close",s);break;case"iframe":case"object":case"embed":me("load",s);break;case"video":case"audio":for(r=0;r<Hr.length;r++)me(Hr[r],s);break;case"source":me("error",s);break;case"img":case"image":case"link":me("error",s),me("load",s);break;case"details":me("toggle",s);break;case"input":Ed(s,i),me("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!i.multiple},me("invalid",s);break;case"textarea":Ld(s,i),me("invalid",s)}Wl(n,i),r=null;for(var a in i)if(i.hasOwnProperty(a)){var l=i[a];a==="children"?typeof l=="string"?s.textContent!==l&&(i.suppressHydrationWarning!==!0&&so(s.textContent,l,t),r=["children",l]):typeof l=="number"&&s.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&so(s.textContent,l,t),r=["children",""+l]):Zr.hasOwnProperty(a)&&l!=null&&a==="onScroll"&&me("scroll",s)}switch(n){case"input":qi(s),Pd(s,i,!0);break;case"textarea":qi(s),_d(s);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(s.onclick=Bo)}s=r,e.updateQueue=s,s!==null&&(e.flags|=4)}else{a=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Sf(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=a.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof s.is=="string"?t=a.createElement(n,{is:s.is}):(t=a.createElement(n),n==="select"&&(a=t,s.multiple?a.multiple=!0:s.size&&(a.size=s.size))):t=a.createElementNS(t,n),t[Ht]=e,t[li]=s,Vm(t,e,!1,!1),e.stateNode=t;e:{switch(a=Xl(n,s),n){case"dialog":me("cancel",t),me("close",t),r=s;break;case"iframe":case"object":case"embed":me("load",t),r=s;break;case"video":case"audio":for(r=0;r<Hr.length;r++)me(Hr[r],t);r=s;break;case"source":me("error",t),r=s;break;case"img":case"image":case"link":me("error",t),me("load",t),r=s;break;case"details":me("toggle",t),r=s;break;case"input":Ed(t,s),r=$l(t,s),me("invalid",t);break;case"option":r=s;break;case"select":t._wrapperState={wasMultiple:!!s.multiple},r=be({},s,{value:void 0}),me("invalid",t);break;case"textarea":Ld(t,s),r=Bl(t,s),me("invalid",t);break;default:r=s}Wl(n,r),l=r;for(i in l)if(l.hasOwnProperty(i)){var c=l[i];i==="style"?Cf(t,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&jf(t,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&Jr(t,c):typeof c=="number"&&Jr(t,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Zr.hasOwnProperty(i)?c!=null&&i==="onScroll"&&me("scroll",t):c!=null&&Fc(t,i,c,a))}switch(n){case"input":qi(t),Pd(t,s,!1);break;case"textarea":qi(t),_d(t);break;case"option":s.value!=null&&t.setAttribute("value",""+Cn(s.value));break;case"select":t.multiple=!!s.multiple,i=s.value,i!=null?Ys(t,!!s.multiple,i,!1):s.defaultValue!=null&&Ys(t,!!s.multiple,s.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=Bo)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Fe(e),null;case 6:if(t&&e.stateNode!=null)qm(t,e,t.memoizedProps,s);else{if(typeof s!="string"&&e.stateNode===null)throw Error(L(166));if(n=Wn(ui.current),Wn(Yt.current),ro(e)){if(s=e.stateNode,n=e.memoizedProps,s[Ht]=e,(i=s.nodeValue!==n)&&(t=mt,t!==null))switch(t.tag){case 3:so(s.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&so(s.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else s=(n.nodeType===9?n:n.ownerDocument).createTextNode(s),s[Ht]=e,e.stateNode=s}return Fe(e),null;case 13:if(pe(ve),s=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(ge&&ft!==null&&e.mode&1&&!(e.flags&128))fm(),Qs(),e.flags|=98560,i=!1;else if(i=ro(e),s!==null&&s.dehydrated!==null){if(t===null){if(!i)throw Error(L(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(L(317));i[Ht]=e}else Qs(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Fe(e),i=!1}else Lt!==null&&(Nc(Lt),Lt=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(s=s!==null,s!==(t!==null&&t.memoizedState!==null)&&s&&(e.child.flags|=8192,e.mode&1&&(t===null||ve.current&1?_e===0&&(_e=3):ku())),e.updateQueue!==null&&(e.flags|=4),Fe(e),null);case 4:return Js(),xc(t,e),t===null&&oi(e.stateNode.containerInfo),Fe(e),null;case 10:return iu(e.type._context),Fe(e),null;case 17:return ot(e.type)&&Yo(),Fe(e),null;case 19:if(pe(ve),i=e.memoizedState,i===null)return Fe(e),null;if(s=(e.flags&128)!==0,a=i.rendering,a===null)if(s)_r(i,!1);else{if(_e!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(a=Ko(t),a!==null){for(e.flags|=128,_r(i,!1),s=a.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),e.subtreeFlags=0,s=n,n=e.child;n!==null;)i=n,t=s,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,t=a.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return de(ve,ve.current&1|2),e.child}t=t.sibling}i.tail!==null&&Te()>tr&&(e.flags|=128,s=!0,_r(i,!1),e.lanes=4194304)}else{if(!s)if(t=Ko(a),t!==null){if(e.flags|=128,s=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),_r(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!ge)return Fe(e),null}else 2*Te()-i.renderingStartTime>tr&&n!==1073741824&&(e.flags|=128,s=!0,_r(i,!1),e.lanes=4194304);i.isBackwards?(a.sibling=e.child,e.child=a):(n=i.last,n!==null?n.sibling=a:e.child=a,i.last=a)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Te(),e.sibling=null,n=ve.current,de(ve,s?n&1|2:n&1),e):(Fe(e),null);case 22:case 23:return bu(),s=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==s&&(e.flags|=8192),s&&e.mode&1?dt&1073741824&&(Fe(e),e.subtreeFlags&6&&(e.flags|=8192)):Fe(e),null;case 24:return null;case 25:return null}throw Error(L(156,e.tag))}function Cv(t,e){switch(tu(e),e.tag){case 1:return ot(e.type)&&Yo(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Js(),pe(it),pe(Be),uu(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return cu(e),null;case 13:if(pe(ve),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(L(340));Qs()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return pe(ve),null;case 4:return Js(),null;case 10:return iu(e.type._context),null;case 22:case 23:return bu(),null;case 24:return null;default:return null}}var ao=!1,He=!1,Tv=typeof WeakSet=="function"?WeakSet:Set,O=null;function Hs(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(s){Se(t,e,s)}else n.current=null}function yc(t,e,n){try{n()}catch(s){Se(t,e,s)}}var bh=!1;function Mv(t,e){if(tc=$o,t=em(),Jc(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var s=n.getSelection&&n.getSelection();if(s&&s.rangeCount!==0){n=s.anchorNode;var r=s.anchorOffset,i=s.focusNode;s=s.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var a=0,l=-1,c=-1,u=0,f=0,h=t,p=null;t:for(;;){for(var b;h!==n||r!==0&&h.nodeType!==3||(l=a+r),h!==i||s!==0&&h.nodeType!==3||(c=a+s),h.nodeType===3&&(a+=h.nodeValue.length),(b=h.firstChild)!==null;)p=h,h=b;for(;;){if(h===t)break t;if(p===n&&++u===r&&(l=a),p===i&&++f===s&&(c=a),(b=h.nextSibling)!==null)break;h=p,p=h.parentNode}h=b}n=l===-1||c===-1?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(nc={focusedElem:t,selectionRange:n},$o=!1,O=e;O!==null;)if(e=O,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,O=t;else for(;O!==null;){e=O;try{var y=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(y!==null){var S=y.memoizedProps,j=y.memoizedState,v=e.stateNode,g=v.getSnapshotBeforeUpdate(e.elementType===e.type?S:Et(e.type,S),j);v.__reactInternalSnapshotBeforeUpdate=g}break;case 3:var x=e.stateNode.containerInfo;x.nodeType===1?x.textContent="":x.nodeType===9&&x.documentElement&&x.removeChild(x.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(L(163))}}catch(w){Se(e,e.return,w)}if(t=e.sibling,t!==null){t.return=e.return,O=t;break}O=e.return}return y=bh,bh=!1,y}function Gr(t,e,n){var s=e.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var r=s=s.next;do{if((r.tag&t)===t){var i=r.destroy;r.destroy=void 0,i!==void 0&&yc(e,n,i)}r=r.next}while(r!==s)}}function ma(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var s=n.create;n.destroy=s()}n=n.next}while(n!==e)}}function vc(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function Km(t){var e=t.alternate;e!==null&&(t.alternate=null,Km(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Ht],delete e[li],delete e[ic],delete e[uv],delete e[dv])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function Qm(t){return t.tag===5||t.tag===3||t.tag===4}function kh(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Qm(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function wc(t,e,n){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Bo));else if(s!==4&&(t=t.child,t!==null))for(wc(t,e,n),t=t.sibling;t!==null;)wc(t,e,n),t=t.sibling}function bc(t,e,n){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(s!==4&&(t=t.child,t!==null))for(bc(t,e,n),t=t.sibling;t!==null;)bc(t,e,n),t=t.sibling}var De=null,Pt=!1;function un(t,e,n){for(n=n.child;n!==null;)Zm(t,e,n),n=n.sibling}function Zm(t,e,n){if(Bt&&typeof Bt.onCommitFiberUnmount=="function")try{Bt.onCommitFiberUnmount(oa,n)}catch{}switch(n.tag){case 5:He||Hs(n,e);case 6:var s=De,r=Pt;De=null,un(t,e,n),De=s,Pt=r,De!==null&&(Pt?(t=De,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):De.removeChild(n.stateNode));break;case 18:De!==null&&(Pt?(t=De,n=n.stateNode,t.nodeType===8?fl(t.parentNode,n):t.nodeType===1&&fl(t,n),si(t)):fl(De,n.stateNode));break;case 4:s=De,r=Pt,De=n.stateNode.containerInfo,Pt=!0,un(t,e,n),De=s,Pt=r;break;case 0:case 11:case 14:case 15:if(!He&&(s=n.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){r=s=s.next;do{var i=r,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&yc(n,e,a),r=r.next}while(r!==s)}un(t,e,n);break;case 1:if(!He&&(Hs(n,e),s=n.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=n.memoizedProps,s.state=n.memoizedState,s.componentWillUnmount()}catch(l){Se(n,e,l)}un(t,e,n);break;case 21:un(t,e,n);break;case 22:n.mode&1?(He=(s=He)||n.memoizedState!==null,un(t,e,n),He=s):un(t,e,n);break;default:un(t,e,n)}}function Sh(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new Tv),e.forEach(function(s){var r=Rv.bind(null,t,s);n.has(s)||(n.add(s),s.then(r,r))})}}function Tt(t,e){var n=e.deletions;if(n!==null)for(var s=0;s<n.length;s++){var r=n[s];try{var i=t,a=e,l=a;e:for(;l!==null;){switch(l.tag){case 5:De=l.stateNode,Pt=!1;break e;case 3:De=l.stateNode.containerInfo,Pt=!0;break e;case 4:De=l.stateNode.containerInfo,Pt=!0;break e}l=l.return}if(De===null)throw Error(L(160));Zm(i,a,r),De=null,Pt=!1;var c=r.alternate;c!==null&&(c.return=null),r.return=null}catch(u){Se(r,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Jm(e,t),e=e.sibling}function Jm(t,e){var n=t.alternate,s=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Tt(e,t),$t(t),s&4){try{Gr(3,t,t.return),ma(3,t)}catch(S){Se(t,t.return,S)}try{Gr(5,t,t.return)}catch(S){Se(t,t.return,S)}}break;case 1:Tt(e,t),$t(t),s&512&&n!==null&&Hs(n,n.return);break;case 5:if(Tt(e,t),$t(t),s&512&&n!==null&&Hs(n,n.return),t.flags&32){var r=t.stateNode;try{Jr(r,"")}catch(S){Se(t,t.return,S)}}if(s&4&&(r=t.stateNode,r!=null)){var i=t.memoizedProps,a=n!==null?n.memoizedProps:i,l=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&bf(r,i),Xl(l,a);var u=Xl(l,i);for(a=0;a<c.length;a+=2){var f=c[a],h=c[a+1];f==="style"?Cf(r,h):f==="dangerouslySetInnerHTML"?jf(r,h):f==="children"?Jr(r,h):Fc(r,f,h,u)}switch(l){case"input":Fl(r,i);break;case"textarea":kf(r,i);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!i.multiple;var b=i.value;b!=null?Ys(r,!!i.multiple,b,!1):p!==!!i.multiple&&(i.defaultValue!=null?Ys(r,!!i.multiple,i.defaultValue,!0):Ys(r,!!i.multiple,i.multiple?[]:"",!1))}r[li]=i}catch(S){Se(t,t.return,S)}}break;case 6:if(Tt(e,t),$t(t),s&4){if(t.stateNode===null)throw Error(L(162));r=t.stateNode,i=t.memoizedProps;try{r.nodeValue=i}catch(S){Se(t,t.return,S)}}break;case 3:if(Tt(e,t),$t(t),s&4&&n!==null&&n.memoizedState.isDehydrated)try{si(e.containerInfo)}catch(S){Se(t,t.return,S)}break;case 4:Tt(e,t),$t(t);break;case 13:Tt(e,t),$t(t),r=t.child,r.flags&8192&&(i=r.memoizedState!==null,r.stateNode.isHidden=i,!i||r.alternate!==null&&r.alternate.memoizedState!==null||(vu=Te())),s&4&&Sh(t);break;case 22:if(f=n!==null&&n.memoizedState!==null,t.mode&1?(He=(u=He)||f,Tt(e,t),He=u):Tt(e,t),$t(t),s&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!f&&t.mode&1)for(O=t,f=t.child;f!==null;){for(h=O=f;O!==null;){switch(p=O,b=p.child,p.tag){case 0:case 11:case 14:case 15:Gr(4,p,p.return);break;case 1:Hs(p,p.return);var y=p.stateNode;if(typeof y.componentWillUnmount=="function"){s=p,n=p.return;try{e=s,y.props=e.memoizedProps,y.state=e.memoizedState,y.componentWillUnmount()}catch(S){Se(s,n,S)}}break;case 5:Hs(p,p.return);break;case 22:if(p.memoizedState!==null){Nh(h);continue}}b!==null?(b.return=p,O=b):Nh(h)}f=f.sibling}e:for(f=null,h=t;;){if(h.tag===5){if(f===null){f=h;try{r=h.stateNode,u?(i=r.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=h.stateNode,c=h.memoizedProps.style,a=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=Nf("display",a))}catch(S){Se(t,t.return,S)}}}else if(h.tag===6){if(f===null)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(S){Se(t,t.return,S)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;f===h&&(f=null),h=h.return}f===h&&(f=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Tt(e,t),$t(t),s&4&&Sh(t);break;case 21:break;default:Tt(e,t),$t(t)}}function $t(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(Qm(n)){var s=n;break e}n=n.return}throw Error(L(160))}switch(s.tag){case 5:var r=s.stateNode;s.flags&32&&(Jr(r,""),s.flags&=-33);var i=kh(t);bc(t,i,r);break;case 3:case 4:var a=s.stateNode.containerInfo,l=kh(t);wc(t,l,a);break;default:throw Error(L(161))}}catch(c){Se(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Ev(t,e,n){O=t,ep(t)}function ep(t,e,n){for(var s=(t.mode&1)!==0;O!==null;){var r=O,i=r.child;if(r.tag===22&&s){var a=r.memoizedState!==null||ao;if(!a){var l=r.alternate,c=l!==null&&l.memoizedState!==null||He;l=ao;var u=He;if(ao=a,(He=c)&&!u)for(O=r;O!==null;)a=O,c=a.child,a.tag===22&&a.memoizedState!==null?Ch(r):c!==null?(c.return=a,O=c):Ch(r);for(;i!==null;)O=i,ep(i),i=i.sibling;O=r,ao=l,He=u}jh(t)}else r.subtreeFlags&8772&&i!==null?(i.return=r,O=i):jh(t)}}function jh(t){for(;O!==null;){var e=O;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:He||ma(5,e);break;case 1:var s=e.stateNode;if(e.flags&4&&!He)if(n===null)s.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:Et(e.type,n.memoizedProps);s.componentDidUpdate(r,n.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&lh(e,i,s);break;case 3:var a=e.updateQueue;if(a!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}lh(e,a,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var f=u.memoizedState;if(f!==null){var h=f.dehydrated;h!==null&&si(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(L(163))}He||e.flags&512&&vc(e)}catch(p){Se(e,e.return,p)}}if(e===t){O=null;break}if(n=e.sibling,n!==null){n.return=e.return,O=n;break}O=e.return}}function Nh(t){for(;O!==null;){var e=O;if(e===t){O=null;break}var n=e.sibling;if(n!==null){n.return=e.return,O=n;break}O=e.return}}function Ch(t){for(;O!==null;){var e=O;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{ma(4,e)}catch(c){Se(e,n,c)}break;case 1:var s=e.stateNode;if(typeof s.componentDidMount=="function"){var r=e.return;try{s.componentDidMount()}catch(c){Se(e,r,c)}}var i=e.return;try{vc(e)}catch(c){Se(e,i,c)}break;case 5:var a=e.return;try{vc(e)}catch(c){Se(e,a,c)}}}catch(c){Se(e,e.return,c)}if(e===t){O=null;break}var l=e.sibling;if(l!==null){l.return=e.return,O=l;break}O=e.return}}var Pv=Math.ceil,Jo=on.ReactCurrentDispatcher,xu=on.ReactCurrentOwner,kt=on.ReactCurrentBatchConfig,se=0,ze=null,Ee=null,Re=0,dt=0,Bs=En(0),_e=0,mi=null,Qn=0,pa=0,yu=0,qr=null,st=null,vu=0,tr=1/0,Kt=null,ea=!1,kc=null,Sn=null,lo=!1,xn=null,ta=0,Kr=0,Sc=null,To=-1,Mo=0;function Ge(){return se&6?Te():To!==-1?To:To=Te()}function jn(t){return t.mode&1?se&2&&Re!==0?Re&-Re:fv.transition!==null?(Mo===0&&(Mo=Of()),Mo):(t=ce,t!==0||(t=window.event,t=t===void 0?16:Xf(t.type)),t):1}function It(t,e,n,s){if(50<Kr)throw Kr=0,Sc=null,Error(L(185));xi(t,n,s),(!(se&2)||t!==ze)&&(t===ze&&(!(se&2)&&(pa|=n),_e===4&&pn(t,Re)),at(t,s),n===1&&se===0&&!(e.mode&1)&&(tr=Te()+500,da&&Pn()))}function at(t,e){var n=t.callbackNode;fy(t,e);var s=Oo(t,t===ze?Re:0);if(s===0)n!==null&&Ad(n),t.callbackNode=null,t.callbackPriority=0;else if(e=s&-s,t.callbackPriority!==e){if(n!=null&&Ad(n),e===1)t.tag===0?hv(Th.bind(null,t)):um(Th.bind(null,t)),lv(function(){!(se&6)&&Pn()}),n=null;else{switch($f(s)){case 1:n=Xc;break;case 4:n=Df;break;case 16:n=Ro;break;case 536870912:n=Rf;break;default:n=Ro}n=lp(n,tp.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function tp(t,e){if(To=-1,Mo=0,se&6)throw Error(L(327));var n=t.callbackNode;if(Gs()&&t.callbackNode!==n)return null;var s=Oo(t,t===ze?Re:0);if(s===0)return null;if(s&30||s&t.expiredLanes||e)e=na(t,s);else{e=s;var r=se;se|=2;var i=sp();(ze!==t||Re!==e)&&(Kt=null,tr=Te()+500,Un(t,e));do try{Iv();break}catch(l){np(t,l)}while(!0);ru(),Jo.current=i,se=r,Ee!==null?e=0:(ze=null,Re=0,e=_e)}if(e!==0){if(e===2&&(r=Kl(t),r!==0&&(s=r,e=jc(t,r))),e===1)throw n=mi,Un(t,0),pn(t,s),at(t,Te()),n;if(e===6)pn(t,s);else{if(r=t.current.alternate,!(s&30)&&!Lv(r)&&(e=na(t,s),e===2&&(i=Kl(t),i!==0&&(s=i,e=jc(t,i))),e===1))throw n=mi,Un(t,0),pn(t,s),at(t,Te()),n;switch(t.finishedWork=r,t.finishedLanes=s,e){case 0:case 1:throw Error(L(345));case 2:Fn(t,st,Kt);break;case 3:if(pn(t,s),(s&130023424)===s&&(e=vu+500-Te(),10<e)){if(Oo(t,0)!==0)break;if(r=t.suspendedLanes,(r&s)!==s){Ge(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=rc(Fn.bind(null,t,st,Kt),e);break}Fn(t,st,Kt);break;case 4:if(pn(t,s),(s&4194240)===s)break;for(e=t.eventTimes,r=-1;0<s;){var a=31-_t(s);i=1<<a,a=e[a],a>r&&(r=a),s&=~i}if(s=r,s=Te()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*Pv(s/1960))-s,10<s){t.timeoutHandle=rc(Fn.bind(null,t,st,Kt),s);break}Fn(t,st,Kt);break;case 5:Fn(t,st,Kt);break;default:throw Error(L(329))}}}return at(t,Te()),t.callbackNode===n?tp.bind(null,t):null}function jc(t,e){var n=qr;return t.current.memoizedState.isDehydrated&&(Un(t,e).flags|=256),t=na(t,e),t!==2&&(e=st,st=n,e!==null&&Nc(e)),t}function Nc(t){st===null?st=t:st.push.apply(st,t)}function Lv(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var s=0;s<n.length;s++){var r=n[s],i=r.getSnapshot;r=r.value;try{if(!zt(i(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function pn(t,e){for(e&=~yu,e&=~pa,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-_t(e),s=1<<n;t[n]=-1,e&=~s}}function Th(t){if(se&6)throw Error(L(327));Gs();var e=Oo(t,0);if(!(e&1))return at(t,Te()),null;var n=na(t,e);if(t.tag!==0&&n===2){var s=Kl(t);s!==0&&(e=s,n=jc(t,s))}if(n===1)throw n=mi,Un(t,0),pn(t,e),at(t,Te()),n;if(n===6)throw Error(L(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Fn(t,st,Kt),at(t,Te()),null}function wu(t,e){var n=se;se|=1;try{return t(e)}finally{se=n,se===0&&(tr=Te()+500,da&&Pn())}}function Zn(t){xn!==null&&xn.tag===0&&!(se&6)&&Gs();var e=se;se|=1;var n=kt.transition,s=ce;try{if(kt.transition=null,ce=1,t)return t()}finally{ce=s,kt.transition=n,se=e,!(se&6)&&Pn()}}function bu(){dt=Bs.current,pe(Bs)}function Un(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,av(n)),Ee!==null)for(n=Ee.return;n!==null;){var s=n;switch(tu(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&Yo();break;case 3:Js(),pe(it),pe(Be),uu();break;case 5:cu(s);break;case 4:Js();break;case 13:pe(ve);break;case 19:pe(ve);break;case 10:iu(s.type._context);break;case 22:case 23:bu()}n=n.return}if(ze=t,Ee=t=Nn(t.current,null),Re=dt=e,_e=0,mi=null,yu=pa=Qn=0,st=qr=null,Yn!==null){for(e=0;e<Yn.length;e++)if(n=Yn[e],s=n.interleaved,s!==null){n.interleaved=null;var r=s.next,i=n.pending;if(i!==null){var a=i.next;i.next=r,s.next=a}n.pending=s}Yn=null}return t}function np(t,e){do{var n=Ee;try{if(ru(),jo.current=Zo,Qo){for(var s=we.memoizedState;s!==null;){var r=s.queue;r!==null&&(r.pending=null),s=s.next}Qo=!1}if(Kn=0,Ie=Le=we=null,Vr=!1,di=0,xu.current=null,n===null||n.return===null){_e=1,mi=e,Ee=null;break}e:{var i=t,a=n.return,l=n,c=e;if(e=Re,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var u=c,f=l,h=f.tag;if(!(f.mode&1)&&(h===0||h===11||h===15)){var p=f.alternate;p?(f.updateQueue=p.updateQueue,f.memoizedState=p.memoizedState,f.lanes=p.lanes):(f.updateQueue=null,f.memoizedState=null)}var b=mh(a);if(b!==null){b.flags&=-257,ph(b,a,l,i,e),b.mode&1&&fh(i,u,e),e=b,c=u;var y=e.updateQueue;if(y===null){var S=new Set;S.add(c),e.updateQueue=S}else y.add(c);break e}else{if(!(e&1)){fh(i,u,e),ku();break e}c=Error(L(426))}}else if(ge&&l.mode&1){var j=mh(a);if(j!==null){!(j.flags&65536)&&(j.flags|=256),ph(j,a,l,i,e),nu(er(c,l));break e}}i=c=er(c,l),_e!==4&&(_e=2),qr===null?qr=[i]:qr.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var v=$m(i,c,e);ah(i,v);break e;case 1:l=c;var g=i.type,x=i.stateNode;if(!(i.flags&128)&&(typeof g.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(Sn===null||!Sn.has(x)))){i.flags|=65536,e&=-e,i.lanes|=e;var w=Fm(i,l,e);ah(i,w);break e}}i=i.return}while(i!==null)}ip(n)}catch(N){e=N,Ee===n&&n!==null&&(Ee=n=n.return);continue}break}while(!0)}function sp(){var t=Jo.current;return Jo.current=Zo,t===null?Zo:t}function ku(){(_e===0||_e===3||_e===2)&&(_e=4),ze===null||!(Qn&268435455)&&!(pa&268435455)||pn(ze,Re)}function na(t,e){var n=se;se|=2;var s=sp();(ze!==t||Re!==e)&&(Kt=null,Un(t,e));do try{_v();break}catch(r){np(t,r)}while(!0);if(ru(),se=n,Jo.current=s,Ee!==null)throw Error(L(261));return ze=null,Re=0,_e}function _v(){for(;Ee!==null;)rp(Ee)}function Iv(){for(;Ee!==null&&!ry();)rp(Ee)}function rp(t){var e=ap(t.alternate,t,dt);t.memoizedProps=t.pendingProps,e===null?ip(t):Ee=e,xu.current=null}function ip(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=Cv(n,e),n!==null){n.flags&=32767,Ee=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{_e=6,Ee=null;return}}else if(n=Nv(n,e,dt),n!==null){Ee=n;return}if(e=e.sibling,e!==null){Ee=e;return}Ee=e=t}while(e!==null);_e===0&&(_e=5)}function Fn(t,e,n){var s=ce,r=kt.transition;try{kt.transition=null,ce=1,zv(t,e,n,s)}finally{kt.transition=r,ce=s}return null}function zv(t,e,n,s){do Gs();while(xn!==null);if(se&6)throw Error(L(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(L(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(my(t,i),t===ze&&(Ee=ze=null,Re=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||lo||(lo=!0,lp(Ro,function(){return Gs(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=kt.transition,kt.transition=null;var a=ce;ce=1;var l=se;se|=4,xu.current=null,Mv(t,n),Jm(n,t),ev(nc),$o=!!tc,nc=tc=null,t.current=n,Ev(n),iy(),se=l,ce=a,kt.transition=i}else t.current=n;if(lo&&(lo=!1,xn=t,ta=r),i=t.pendingLanes,i===0&&(Sn=null),ly(n.stateNode),at(t,Te()),e!==null)for(s=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],s(r.value,{componentStack:r.stack,digest:r.digest});if(ea)throw ea=!1,t=kc,kc=null,t;return ta&1&&t.tag!==0&&Gs(),i=t.pendingLanes,i&1?t===Sc?Kr++:(Kr=0,Sc=t):Kr=0,Pn(),null}function Gs(){if(xn!==null){var t=$f(ta),e=kt.transition,n=ce;try{if(kt.transition=null,ce=16>t?16:t,xn===null)var s=!1;else{if(t=xn,xn=null,ta=0,se&6)throw Error(L(331));var r=se;for(se|=4,O=t.current;O!==null;){var i=O,a=i.child;if(O.flags&16){var l=i.deletions;if(l!==null){for(var c=0;c<l.length;c++){var u=l[c];for(O=u;O!==null;){var f=O;switch(f.tag){case 0:case 11:case 15:Gr(8,f,i)}var h=f.child;if(h!==null)h.return=f,O=h;else for(;O!==null;){f=O;var p=f.sibling,b=f.return;if(Km(f),f===u){O=null;break}if(p!==null){p.return=b,O=p;break}O=b}}}var y=i.alternate;if(y!==null){var S=y.child;if(S!==null){y.child=null;do{var j=S.sibling;S.sibling=null,S=j}while(S!==null)}}O=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,O=a;else e:for(;O!==null;){if(i=O,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Gr(9,i,i.return)}var v=i.sibling;if(v!==null){v.return=i.return,O=v;break e}O=i.return}}var g=t.current;for(O=g;O!==null;){a=O;var x=a.child;if(a.subtreeFlags&2064&&x!==null)x.return=a,O=x;else e:for(a=g;O!==null;){if(l=O,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:ma(9,l)}}catch(N){Se(l,l.return,N)}if(l===a){O=null;break e}var w=l.sibling;if(w!==null){w.return=l.return,O=w;break e}O=l.return}}if(se=r,Pn(),Bt&&typeof Bt.onPostCommitFiberRoot=="function")try{Bt.onPostCommitFiberRoot(oa,t)}catch{}s=!0}return s}finally{ce=n,kt.transition=e}}return!1}function Mh(t,e,n){e=er(n,e),e=$m(t,e,1),t=kn(t,e,1),e=Ge(),t!==null&&(xi(t,1,e),at(t,e))}function Se(t,e,n){if(t.tag===3)Mh(t,t,n);else for(;e!==null;){if(e.tag===3){Mh(e,t,n);break}else if(e.tag===1){var s=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(Sn===null||!Sn.has(s))){t=er(n,t),t=Fm(e,t,1),e=kn(e,t,1),t=Ge(),e!==null&&(xi(e,1,t),at(e,t));break}}e=e.return}}function Av(t,e,n){var s=t.pingCache;s!==null&&s.delete(e),e=Ge(),t.pingedLanes|=t.suspendedLanes&n,ze===t&&(Re&n)===n&&(_e===4||_e===3&&(Re&130023424)===Re&&500>Te()-vu?Un(t,0):yu|=n),at(t,e)}function op(t,e){e===0&&(t.mode&1?(e=Zi,Zi<<=1,!(Zi&130023424)&&(Zi=4194304)):e=1);var n=Ge();t=sn(t,e),t!==null&&(xi(t,e,n),at(t,n))}function Dv(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),op(t,n)}function Rv(t,e){var n=0;switch(t.tag){case 13:var s=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:s=t.stateNode;break;default:throw Error(L(314))}s!==null&&s.delete(e),op(t,n)}var ap;ap=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||it.current)rt=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return rt=!1,jv(t,e,n);rt=!!(t.flags&131072)}else rt=!1,ge&&e.flags&1048576&&dm(e,Uo,e.index);switch(e.lanes=0,e.tag){case 2:var s=e.type;Co(t,e),t=e.pendingProps;var r=Ks(e,Be.current);Vs(e,n),r=hu(null,e,s,t,r,n);var i=fu();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,ot(s)?(i=!0,Wo(e)):i=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,au(e),r.updater=fa,e.stateNode=r,r._reactInternals=e,dc(e,s,t,n),e=mc(null,e,s,!0,i,n)):(e.tag=0,ge&&i&&eu(e),Ve(null,e,r,n),e=e.child),e;case 16:s=e.elementType;e:{switch(Co(t,e),t=e.pendingProps,r=s._init,s=r(s._payload),e.type=s,r=e.tag=$v(s),t=Et(s,t),r){case 0:e=fc(null,e,s,t,n);break e;case 1:e=yh(null,e,s,t,n);break e;case 11:e=gh(null,e,s,t,n);break e;case 14:e=xh(null,e,s,Et(s.type,t),n);break e}throw Error(L(306,s,""))}return e;case 0:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:Et(s,r),fc(t,e,s,r,n);case 1:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:Et(s,r),yh(t,e,s,r,n);case 3:e:{if(Wm(e),t===null)throw Error(L(387));s=e.pendingProps,i=e.memoizedState,r=i.element,xm(t,e),qo(e,s,null,n);var a=e.memoizedState;if(s=a.element,i.isDehydrated)if(i={element:s,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){r=er(Error(L(423)),e),e=vh(t,e,s,n,r);break e}else if(s!==r){r=er(Error(L(424)),e),e=vh(t,e,s,n,r);break e}else for(ft=bn(e.stateNode.containerInfo.firstChild),mt=e,ge=!0,Lt=null,n=pm(e,null,s,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Qs(),s===r){e=rn(t,e,n);break e}Ve(t,e,s,n)}e=e.child}return e;case 5:return ym(e),t===null&&lc(e),s=e.type,r=e.pendingProps,i=t!==null?t.memoizedProps:null,a=r.children,sc(s,r)?a=null:i!==null&&sc(s,i)&&(e.flags|=32),Ym(t,e),Ve(t,e,a,n),e.child;case 6:return t===null&&lc(e),null;case 13:return Xm(t,e,n);case 4:return lu(e,e.stateNode.containerInfo),s=e.pendingProps,t===null?e.child=Zs(e,null,s,n):Ve(t,e,s,n),e.child;case 11:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:Et(s,r),gh(t,e,s,r,n);case 7:return Ve(t,e,e.pendingProps,n),e.child;case 8:return Ve(t,e,e.pendingProps.children,n),e.child;case 12:return Ve(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(s=e.type._context,r=e.pendingProps,i=e.memoizedProps,a=r.value,de(Vo,s._currentValue),s._currentValue=a,i!==null)if(zt(i.value,a)){if(i.children===r.children&&!it.current){e=rn(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var l=i.dependencies;if(l!==null){a=i.child;for(var c=l.firstContext;c!==null;){if(c.context===s){if(i.tag===1){c=en(-1,n&-n),c.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var f=u.pending;f===null?c.next=c:(c.next=f.next,f.next=c),u.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),cc(i.return,n,e),l.lanes|=n;break}c=c.next}}else if(i.tag===10)a=i.type===e.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(L(341));a.lanes|=n,l=a.alternate,l!==null&&(l.lanes|=n),cc(a,n,e),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===e){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}Ve(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,s=e.pendingProps.children,Vs(e,n),r=St(r),s=s(r),e.flags|=1,Ve(t,e,s,n),e.child;case 14:return s=e.type,r=Et(s,e.pendingProps),r=Et(s.type,r),xh(t,e,s,r,n);case 15:return Hm(t,e,e.type,e.pendingProps,n);case 17:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:Et(s,r),Co(t,e),e.tag=1,ot(s)?(t=!0,Wo(e)):t=!1,Vs(e,n),Om(e,s,r),dc(e,s,r,n),mc(null,e,s,!0,t,n);case 19:return Um(t,e,n);case 22:return Bm(t,e,n)}throw Error(L(156,e.tag))};function lp(t,e){return Af(t,e)}function Ov(t,e,n,s){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function bt(t,e,n,s){return new Ov(t,e,n,s)}function Su(t){return t=t.prototype,!(!t||!t.isReactComponent)}function $v(t){if(typeof t=="function")return Su(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Bc)return 11;if(t===Yc)return 14}return 2}function Nn(t,e){var n=t.alternate;return n===null?(n=bt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Eo(t,e,n,s,r,i){var a=2;if(s=t,typeof t=="function")Su(t)&&(a=1);else if(typeof t=="string")a=5;else e:switch(t){case _s:return Vn(n.children,r,i,e);case Hc:a=8,r|=8;break;case Al:return t=bt(12,n,e,r|2),t.elementType=Al,t.lanes=i,t;case Dl:return t=bt(13,n,e,r),t.elementType=Dl,t.lanes=i,t;case Rl:return t=bt(19,n,e,r),t.elementType=Rl,t.lanes=i,t;case yf:return ga(n,r,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case gf:a=10;break e;case xf:a=9;break e;case Bc:a=11;break e;case Yc:a=14;break e;case hn:a=16,s=null;break e}throw Error(L(130,t==null?t:typeof t,""))}return e=bt(a,n,e,r),e.elementType=t,e.type=s,e.lanes=i,e}function Vn(t,e,n,s){return t=bt(7,t,s,e),t.lanes=n,t}function ga(t,e,n,s){return t=bt(22,t,s,e),t.elementType=yf,t.lanes=n,t.stateNode={isHidden:!1},t}function bl(t,e,n){return t=bt(6,t,null,e),t.lanes=n,t}function kl(t,e,n){return e=bt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Fv(t,e,n,s,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=nl(0),this.expirationTimes=nl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=nl(0),this.identifierPrefix=s,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function ju(t,e,n,s,r,i,a,l,c){return t=new Fv(t,e,n,l,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=bt(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:s,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},au(i),t}function Hv(t,e,n){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ls,key:s==null?null:""+s,children:t,containerInfo:e,implementation:n}}function cp(t){if(!t)return Tn;t=t._reactInternals;e:{if(ss(t)!==t||t.tag!==1)throw Error(L(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(ot(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(L(171))}if(t.tag===1){var n=t.type;if(ot(n))return cm(t,n,e)}return e}function up(t,e,n,s,r,i,a,l,c){return t=ju(n,s,!0,t,r,i,a,l,c),t.context=cp(null),n=t.current,s=Ge(),r=jn(n),i=en(s,r),i.callback=e??null,kn(n,i,r),t.current.lanes=r,xi(t,r,s),at(t,s),t}function xa(t,e,n,s){var r=e.current,i=Ge(),a=jn(r);return n=cp(n),e.context===null?e.context=n:e.pendingContext=n,e=en(i,a),e.payload={element:t},s=s===void 0?null:s,s!==null&&(e.callback=s),t=kn(r,e,a),t!==null&&(It(t,r,a,i),So(t,r,a)),a}function sa(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Eh(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Nu(t,e){Eh(t,e),(t=t.alternate)&&Eh(t,e)}function Bv(){return null}var dp=typeof reportError=="function"?reportError:function(t){console.error(t)};function Cu(t){this._internalRoot=t}ya.prototype.render=Cu.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(L(409));xa(t,e,null,null)};ya.prototype.unmount=Cu.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Zn(function(){xa(null,t,null,null)}),e[nn]=null}};function ya(t){this._internalRoot=t}ya.prototype.unstable_scheduleHydration=function(t){if(t){var e=Bf();t={blockedOn:null,target:t,priority:e};for(var n=0;n<mn.length&&e!==0&&e<mn[n].priority;n++);mn.splice(n,0,t),n===0&&Wf(t)}};function Tu(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function va(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Ph(){}function Yv(t,e,n,s,r){if(r){if(typeof s=="function"){var i=s;s=function(){var u=sa(a);i.call(u)}}var a=up(e,s,t,0,null,!1,!1,"",Ph);return t._reactRootContainer=a,t[nn]=a.current,oi(t.nodeType===8?t.parentNode:t),Zn(),a}for(;r=t.lastChild;)t.removeChild(r);if(typeof s=="function"){var l=s;s=function(){var u=sa(c);l.call(u)}}var c=ju(t,0,!1,null,null,!1,!1,"",Ph);return t._reactRootContainer=c,t[nn]=c.current,oi(t.nodeType===8?t.parentNode:t),Zn(function(){xa(e,c,n,s)}),c}function wa(t,e,n,s,r){var i=n._reactRootContainer;if(i){var a=i;if(typeof r=="function"){var l=r;r=function(){var c=sa(a);l.call(c)}}xa(e,a,t,r)}else a=Yv(n,e,t,r,s);return sa(a)}Ff=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Fr(e.pendingLanes);n!==0&&(Uc(e,n|1),at(e,Te()),!(se&6)&&(tr=Te()+500,Pn()))}break;case 13:Zn(function(){var s=sn(t,1);if(s!==null){var r=Ge();It(s,t,1,r)}}),Nu(t,1)}};Vc=function(t){if(t.tag===13){var e=sn(t,134217728);if(e!==null){var n=Ge();It(e,t,134217728,n)}Nu(t,134217728)}};Hf=function(t){if(t.tag===13){var e=jn(t),n=sn(t,e);if(n!==null){var s=Ge();It(n,t,e,s)}Nu(t,e)}};Bf=function(){return ce};Yf=function(t,e){var n=ce;try{return ce=t,e()}finally{ce=n}};Vl=function(t,e,n){switch(e){case"input":if(Fl(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var s=n[e];if(s!==t&&s.form===t.form){var r=ua(s);if(!r)throw Error(L(90));wf(s),Fl(s,r)}}}break;case"textarea":kf(t,n);break;case"select":e=n.value,e!=null&&Ys(t,!!n.multiple,e,!1)}};Ef=wu;Pf=Zn;var Wv={usingClientEntryPoint:!1,Events:[vi,Ds,ua,Tf,Mf,wu]},Ir={findFiberByHostInstance:Bn,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Xv={bundleType:Ir.bundleType,version:Ir.version,rendererPackageName:Ir.rendererPackageName,rendererConfig:Ir.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:on.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=If(t),t===null?null:t.stateNode},findFiberByHostInstance:Ir.findFiberByHostInstance||Bv,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var co=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!co.isDisabled&&co.supportsFiber)try{oa=co.inject(Xv),Bt=co}catch{}}gt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Wv;gt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Tu(e))throw Error(L(200));return Hv(t,e,null,n)};gt.createRoot=function(t,e){if(!Tu(t))throw Error(L(299));var n=!1,s="",r=dp;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(s=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=ju(t,1,!1,null,null,n,!1,s,r),t[nn]=e.current,oi(t.nodeType===8?t.parentNode:t),new Cu(e)};gt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(L(188)):(t=Object.keys(t).join(","),Error(L(268,t)));return t=If(e),t=t===null?null:t.stateNode,t};gt.flushSync=function(t){return Zn(t)};gt.hydrate=function(t,e,n){if(!va(e))throw Error(L(200));return wa(null,t,e,!0,n)};gt.hydrateRoot=function(t,e,n){if(!Tu(t))throw Error(L(405));var s=n!=null&&n.hydratedSources||null,r=!1,i="",a=dp;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(a=n.onRecoverableError)),e=up(e,null,t,1,n??null,r,!1,i,a),t[nn]=e.current,oi(t),s)for(t=0;t<s.length;t++)n=s[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new ya(e)};gt.render=function(t,e,n){if(!va(e))throw Error(L(200));return wa(null,t,e,!1,n)};gt.unmountComponentAtNode=function(t){if(!va(t))throw Error(L(40));return t._reactRootContainer?(Zn(function(){wa(null,null,t,!1,function(){t._reactRootContainer=null,t[nn]=null})}),!0):!1};gt.unstable_batchedUpdates=wu;gt.unstable_renderSubtreeIntoContainer=function(t,e,n,s){if(!va(n))throw Error(L(200));if(t==null||t._reactInternals===void 0)throw Error(L(38));return wa(t,e,n,!1,s)};gt.version="18.3.1-next-f1338f8080-20240426";function hp(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(hp)}catch(t){console.error(t)}}hp(),hf.exports=gt;var Jn=hf.exports;const Uv=Jh(Jn);var Lh=Jn;Il.createRoot=Lh.createRoot,Il.hydrateRoot=Lh.hydrateRoot;function _h(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function fp(...t){return e=>{let n=!1;const s=t.map(r=>{const i=_h(r,e);return!n&&typeof i=="function"&&(n=!0),i});if(n)return()=>{for(let r=0;r<s.length;r++){const i=s[r];typeof i=="function"?i():_h(t[r],null)}}}}function es(...t){return m.useCallback(fp(...t),t)}function ra(t){const e=Gv(t),n=m.forwardRef((s,r)=>{const{children:i,...a}=s,l=m.Children.toArray(i),c=l.find(Kv);if(c){const u=c.props.children,f=l.map(h=>h===c?m.Children.count(u)>1?m.Children.only(null):m.isValidElement(u)?u.props.children:null:h);return o.jsx(e,{...a,ref:r,children:m.isValidElement(u)?m.cloneElement(u,void 0,f):null})}return o.jsx(e,{...a,ref:r,children:i})});return n.displayName=`${t}.Slot`,n}var Vv=ra("Slot");function Gv(t){const e=m.forwardRef((n,s)=>{const{children:r,...i}=n;if(m.isValidElement(r)){const a=Zv(r),l=Qv(i,r.props);return r.type!==m.Fragment&&(l.ref=s?fp(s,a):a),m.cloneElement(r,l)}return m.Children.count(r)>1?m.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var qv=Symbol("radix.slottable");function Kv(t){return m.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===qv}function Qv(t,e){const n={...e};for(const s in e){const r=t[s],i=e[s];/^on[A-Z]/.test(s)?r&&i?n[s]=(...l)=>{const c=i(...l);return r(...l),c}:r&&(n[s]=r):s==="style"?n[s]={...r,...i}:s==="className"&&(n[s]=[r,i].filter(Boolean).join(" "))}return{...t,...n}}function Zv(t){var s,r;let e=(s=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:s.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=(r=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:r.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}function mp(t){var e,n,s="";if(typeof t=="string"||typeof t=="number")s+=t;else if(typeof t=="object")if(Array.isArray(t)){var r=t.length;for(e=0;e<r;e++)t[e]&&(n=mp(t[e]))&&(s&&(s+=" "),s+=n)}else for(n in t)t[n]&&(s&&(s+=" "),s+=n);return s}function pp(){for(var t,e,n=0,s="",r=arguments.length;n<r;n++)(t=arguments[n])&&(e=mp(t))&&(s&&(s+=" "),s+=e);return s}const Ih=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,zh=pp,gp=(t,e)=>n=>{var s;if((e==null?void 0:e.variants)==null)return zh(t,n==null?void 0:n.class,n==null?void 0:n.className);const{variants:r,defaultVariants:i}=e,a=Object.keys(r).map(u=>{const f=n==null?void 0:n[u],h=i==null?void 0:i[u];if(f===null)return null;const p=Ih(f)||Ih(h);return r[u][p]}),l=n&&Object.entries(n).reduce((u,f)=>{let[h,p]=f;return p===void 0||(u[h]=p),u},{}),c=e==null||(s=e.compoundVariants)===null||s===void 0?void 0:s.reduce((u,f)=>{let{class:h,className:p,...b}=f;return Object.entries(b).every(y=>{let[S,j]=y;return Array.isArray(j)?j.includes({...i,...l}[S]):{...i,...l}[S]===j})?[...u,h,p]:u},[]);return zh(t,a,c,n==null?void 0:n.class,n==null?void 0:n.className)};function Jv(){for(var t=0,e,n,s="";t<arguments.length;)(e=arguments[t++])&&(n=xp(e))&&(s&&(s+=" "),s+=n);return s}function xp(t){if(typeof t=="string")return t;for(var e,n="",s=0;s<t.length;s++)t[s]&&(e=xp(t[s]))&&(n&&(n+=" "),n+=e);return n}var Mu="-";function e0(t){var e=n0(t),n=t.conflictingClassGroups,s=t.conflictingClassGroupModifiers,r=s===void 0?{}:s;function i(l){var c=l.split(Mu);return c[0]===""&&c.length!==1&&c.shift(),yp(c,e)||t0(l)}function a(l,c){var u=n[l]||[];return c&&r[l]?[].concat(u,r[l]):u}return{getClassGroupId:i,getConflictingClassGroupIds:a}}function yp(t,e){var a;if(t.length===0)return e.classGroupId;var n=t[0],s=e.nextPart.get(n),r=s?yp(t.slice(1),s):void 0;if(r)return r;if(e.validators.length!==0){var i=t.join(Mu);return(a=e.validators.find(function(l){var c=l.validator;return c(i)}))==null?void 0:a.classGroupId}}var Ah=/^\[(.+)\]$/;function t0(t){if(Ah.test(t)){var e=Ah.exec(t)[1],n=e==null?void 0:e.substring(0,e.indexOf(":"));if(n)return"arbitrary.."+n}}function n0(t){var e=t.theme,n=t.prefix,s={nextPart:new Map,validators:[]},r=r0(Object.entries(t.classGroups),n);return r.forEach(function(i){var a=i[0],l=i[1];Cc(l,s,a,e)}),s}function Cc(t,e,n,s){t.forEach(function(r){if(typeof r=="string"){var i=r===""?e:Dh(e,r);i.classGroupId=n;return}if(typeof r=="function"){if(s0(r)){Cc(r(s),e,n,s);return}e.validators.push({validator:r,classGroupId:n});return}Object.entries(r).forEach(function(a){var l=a[0],c=a[1];Cc(c,Dh(e,l),n,s)})})}function Dh(t,e){var n=t;return e.split(Mu).forEach(function(s){n.nextPart.has(s)||n.nextPart.set(s,{nextPart:new Map,validators:[]}),n=n.nextPart.get(s)}),n}function s0(t){return t.isThemeGetter}function r0(t,e){return e?t.map(function(n){var s=n[0],r=n[1],i=r.map(function(a){return typeof a=="string"?e+a:typeof a=="object"?Object.fromEntries(Object.entries(a).map(function(l){var c=l[0],u=l[1];return[e+c,u]})):a});return[s,i]}):t}function i0(t){if(t<1)return{get:function(){},set:function(){}};var e=0,n=new Map,s=new Map;function r(i,a){n.set(i,a),e++,e>t&&(e=0,s=n,n=new Map)}return{get:function(a){var l=n.get(a);if(l!==void 0)return l;if((l=s.get(a))!==void 0)return r(a,l),l},set:function(a,l){n.has(a)?n.set(a,l):r(a,l)}}}var vp="!";function o0(t){var e=t.separator||":",n=e.length===1,s=e[0],r=e.length;return function(a){for(var l=[],c=0,u=0,f,h=0;h<a.length;h++){var p=a[h];if(c===0){if(p===s&&(n||a.slice(h,h+r)===e)){l.push(a.slice(u,h)),u=h+r;continue}if(p==="/"){f=h;continue}}p==="["?c++:p==="]"&&c--}var b=l.length===0?a:a.substring(u),y=b.startsWith(vp),S=y?b.substring(1):b,j=f&&f>u?f-u:void 0;return{modifiers:l,hasImportantModifier:y,baseClassName:S,maybePostfixModifierPosition:j}}}function a0(t){if(t.length<=1)return t;var e=[],n=[];return t.forEach(function(s){var r=s[0]==="[";r?(e.push.apply(e,n.sort().concat([s])),n=[]):n.push(s)}),e.push.apply(e,n.sort()),e}function l0(t){return{cache:i0(t.cacheSize),splitModifiers:o0(t),...e0(t)}}var c0=/\s+/;function u0(t,e){var n=e.splitModifiers,s=e.getClassGroupId,r=e.getConflictingClassGroupIds,i=new Set;return t.trim().split(c0).map(function(a){var l=n(a),c=l.modifiers,u=l.hasImportantModifier,f=l.baseClassName,h=l.maybePostfixModifierPosition,p=s(h?f.substring(0,h):f),b=!!h;if(!p){if(!h)return{isTailwindClass:!1,originalClassName:a};if(p=s(f),!p)return{isTailwindClass:!1,originalClassName:a};b=!1}var y=a0(c).join(":"),S=u?y+vp:y;return{isTailwindClass:!0,modifierId:S,classGroupId:p,originalClassName:a,hasPostfixModifier:b}}).reverse().filter(function(a){if(!a.isTailwindClass)return!0;var l=a.modifierId,c=a.classGroupId,u=a.hasPostfixModifier,f=l+c;return i.has(f)?!1:(i.add(f),r(c,u).forEach(function(h){return i.add(l+h)}),!0)}).reverse().map(function(a){return a.originalClassName}).join(" ")}function d0(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var s,r,i,a=l;function l(u){var f=e[0],h=e.slice(1),p=h.reduce(function(b,y){return y(b)},f());return s=l0(p),r=s.cache.get,i=s.cache.set,a=c,c(u)}function c(u){var f=r(u);if(f)return f;var h=u0(u,s);return i(u,h),h}return function(){return a(Jv.apply(null,arguments))}}function fe(t){var e=function(s){return s[t]||[]};return e.isThemeGetter=!0,e}var wp=/^\[(?:([a-z-]+):)?(.+)\]$/i,h0=/^\d+\/\d+$/,f0=new Set(["px","full","screen"]),m0=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,p0=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,g0=/^-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/;function Mt(t){return Xn(t)||f0.has(t)||h0.test(t)||Tc(t)}function Tc(t){return rs(t,"length",k0)}function x0(t){return rs(t,"size",bp)}function y0(t){return rs(t,"position",bp)}function v0(t){return rs(t,"url",S0)}function uo(t){return rs(t,"number",Xn)}function Xn(t){return!Number.isNaN(Number(t))}function w0(t){return t.endsWith("%")&&Xn(t.slice(0,-1))}function zr(t){return Rh(t)||rs(t,"number",Rh)}function ee(t){return wp.test(t)}function Ar(){return!0}function dn(t){return m0.test(t)}function b0(t){return rs(t,"",j0)}function rs(t,e,n){var s=wp.exec(t);return s?s[1]?s[1]===e:n(s[2]):!1}function k0(t){return p0.test(t)}function bp(){return!1}function S0(t){return t.startsWith("url(")}function Rh(t){return Number.isInteger(Number(t))}function j0(t){return g0.test(t)}function N0(){var t=fe("colors"),e=fe("spacing"),n=fe("blur"),s=fe("brightness"),r=fe("borderColor"),i=fe("borderRadius"),a=fe("borderSpacing"),l=fe("borderWidth"),c=fe("contrast"),u=fe("grayscale"),f=fe("hueRotate"),h=fe("invert"),p=fe("gap"),b=fe("gradientColorStops"),y=fe("gradientColorStopPositions"),S=fe("inset"),j=fe("margin"),v=fe("opacity"),g=fe("padding"),x=fe("saturate"),w=fe("scale"),N=fe("sepia"),T=fe("skew"),P=fe("space"),E=fe("translate"),$=function(){return["auto","contain","none"]},D=function(){return["auto","hidden","clip","visible","scroll"]},G=function(){return["auto",ee,e]},q=function(){return[ee,e]},re=function(){return["",Mt]},X=function(){return["auto",Xn,ee]},ae=function(){return["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"]},je=function(){return["solid","dashed","dotted","double","none"]},Qe=function(){return["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity","plus-lighter"]},z=function(){return["start","end","center","between","around","evenly","stretch"]},B=function(){return["","0",ee]},W=function(){return["auto","avoid","all","avoid-page","page","left","right","column"]},te=function(){return[Xn,uo]},ne=function(){return[Xn,ee]};return{cacheSize:500,theme:{colors:[Ar],spacing:[Mt],blur:["none","",dn,ee],brightness:te(),borderColor:[t],borderRadius:["none","","full",dn,ee],borderSpacing:q(),borderWidth:re(),contrast:te(),grayscale:B(),hueRotate:ne(),invert:B(),gap:q(),gradientColorStops:[t],gradientColorStopPositions:[w0,Tc],inset:G(),margin:G(),opacity:te(),padding:q(),saturate:te(),scale:te(),sepia:B(),skew:ne(),space:q(),translate:q()},classGroups:{aspect:[{aspect:["auto","square","video",ee]}],container:["container"],columns:[{columns:[dn]}],"break-after":[{"break-after":W()}],"break-before":[{"break-before":W()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none"]}],clear:[{clear:["left","right","both","none"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[].concat(ae(),[ee])}],overflow:[{overflow:D()}],"overflow-x":[{"overflow-x":D()}],"overflow-y":[{"overflow-y":D()}],overscroll:[{overscroll:$()}],"overscroll-x":[{"overscroll-x":$()}],"overscroll-y":[{"overscroll-y":$()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[S]}],"inset-x":[{"inset-x":[S]}],"inset-y":[{"inset-y":[S]}],start:[{start:[S]}],end:[{end:[S]}],top:[{top:[S]}],right:[{right:[S]}],bottom:[{bottom:[S]}],left:[{left:[S]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",zr]}],basis:[{basis:G()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",ee]}],grow:[{grow:B()}],shrink:[{shrink:B()}],order:[{order:["first","last","none",zr]}],"grid-cols":[{"grid-cols":[Ar]}],"col-start-end":[{col:["auto",{span:["full",zr]},ee]}],"col-start":[{"col-start":X()}],"col-end":[{"col-end":X()}],"grid-rows":[{"grid-rows":[Ar]}],"row-start-end":[{row:["auto",{span:[zr]},ee]}],"row-start":[{"row-start":X()}],"row-end":[{"row-end":X()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",ee]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",ee]}],gap:[{gap:[p]}],"gap-x":[{"gap-x":[p]}],"gap-y":[{"gap-y":[p]}],"justify-content":[{justify:["normal"].concat(z())}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal"].concat(z(),["baseline"])}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[].concat(z(),["baseline"])}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[g]}],px:[{px:[g]}],py:[{py:[g]}],ps:[{ps:[g]}],pe:[{pe:[g]}],pt:[{pt:[g]}],pr:[{pr:[g]}],pb:[{pb:[g]}],pl:[{pl:[g]}],m:[{m:[j]}],mx:[{mx:[j]}],my:[{my:[j]}],ms:[{ms:[j]}],me:[{me:[j]}],mt:[{mt:[j]}],mr:[{mr:[j]}],mb:[{mb:[j]}],ml:[{ml:[j]}],"space-x":[{"space-x":[P]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[P]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit",ee,e]}],"min-w":[{"min-w":["min","max","fit",ee,Mt]}],"max-w":[{"max-w":["0","none","full","min","max","fit","prose",{screen:[dn]},dn,ee]}],h:[{h:[ee,e,"auto","min","max","fit"]}],"min-h":[{"min-h":["min","max","fit",ee,Mt]}],"max-h":[{"max-h":[ee,e,"min","max","fit"]}],"font-size":[{text:["base",dn,Tc]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",uo]}],"font-family":[{font:[Ar]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",ee]}],"line-clamp":[{"line-clamp":["none",Xn,uo]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",ee,Mt]}],"list-image":[{"list-image":["none",ee]}],"list-style-type":[{list:["none","disc","decimal",ee]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[v]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[v]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[].concat(je(),["wavy"])}],"text-decoration-thickness":[{decoration:["auto","from-font",Mt]}],"underline-offset":[{"underline-offset":["auto",ee,Mt]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],indent:[{indent:q()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",ee]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",ee]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[v]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[].concat(ae(),[y0])}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",x0]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},v0]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[y]}],"gradient-via-pos":[{via:[y]}],"gradient-to-pos":[{to:[y]}],"gradient-from":[{from:[b]}],"gradient-via":[{via:[b]}],"gradient-to":[{to:[b]}],rounded:[{rounded:[i]}],"rounded-s":[{"rounded-s":[i]}],"rounded-e":[{"rounded-e":[i]}],"rounded-t":[{"rounded-t":[i]}],"rounded-r":[{"rounded-r":[i]}],"rounded-b":[{"rounded-b":[i]}],"rounded-l":[{"rounded-l":[i]}],"rounded-ss":[{"rounded-ss":[i]}],"rounded-se":[{"rounded-se":[i]}],"rounded-ee":[{"rounded-ee":[i]}],"rounded-es":[{"rounded-es":[i]}],"rounded-tl":[{"rounded-tl":[i]}],"rounded-tr":[{"rounded-tr":[i]}],"rounded-br":[{"rounded-br":[i]}],"rounded-bl":[{"rounded-bl":[i]}],"border-w":[{border:[l]}],"border-w-x":[{"border-x":[l]}],"border-w-y":[{"border-y":[l]}],"border-w-s":[{"border-s":[l]}],"border-w-e":[{"border-e":[l]}],"border-w-t":[{"border-t":[l]}],"border-w-r":[{"border-r":[l]}],"border-w-b":[{"border-b":[l]}],"border-w-l":[{"border-l":[l]}],"border-opacity":[{"border-opacity":[v]}],"border-style":[{border:[].concat(je(),["hidden"])}],"divide-x":[{"divide-x":[l]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[l]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[v]}],"divide-style":[{divide:je()}],"border-color":[{border:[r]}],"border-color-x":[{"border-x":[r]}],"border-color-y":[{"border-y":[r]}],"border-color-t":[{"border-t":[r]}],"border-color-r":[{"border-r":[r]}],"border-color-b":[{"border-b":[r]}],"border-color-l":[{"border-l":[r]}],"divide-color":[{divide:[r]}],"outline-style":[{outline:[""].concat(je())}],"outline-offset":[{"outline-offset":[ee,Mt]}],"outline-w":[{outline:[Mt]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:re()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[v]}],"ring-offset-w":[{"ring-offset":[Mt]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",dn,b0]}],"shadow-color":[{shadow:[Ar]}],opacity:[{opacity:[v]}],"mix-blend":[{"mix-blend":Qe()}],"bg-blend":[{"bg-blend":Qe()}],filter:[{filter:["","none"]}],blur:[{blur:[n]}],brightness:[{brightness:[s]}],contrast:[{contrast:[c]}],"drop-shadow":[{"drop-shadow":["","none",dn,ee]}],grayscale:[{grayscale:[u]}],"hue-rotate":[{"hue-rotate":[f]}],invert:[{invert:[h]}],saturate:[{saturate:[x]}],sepia:[{sepia:[N]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[n]}],"backdrop-brightness":[{"backdrop-brightness":[s]}],"backdrop-contrast":[{"backdrop-contrast":[c]}],"backdrop-grayscale":[{"backdrop-grayscale":[u]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[f]}],"backdrop-invert":[{"backdrop-invert":[h]}],"backdrop-opacity":[{"backdrop-opacity":[v]}],"backdrop-saturate":[{"backdrop-saturate":[x]}],"backdrop-sepia":[{"backdrop-sepia":[N]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[a]}],"border-spacing-x":[{"border-spacing-x":[a]}],"border-spacing-y":[{"border-spacing-y":[a]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",ee]}],duration:[{duration:ne()}],ease:[{ease:["linear","in","out","in-out",ee]}],delay:[{delay:ne()}],animate:[{animate:["none","spin","ping","pulse","bounce",ee]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[w]}],"scale-x":[{"scale-x":[w]}],"scale-y":[{"scale-y":[w]}],rotate:[{rotate:[zr,ee]}],"translate-x":[{"translate-x":[E]}],"translate-y":[{"translate-y":[E]}],"skew-x":[{"skew-x":[T]}],"skew-y":[{"skew-y":[T]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",ee]}],accent:[{accent:["auto",t]}],appearance:["appearance-none"],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",ee]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":q()}],"scroll-mx":[{"scroll-mx":q()}],"scroll-my":[{"scroll-my":q()}],"scroll-ms":[{"scroll-ms":q()}],"scroll-me":[{"scroll-me":q()}],"scroll-mt":[{"scroll-mt":q()}],"scroll-mr":[{"scroll-mr":q()}],"scroll-mb":[{"scroll-mb":q()}],"scroll-ml":[{"scroll-ml":q()}],"scroll-p":[{"scroll-p":q()}],"scroll-px":[{"scroll-px":q()}],"scroll-py":[{"scroll-py":q()}],"scroll-ps":[{"scroll-ps":q()}],"scroll-pe":[{"scroll-pe":q()}],"scroll-pt":[{"scroll-pt":q()}],"scroll-pr":[{"scroll-pr":q()}],"scroll-pb":[{"scroll-pb":q()}],"scroll-pl":[{"scroll-pl":q()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","pinch-zoom","manipulation",{pan:["x","left","right","y","up","down"]}]}],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",ee]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[Mt,uo]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}}var C0=d0(N0);function lt(...t){return C0(pp(t))}const T0=gp("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),I=m.forwardRef(({className:t,variant:e,size:n,asChild:s=!1,...r},i)=>{const a=s?Vv:"button";return o.jsx(a,{className:lt(T0({variant:e,size:n,className:t})),ref:i,...r})});I.displayName="Button";function M0({className:t,variant:e="default",...n}){const s={default:"bg-primary text-primary-foreground hover:bg-primary/80",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"border border-input text-foreground"};return o.jsx("div",{className:lt("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",s[e],t),...n})}const Q=({content:t,side:e="top",className:n="",children:s,offsetY:r=8})=>{const i=`tooltip-${ye.useId()}`,a=ye.isValidElement(s)?ye.cloneElement(s,{"aria-describedby":i}):o.jsx("span",{tabIndex:0,"aria-describedby":i,className:"inline-flex",children:s}),l=ye.useRef(null),c=ye.useRef(null),u=ye.useRef(null),[f,h]=ye.useState(!1),[p,b]=ye.useState(null),[y,S]=ye.useState(!1),j=ye.useCallback(()=>{let w=r;if(l.current)try{const N=l.current.dataset;if(N&&N.tooltipOffset){const T=parseInt(N.tooltipOffset,10);Number.isNaN(T)||(w=T)}}catch{}return w},[r]),v=ye.useCallback(()=>{if(!l.current)return;const w=l.current.getBoundingClientRect(),N=j(),T=w.left+w.width/2,P=40;let E=w.top;e==="top"?E=w.top-P-N:e==="bottom"||e==="auto"?E=w.bottom+N:E=w.top+w.height/2,b({left:T,top:E})},[e,j]);ye.useEffect(()=>(window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)),[v]);const g=()=>{requestAnimationFrame(()=>v()),h(!0),S(!0)},x=()=>{h(!1),window.setTimeout(()=>S(!1),220)};return ye.useEffect(()=>{if(!f||!u.current||!l.current)return;const w=u.current.getBoundingClientRect(),N=l.current.getBoundingClientRect(),T=j(),P=w.width/2;let E=N.left+N.width/2;const $=8+P,D=window.innerWidth-8-P;E<$&&(E=$),E>D&&(E=D);let G=N.top-w.height-T;(e==="bottom"||e==="auto")&&(G=N.bottom+T),G=Math.max(8,Math.min(window.innerHeight-w.height-8,G)),b({left:E,top:G})},[f,e,j]),o.jsxs(o.Fragment,{children:[o.jsx("span",{ref:l,onMouseEnter:g,onFocus:g,onMouseLeave:x,onBlur:x,className:`relative inline-flex ${n}`,children:a}),typeof document<"u"&&p&&y&&Jn.createPortal(o.jsxs("div",{ref:u,id:i,role:"tooltip",className:`custom-tooltip ${f?"visible":"fade-out"}`,style:{left:p.left,top:p.top,transform:"translateX(-50%)"},children:[o.jsx("span",{ref:c,className:"inline-block text-xs px-3 py-1.5 rounded-md shadow-md max-w-[18rem] break-words",style:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:t}),o.jsx("span",{className:"absolute left-1/2 -translate-x-1/2 mt-[-6px] w-2 h-2 rotate-45 bg-black","aria-hidden":!0})]}),document.body)]})},F=m.forwardRef(({className:t,type:e,...n},s)=>o.jsx("input",{type:e,className:lt("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...n}));F.displayName="Input";function Cs({open:t,onOpenChange:e,children:n}){return t?o.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[o.jsx("div",{className:"fixed inset-0 bg-black/80",onClick:()=>e(!1)}),o.jsx("div",{className:"relative z-50",children:n})]}):null}function Ts({className:t,children:e,...n}){return o.jsx("div",{className:lt("bg-background border border-border rounded-lg p-6 w-full max-w-lg mx-auto shadow-lg",t),...n,children:e})}function Ms({className:t,children:e,...n}){return o.jsx("div",{className:lt("flex flex-col space-y-1.5 text-center sm:text-left",t),...n,children:e})}function Es({className:t,children:e,...n}){return o.jsx("h3",{className:lt("text-lg font-semibold leading-none tracking-tight",t),...n,children:e})}function Ps({className:t,children:e,...n}){return o.jsx("p",{className:lt("text-sm text-muted-foreground",t),...n,children:e})}function Dr({className:t,children:e,...n}){return o.jsx("div",{className:lt("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...n,children:e})}/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E0=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),P0=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,n,s)=>s?s.toUpperCase():n.toLowerCase()),Oh=t=>{const e=P0(t);return e.charAt(0).toUpperCase()+e.slice(1)},kp=(...t)=>t.filter((e,n,s)=>!!e&&e.trim()!==""&&s.indexOf(e)===n).join(" ").trim(),L0=t=>{for(const e in t)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var _0={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I0=m.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:n=2,absoluteStrokeWidth:s,className:r="",children:i,iconNode:a,...l},c)=>m.createElement("svg",{ref:c,..._0,width:e,height:e,stroke:t,strokeWidth:s?Number(n)*24/Number(e):n,className:kp("lucide",r),...!i&&!L0(l)&&{"aria-hidden":"true"},...l},[...a.map(([u,f])=>m.createElement(u,f)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=(t,e)=>{const n=m.forwardRef(({className:s,...r},i)=>m.createElement(I0,{ref:i,iconNode:e,className:kp(`lucide-${E0(Oh(t))}`,`lucide-${t}`,s),...r}));return n.displayName=Oh(t),n};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z0=[["circle",{cx:"9",cy:"9",r:"7",key:"p2h5vp"}],["circle",{cx:"15",cy:"15",r:"7",key:"19ennj"}]],A0=Y("blend",z0);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D0=[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]],R0=Y("box",D0);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O0=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],$0=Y("check",O0);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F0=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],H0=Y("chevron-left",F0);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B0=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Y0=Y("chevron-right",B0);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W0=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Sl=Y("circle-question-mark",W0);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X0=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Rr=Y("circle",X0);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U0=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],V0=Y("clock",U0);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G0=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],q0=Y("download",G0);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K0=[["path",{d:"M21 21H8a2 2 0 0 1-1.42-.587l-3.994-3.999a2 2 0 0 1 0-2.828l10-10a2 2 0 0 1 2.829 0l5.999 6a2 2 0 0 1 0 2.828L12.834 21",key:"g5wo59"}],["path",{d:"m5.082 11.09 8.828 8.828",key:"1wx5vj"}]],jl=Y("eraser",K0);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q0=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Z0=Y("eye-off",Q0);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J0=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ew=Y("eye",J0);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tw=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],nw=Y("folder-open",tw);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sw=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],Po=Y("folder",sw);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rw=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],Mc=Y("grid-3x3",rw);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iw=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],ow=Y("image",iw);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aw=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],$h=Y("link-2",aw);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lw=[["line",{x1:"2",x2:"5",y1:"12",y2:"12",key:"bvdh0s"}],["line",{x1:"19",x2:"22",y1:"12",y2:"12",key:"1tbv5k"}],["line",{x1:"12",x2:"12",y1:"2",y2:"5",key:"11lu5j"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}],["circle",{cx:"12",cy:"12",r:"7",key:"fim9np"}]],cw=Y("locate",lw);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uw=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],Fh=Y("map-pin",uw);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dw=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],Nl=Y("map",dw);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hw=[["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 18h16",key:"19g7jn"}],["path",{d:"M4 6h16",key:"1o0s65"}]],fw=Y("menu",hw);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mw=[["path",{d:"M5 12h14",key:"1ays0h"}]],Ec=Y("minus",mw);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pw=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],gw=Y("moon",pw);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xw=[["path",{d:"M4.037 4.688a.495.495 0 0 1 .651-.651l16 6.5a.5.5 0 0 1-.063.947l-6.124 1.58a2 2 0 0 0-1.438 1.435l-1.579 6.126a.5.5 0 0 1-.947.063z",key:"edeuup"}]],yw=Y("mouse-pointer-2",xw);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vw=[["rect",{x:"5",y:"2",width:"14",height:"20",rx:"7",key:"11ol66"}],["path",{d:"M12 6v4",key:"16clxf"}]],ho=Y("mouse",vw);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ww=[["path",{d:"M12.586 12.586 19 19",key:"ea5xo7"}],["path",{d:"M3.688 3.037a.497.497 0 0 0-.651.651l6.5 15.999a.501.501 0 0 0 .947-.062l1.569-6.083a2 2 0 0 1 1.448-1.479l6.124-1.579a.5.5 0 0 0 .063-.947z",key:"277e5u"}]],bw=Y("mouse-pointer",ww);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kw=[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]],Sw=Y("move",kw);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jw=[["path",{d:"m19 11-8-8-8.6 8.6a2 2 0 0 0 0 2.8l5.2 5.2c.8.8 2 .8 2.8 0L19 11Z",key:"irua1i"}],["path",{d:"m5 2 5 5",key:"1lls2c"}],["path",{d:"M2 13h15",key:"1hkzvu"}],["path",{d:"M22 20a2 2 0 1 1-4 0c0-1.6 1.7-2.4 2-4 .3 1.6 2 2.4 2 4Z",key:"xk76lq"}]],Cl=Y("paint-bucket",jw);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nw=[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v4",key:"qmzblu"}],["path",{d:"M17 2a1 1 0 0 1 1 1v9H6V3a1 1 0 0 1 1-1z",key:"ycvu00"}],["path",{d:"M6 12a1 1 0 0 0-1 1v1a2 2 0 0 0 2 2h2a1 1 0 0 1 1 1v2.9a2 2 0 1 0 4 0V17a1 1 0 0 1 1-1h2a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1",key:"iw4wnp"}]],fo=Y("paintbrush-vertical",Nw);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cw=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Hh=Y("pen",Cw);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tw=[["path",{d:"m12 9-8.414 8.414A2 2 0 0 0 3 18.828v1.344a2 2 0 0 1-.586 1.414A2 2 0 0 1 3.828 21h1.344a2 2 0 0 0 1.414-.586L15 12",key:"1y3wsu"}],["path",{d:"m18 9 .4.4a1 1 0 1 1-3 3l-3.8-3.8a1 1 0 1 1 3-3l.4.4 3.4-3.4a1 1 0 1 1 3 3z",key:"110lr1"}],["path",{d:"m2 22 .414-.414",key:"jhxm08"}]],Bh=Y("pipette",Tw);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mw=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Lo=Y("plus",Mw);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ew=[["path",{d:"m15 14 5-5-5-5",key:"12vg1m"}],["path",{d:"M20 9H9.5A5.5 5.5 0 0 0 4 14.5A5.5 5.5 0 0 0 9.5 20H13",key:"6uklza"}]],Pw=Y("redo-2",Ew);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lw=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],_w=Y("rotate-ccw",Lw);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Iw=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],Yh=Y("save",Iw);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zw=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]],Wh=Y("scan",zw);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aw=[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]],Dw=Y("scissors",Aw);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rw=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Xh=Y("settings",Rw);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ow=[["path",{d:"M8.3 10a.7.7 0 0 1-.626-1.079L11.4 3a.7.7 0 0 1 1.198-.043L16.3 8.9a.7.7 0 0 1-.572 1.1Z",key:"1bo67w"}],["rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",key:"1bkyp8"}],["circle",{cx:"17.5",cy:"17.5",r:"3.5",key:"w3z12y"}]],$w=Y("shapes",Ow);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fw=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Tl=Y("shield",Fw);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hw=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],Hn=Y("square",Hw);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bw=[["path",{d:"M14 13V8.5C14 7 15 7 15 5a3 3 0 0 0-6 0c0 2 1 2 1 3.5V13",key:"i9gjdv"}],["path",{d:"M20 15.5a2.5 2.5 0 0 0-2.5-2.5h-11A2.5 2.5 0 0 0 4 15.5V17a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1z",key:"1vzg3v"}],["path",{d:"M5 22h14",key:"ehvnwv"}]],Yw=Y("stamp",Bw);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ww=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],Xw=Y("sun",Ww);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uw=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],js=Y("target",Uw);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vw=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Gw=Y("trash-2",Vw);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qw=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Kw=Y("triangle-alert",qw);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qw=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],Zw=Y("undo-2",Qw);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jw=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],mo=Y("upload",Jw);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e1=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],t1=Y("users",e1);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n1=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],Ml=Y("wand-sparkles",n1);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s1=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Ue=Y("x",s1);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r1=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],i1=Y("zoom-in",r1);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o1=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],a1=Y("zoom-out",o1),l1=new Set(["collision_tileset.png"]),Ns="collision",Uh="collision_tileset.png",c1={1:"Blocks all, very visible at minimap",2:"Blocks ground units, less visible at minimap",3:"Blocks all, not visible at minimap",4:"Blocks ground units, not visible at minimap"};class El{constructor(e){this.projectName="",this.tilesetImage=null,this.tilesetFileName=null,this.tilesetColumns=0,this.tilesetRows=0,this.tileCount=0,this.showMinimap=!0,this.isDarkMode=!1,this.debugMode=!1,this.resizeObserver=null,this.boundResizeHandler=null,this.boundMouseDown=null,this.boundMouseMove=null,this.boundMouseUp=null,this.boundMouseLeave=null,this.boundWheel=null,this.boundContextMenu=null,this.mapWidth=20,this.mapHeight=15,this.mapName="Untitled Map",this.tileSizeX=64,this.tileSizeY=32,this.orientation="isometric",this.tileContentThreshold=10,this.objectSeparationSensitivity=.5,this.detectedTileData=new Map,this.layerTilesets=new Map,this.collisionTilesetLoading=!1,this.collisionTooltipEl=null,this.collisionTooltipHideTimeout=null,this.nextLayerTabId=1,this.layerTabs=new Map,this.layerActiveTabId=new Map,this.layerTileData=new Map,this.layerActiveGid=new Map,this.tilesets=[],this.tilesetSourcePath=null,this.tileLayers=[],this.activeLayerId=null,this.nextLayerId=1,this.collisionData=[],this.objects=[],this.selectedObject=null,this.nextObjectId=1,this.selectedObjectId=null,this.isDraggingActor=!1,this.draggingActorId=null,this.heroX=0,this.heroY=0,this.isDraggingHero=!1,this.heroLastClickTime=0,this.tool="tiles",this.currentTool="brush",this.currentSelectionTool="rectangular",this.currentShapeTool="rectangle",this.currentStampMode="select",this.activeGid=0,this.multiSelectedBrushes=new Set,this.isMouseDown=!1,this.selection={active:!1,startX:-1,startY:-1,endX:-1,endY:-1,tiles:[]},this.isSelecting=!1,this.shapeDrawing={active:!1,startX:-1,startY:-1,endX:-1,endY:-1,preview:[]},this.isDrawingShape=!1,this.hoverX=-1,this.hoverY=-1,this.zoom=1,this.panX=0,this.panY=0,this.isPanning=!1,this.lastPanX=0,this.lastPanY=0,this.spacePressed=!1,this.history=[],this.historyIndex=-1,this.maxHistorySize=50,this.isApplyingHistory=!1,this.hasUnsavedChanges=!1,this.autoSaveTimeout=null,this.lastSaveTimestamp=0,this.autoSaveCallback=null,this.saveStatusCallback=null,this.activeGidCallback=null,this.AUTO_SAVE_DELAY=8e3,this.IMMEDIATE_SAVE_DELAY=2e3,this.autoSaveEnabled=!0,this.sidebarTransitioning=!1,this.lastMiniMapPos=null,this.eyedropperCallback=null,this.objectsChangedCallback=null,this.stamps=new Map,this.activeStamp=null,this.stampPreview={x:0,y:0,visible:!1},this.stampCallback=null,this.heroEditCallback=null,this.mapCanvas=e,this.initializeCanvas(),this.initializeState(),this.bindEvents(),this.createDefaultLayers(),this.saveState(),this.draw()}exportSettingsTxt(e){const n=window.require?window.require("fs"):null;if(!n){console.warn("fs module not available. Cannot write settings.txt");return}const s=`#this file is necesserey to work this project run in flare. please do not remove it. -Ism
description=${this.projectName||"--> Project Name comes here."}
game=flare_studio_game
version=1.14
engine_version_min=1.13.01
`,r=n.existsSync(e)?`${e}/settings.txt`:"settings.txt";try{n.writeFileSync(r,s,"utf8"),console.log("settings.txt exported to",r)}catch(i){console.error("Failed to write settings.txt:",i)}}getTileCount(){return this.tileCount}setTileContentThreshold(e){this.tileContentThreshold=Math.max(0,Math.min(255,e))}getTileContentThreshold(){return this.tileContentThreshold}refreshTilePalette(e=!1){this.tilesetImage&&this.createTilePalette(e)}getDetectedTileInfo(){const e=[];return this.detectedTileData.forEach((n,s)=>{e.push({gid:s,width:n.width,height:n.height,sourceX:n.sourceX,sourceY:n.sourceY})}),e.sort((n,s)=>n.gid-s.gid)}getDetectedTilesForLayer(e){const n=this.layerTileData.get(e);return n?Array.from(n.entries()):[]}getCurrentLayerActiveGid(){const e=this.tileLayers.find(n=>n.id===this.activeLayerId);return e&&this.layerActiveGid.get(e.type)||0}setCurrentLayerActiveGid(e){const n=this.tileLayers.find(s=>s.id===this.activeLayerId);if(n&&(this.layerActiveGid.set(n.type,e),this.activeGid=e,this.activeGidCallback))try{this.activeGidCallback(this.activeGid)}catch(s){console.warn("activeGidCallback error",s)}}mergeBrushes(e){if(e.length<2)return;const n=e.map(h=>this.detectedTileData.get(h)).filter(h=>h!==void 0);if(n.length!==e.length)throw new Error("Some selected brushes not found");let s=Number.MAX_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER,a=Number.MIN_SAFE_INTEGER;for(const h of n)s=Math.min(s,h.sourceX),r=Math.min(r,h.sourceY),i=Math.max(i,h.sourceX+h.width),a=Math.max(a,h.sourceY+h.height);const l={sourceX:s,sourceY:r,width:i-s,height:a-r},c=Array.from(this.detectedTileData.entries()),u=c.findIndex(([h])=>e.includes(h)),f=c.filter(([h])=>!e.includes(h));f.splice(u,0,[e[0],l]),this.detectedTileData.clear(),f.forEach(([h,p],b)=>{this.detectedTileData.set(b,p)}),this.createTilePalette(!0),this.markAsChanged(!0),console.log(`Merged ${e.length} brushes into new brush at position ${u}`)}separateBrush(e){console.log(`separateBrush called with brushId: ${e}`);const n=this.detectedTileData.get(e);if(!n)throw console.error(`Brush ${e} not found`),new Error(`Brush ${e} not found`);console.log(`Separating brush ${e} with data:`,n);const s=Array.from(this.detectedTileData.entries()),r=s.findIndex(([l])=>l===e),i=s.filter(([l])=>l!==e),a=[];if(this.tilesetImage){const l=document.createElement("canvas");l.width=n.width,l.height=n.height;const c=l.getContext("2d");if(c){c.drawImage(this.tilesetImage,n.sourceX,n.sourceY,n.width,n.height,0,0,n.width,n.height);const f=c.getImageData(0,0,n.width,n.height).data;console.log(`Analyzing brush area: ${n.width}x${n.height}`);const h=this.findVerticalGaps(f,n.width,n.height);if(console.log("Found vertical gaps:",h),h.length>0){let p=0;for(const b of h){if(b>p){const y=b-p,S=this.findObjectBoundsInRegion(f,n.width,n.height,p,0,y,n.height);S&&S.width>0&&S.height>0&&a.push({sourceX:n.sourceX+S.x,sourceY:n.sourceY+S.y,width:S.width,height:S.height})}p=b+1}if(p<n.width){const b=n.width-p,y=this.findObjectBoundsInRegion(f,n.width,n.height,p,0,b,n.height);y&&y.width>0&&y.height>0&&a.push({sourceX:n.sourceX+y.x,sourceY:n.sourceY+y.y,width:y.width,height:y.height})}}else{const p=new Array(n.width*n.height).fill(!1);for(let b=0;b<n.height;b++)for(let y=0;y<n.width;y++){const S=b*n.width+y;if(p[S]||this.isPixelTransparent(f,y,b,n.width))continue;console.log(`Starting flood fill at pixel (${y}, ${b})`);const j=this.floodFillObjectDataInRegion(f,n.width,n.height,y,b,p);j&&this.isValidObjectSize(j.bounds)?(console.log("Found valid connected component:",j),a.push({sourceX:n.sourceX+j.bounds.x,sourceY:n.sourceY+j.bounds.y,width:j.bounds.width,height:j.bounds.height})):j&&console.log("Found invalid connected component (too small):",j)}}}}if(console.log(`Found ${a.length} new brushes from separation:`,a),a.length<=1){console.log(`No separation needed - only found ${a.length} component(s)`);return}a.forEach((l,c)=>{i.splice(r+c,0,[r+c,l])}),this.detectedTileData.clear(),i.forEach(([l,c],u)=>{this.detectedTileData.set(u,c)}),this.createTilePalette(!0),this.markAsChanged(!0),console.log(`Separated brush ${e} into ${a.length} new brushes`)}removeBrush(e){if(console.log(`removeBrush called with brushId: ${e}`),console.log("detectedTileData keys before removal:",Array.from(this.detectedTileData.keys())),!this.detectedTileData.has(e))throw console.error(`Brush ${e} not found in detectedTileData`),new Error(`Brush ${e} not found`);const n=Array.from(this.detectedTileData.entries());console.log("brushArray before filtering:",n.map(([r,i])=>r));const s=n.filter(([r])=>r!==e);console.log("filteredArray after filtering:",s.map(([r,i])=>r)),this.detectedTileData.clear(),s.forEach(([r,i],a)=>{this.detectedTileData.set(a,i)}),console.log("detectedTileData keys after rebuild:",Array.from(this.detectedTileData.keys())),this.createTilePalette(!0),this.markAsChanged(!0),console.log(`Removed brush ${e}`)}reorderBrush(e,n){const s=Array.from(this.detectedTileData.entries());if(e<0||e>=s.length||n<0||n>=s.length)throw new Error("Invalid brush indices for reordering");const[r]=s.splice(e,1);s.splice(n,0,r),this.detectedTileData.clear(),s.forEach(([i,a],l)=>{this.detectedTileData.set(l,a)}),this.createTilePalette(!0),this.markAsChanged(!0),console.log(`Reordered brush from index ${e} to ${n}`)}findVerticalGaps(e,n,s){const r=[];for(let i=1;i<n-1;i++){let a=!1;for(let l=0;l<s;l++)if(!this.isPixelTransparent(e,i,l,n)){a=!0;break}if(!a){let l=!1,c=!1;for(let u=0;u<s;u++)if(!this.isPixelTransparent(e,i-1,u,n)){l=!0;break}for(let u=0;u<s;u++)if(!this.isPixelTransparent(e,i+1,u,n)){c=!0;break}l&&c&&r.push(i)}}return console.log(`Detected ${r.length} vertical gaps at columns:`,r),r}findObjectBoundsInRegion(e,n,s,r,i,a,l){let c=r+a,u=r,f=i+l,h=i,p=!1;for(let b=i;b<i+l&&b<s;b++)for(let y=r;y<r+a&&y<n;y++)this.isPixelTransparent(e,y,b,n)||(p=!0,c=Math.min(c,y),u=Math.max(u,y),f=Math.min(f,b),h=Math.max(h,b));return p?{x:c,y:f,width:u-c+1,height:h-f+1}:null}floodFillObjectDataInRegion(e,n,s,r,i,a){const l=[{x:r,y:i}];let c=r,u=r,f=i,h=i,p=0;const b=[];for(;l.length>0;){const x=l.pop(),{x:w,y:N}=x;if(w<0||w>=n||N<0||N>=s)continue;const T=N*n+w;a[T]||this.isPixelTransparent(e,w,N,n)||(a[T]=!0,p++,b.push({x:w,y:N}),c=Math.min(c,w),u=Math.max(u,w),f=Math.min(f,N),h=Math.max(h,N),l.push({x:w+1,y:N}),l.push({x:w-1,y:N}),l.push({x:w,y:N+1}),l.push({x:w,y:N-1}))}if(p===0)return null;const y=1,S=Math.max(0,c-y),j=Math.max(0,f-y),v=Math.min(n-1,u+y),g=Math.min(s-1,h+y);return{bounds:{x:S,y:j,width:v-S+1,height:g-j+1},pixels:b}}ensureCollisionTileset(){if(this.layerTilesets.has(Ns)||this.collisionTilesetLoading)return;const e=this.resolveInternalAssetPath(Uh);if(!e){console.warn("Unable to resolve collision tileset asset path");return}this.collisionTilesetLoading=!0;const n=new Image;n.onload=()=>{const s=Math.max(1,Math.floor(n.width/this.tileSizeX)),r=Math.max(1,Math.floor(n.height/this.tileSizeY)),i=Math.max(1,s*r);this.layerTilesets.set(Ns,{image:n,fileName:Uh,columns:s,rows:r,count:i,tileWidth:this.tileSizeX,tileHeight:this.tileSizeY,spacing:0,margin:0,sourcePath:e}),this.collisionTilesetLoading=!1,this.getCurrentLayerType()===Ns&&(this.updateCurrentTileset(Ns),this.draw())},n.onerror=s=>{console.warn("Failed to load default collision tileset.",s),this.collisionTilesetLoading=!1},n.src=e}clearCollisionBrushTooltipHideTimeout(){this.collisionTooltipHideTimeout!==null&&(window.clearTimeout(this.collisionTooltipHideTimeout),this.collisionTooltipHideTimeout=null)}getCollisionTooltipElement(){if(typeof document>"u")return null;if(!this.collisionTooltipEl){const e=document.createElement("div");e.dataset.collisionTooltip="true",e.setAttribute("role","tooltip"),e.setAttribute("aria-hidden","true"),e.style.position="fixed",e.style.pointerEvents="none",e.style.zIndex="9999",e.style.maxWidth="260px",e.style.padding="6px 10px",e.style.fontSize="12px",e.style.lineHeight="1.2",e.style.fontWeight="500",e.style.color="#f5f5f5",e.style.background="rgba(15, 15, 16, 0.92)",e.style.border="1px solid rgba(255, 255, 255, 0.08)",e.style.borderRadius="8px",e.style.boxShadow="0 12px 32px rgba(0, 0, 0, 0.35)",e.style.backdropFilter="blur(4px)",e.style.opacity="0",e.style.transform="translateY(0)",e.style.transition="opacity 120ms ease, transform 120ms ease",e.style.whiteSpace="nowrap",e.style.display="none",document.body.appendChild(e),this.collisionTooltipEl=e}return this.collisionTooltipEl}positionCollisionBrushTooltip(e,n,s){const i=n.getBoundingClientRect(),a=window.innerWidth,l=window.innerHeight,c=s?s.clientX:i.left+i.width/2;let u=(s?s.clientY:i.top)-e.offsetHeight-12,f=!1;u<12&&(f=!0,u=(s?s.clientY:i.bottom)+12);let h=c-e.offsetWidth/2;return h<12?h=12:h+e.offsetWidth>a-12&&(h=a-12-e.offsetWidth),u+e.offsetHeight>l-12&&(u=Math.max(12,l-12-e.offsetHeight)),e.style.left=`${Math.round(h)}px`,e.style.top=`${Math.round(u)}px`,f}showCollisionBrushTooltip(e,n,s){const r=this.getCollisionTooltipElement();if(!r)return;this.clearCollisionBrushTooltipHideTimeout(),r.textContent=n,r.setAttribute("aria-hidden","false"),r.style.display="block",r.style.opacity="0";const i=this.positionCollisionBrushTooltip(r,e,s);r.style.transform=`translateY(${i?"6px":"-6px"})`,requestAnimationFrame(()=>{r.style.opacity="1",r.style.transform="translateY(0)"})}updateCollisionBrushTooltipPosition(e,n){const s=this.collisionTooltipEl;!s||s.style.display==="none"||(this.clearCollisionBrushTooltipHideTimeout(),this.positionCollisionBrushTooltip(s,e,n),s.style.transform="translateY(0)")}getLayerTilesetOrFallback(e){const n=this.layerTilesets.get(e);if(n&&n.image)return n;if(e==="background"&&this.tilesetImage&&this.tilesetFileName){const s=this.tilesetColumns||Math.max(1,Math.floor(this.tilesetImage.width/this.tileSizeX)),r=this.tilesetRows||Math.max(1,Math.floor(this.tilesetImage.height/this.tileSizeY)),i=this.tileCount||Math.max(1,s*r),a=this.tilesetTileWidth??Math.round(this.tilesetImage.width/Math.max(s,1)),l=this.tilesetTileHeight??Math.round(this.tilesetImage.height/Math.max(r,1));return{image:this.tilesetImage,fileName:this.tilesetFileName,columns:s,rows:r,count:i,tileWidth:a,tileHeight:l,spacing:this.tilesetSpacing??0,margin:this.tilesetMargin??0,sourcePath:this.tilesetSourcePath??null}}return n??null}hideCollisionBrushTooltip(e=!1){const n=this.collisionTooltipEl;if(n){if(this.clearCollisionBrushTooltipHideTimeout(),n.setAttribute("aria-hidden","true"),n.style.opacity="0",e){n.style.display="none";return}this.collisionTooltipHideTimeout=window.setTimeout(()=>{this.collisionTooltipEl===n&&(n.style.display="none"),this.collisionTooltipHideTimeout=null},150)}}snapshotLayerGids(){const e=new Map;for(const n of this.tileLayers){const s=new Set;let r=0;for(const i of n.data)i>0&&(r++,s.add(i));e.set(n.type,{unique:Array.from(s).sort((i,a)=>i-a),nonZeroCount:r})}return e}logLayerGidChanges(e,n,s){for(const[r,i]of n.entries()){if(r===s)continue;const a=e.get(r);if(!a)continue;const l=a.unique.length!==i.unique.length||a.unique.some((u,f)=>u!==i.unique[f]),c=a.nonZeroCount!==i.nonZeroCount;(l||c)&&console.warn("[GID DEBUG]",{sourceLayerType:s,layerType:r,before:a,after:i})}}updateActiveGid(e){if(this.activeGid=e,this.activeGidCallback)try{this.activeGidCallback(this.activeGid)}catch(n){console.warn("activeGidCallback error",n)}}setActiveGidCallback(e){if(this.activeGidCallback=e,e)try{e(this.activeGid)}catch(n){console.warn("setActiveGidCallback initial callback error",n)}}initializeCanvas(){const e=this.mapCanvas.getContext("2d");if(!e)throw new Error("Unable to get canvas context");this.ctx=e,this.ctx.imageSmoothingEnabled=!1,this.cleanupCanvasObservers(),this.resizeCanvas(),this.boundResizeHandler=()=>this.resizeCanvas(),window.addEventListener("resize",this.boundResizeHandler),window.ResizeObserver&&(this.resizeObserver=new ResizeObserver(()=>this.resizeCanvas()),this.mapCanvas.parentElement&&this.resizeObserver.observe(this.mapCanvas.parentElement))}cleanupCanvasObservers(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.boundResizeHandler&&(window.removeEventListener("resize",this.boundResizeHandler),this.boundResizeHandler=null)}cleanupCanvasEvents(){this.boundMouseDown&&(this.mapCanvas.removeEventListener("mousedown",this.boundMouseDown),this.boundMouseDown=null),this.boundMouseMove&&(this.mapCanvas.removeEventListener("mousemove",this.boundMouseMove),this.boundMouseMove=null),this.boundMouseUp&&(this.mapCanvas.removeEventListener("mouseup",this.boundMouseUp),this.boundMouseUp=null),this.boundMouseLeave&&(this.mapCanvas.removeEventListener("mouseleave",this.boundMouseLeave),this.boundMouseLeave=null),this.boundWheel&&(this.mapCanvas.removeEventListener("wheel",this.boundWheel),this.boundWheel=null),this.boundContextMenu&&(this.mapCanvas.removeEventListener("contextmenu",this.boundContextMenu),this.boundContextMenu=null)}resizeCanvas(){const e=this.mapCanvas.parentElement;e&&requestAnimationFrame(()=>{const n=e.getBoundingClientRect(),s=Math.max(1,Math.floor(n.width)),r=Math.max(1,Math.floor(n.height));(this.mapCanvas.width!==s||this.mapCanvas.height!==r)&&(this.mapCanvas.width=s,this.mapCanvas.height=r,this.draw())})}initializeState(){this.collisionData=new Array(this.mapWidth*this.mapHeight).fill(0)}bindEvents(){this.cleanupCanvasEvents(),this.boundMouseDown=this.handleMouseDown.bind(this),this.boundMouseMove=this.handleMouseMove.bind(this),this.boundMouseUp=this.handleMouseUp.bind(this),this.boundMouseLeave=this.handleMouseLeave.bind(this),this.boundWheel=this.handleWheel.bind(this),this.boundContextMenu=e=>e.preventDefault(),this.mapCanvas.addEventListener("mousedown",this.boundMouseDown),this.mapCanvas.addEventListener("mousemove",this.boundMouseMove),this.mapCanvas.addEventListener("mouseup",this.boundMouseUp),this.mapCanvas.addEventListener("mouseleave",this.boundMouseLeave),this.mapCanvas.addEventListener("contextmenu",this.boundContextMenu),this.mapCanvas.addEventListener("wheel",this.boundWheel),document.addEventListener("keydown",this.handleKeyDown.bind(this)),document.addEventListener("keyup",this.handleKeyUp.bind(this)),this.mapCanvas.tabIndex=0}createDefaultLayers(){this.tileLayers=[{id:1,name:"NPC Layer",type:"npc",data:new Array(this.mapWidth*this.mapHeight).fill(0),visible:!0,transparency:1},{id:2,name:"Enemy Layer",type:"enemy",data:new Array(this.mapWidth*this.mapHeight).fill(0),visible:!0,transparency:1},{id:3,name:"Event Layer",type:"event",data:new Array(this.mapWidth*this.mapHeight).fill(0),visible:!0,transparency:1},{id:4,name:"Collision Layer",type:"collision",data:new Array(this.mapWidth*this.mapHeight).fill(0),visible:!0,transparency:1},{id:5,name:"Object Layer",type:"object",data:new Array(this.mapWidth*this.mapHeight).fill(0),visible:!0,transparency:1},{id:6,name:"Background Layer",type:"background",data:new Array(this.mapWidth*this.mapHeight).fill(0),visible:!0,transparency:1}],this.activeLayerId=6,this.nextLayerId=7,this.sortLayersByPriority();try{this.layerTabs.clear(),this.layerActiveTabId.clear();const e=this.tileLayers.some(s=>s.type==="object"),n=this.tileLayers.some(s=>s.type==="background");if(e){const s=this.createLayerTab("object");this.setActiveLayerTab("object",s)}if(n){const s=this.createLayerTab("background");this.setActiveLayerTab("background",s)}}catch(e){console.warn("Failed to initialize default layer tabs",e)}this.ensureCollisionTileset()}getDraggableActorAt(e,n){return e<0||n<0?null:this.objects.find(s=>s.x===e&&s.y===n&&this.actorUsesPlaceholder(s))||null}handleActorDrag(e,n){if(!this.isDraggingActor||this.draggingActorId===null||e<0||n<0||e>=this.mapWidth||n>=this.mapHeight)return;const s=this.objects.find(r=>r.id===this.draggingActorId);s&&(s.x===e&&s.y===n||(this.updateMapObject(s.id,{x:e,y:n}),this.draw()))}handleMouseDown(e){const n=this.mapCanvas.getBoundingClientRect(),s=e.clientX-n.left,r=e.clientY-n.top;if(this.spacePressed)this.isPanning=!0,this.lastPanX=s,this.lastPanY=r,this.mapCanvas.style.cursor="grabbing";else{this.isMouseDown=!0;const i=this.screenToTile(s,r);if(i){if(this.isHeroAtPosition(i.x,i.y)){this.handleHeroClick(i.x,i.y,e);return}const a=this.getDraggableActorAt(i.x,i.y);if(a){this.isDraggingActor=!0,this.draggingActorId=a.id,this.selectedObject=a,this.selectedObjectId=a.id;return}this.tool==="tiles"?this.handleTileClick(i.x,i.y,e.button===2):this.tool==="selection"?this.handleSelectionStart(i.x,i.y,e.button===2):this.tool==="shape"?this.handleShapeStart(i.x,i.y,e.button===2):this.tool==="eyedropper"?this.handleEyedropper(i.x,i.y)&&(this.isMouseDown=!1):this.tool==="stamp"&&this.handleStampClick(i.x,i.y,e.button===2)}}}handleMouseMove(e){const n=this.mapCanvas.getBoundingClientRect(),s=e.clientX-n.left,r=e.clientY-n.top;if(this.isPanning&&this.spacePressed){const i=s-this.lastPanX,a=r-this.lastPanY;this.setPan(i,a),this.lastPanX=s,this.lastPanY=r}else{const i=this.screenToTile(s,r);i&&(this.hoverX=i.x,this.hoverY=i.y,this.updateCursorForHover(),this.tool==="stamp"&&this.currentStampMode==="place"&&this.activeStamp&&(this.stampPreview.x=i.x,this.stampPreview.y=i.y,this.stampPreview.visible=!0),this.isMouseDown&&!this.spacePressed&&(this.isDraggingHero?this.setHeroPosition(i.x,i.y):this.isDraggingActor?this.handleActorDrag(i.x,i.y):this.tool==="tiles"?this.handleTileClick(i.x,i.y,!1):this.isSelecting?this.handleSelectionDrag(i.x,i.y):this.isDrawingShape&&this.handleShapeDrag(i.x,i.y)))}this.draw()}handleMouseUp(){this.isSelecting?this.handleSelectionEnd():this.isDrawingShape&&this.handleShapeEnd(),this.isDraggingHero&&(this.isDraggingHero=!1),this.isDraggingActor&&(this.isDraggingActor=!1,this.draggingActorId=null),this.isMouseDown=!1,this.isPanning=!1}handleMouseLeave(){this.hideObjectTooltip(),this.hoverX=-1,this.hoverY=-1,this.isDraggingActor=!1,this.draggingActorId=null,this.draw()}handleHeroClick(e,n,s){const r=Date.now();r-this.heroLastClickTime<300?this.openHeroEditDialog():this.isDraggingHero=!0,this.heroLastClickTime=r}openHeroEditDialog(){this.heroEditCallback?this.heroEditCallback(this.heroX,this.heroY,this.mapWidth,this.mapHeight,(e,n)=>{this.setHeroPosition(e,n)}):alert(`Hero position: (${this.heroX}, ${this.heroY}). Set up hero edit dialog in React component.`)}handleWheel(e){e.preventDefault();const n=e.deltaY>0?.9:1.1;this.setZoom(this.zoom*n)}handleKeyDown(e){if(e.code==="Space"&&(e.preventDefault(),this.spacePressed=!0,this.mapCanvas.style.cursor="grab"),e.ctrlKey||e.metaKey)switch(e.code){case"KeyZ":e.preventDefault(),e.shiftKey?this.redo():this.undo();break;case"KeyY":e.preventDefault(),this.redo();break;case"KeyA":e.preventDefault(),this.selectAll();break}switch(e.code){case"Delete":case"Backspace":e.preventDefault(),this.deleteSelection();break;case"Escape":e.preventDefault(),this.clearSelection(),this.isDrawingShape&&(this.shapeDrawing.active=!1,this.isDrawingShape=!1,this.shapeDrawing.preview=[],this.draw());break}}handleKeyUp(e){e.code==="Space"&&(e.preventDefault(),this.spacePressed=!1,this.mapCanvas.style.cursor="crosshair")}screenToTile(e,n){const s=this.screenToWorld(e,n);return this.raycastToTile(s.x,s.y)}handleStampClick(e,n,s){if(s){this.stampPreview.visible=!1,this.draw();return}this.currentStampMode==="create"?this.handleSelectionStart(e,n,s):this.currentStampMode==="place"&&this.activeStamp&&this.placeStamp(e,n)}handleTileClick(e,n,s){if(this.activeLayerId!==null){const r=this.tileLayers.find(i=>i.id===this.activeLayerId);if(r){const i=n*this.mapWidth+e,a=r.data[i];let l;const c=this.getCurrentLayerActiveGid();if(s)l=0;else switch(this.currentTool){case"brush":if(c===0&&this.multiSelectedBrushes.size===0)return;if(this.multiSelectedBrushes.size>1){this.saveState(),this.placeMultiSelectionAt(e,n),this.markAsChanged();return}l=c;break;case"eraser":l=0;break;case"bucket":if(c===0)return;a!==c&&(this.saveState(),this.bucketFill(r,e,n,c),this.markAsChanged(),this.draw());return;default:if(c===0)return;l=c;break}a!==l&&(this.saveState(),console.log(`Painting on layer: ${r.name} (ID: ${r.id}, Type: ${r.type})`),console.log(`Position: (${e}, ${n}), Index: ${i}`),console.log(`Current value: ${a}, New value: ${l}`),console.log(`Active GID for this layer: ${c}`),r.data[i]=l,(r.type==="event"||r.type==="enemy"||r.type==="npc"||r.type==="object")&&(l>0?this.createObjectFromTile(e,n,r.type,l):this.removeObjectAtPosition(e,n)),this.markAsChanged(),this.draw())}}}handleSelectionStart(e,n,s){if(s){this.clearSelection();return}const r=this.tileLayers.find(i=>i.id===this.activeLayerId);r&&(this.selection.startX=e,this.selection.startY=n,this.selection.endX=e,this.selection.endY=n,this.currentSelectionTool==="magic-wand"?(this.selectMagicWand(r,e,n),this.draw()):this.currentSelectionTool==="same-tile"?(this.selectSameTile(r,e,n),this.draw()):this.isSelecting=!0)}handleSelectionDrag(e,n){this.isSelecting&&(this.selection.endX=e,this.selection.endY=n,this.draw())}handleSelectionEnd(){if(!this.isSelecting)return;const e=this.tileLayers.find(n=>n.id===this.activeLayerId);e&&(this.currentSelectionTool==="rectangular"?this.selectRectangular(e,this.selection.startX,this.selection.startY,this.selection.endX,this.selection.endY):this.currentSelectionTool==="circular"&&this.selectCircular(e,this.selection.startX,this.selection.startY,this.selection.endX,this.selection.endY),this.isSelecting=!1,this.draw())}handleShapeStart(e,n,s){if(s){this.shapeDrawing.active=!1,this.isDrawingShape=!1,this.draw();return}this.shapeDrawing.active=!0,this.shapeDrawing.startX=e,this.shapeDrawing.startY=n,this.shapeDrawing.endX=e,this.shapeDrawing.endY=n,this.shapeDrawing.preview=[],this.isDrawingShape=!0}handleShapeDrag(e,n){if(this.isDrawingShape){switch(this.shapeDrawing.endX=e,this.shapeDrawing.endY=n,this.currentShapeTool){case"rectangle":this.shapeDrawing.preview=this.drawRectangleShape(this.shapeDrawing.startX,this.shapeDrawing.startY,this.shapeDrawing.endX,this.shapeDrawing.endY);break;case"circle":this.shapeDrawing.preview=this.drawCircleShape(this.shapeDrawing.startX,this.shapeDrawing.startY,this.shapeDrawing.endX,this.shapeDrawing.endY);break;case"line":this.shapeDrawing.preview=this.drawLineShape(this.shapeDrawing.startX,this.shapeDrawing.startY,this.shapeDrawing.endX,this.shapeDrawing.endY);break}this.draw()}}handleShapeEnd(){if(!this.isDrawingShape)return;const e=this.tileLayers.find(s=>s.id===this.activeLayerId);if(!e)return;const n=this.getCurrentLayerActiveGid();this.shapeDrawing.preview.length>0&&n>0&&(this.saveState(),this.shapeDrawing.preview.forEach(s=>{const r=s.y*this.mapWidth+s.x;e.data[r]=n}),this.markAsChanged()),this.shapeDrawing.active=!1,this.isDrawingShape=!1,this.shapeDrawing.preview=[],this.draw()}handleEyedropper(e,n){const s=this.tileLayers.find(r=>r.id===this.activeLayerId);if(!s)return null;if(e>=0&&e<this.mapWidth&&n>=0&&n<this.mapHeight){const r=n*this.mapWidth+e,i=s.data[r];if(i>0)return this.setCurrentLayerActiveGid(i),this.updateTilePaletteSelection(),this.tool="tiles",this.currentTool="brush",this.mapCanvas.style.cursor="crosshair",this.eyedropperCallback&&this.eyedropperCallback(),i}return null}updateTilePaletteSelection(){const e=document.getElementById("activeGid");e&&(e.textContent=this.activeGid.toString()),document.querySelectorAll(".tile-palette .tile").forEach((s,r)=>{const i=s;r===this.activeGid-1?(i.classList.add("selected"),i.scrollIntoView({behavior:"smooth",block:"nearest"})):i.classList.remove("selected")})}draw(){this.ctx.clearRect(0,0,this.mapCanvas.width,this.mapCanvas.height),this.ctx.save(),this.drawGrid(),this.drawTiles(),this.hoverX>=0&&this.hoverY>=0&&this.drawHover(),this.drawSelection(),this.drawHeroPosition(),this.drawActorPlaceholders(),this.drawShapePreview(),this.ctx.restore(),this.drawMiniMap(),this.drawStampPreview(),this.drawDebugInfo()}mapToScreen(e,n){const s=(e-n)*(this.tileSizeX/2),r=(e+n)*(this.tileSizeY/2),i=this.mapCanvas.width/2+this.panX,a=100+this.panY;return{x:(s+i)*this.zoom,y:(r+a)*this.zoom}}screenToMap(e,n){const s=e/this.zoom,r=n/this.zoom,i=this.mapCanvas.width/2+this.panX,a=100+this.panY,l=s-i,c=r-a,u=l-this.tileSizeX/2,f=c-this.tileSizeY/2,h=this.tileSizeX/2,p=this.tileSizeY/2,b=(u/h+f/p)/2,y=(f/p-u/h)/2;return{x:Math.floor(b),y:Math.floor(y)}}screenToWorld(e,n){const s=e/this.zoom,r=n/this.zoom,i=this.mapCanvas.width/2+this.panX,a=100+this.panY;return{x:s-i,y:r-a}}raycastToTile(e,n){const s=[],r=this.worldToScreen(e,n);for(let i=0;i<this.mapHeight;i++)for(let a=0;a<this.mapWidth;a++)if(this.isPointInTileDiamond(e,n,a,i)){const l=this.mapToScreen(a,i),c=Math.sqrt(Math.pow(r.x-l.x,2)+Math.pow(r.y-l.y,2));s.push({x:a,y:i,distance:c})}return s.length>0?(s.sort((i,a)=>i.distance-a.distance),{x:s[0].x,y:s[0].y}):null}isPointInTileDiamond(e,n,s,r){const i=this.mapToScreen(s,r),a=this.worldToScreen(e,n),l=a.x-i.x,c=a.y-i.y,u=this.tileSizeX/2*this.zoom,f=this.tileSizeY/2*this.zoom,h=.9,p=Math.abs(l/u),b=Math.abs(c/f);return p+b<=h}tileToWorld(e,n){return{x:(e-n)*(this.tileSizeX/2),y:(e+n)*(this.tileSizeY/2)}}worldToScreen(e,n){const s=this.mapCanvas.width/2+this.panX,r=100+this.panY;return{x:(e+s)*this.zoom,y:(n+r)*this.zoom}}drawDebugInfo(){if(this.debugMode){this.ctx.strokeStyle="rgba(255, 0, 0, 0.5)",this.ctx.lineWidth=1;for(let e=0;e<this.mapHeight;e++)for(let n=0;n<this.mapWidth;n++){const s=this.mapToScreen(n,e),r=this.tileSizeX/2*this.zoom,i=this.tileSizeY/2*this.zoom;this.ctx.beginPath(),this.ctx.moveTo(s.x,s.y-i),this.ctx.lineTo(s.x+r,s.y),this.ctx.lineTo(s.x,s.y+i),this.ctx.lineTo(s.x-r,s.y),this.ctx.closePath(),this.ctx.stroke(),this.ctx.strokeStyle="rgba(0, 255, 0, 0.5)",this.ctx.lineWidth=1;const a=this.tileSizeX*this.zoom,l=this.tileSizeY*this.zoom,c=s.y+i,u=s.x-a/2,f=c-l;this.ctx.strokeRect(u,f,a,l),this.ctx.strokeStyle="rgba(255, 0, 0, 0.5)",this.ctx.fillStyle="rgba(255, 255, 255, 0.8)",this.ctx.font="10px Arial",this.ctx.textAlign="center",this.ctx.fillText(`${n},${e}`,s.x,s.y)}}}toggleDebugMode(){this.debugMode=!this.debugMode,this.draw()}getDebugMode(){return this.debugMode}setZoom(e){this.zoom=Math.max(.1,Math.min(5,e)),this.draw()}getZoom(){return this.zoom}zoomIn(){this.setZoom(this.zoom*1.2)}zoomOut(){this.setZoom(this.zoom/1.2)}resetZoom(){this.zoom=1,this.panX=0,this.panY=0,this.draw()}toggleMinimap(){this.showMinimap=!this.showMinimap,this.draw()}setSidebarTransitioning(e){this.sidebarTransitioning=!!e,this.sidebarTransitioning||(this.lastMiniMapPos=null)}setPan(e,n){this.panX+=e,this.panY+=n,this.draw()}resizeCanvasToContainer(){this.resizeCanvas()}drawGrid(){this.ctx.strokeStyle=this.isDarkMode?"#666":"#999",this.ctx.lineWidth=Math.max(1,Math.min(3,2/this.zoom)),this.ctx.globalAlpha=.8;for(let e=0;e<this.mapHeight;e++)for(let n=0;n<this.mapWidth;n++){const s=this.mapToScreen(n,e),r=this.tileSizeX/2*this.zoom,i=this.tileSizeY/2*this.zoom;this.ctx.beginPath(),this.ctx.moveTo(s.x,s.y-i),this.ctx.lineTo(s.x+r,s.y),this.ctx.lineTo(s.x,s.y+i),this.ctx.lineTo(s.x-r,s.y),this.ctx.closePath(),this.ctx.stroke()}this.ctx.globalAlpha=1}drawTiles(){const e=[...this.tileLayers].reverse();for(const n of e){if(!n.visible)continue;const s=this.getLayerTilesetOrFallback(n.type);if(!s||!s.image)continue;this.ctx.globalAlpha=n.transparency||1;const r=this.layerTileData.get(n.type)||new Map;for(let i=0;i<this.mapHeight;i++)for(let a=0;a<this.mapWidth;a++){const l=i*this.mapWidth+a,c=n.data[l];c>0&&this.drawTileFromLayer(a,i,c,s,r)}}this.ctx.globalAlpha=1}drawTileFromLayer(e,n,s,r,i){if(!r.image||s<=0)return;const a=i.get(s);let l,c,u,f,h,p;if(a)l=a.sourceX,c=a.sourceY,u=a.width,f=a.height,h=a.originX,p=a.originY;else{const T=s-1;l=T%r.columns*this.tileSizeX,c=Math.floor(T/r.columns)*this.tileSizeY,u=this.tileSizeX,f=this.tileSizeY}const b=this.mapToScreen(e,n),y=u*this.zoom,S=f*this.zoom,j=this.tileSizeY/2*this.zoom,v=b.y+j,g=typeof h=="number"?h:Math.floor(u/2),x=typeof p=="number"?p:f,w=b.x-g*this.zoom,N=v-x*this.zoom;this.ctx.drawImage(r.image,l,c,u,f,w,N,y,S)}drawTile(e,n,s){if(!this.tilesetImage||s<=0)return;const r=this.detectedTileData.get(s);let i,a,l,c,u,f;if(r)i=r.sourceX,a=r.sourceY,l=r.width,c=r.height,u=r.originX,f=r.originY;else{const w=s-1;i=w%this.tilesetColumns*this.tileSizeX,a=Math.floor(w/this.tilesetColumns)*this.tileSizeY,l=this.tileSizeX,c=this.tileSizeY}const h=this.mapToScreen(e,n),p=l*this.zoom,b=c*this.zoom,y=this.tileSizeY/2*this.zoom,S=h.y+y,j=typeof u=="number"?u:Math.floor(l/2),v=typeof f=="number"?f:c,g=h.x-j*this.zoom,x=S-v*this.zoom;this.ctx.drawImage(this.tilesetImage,i,a,l,c,g,x,p,b)}drawHover(){const e=this.mapToScreen(this.hoverX,this.hoverY),n=this.tileSizeX/2*this.zoom,s=this.tileSizeY/2*this.zoom,r=this.getActiveLayer();r&&["enemy","npc","object","event","background"].includes(r.type)&&this.getObjectsAtPosition(this.hoverX,this.hoverY).length>0?(this.ctx.save(),[{color:"rgba(255, 107, 0, 0.1)",width:8},{color:"rgba(255, 107, 0, 0.2)",width:6},{color:"rgba(255, 107, 0, 0.3)",width:4},{color:"rgba(255, 107, 0, 0.5)",width:2}].forEach(c=>{this.ctx.strokeStyle=c.color,this.ctx.lineWidth=Math.max(1,Math.min(c.width,c.width/this.zoom)),this.ctx.shadowColor="#ff6b00",this.ctx.shadowBlur=Math.max(2,Math.min(10,c.width/this.zoom)),this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y-s),this.ctx.lineTo(e.x+n,e.y),this.ctx.lineTo(e.x,e.y+s),this.ctx.lineTo(e.x-n,e.y),this.ctx.closePath(),this.ctx.stroke()}),this.ctx.shadowColor="transparent",this.ctx.shadowBlur=0,this.ctx.strokeStyle="#ff6b00",this.ctx.lineWidth=Math.max(1,Math.min(3,3/this.zoom)),this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y-s),this.ctx.lineTo(e.x+n,e.y),this.ctx.lineTo(e.x,e.y+s),this.ctx.lineTo(e.x-n,e.y),this.ctx.closePath(),this.ctx.stroke(),this.ctx.restore()):(this.ctx.strokeStyle="#007acc",this.ctx.lineWidth=Math.max(1,Math.min(3,2/this.zoom)),this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y-s),this.ctx.lineTo(e.x+n,e.y),this.ctx.lineTo(e.x,e.y+s),this.ctx.lineTo(e.x-n,e.y),this.ctx.closePath(),this.ctx.stroke())}drawSelection(){this.isSelecting&&(this.currentSelectionTool==="rectangular"||this.currentSelectionTool==="circular")&&(this.ctx.strokeStyle="#ff6b00",this.ctx.lineWidth=Math.max(1,Math.min(2,2/this.zoom)),this.ctx.setLineDash([5,5]),this.currentSelectionTool==="rectangular"?this.drawRectangularSelectionPreview():this.currentSelectionTool==="circular"&&this.drawCircularSelectionPreview(),this.ctx.setLineDash([])),this.selection.active&&this.selection.tiles.length>0&&(this.ctx.strokeStyle="#00ff00",this.ctx.lineWidth=Math.max(1,Math.min(2,2/this.zoom)),this.selection.tiles.forEach(e=>{const n=this.mapToScreen(e.x,e.y),s=this.tileSizeX/2*this.zoom,r=this.tileSizeY/2*this.zoom;this.ctx.beginPath(),this.ctx.moveTo(n.x,n.y-r),this.ctx.lineTo(n.x+s,n.y),this.ctx.lineTo(n.x,n.y+r),this.ctx.lineTo(n.x-s,n.y),this.ctx.closePath(),this.ctx.stroke()}))}drawRectangularSelectionPreview(){const e=Math.min(this.selection.startX,this.selection.endX),n=Math.max(this.selection.startX,this.selection.endX),s=Math.min(this.selection.startY,this.selection.endY),r=Math.max(this.selection.startY,this.selection.endY);for(let i=s;i<=r;i++)for(let a=e;a<=n;a++)if(a>=0&&a<this.mapWidth&&i>=0&&i<this.mapHeight){const l=this.mapToScreen(a,i),c=this.tileSizeX/2*this.zoom,u=this.tileSizeY/2*this.zoom;this.ctx.beginPath(),this.ctx.moveTo(l.x,l.y-u),this.ctx.lineTo(l.x+c,l.y),this.ctx.lineTo(l.x,l.y+u),this.ctx.lineTo(l.x-c,l.y),this.ctx.closePath(),this.ctx.stroke()}}drawCircularSelectionPreview(){const e=Math.sqrt(Math.pow(this.selection.endX-this.selection.startX,2)+Math.pow(this.selection.endY-this.selection.startY,2));for(let n=0;n<this.mapHeight;n++)for(let s=0;s<this.mapWidth;s++)if(Math.sqrt(Math.pow(s-this.selection.startX,2)+Math.pow(n-this.selection.startY,2))<=e){const i=this.mapToScreen(s,n),a=this.tileSizeX/2*this.zoom,l=this.tileSizeY/2*this.zoom;this.ctx.beginPath(),this.ctx.moveTo(i.x,i.y-l),this.ctx.lineTo(i.x+a,i.y),this.ctx.lineTo(i.x,i.y+l),this.ctx.lineTo(i.x-a,i.y),this.ctx.closePath(),this.ctx.stroke()}}drawShapePreview(){!this.isDrawingShape||this.shapeDrawing.preview.length===0||(this.ctx.strokeStyle="#0099ff",this.ctx.lineWidth=Math.max(1,Math.min(2,2/this.zoom)),this.ctx.setLineDash([3,3]),this.shapeDrawing.preview.forEach(e=>{const n=this.mapToScreen(e.x,e.y),s=this.tileSizeX/2*this.zoom,r=this.tileSizeY/2*this.zoom;this.ctx.beginPath(),this.ctx.moveTo(n.x,n.y-r),this.ctx.lineTo(n.x+s,n.y),this.ctx.lineTo(n.x,n.y+r),this.ctx.lineTo(n.x-s,n.y),this.ctx.closePath(),this.ctx.stroke()}),this.ctx.setLineDash([]))}drawHeroPosition(){const e=this.mapToScreen(this.heroX,this.heroY),n=this.tileSizeX/2*this.zoom,s=this.tileSizeY/2*this.zoom;this.ctx.save(),this.hoverX===this.heroX&&this.hoverY===this.heroY&&[{color:"rgba(255, 107, 0, 0.1)",width:8},{color:"rgba(255, 107, 0, 0.2)",width:6},{color:"rgba(255, 107, 0, 0.3)",width:4},{color:"rgba(255, 107, 0, 0.5)",width:2}].forEach(a=>{this.ctx.strokeStyle=a.color,this.ctx.lineWidth=Math.max(1,Math.min(a.width,a.width/this.zoom)),this.ctx.shadowColor="#ff6b00",this.ctx.shadowBlur=Math.max(2,Math.min(10,a.width/this.zoom)),this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y-s),this.ctx.lineTo(e.x+n,e.y),this.ctx.lineTo(e.x,e.y+s),this.ctx.lineTo(e.x-n,e.y),this.ctx.closePath(),this.ctx.stroke()}),this.ctx.shadowColor="transparent",this.ctx.shadowBlur=0,this.ctx.fillStyle="#ff6b00",this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y-s),this.ctx.lineTo(e.x+n,e.y),this.ctx.lineTo(e.x,e.y+s),this.ctx.lineTo(e.x-n,e.y),this.ctx.closePath(),this.ctx.fill(),this.ctx.strokeStyle="#ff8c00",this.ctx.lineWidth=Math.max(1,Math.min(2,2/this.zoom)),this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y-s),this.ctx.lineTo(e.x+n,e.y),this.ctx.lineTo(e.x,e.y+s),this.ctx.lineTo(e.x-n,e.y),this.ctx.closePath(),this.ctx.stroke(),this.drawHeroIcon(e.x,e.y),this.ctx.restore()}drawHeroIcon(e,n){const r=Math.max(12,Math.min(20,16*this.zoom))/2;this.ctx.save(),this.ctx.fillStyle="#ffffff",this.ctx.strokeStyle="#ffffff",this.ctx.lineWidth=1.5,this.ctx.beginPath(),this.ctx.arc(e,n-r*.6,r*.25,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.roundRect(e-r*.3,n-r*.2,r*.6,r*.8,r*.15),this.ctx.fill(),this.ctx.restore()}getActorLayerType(e){return e.type==="npc"||e.category==="npc"?"npc":e.type==="enemy"||e.category==="enemy"||e.category==="creature"||e.type==="creature"?e.category==="npc"?"npc":"enemy":null}getActorLayerByType(e){return this.tileLayers.find(n=>n.type===e)||null}actorUsesPlaceholder(e){const n=this.getActorLayerType(e);if(!n)return!1;const s=this.getActorLayerByType(n);if(!s)return!1;const r=e.y*this.mapWidth+e.x;return r<0||r>=s.data.length?!1:s.data[r]===0}drawActorPlaceholders(){for(const e of this.objects){if(!this.actorUsesPlaceholder(e))continue;const n=this.getActorLayerType(e);n&&this.drawActorPlaceholder(e,n)}}drawActorPlaceholder(e,n){const s=this.mapToScreen(e.x,e.y),r=this.tileSizeX/2*this.zoom,i=this.tileSizeY/2*this.zoom;this.ctx.save();const a=this.hoverX===e.x&&this.hoverY===e.y,l=this.isDraggingActor&&this.draggingActorId===e.id;(a||l)&&[{color:"rgba(255, 107, 0, 0.1)",width:8},{color:"rgba(255, 107, 0, 0.2)",width:6},{color:"rgba(255, 107, 0, 0.3)",width:4},{color:"rgba(255, 107, 0, 0.5)",width:2}].forEach(u=>{this.ctx.strokeStyle=u.color,this.ctx.lineWidth=Math.max(1,Math.min(u.width,u.width/this.zoom)),this.ctx.shadowColor="#ff6b00",this.ctx.shadowBlur=Math.max(2,Math.min(10,u.width/this.zoom)),this.ctx.beginPath(),this.ctx.moveTo(s.x,s.y-i),this.ctx.lineTo(s.x+r,s.y),this.ctx.lineTo(s.x,s.y+i),this.ctx.lineTo(s.x-r,s.y),this.ctx.closePath(),this.ctx.stroke()}),this.ctx.shadowColor="transparent",this.ctx.shadowBlur=0,this.ctx.fillStyle="#ff6b00",this.ctx.beginPath(),this.ctx.moveTo(s.x,s.y-i),this.ctx.lineTo(s.x+r,s.y),this.ctx.lineTo(s.x,s.y+i),this.ctx.lineTo(s.x-r,s.y),this.ctx.closePath(),this.ctx.fill(),this.ctx.strokeStyle="#ff8c00",this.ctx.lineWidth=Math.max(1,Math.min(2,2/this.zoom)),this.ctx.beginPath(),this.ctx.moveTo(s.x,s.y-i),this.ctx.lineTo(s.x+r,s.y),this.ctx.lineTo(s.x,s.y+i),this.ctx.lineTo(s.x-r,s.y),this.ctx.closePath(),this.ctx.stroke(),this.drawActorIcon(s.x,s.y,n),this.ctx.restore()}drawActorIcon(e,n,s){const r=Math.max(10,Math.min(18,14*this.zoom)),i=s==="npc"?"N":"E";this.ctx.save(),this.ctx.fillStyle="#ffffff",this.ctx.font=`bold ${r}px "Segoe UI", sans-serif`,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(i,e,n),this.ctx.restore()}drawStampPreview(){if(!(!this.stampPreview.visible||!this.activeStamp)){this.ctx.strokeStyle="#00ff00",this.ctx.fillStyle="rgba(0, 255, 0, 0.2)",this.ctx.lineWidth=Math.max(1,Math.min(2,2/this.zoom)),this.ctx.setLineDash([3,3]);for(let e=0;e<this.activeStamp.height;e++)for(let n=0;n<this.activeStamp.width;n++){const s=this.stampPreview.x+n,r=this.stampPreview.y+e;if(s>=0&&s<this.mapWidth&&r>=0&&r<this.mapHeight){const i=this.mapToScreen(s,r),a=this.tileSizeX/2*this.zoom,l=this.tileSizeY/2*this.zoom;this.ctx.beginPath(),this.ctx.moveTo(i.x,i.y-l),this.ctx.lineTo(i.x+a,i.y),this.ctx.lineTo(i.x,i.y+l),this.ctx.lineTo(i.x-a,i.y),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke()}}this.ctx.setLineDash([])}}drawMiniMap(){if(!this.showMinimap)return;const e=150,n=120,s=10,r=this.mapCanvas.getBoundingClientRect(),i=window.innerWidth-e-s,a=window.innerHeight-n-s;let l=Math.floor(i-r.left),c=Math.floor(a-r.top);l=Math.max(0,Math.min(this.mapCanvas.width-e,l)),c=Math.max(0,Math.min(this.mapCanvas.height-n,c)),this.lastMiniMapPos={x:l,y:c},this.ctx.save();const u=5,f=l-u,h=c-u,p=e+u*2,b=n+u*2,y=Math.min(12,Math.floor(Math.min(p,b)/6)),S=Math.min(8,Math.floor(Math.min(e,n)/8)),j=(E,$,D,G,q)=>{const re=Math.max(0,Math.min(q,Math.min(D,G)/2));this.ctx.beginPath(),this.ctx.moveTo(E+re,$),this.ctx.lineTo(E+D-re,$),this.ctx.quadraticCurveTo(E+D,$,E+D,$+re),this.ctx.lineTo(E+D,$+G-re),this.ctx.quadraticCurveTo(E+D,$+G,E+D-re,$+G),this.ctx.lineTo(E+re,$+G),this.ctx.quadraticCurveTo(E,$+G,E,$+G-re),this.ctx.lineTo(E,$+re),this.ctx.quadraticCurveTo(E,$,E+re,$),this.ctx.closePath()};this.ctx.fillStyle=this.isDarkMode?"rgba(42, 42, 42, 0.9)":"rgba(0, 0, 0, 0.7)",j(f,h,p,b,y),this.ctx.fill(),this.ctx.fillStyle=this.isDarkMode?"#2a2a2a":"#f0f0f0",j(l,c,e,n,S),this.ctx.fill(),this.ctx.strokeStyle=this.isDarkMode?"#999":"#333",this.ctx.lineWidth=1,j(l,c,e,n,S),this.ctx.stroke();const v=Math.floor(e/this.mapWidth)||1,g=Math.floor(n/this.mapHeight)||1,x=Math.max(1,Math.min(v,g)),w=this.mapWidth*x,N=this.mapHeight*x,T=l+Math.floor((e-w)/2),P=c+Math.floor((n-N)/2);this.ctx.imageSmoothingEnabled=!1;for(let E=0;E<this.tileLayers.length;E++){const $=this.tileLayers[E];if($.visible)for(let D=0;D<this.mapHeight;D++)for(let G=0;G<this.mapWidth;G++){const q=D*this.mapWidth+G,re=$.data[q];if(re>0){const X=T+G*x,ae=P+D*x,je=re*137.5%360;this.ctx.fillStyle=`hsl(${je}, 55%, ${E===0?"45%":"60%"})`,this.ctx.fillRect(X,ae,x,x)}}}if(x>=3){this.ctx.strokeStyle=this.isDarkMode?"rgba(255,255,255,0.03)":"rgba(0,0,0,0.05)",this.ctx.lineWidth=.5;for(let E=0;E<this.mapHeight;E++)for(let $=0;$<this.mapWidth;$++){const D=T+$*x+.25,G=P+E*x+.25;this.ctx.strokeRect(D,G,x-.5,x-.5)}}this.ctx.restore()}handleFileUpload(e,n){if(n==="tileset"){const s=new FileReader;s.onload=r=>{var a;const i=new Image;i.onload=()=>{this.tilesetImage=i,this.tilesetFileName=e.name;const l=Math.max(1,Math.floor(i.width/this.tileSizeX)),c=Math.max(1,Math.floor(i.height/this.tileSizeY));this.tilesetColumns=l,this.tilesetRows=c,this.tileCount=l*c,this.tilesetTileWidth=l>0?Math.round(i.width/l):this.tileSizeX,this.tilesetTileHeight=c>0?Math.round(i.height/c):this.tileSizeY,this.tilesetSpacing=0,this.tilesetMargin=0,this.tilesetSourcePath=this.extractFileSourcePath(e),this.createTilePalette(),this.draw()},i.src=(a=r.target)==null?void 0:a.result},s.readAsDataURL(e)}else if(n==="layerTileset"){const s=this.tileLayers.find(r=>r.id===this.activeLayerId);s&&this.setLayerTileset(s.type,e)}}createTilePalette(e=!1){const n=document.getElementById("tilesContainer");if(!n||!this.tilesetImage)return;n.innerHTML="",this.hideCollisionBrushTooltip(!0);const s=this.tileLayers.find(c=>c.id===this.activeLayerId),r=(s==null?void 0:s.type)===Ns;let i;if(e&&this.detectedTileData.size>0)i=Array.from(this.detectedTileData.entries()).map(([c,u])=>({index:c,sourceX:u.sourceX,sourceY:u.sourceY,width:u.width,height:u.height}));else{this.detectedTileData.clear(),i=this.detectVariableSizedTiles().map(f=>(this.detectedTileData.set(f.index,{sourceX:f.sourceX,sourceY:f.sourceY,width:f.width,height:f.height,originX:Math.floor(f.width/2),originY:f.height}),f));const u=this.tileLayers.find(f=>f.id===this.activeLayerId);if(u){const f=new Map;for(const[h,p]of this.detectedTileData.entries())f.set(h,{sourceX:p.sourceX,sourceY:p.sourceY,width:p.width,height:p.height,originX:p.originX,originY:p.originY});this.layerTileData.set(u.type,f),console.log(`Stored ${f.size} newly detected tiles for layer type: ${u.type}`)}}let a=0;const l=()=>document.getElementById("brushToolState")||document.querySelector("[data-brush-tool]");for(const c of i){const u=document.createElement("canvas");u.width=c.width,u.height=c.height,u.width=c.width,u.height=c.height,u.className="palette-tile",u.style.setProperty("--tile-width",`${c.width}px`),u.style.setProperty("--tile-height",`${c.height}px`);const f=u.getContext("2d");if(f){f.drawImage(this.tilesetImage,c.sourceX,c.sourceY,c.width,c.height,0,0,c.width,c.height);const w=Math.floor(c.width/2),N=Math.floor(c.height/2);f.strokeStyle="rgba(255,0,0,0.8)",f.lineWidth=1,f.beginPath(),f.moveTo(w-3,N),f.lineTo(w+3,N),f.moveTo(w,N-3),f.lineTo(w,N+3),f.stroke()}const h=document.createElement("div");h.className="brush-wrapper",h.style.position="relative",h.style.display="inline-block",h.style.margin="2px";const p=r?c1[c.index]:void 0,b=document.createElement("div");b.className="selection-number",b.style.position="absolute",b.style.top="2px",b.style.left="2px",b.style.background="red",b.style.color="white",b.style.borderRadius="50%",b.style.width="16px",b.style.height="16px",b.style.fontSize="10px",b.style.display="none",b.style.alignItems="center",b.style.justifyContent="center",b.style.fontWeight="bold",b.style.zIndex="10";const y=document.createElement("div");y.className="remove-overlay",y.style.position="absolute",y.style.top="0",y.style.left="0",y.style.right="0",y.style.bottom="0",y.style.background="rgba(255, 0, 0, 0.7)",y.style.display="none",y.style.alignItems="center",y.style.justifyContent="center",y.style.fontSize="24px",y.style.color="white",y.style.cursor="pointer",y.style.zIndex="10",y.textContent="✕";const S=document.createElement("div");S.className="separate-icon",S.style.position="absolute",S.style.top="50%",S.style.left="50%",S.style.transform="translate(-50%, -50%)",S.style.display="none",S.style.alignItems="center",S.style.justifyContent="center",S.style.background="none",S.style.color="white",S.style.zIndex="2",S.style.pointerEvents="none",S.style.width="24px",S.style.height="24px",S.innerHTML=`
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="6" cy="6" r="3"></circle>
          <circle cx="6" cy="18" r="3"></circle>
          <line x1="20" y1="4" x2="8.12" y2="15.88"></line>
          <line x1="14.47" y1="14.48" x2="20" y2="20"></line>
          <line x1="8.12" y1="8.12" x2="12" y2="12"></line>
        </svg>
      `;const j=document.createElement("div");j.className="merge-icon",j.style.position="absolute",j.style.top="50%",j.style.left="50%",j.style.transform="translate(-50%, -50%)",j.style.display="none",j.style.alignItems="center",j.style.justifyContent="center",j.style.background="none",j.style.color="white",j.style.zIndex="2",j.style.pointerEvents="none",j.style.width="24px",j.style.height="24px",j.innerHTML=`
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="m8 6 4-4 4 4"></path>
          <path d="M12 2v10.3a4 4 0 0 1-1.172 2.872L4 22"></path>
          <path d="m20 22-6.828-6.828A4 4 0 0 1 12 12.3"></path>
        </svg>
      `,y.addEventListener("click",w=>{w.preventDefault(),w.stopPropagation(),console.log(`Remove overlay clicked for tile index: ${c.index}`),this.handleBrushRemove(c.index)}),u.addEventListener("click",w=>{w.preventDefault();const N=l(),T=(N==null?void 0:N.getAttribute("data-brush-tool"))||"none";if(console.log(`Tile clicked! Index: ${c.index}, Current brush tool: ${T}`),T==="merge"){console.log("Handling merge tool selection (no auto-merge)"),this.handleBrushMerge(c.index,h);return}if(T==="separate"){console.log("Handling separate tool"),this.handleBrushSeparate(c.index);return}if(T==="remove"){console.log("Handling remove tool"),this.handleBrushRemove(c.index);return}if(w.ctrlKey||w.metaKey){if(this.multiSelectedBrushes.has(c.index)?this.multiSelectedBrushes.delete(c.index):this.multiSelectedBrushes.add(c.index),this.multiSelectedBrushes.size===1){const E=Array.from(this.multiSelectedBrushes.values())[0];this.setCurrentLayerActiveGid(E)}this.updateActiveTile();return}this.multiSelectedBrushes.clear(),this.setCurrentLayerActiveGid(c.index),this.updateActiveTile()}),h.draggable=!1,h.addEventListener("dragstart",w=>{const N=l();((N==null?void 0:N.getAttribute("data-brush-tool"))||"none")==="move"?(h.style.opacity="0.5",w.dataTransfer.effectAllowed="move",w.dataTransfer.setData("text/plain",c.index.toString()),this.dispatchBrushEvent("dragstart",c.index)):w.preventDefault()}),h.addEventListener("dragend",w=>{h.style.opacity="1",this.dispatchBrushEvent("dragend",c.index)}),h.addEventListener("dragover",w=>{const N=l();((N==null?void 0:N.getAttribute("data-brush-tool"))||"none")==="move"&&(w.preventDefault(),w.dataTransfer.dropEffect="move",h.style.borderTop="3px solid #007acc")}),h.addEventListener("dragleave",w=>{h.style.borderTop=""}),h.addEventListener("drop",w=>{w.preventDefault(),h.style.borderTop="";const N=l();if(((N==null?void 0:N.getAttribute("data-brush-tool"))||"none")==="move"){const P=parseInt(w.dataTransfer.getData("text/plain")),E=c.index;P!==E&&this.dispatchBrushEvent("drop",{from:P,to:E})}});const v=()=>{const w=l(),N=(w==null?void 0:w.getAttribute("data-brush-tool"))||"none";h.classList.remove("separate-mode","merge-mode","merge-selected-first","merge-selected-second"),h.draggable=!1,h.style.cursor="",h.title="",h.setAttribute("data-tile-index",c.index.toString()),N==="move"?(h.draggable=!0,h.style.cursor="move",h.title="Drag to reorder"):N==="separate"?(h.classList.add("separate-mode"),h.style.cursor="pointer",h.title="Click to separate"):N==="merge"&&(h.classList.add("merge-mode"),h.style.cursor="pointer",h.title="Click to merge (max 2 brushes)")};v();const g=new MutationObserver(()=>{v()}),x=l();x&&g.observe(x,{attributes:!0,attributeFilter:["data-brush-tool"]}),h.addEventListener("mouseenter",w=>{const N=document.querySelector("[data-brush-tool]");((N==null?void 0:N.getAttribute("data-brush-tool"))||"none")==="remove"&&(y.style.display="flex"),p&&this.showCollisionBrushTooltip(h,p,w)}),h.addEventListener("mouseleave",()=>{y.style.display="none",p&&this.hideCollisionBrushTooltip()}),p&&h.addEventListener("mousemove",w=>{this.updateCollisionBrushTooltipPosition(h,w)}),u.setAttribute("data-tile-index",c.index.toString()),u.setAttribute("data-tile-width",c.width.toString()),u.setAttribute("data-tile-height",c.height.toString()),u.setAttribute("data-source-x",c.sourceX.toString()),u.setAttribute("data-source-y",c.sourceY.toString()),u.setAttribute("data-origin-x",Math.floor(c.width/2).toString()),u.setAttribute("data-origin-y",Math.floor(c.height/2).toString()),h.appendChild(u),h.appendChild(b),h.appendChild(y),h.appendChild(S),h.appendChild(j),n.appendChild(h),a++}console.log(`Created ${a} variable-sized tiles from tileset`)}handleBrushMerge(e,n){const s=document.querySelector(".merge-selected-first"),r=document.querySelector(".merge-selected-second");if(n.classList.contains("merge-selected-first")||n.classList.contains("merge-selected-second")){n.classList.remove("merge-selected-first","merge-selected-second");return}if(!s)n.classList.add("merge-selected-first");else if(!r)n.classList.add("merge-selected-second");else return}performMerge(e,n){console.log(`Merging tiles ${e} and ${n}`);try{this.mergeBrushes([e,n]),console.log(`Successfully merged brushes ${e} and ${n}`)}catch(s){console.error("Failed to merge brushes:",s)}}handleBrushSeparate(e){this.dispatchBrushEvent("separate",e)}handleBrushRemove(e){console.log(`handleBrushRemove called with tileIndex: ${e}`),this.dispatchBrushEvent("remove",e)}dispatchBrushEvent(e,n){const s=new CustomEvent("brushAction",{detail:typeof n=="number"?{action:e,tileIndex:n}:{action:e,...n}});document.dispatchEvent(s)}detectVariableSizedTiles(){if(!this.tilesetImage)return[];const e=[],n=document.createElement("canvas");n.width=this.tilesetImage.width,n.height=this.tilesetImage.height;const s=n.getContext("2d");if(!s)return[];s.drawImage(this.tilesetImage,0,0);const i=s.getImageData(0,0,this.tilesetImage.width,this.tilesetImage.height).data,a=new Array(this.tilesetImage.width*this.tilesetImage.height).fill(!1);let l=1;const c=[];for(let u=0;u<this.tilesetImage.height;u++)for(let f=0;f<this.tilesetImage.width;f++){const h=u*this.tilesetImage.width+f;if(a[h]||this.isPixelTransparent(i,f,u,this.tilesetImage.width))continue;const p=this.floodFillObjectData(i,this.tilesetImage.width,this.tilesetImage.height,f,u,a);p&&this.isValidObjectSize(p.bounds)&&c.push(p)}for(const u of c){const f=this.intelligentObjectSplit(u);for(const h of f)e.push({index:l++,sourceX:h.x,sourceY:h.y,width:h.width,height:h.height})}return e}isPixelTransparent(e,n,s,r){const i=(s*r+n)*4+3;return e[i]<=this.tileContentThreshold}floodFillObjectData(e,n,s,r,i,a){const l=[{x:r,y:i}];let c=r,u=r,f=i,h=i,p=0;const b=[];for(;l.length>0;){const x=l.pop(),{x:w,y:N}=x;if(w<0||w>=n||N<0||N>=s)continue;const T=N*n+w;a[T]||this.isPixelTransparent(e,w,N,n)||(a[T]=!0,p++,b.push({x:w,y:N}),c=Math.min(c,w),u=Math.max(u,w),f=Math.min(f,N),h=Math.max(h,N),l.push({x:w+1,y:N}),l.push({x:w-1,y:N}),l.push({x:w,y:N+1}),l.push({x:w,y:N-1}),l.push({x:w+1,y:N+1}),l.push({x:w+1,y:N-1}),l.push({x:w-1,y:N+1}),l.push({x:w-1,y:N-1}))}if(p===0)return null;const y=1,S=Math.max(0,c-y),j=Math.max(0,f-y),v=Math.min(n-1,u+y),g=Math.min(s-1,h+y);return{bounds:{x:S,y:j,width:v-S+1,height:g-j+1},pixels:b}}intelligentObjectSplit(e){const{bounds:n,pixels:s}=e,{width:r,height:i}=n,a=s.length,l=r*i,c=a/l,u=Math.max(this.tileSizeX,this.tileSizeY),f=this.shouldSplitDirection(s,n,"horizontal",u),h=this.shouldSplitDirection(s,n,"vertical",u),p=this.isFloorPattern(n,s),b=this.isVerticalWall(n,s),y=this.isHorizontalWall(n,s);return console.log(`Object analysis: ${r}x${i}, density: ${c.toFixed(2)}, floor: ${p}, vWall: ${b}, hWall: ${y}`),p?(console.log("Detected floor/ground pattern - splitting into individual tiles"),this.splitObjectByGrid(e,"horizontal")):b?(console.log("Detected vertical wall/structure - keeping as single tile"),[n]):y?(console.log("Detected horizontal wall - keeping as single tile"),[n]):f&&r>this.tileSizeX*1.5?(console.log("Splitting horizontal arrangement into individual objects"),this.splitObjectByGrid(e,"horizontal")):h&&i>this.tileSizeY*1.5&&!this.isLikelySingleVerticalObject(n,s)?(console.log("Splitting vertical arrangement into individual objects"),this.splitObjectByGrid(e,"vertical")):c<.4&&l>u*u*2?(console.log("Splitting sparse large object"),this.splitObjectByDensity(e)):(r>this.tileSizeX*1.8||i>this.tileSizeY*1.8)&&!b&&!y&&c<.8?(console.log("Splitting large non-wall object into tile-sized pieces"),this.splitObjectByGrid(e,r>i?"horizontal":"vertical")):(console.log("Keeping as single object"),[n])}isVerticalWall(e,n){const{width:s,height:r}=e,i=r/s,a=n.length/(s*r);if(i<1.5||a<.5)return!1;const l=this.hasConsistentVerticalWidth(n,e),c=this.hasVerticalContinuity(n,e),u=r>this.tileSizeY*1.5&&s<=this.tileSizeX*1.2;return l&&c||u&&a>.6}isHorizontalWall(e,n){const{width:s,height:r}=e,i=s/r,a=n.length/(s*r);if(i<2||a<.6||r<this.tileSizeY*.7)return!1;const l=this.hasConsistentHorizontalHeight(n,e),c=this.hasHorizontalContinuity(n,e);return l&&c}isLikelySingleVerticalObject(e,n){const{width:s,height:r}=e;return n.length/(s*r)>.7?!0:this.hasVerticalContinuity(n,e)}hasConsistentVerticalWidth(e,n){const{y:s,height:r}=n,i=Math.max(1,Math.floor(r/5)),a=[];for(let f=0;f<5;f++){const h=s+f*i,p=Math.min(h+i,s+r);let b=Number.MAX_SAFE_INTEGER,y=Number.MIN_SAFE_INTEGER,S=!1;for(const j of e)j.y>=h&&j.y<p&&(b=Math.min(b,j.x),y=Math.max(y,j.x),S=!0);S&&a.push(y-b+1)}if(a.length<2)return!1;const l=a.reduce((f,h)=>f+h,0)/a.length,c=a.reduce((f,h)=>f+Math.pow(h-l,2),0)/a.length,u=Math.sqrt(c);return l>0&&u/l<.3}hasConsistentHorizontalHeight(e,n){const{x:s,width:r}=n,i=Math.max(1,Math.floor(r/5)),a=[];for(let f=0;f<5;f++){const h=s+f*i,p=Math.min(h+i,s+r);let b=Number.MAX_SAFE_INTEGER,y=Number.MIN_SAFE_INTEGER,S=!1;for(const j of e)j.x>=h&&j.x<p&&(b=Math.min(b,j.y),y=Math.max(y,j.y),S=!0);S&&a.push(y-b+1)}if(a.length<2)return!1;const l=a.reduce((f,h)=>f+h,0)/a.length,c=a.reduce((f,h)=>f+Math.pow(h-l,2),0)/a.length,u=Math.sqrt(c);return l>0&&u/l<.3}hasVerticalContinuity(e,n){const{y:s,height:r}=n,i=Math.max(1,Math.floor(r/10));let a=0,l=0;for(let c=s;c<s+r;c+=i){const u=Math.min(c+i,s+r);let f=!1;for(const h of e)if(h.y>=c&&h.y<u){f=!0;break}f&&a++,l++}return l>0&&a/l>=.7}hasHorizontalContinuity(e,n){const{x:s,width:r}=n,i=Math.max(1,Math.floor(r/10));let a=0,l=0;for(let c=s;c<s+r;c+=i){const u=Math.min(c+i,s+r);let f=!1;for(const h of e)if(h.x>=c&&h.x<u){f=!0;break}f&&a++,l++}return l>0&&a/l>=.7}isFloorPattern(e,n){const{width:s,height:r}=e,i=r<=this.tileSizeY*.6,a=s>this.tileSizeX*1.3,l=this.hasRepeatingHorizontalPattern(n,e),c=this.hasDiamondLikeShape(n,e);return i&&a||l&&a||c&&a}hasRepeatingHorizontalPattern(e,n){const{x:s,width:r}=n,i=this.tileSizeX,a=Math.floor(r/i);if(a<2)return!1;const l=[];for(let h=0;h<a;h++){const p=s+h*i,b=p+i;let y=0;for(const S of e)S.x>=p&&S.x<b&&y++;l.push(y)}const c=l.reduce((h,p)=>h+p,0)/l.length,u=l.reduce((h,p)=>h+Math.pow(p-c,2),0)/l.length,f=Math.sqrt(u);return c>0&&f/c<.5}hasDiamondLikeShape(e,n){const{y:s,height:r}=n,i=[];for(let h=0;h<r;h++){let p=0;for(const b of e)b.y===s+h&&p++;i.push(p)}if(i.length<3)return!1;const a=Math.floor(i.length*.2),l=Math.floor(i.length*.3),c=Math.floor(i.length*.7),u=(i.slice(0,a).reduce((h,p)=>h+p,0)+i.slice(-a).reduce((h,p)=>h+p,0))/(a*2||1);return i.slice(l,c).reduce((h,p)=>h+p,0)/(c-l||1)>u*1.2}shouldSplitDirection(e,n,s,r){const{x:i,y:a,width:l,height:c}=n;if(s==="horizontal"){const u=[],f=Math.max(1,Math.floor(l/(l/r)));for(let y=0;y<l;y+=f){let S=0;for(const j of e)j.x>=i+y&&j.x<i+y+f&&S++;u.push(S)}let h=0,p=0;const b=u.reduce((y,S)=>y+S,0)/u.length;for(let y=0;y<u.length;y++)u[y]<b*.3?h++:u[y]>b*.7&&p++;return p>=2&&h>=1}else{const u=[],f=Math.max(1,Math.floor(c/(c/r)));for(let y=0;y<c;y+=f){let S=0;for(const j of e)j.y>=a+y&&j.y<a+y+f&&S++;u.push(S)}let h=0,p=0;const b=u.reduce((y,S)=>y+S,0)/u.length;for(let y=0;y<u.length;y++)u[y]<b*.3?h++:u[y]>b*.7&&p++;return p>=2&&h>=1}}splitObjectByGrid(e,n){const{bounds:s}=e,r=[];if(n==="horizontal"){const i=this.tileSizeX;for(let a=s.x;a<s.x+s.width;a+=i){const l=this.findContentInRegion(e.pixels,{x:a,y:s.y,width:Math.min(i,s.x+s.width-a),height:s.height});l&&r.push(l)}}else{const i=this.tileSizeY;for(let a=s.y;a<s.y+s.height;a+=i){const l=this.findContentInRegion(e.pixels,{x:s.x,y:a,width:s.width,height:Math.min(i,s.y+s.height-a)});l&&r.push(l)}}return r.length>0?r:[s]}splitObjectByDensity(e){const{bounds:n}=e,s=Math.min(this.tileSizeX,this.tileSizeY),r=[];for(let i=n.y;i<n.y+n.height;i+=s)for(let a=n.x;a<n.x+n.width;a+=s){const l=this.findContentInRegion(e.pixels,{x:a,y:i,width:Math.min(s,n.x+n.width-a),height:Math.min(s,n.y+n.height-i)});l&&r.push(l)}return r.length>0?r:[n]}findContentInRegion(e,n){let s=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,a=Number.MIN_SAFE_INTEGER,l=!1;for(const u of e)u.x>=n.x&&u.x<n.x+n.width&&u.y>=n.y&&u.y<n.y+n.height&&(s=Math.min(s,u.x),r=Math.max(r,u.x),i=Math.min(i,u.y),a=Math.max(a,u.y),l=!0);if(!l)return null;const c=1;return{x:Math.max(0,s-c),y:Math.max(0,i-c),width:r-s+1+c*2,height:a-i+1+c*2}}isValidObjectSize(e){var r,i;const s=Math.max(((r=this.tilesetImage)==null?void 0:r.width)||512,((i=this.tilesetImage)==null?void 0:i.height)||512);return e.width>=8&&e.height>=8&&e.width<=s&&e.height<=s&&e.width*e.height>=8*8}setObjectSeparationSensitivity(e){this.objectSeparationSensitivity=Math.max(0,Math.min(1,e))}getObjectSeparationSensitivity(){return this.objectSeparationSensitivity}tileHasContent(e){try{const s=e.getImageData(0,0,this.tileSizeX,this.tileSizeY).data;for(let r=3;r<s.length;r+=4)if(s[r]>this.tileContentThreshold)return!0;return!1}catch(n){return console.warn("Could not analyze tile content, assuming tile has content:",n),!0}}updateActiveTile(){const e=document.getElementById("activeGid");e&&(e.textContent=this.activeGid.toString()),document.querySelectorAll(".palette-tile").forEach(s=>{s.classList.remove("selected","multi-selected");const r=parseInt(s.getAttribute("data-tile-index")||"0");r===this.activeGid&&this.activeGid>0&&s.classList.add("selected"),this.multiSelectedBrushes.has(r)&&s.classList.add("multi-selected")})}resizeMap(e,n){this.mapWidth=e,this.mapHeight=n;for(const s of this.tileLayers){const r=new Array(e*n).fill(0);for(let i=0;i<Math.min(n,this.mapHeight);i++)for(let a=0;a<Math.min(e,this.mapWidth);a++){const l=i*this.mapWidth+a,c=i*e+a;l<s.data.length&&(r[c]=s.data[l])}s.data=r}this.draw(),this.markAsChanged(!0)}addLayer(e,n){if(this.tileLayers.find(i=>i.type===n))return!1;this.saveState();const r={id:this.nextLayerId++,name:e,type:n,data:new Array(this.mapWidth*this.mapHeight).fill(0),visible:!0,transparency:1};return this.tileLayers.push(r),this.sortLayersByPriority(),this.activeLayerId=r.id,this.draw(),this.markAsChanged(!0),!0}sortLayersByPriority(){const e={npc:1,enemy:2,event:3,collision:4,object:5,background:6};this.tileLayers.sort((n,s)=>e[n.type]-e[s.type])}deleteLayer(e){if(this.tileLayers.length<=1)return!1;const n=this.tileLayers.findIndex(s=>s.id===e);return n!==-1?(this.saveState(),this.tileLayers.splice(n,1),this.activeLayerId===e&&(this.activeLayerId=this.tileLayers.length>0?this.tileLayers[0].id:null),this.draw(),this.markAsChanged(!0),!0):!1}setActiveLayer(e){this.activeLayerId=e;const n=this.tileLayers.find(s=>s.id===e);n&&this.updateCurrentTileset(n.type),this.draw()}toggleLayerVisibility(e){const n=this.tileLayers.find(s=>s.id===e);n&&(n.visible=!n.visible,this.draw())}setLayerTransparency(e,n){const s=this.tileLayers.find(r=>r.id===e);s&&(s.transparency=Math.max(0,Math.min(1,n)),this.draw())}setMapName(e){if(typeof e=="string"){const n=e.trim();this.mapName=n.length>0?n:"Untitled Map"}else this.mapName="Untitled Map"}getMapName(){return this.mapName}setMapSize(e,n){this.mapWidth=e,this.mapHeight=n,this.collisionData=new Array(e*n).fill(0),this.tileLayers.forEach(s=>{const r=s.data;s.data=new Array(e*n).fill(0);for(let i=0;i<Math.min(n,15);i++)for(let a=0;a<Math.min(e,20);a++){const l=i*20+a,c=i*e+a;l<r.length&&(s.data[c]=r[l])}}),this.draw()}renameLayer(e,n){const s=this.tileLayers.find(r=>r.id===e);s&&(s.name=n)}changeLayerType(e,n,s){const r=this.tileLayers.find(i=>i.id===e);return r?(r.type=n,r.name=s,this.sortLayersByPriority(),!0):!1}setLayerType(e,n){const s=this.tileLayers.find(r=>r.id===e);s&&(s.type=n,this.sortLayersByPriority())}getLayers(){return this.tileLayers}getActiveLayerId(){return this.activeLayerId}getHoverCoordinates(){return this.hoverX>=0&&this.hoverY>=0?{x:this.hoverX,y:this.hoverY}:null}getActiveLayer(){return this.activeLayerId!==null&&this.tileLayers.find(e=>e.id===this.activeLayerId)||null}setCurrentTool(e){this.currentTool=e,this.tool="tiles"}getCurrentTool(){return this.currentTool}setCurrentSelectionTool(e){this.currentSelectionTool=e,this.tool="selection"}getCurrentSelectionTool(){return this.currentSelectionTool}setCurrentShapeTool(e){this.currentShapeTool=e,this.tool="shape"}getCurrentShapeTool(){return this.currentShapeTool}setEyedropperTool(){this.tool="eyedropper",this.mapCanvas.style.cursor="crosshair"}isEyedropperActive(){return this.tool==="eyedropper"}setEyedropperCallback(e){this.eyedropperCallback=e}setObjectsChangedCallback(e){this.objectsChangedCallback=e,e&&e(this.getMapObjects())}setStampTool(){this.tool="stamp",this.mapCanvas.style.cursor="crosshair",this.stampPreview.visible=!1}isStampActive(){return this.tool==="stamp"}setCurrentStampMode(e){this.currentStampMode=e,this.stampPreview.visible=e==="place"&&this.activeStamp!==null,this.draw()}getCurrentStampMode(){return this.currentStampMode}createStampFromSelection(e){if(!this.selection.active||this.selection.tiles.length===0)return!1;let n=1/0,s=1/0,r=-1/0,i=-1/0;for(const h of this.selection.tiles)n=Math.min(n,h.x),s=Math.min(s,h.y),r=Math.max(r,h.x),i=Math.max(i,h.y);const a=r-n+1,l=i-s+1,c=[],u=this.activeLayerId||0;for(const h of this.selection.tiles)h.gid>0&&c.push({tileId:h.gid,layerId:u,x:h.x-n,y:h.y-s});const f={id:Date.now().toString(),name:e,width:a,height:l,tiles:c};return this.stamps.set(f.id,f),this.clearSelection(),this.stampCallback&&this.stampCallback(Array.from(this.stamps.values())),!0}setActiveStamp(e){e&&this.stamps.has(e)?(this.activeStamp=this.stamps.get(e),this.currentStampMode="place",this.stampPreview.visible=!0):(this.activeStamp=null,this.stampPreview.visible=!1),this.draw()}getStamps(){return Array.from(this.stamps.values())}deleteStamp(e){return this.stamps.has(e)?(this.stamps.delete(e),this.activeStamp&&this.activeStamp.id===e&&(this.activeStamp=null,this.stampPreview.visible=!1),this.stampCallback&&this.stampCallback(Array.from(this.stamps.values())),this.draw(),!0):!1}setStampCallback(e){this.stampCallback=e}setHeroEditCallback(e){this.heroEditCallback=e}placeStamp(e,n){if(this.activeStamp&&!(e<0||n<0||e+this.activeStamp.width>this.mapWidth||n+this.activeStamp.height>this.mapHeight)){for(const s of this.activeStamp.tiles){const r=e+s.x,a=(n+s.y)*this.mapWidth+r;let l=this.tileLayers.find(c=>c.id===s.layerId);!l&&this.activeLayerId!==null&&(l=this.tileLayers.find(c=>c.id===this.activeLayerId)),l&&(l.data[a]=s.tileId)}this.saveState(),this.draw()}}buildStampFromMultiSelection(){if(this.multiSelectedBrushes.size===0)return null;const e=Array.from(this.multiSelectedBrushes.values()),n=e.length,s=Math.ceil(Math.sqrt(n)),r=Math.ceil(n/s),i=[];for(let a=0;a<n;a++){const l=e[a],c=a%s,u=Math.floor(a/s);i.push({tileId:l,layerId:this.activeLayerId??0,x:c,y:u})}return{id:`multiselection-${Date.now()}`,name:"MultiSelectStamp",width:s,height:r,tiles:i}}placeMultiSelectionAt(e,n){const s=this.buildStampFromMultiSelection();if(s){for(const r of s.tiles){const i=e+r.x,a=n+r.y;if(i<0||a<0||i>=this.mapWidth||a>=this.mapHeight)continue;const l=a*this.mapWidth+i,c=this.tileLayers.find(u=>u.id===(r.layerId||this.activeLayerId));c&&(c.data[l]=r.tileId)}this.saveState(),this.draw()}}clearSelection(){this.selection.active=!1,this.selection.tiles=[],this.draw()}hasActiveSelection(){return this.selection.active&&this.selection.tiles.length>0}getSelection(){return[...this.selection.tiles]}selectAll(){const e=this.tileLayers.find(n=>n.id===this.activeLayerId);if(e){this.selection.tiles=[];for(let n=0;n<this.mapHeight;n++)for(let s=0;s<this.mapWidth;s++){const r=n*this.mapWidth+s,i=e.data[r];this.selection.tiles.push({x:s,y:n,gid:i})}this.selection.active=!0,this.draw()}}deleteSelection(){if(!this.selection.active||this.selection.tiles.length===0)return;const e=this.tileLayers.find(n=>n.id===this.activeLayerId);e&&(this.saveState(),this.selection.tiles.forEach(n=>{const s=n.y*this.mapWidth+n.x;e.data[s]=0}),this.clearSelection(),this.markAsChanged(),this.draw())}fillSelection(){if(!this.selection.active||this.selection.tiles.length===0||this.activeGid===0)return;const e=this.tileLayers.find(n=>n.id===this.activeLayerId);e&&(this.saveState(),this.selection.tiles.forEach(n=>{const s=n.y*this.mapWidth+n.x;e.data[s]=this.activeGid}),this.markAsChanged(),this.draw())}bucketFill(e,n,s,r){const i=e.data[s*this.mapWidth+n];if(i===r)return;const a=[{x:n,y:s}],l=new Set;for(;a.length>0;){const{x:c,y:u}=a.pop(),f=u*this.mapWidth+c;c<0||c>=this.mapWidth||u<0||u>=this.mapHeight||l.has(f)||e.data[f]===i&&(l.add(f),e.data[f]=r,a.push({x:c+1,y:u}),a.push({x:c-1,y:u}),a.push({x:c,y:u+1}),a.push({x:c,y:u-1}))}}selectRectangular(e,n,s,r,i){this.selection.tiles=[];const a=Math.min(n,r),l=Math.max(n,r),c=Math.min(s,i),u=Math.max(s,i);for(let f=c;f<=u;f++)for(let h=a;h<=l;h++)if(h>=0&&h<this.mapWidth&&f>=0&&f<this.mapHeight){const p=f*this.mapWidth+h,b=e.data[p];this.selection.tiles.push({x:h,y:f,gid:b})}this.selection.active=!0}selectMagicWand(e,n,s){const r=e.data[s*this.mapWidth+n];this.selection.tiles=[];const i=[{x:n,y:s}],a=new Set;for(;i.length>0;){const{x:l,y:c}=i.pop(),u=c*this.mapWidth+l;l<0||l>=this.mapWidth||c<0||c>=this.mapHeight||a.has(u)||e.data[u]===r&&(a.add(u),this.selection.tiles.push({x:l,y:c,gid:r}),i.push({x:l+1,y:c}),i.push({x:l-1,y:c}),i.push({x:l,y:c+1}),i.push({x:l,y:c-1}))}this.selection.active=!0}selectSameTile(e,n,s){const r=e.data[s*this.mapWidth+n];this.selection.tiles=[];for(let i=0;i<this.mapHeight;i++)for(let a=0;a<this.mapWidth;a++){const l=i*this.mapWidth+a;e.data[l]===r&&this.selection.tiles.push({x:a,y:i,gid:r})}this.selection.active=!0}selectCircular(e,n,s,r,i){this.selection.tiles=[];const a=Math.sqrt(Math.pow(r-n,2)+Math.pow(i-s,2));for(let l=0;l<this.mapHeight;l++)for(let c=0;c<this.mapWidth;c++)if(Math.sqrt(Math.pow(c-n,2)+Math.pow(l-s,2))<=a){const f=l*this.mapWidth+c,h=e.data[f];this.selection.tiles.push({x:c,y:l,gid:h})}this.selection.active=!0}drawRectangleShape(e,n,s,r){const i=[],a=Math.min(e,s),l=Math.max(e,s),c=Math.min(n,r),u=Math.max(n,r);for(let f=a;f<=l;f++)for(let h=c;h<=u;h++)(f===a||f===l||h===c||h===u)&&f>=0&&f<this.mapWidth&&h>=0&&h<this.mapHeight&&i.push({x:f,y:h});return i}drawCircleShape(e,n,s,r){const i=[],a=Math.sqrt(Math.pow(s-e,2)+Math.pow(r-n,2));for(let l=0;l<360;l+=1){const c=l*Math.PI/180,u=Math.round(e+a*Math.cos(c)),f=Math.round(n+a*Math.sin(c));u>=0&&u<this.mapWidth&&f>=0&&f<this.mapHeight&&(i.some(h=>h.x===u&&h.y===f)||i.push({x:u,y:f}))}return i}drawLineShape(e,n,s,r){const i=[],a=Math.abs(s-e),l=Math.abs(r-n),c=e<s?1:-1,u=n<r?1:-1;let f=a-l,h=e,p=n,b=!1;for(;!b;){if(h>=0&&h<this.mapWidth&&p>=0&&p<this.mapHeight&&i.push({x:h,y:p}),h===s&&p===r){b=!0;continue}const y=2*f;y>-l&&(f-=l,h+=c),y<a&&(f+=a,p+=u)}return i}resolveInternalAssetPath(e){if(typeof window>"u")return e;try{return new URL(e,window.location.href).toString()}catch{return e}}normalizePath(e){return e.replace(/\\/g,"/")}isInternalTilesetFile(e){return!!e&&l1.has(e.toLowerCase())}extractFileSourcePath(e){const n=e.path;return n&&typeof n=="string"?this.normalizePath(n):e.name?e.name:null}setLayerTileset(e,n){const s=this.snapshotLayerGids(),r=new Image;r.onload=()=>{const i=Math.max(1,Math.floor(r.width/this.tileSizeX)),a=Math.max(1,Math.floor(r.height/this.tileSizeY)),l=Math.max(1,i*a),c=i>0?Math.round(r.width/i):this.tileSizeX,u=a>0?Math.round(r.height/a):this.tileSizeY,f=this.extractFileSourcePath(n);this.layerTilesets.set(e,{image:r,fileName:n.name,columns:i,rows:a,count:l,tileWidth:c,tileHeight:u,spacing:0,margin:0,sourcePath:f});const h=this.tileLayers.find(b=>b.id===this.activeLayerId);h&&h.type===e&&this.updateCurrentTileset(e);const p=this.snapshotLayerGids();this.logLayerGidChanges(s,p,e)},r.src=URL.createObjectURL(n)}getCurrentLayerType(){const e=this.tileLayers.find(n=>n.id===this.activeLayerId);return e?e.type:null}hasLayerTileset(e){return this.layerTilesets.has(e)}createLayerTab(e,n){const s=this.layerTabs.get(e)||[],r=this.nextLayerTabId++,i={id:r,name:n||`Tab ${s.length+1}`};return s.push(i),this.layerTabs.set(e,s),this.layerActiveTabId.has(e)||this.layerActiveTabId.set(e,r),r}getLayerTabs(e){return this.layerTabs.get(e)||[]}setActiveLayerTab(e,n){this.layerActiveTabId.set(e,n);const s=this.layerTabs.get(e);if(s){const r=s.find(i=>i.id===n);if(r&&r.tileset&&r.tileset.image){const i=r.tileset.columns??(r.tileset.image?Math.max(1,Math.floor(r.tileset.image.width/this.tileSizeX)):1),a=r.tileset.rows??(r.tileset.image?Math.max(1,Math.floor(r.tileset.image.height/this.tileSizeY)):1),l=r.tileset.count??Math.max(1,i*a),c=r.tileset.tileWidth??(r.tileset.image?Math.round(r.tileset.image.width/i):this.tileSizeX),u=r.tileset.tileHeight??(r.tileset.image?Math.round(r.tileset.image.height/a):this.tileSizeY);if(this.layerTilesets.set(e,{image:r.tileset.image,fileName:r.tileset.fileName??null,columns:i,rows:a,count:l,tileWidth:c,tileHeight:u,spacing:r.tileset.spacing??0,margin:r.tileset.margin??0,sourcePath:r.tileset.sourcePath??null}),r.detectedTiles){this.detectedTileData.clear();for(const[f,h]of r.detectedTiles.entries())this.detectedTileData.set(f,h)}this.updateCurrentTileset(e)}else this.layerTilesets.delete(e),this.updateCurrentTileset(e)}}importBrushImageToLayerTab(e,n,s){return new Promise((r,i)=>{const a=new Image;a.onload=()=>{const c=(this.layerTabs.get(e)||[]).find(j=>j.id===n);if(!c)return i(new Error("Tab not found"));c.brushes||(c.brushes=[]),c.brushes.push({image:a,fileName:s.name,width:a.width,height:a.height});const u=Math.max(1,Math.floor(a.width/this.tileSizeX)),f=Math.max(1,Math.floor(a.height/this.tileSizeY)),h=Math.max(1,u*f),p=u>0?Math.round(a.width/u):this.tileSizeX,b=f>0?Math.round(a.height/f):this.tileSizeY,y=this.extractFileSourcePath(s);c.tileset?(c.tileset.image=a,c.tileset.fileName=s.name,c.tileset.columns=u,c.tileset.rows=f,c.tileset.count=h,c.tileset.tileWidth=p,c.tileset.tileHeight=b,c.tileset.spacing=0,c.tileset.margin=0,c.tileset.sourcePath=y):c.tileset={image:a,fileName:s.name,columns:u,rows:f,count:h,tileWidth:p,tileHeight:b,spacing:0,margin:0,sourcePath:y},this.layerActiveTabId.get(e)===n&&this.setActiveLayerTab(e,n),r()},a.onerror=l=>i(new Error("Failed to load brush image")),a.src=URL.createObjectURL(s)})}removeLayerTab(e,n){const s=this.layerTabs.get(e)||[],r=s.findIndex(i=>i.id===n);if(console.info(`removeLayerTab called for layer=${e} tabId=${n} (found idx=${r})`),r!==-1){const i=s.splice(r,1);if(console.info("removeLayerTab removed:",i),this.layerTabs.set(e,s),this.layerActiveTabId.get(e)===n)if(s.length>0)try{this.setActiveLayerTab(e,s[0].id)}catch(l){console.warn("setActiveLayerTab failed during removeLayerTab fallback to direct set:",l),this.layerActiveTabId.set(e,s[0].id),this.updateCurrentTileset(e)}else this.layerActiveTabId.delete(e),this.layerTilesets.delete(e),this.updateCurrentTileset(e)}else console.warn(`removeLayerTab: tab id ${n} not found in layer ${e}. Current tabs:`,s.map(i=>i.id))}getActiveLayerTabId(e){return this.layerActiveTabId.get(e)||null}updateCurrentTileset(e){const n=this.getLayerTilesetOrFallback(e);if(n){this.tilesetImage=n.image,this.tilesetFileName=n.fileName,this.tilesetColumns=n.columns,this.tilesetRows=n.rows,this.tileCount=n.count,this.tilesetTileWidth=n.tileWidth??this.tileSizeX,this.tilesetTileHeight=n.tileHeight??this.tileSizeY,this.tilesetSpacing=n.spacing??0,this.tilesetMargin=n.margin??0,this.tilesetSourcePath=n.sourcePath??this.tilesetSourcePath;const s=this.layerTileData.get(e);if(this.detectedTileData.clear(),s)for(const[i,a]of s.entries())this.detectedTileData.set(i,a);const r=this.layerActiveGid.get(e)||0;this.updateActiveGid(r),this.createTilePalette()}else this.tilesetImage=null,this.tilesetFileName=null,this.tilesetColumns=0,this.tilesetRows=0,this.tileCount=0,this.detectedTileData.clear(),this.updateActiveGid(0),this.clearTilePalette()}clearTilePalette(){const e=document.getElementById("tilesContainer");e&&(e.innerHTML=""),this.hideCollisionBrushTooltip(!0)}clearLayer(){if(this.activeLayerId!==null){const e=this.tileLayers.find(n=>n.id===this.activeLayerId);e&&e.data.fill(0)}this.draw()}removeLayerTileset(){const e=this.tileLayers.find(n=>n.id===this.activeLayerId);if(e){const n=e.type;this.layerTilesets.delete(n),this.layerTileData.delete(n),this.tilesetImage=null,this.tilesetFileName=null,this.tilesetColumns=0,this.tilesetRows=0,this.tileCount=0,this.detectedTileData.clear(),this.activeGid=0,this.clearTilePalette(),this.draw()}}exportFlareMap(){if(!this.tilesetImage||!this.tilesetFileName){alert("Please load a tileset first before exporting.");return}const e=this.generateFlareMapTxt(),n=this.generateFlareTilesetDef();this.downloadFile(e,"map.txt","text/plain"),this.downloadFile(n,"tileset.txt","text/plain"),console.log("Flare-compatible map exported successfully!"),console.log("📁 Files exported:"),console.log("  • map.txt (place in maps/ folder)"),console.log("  • tileset.txt (place in tilesetdefs/ folder)"),console.log("🎮 Format: Fully compatible with Flare Engine"),this.logGlobalTilesetMapping()}logGlobalTilesetMapping(){console.log("??? Global Tileset Mapping:");const e=this.collectGlobalTilesets();for(const n of e){const s=n.offset+n.count-1;console.log(`  ${n.fileName} (${n.layerType}): IDs ${n.offset}-${s} (${n.count} tiles)`)}}autoSaveExport(){if(!this.tilesetImage||!this.tilesetFileName||!this.tileLayers.some(n=>n.data.some(s=>s!==0)))return!1;try{return this.saveToLocalStorage(),!0}catch(n){return console.warn("Auto-save failed:",n),!1}}collectGlobalTilesets(){const e=[],n=new Set,s=a=>{if(!a.fileName||this.isInternalTilesetFile(a.fileName))return;const l=`${a.fileName}:${a.sourcePath??""}`;if(n.has(l))return;const c=Math.max(1,a.columns),u=Math.max(1,a.rows),f=Math.max(1,a.count),h=Math.max(1,a.tileWidth||this.tileSizeX),p=Math.max(1,a.tileHeight||this.tileSizeY),b=a.spacing??0,y=a.margin??0;e.push({id:l||a.fileName,layerType:a.layerType,fileName:a.fileName,count:f,columns:c,rows:u,tileWidth:h,tileHeight:p,spacing:b,margin:y,sourcePath:a.sourcePath,image:a.image,offset:0}),n.add(l)};if(this.tilesetFileName&&this.tileCount>0&&!this.isInternalTilesetFile(this.tilesetFileName)){const a=this.tilesetColumns||(this.tilesetImage?Math.max(1,Math.floor(this.tilesetImage.width/this.tileSizeX)):1),l=this.tilesetRows||(this.tilesetImage?Math.max(1,Math.floor(this.tilesetImage.height/this.tileSizeY)):1),c=this.tilesetTileWidth??(this.tilesetImage?Math.round(this.tilesetImage.width/Math.max(a,1)):this.tileSizeX),u=this.tilesetTileHeight??(this.tilesetImage?Math.round(this.tilesetImage.height/Math.max(l,1)):this.tileSizeY),f=Math.max(1,this.tileCount);s({layerType:"main",fileName:this.tilesetFileName,count:f,columns:a,rows:l,tileWidth:c,tileHeight:u,spacing:this.tilesetSpacing??0,margin:this.tilesetMargin??0,sourcePath:this.tilesetSourcePath,image:this.tilesetImage})}for(const[a,l]of this.layerTilesets.entries()){if(!l.fileName||this.isInternalTilesetFile(l.fileName))continue;const c=l.columns??(l.image?Math.max(1,Math.floor(l.image.width/this.tileSizeX)):1),u=l.rows??(l.image?Math.max(1,Math.floor(l.image.height/this.tileSizeY)):1),f=l.count??Math.max(1,c*u),h=l.tileWidth??(l.image?Math.round(l.image.width/Math.max(c,1)):this.tileSizeX),p=l.tileHeight??(l.image?Math.round(l.image.height/Math.max(u,1)):this.tileSizeY);s({layerType:a,fileName:l.fileName,count:f,columns:c,rows:u,tileWidth:h,tileHeight:p,spacing:l.spacing??0,margin:l.margin??0,sourcePath:l.sourcePath??null,image:l.image??null})}const r={collision:0,main:1,background:2,object:3,event:4,enemy:5,npc:6};e.sort((a,l)=>{const c=r[a.layerType]??99,u=r[l.layerType]??99;if(c!==u)return c-u;const f=(a.fileName||"").toLowerCase(),h=(l.fileName||"").toLowerCase();return f<h?-1:f>h?1:0});let i=1;for(const a of e)a.offset=i,i+=Math.max(1,a.count);return e}resolveTilesetExportPath(e,n){const s=[];if(e.id&&s.push(e.id),e.sourcePath&&s.push(e.sourcePath),e.fileName&&s.push(e.fileName),n){for(const r of s)if(r&&n[r])return this.normalizePath(n[r])}if(e.sourcePath){const r=this.normalizePath(e.sourcePath);if(/[/\\]/.test(r))return r}return e.fileName?`images/tilesets/${e.fileName}`:"tileset.png"}generateFlareMapTxt(e={}){const n=[];n.push("[header]"),n.push(`width=${this.mapWidth}`),n.push(`height=${this.mapHeight}`),n.push(`tilewidth=${this.tileSizeX}`),n.push(`tileheight=${this.tileSizeY}`),n.push("orientation=isometric"),n.push(`hero_pos=${this.heroX},${this.heroY}`),n.push("music=music/default_theme.ogg");const s=(this.mapName||"Map_Name").replace(/[<>:"/\\|?*]/g,"_").trim().replace(/\s+/g,"_").replace(/_{2,}/g,"_");n.push(`tileset=tilesetdefs/tileset_${s}.txt`);const r=e.mapName&&e.mapName.trim()||this.mapName||(this.tilesetFileName?this.tilesetFileName.replace(/\.[^/.]+$/,""):"Untitled Map");n.push(`title=${r}`),n.push("");const a=this.collectGlobalTilesets().filter(h=>h.fileName&&!this.isInternalTilesetFile(h.fileName)),l=new Map;for(const h of a)h.fileName&&(l.has(h.fileName)||l.set(h.fileName,h.offset));n.push("[tilesets]");for(const h of a){if(!h.fileName)continue;const p=`images/tilesets/${h.fileName}`;n.push(`tileset=${p},${h.tileWidth},${h.tileHeight},${h.spacing},${h.margin}`)}n.push("");const c=["background","object","collision"];for(const h of c){const p=this.tileLayers.find(v=>v.type===h&&v.visible);if(!p)continue;n.push("[layer]"),n.push(`type=${p.type}`),n.push("data=");const b=this.getLayerTilesetOrFallback(h),S=h===Ns?null:(b==null?void 0:b.fileName)??null,j=S?l.get(S):void 0;for(let v=0;v<this.mapHeight;v++){const g=[];for(let x=0;x<this.mapWidth;x++){const w=v*this.mapWidth+x,N=p.data[w];let T=0;N>0&&(j!==void 0&&j>=1?T=j+(N-1):T=N),g.push(T.toString())}n.push(g.join(","))}n.push("")}const u=this.objects.filter(h=>h.type==="event");for(const h of u){n.push("[event]"),n.push(`# ${h.name}`),n.push("type=event"),n.push(`location=${h.x},${h.y},${h.width},${h.height}`),h.activate&&n.push(`activate=${h.activate}`),h.hotspot&&n.push(`hotspot=${h.hotspot}`),h.intermap&&n.push(`intermap=${h.intermap}`),h.loot&&n.push(`loot=${h.loot}`),h.soundfx&&n.push(`soundfx=${h.soundfx}`),h.mapmod&&n.push(`mapmod=${h.mapmod}`),h.repeat!==void 0&&n.push(`repeat=${h.repeat}`),h.tooltip&&n.push(`tooltip=${h.tooltip}`);for(const[p,b]of Object.entries(h.properties))n.push(`${p}=${b}`);n.push("")}const f=this.objects.filter(h=>h.type==="enemy");for(const h of f){n.push("[enemy]"),n.push("type=enemy"),n.push(`location=${h.x},${h.y},${h.width},${h.height}`),h.category&&n.push(`category=${h.category}`),h.level&&n.push(`level=${h.level}`),h.number&&n.push(`number=${h.number}`),h.wander_radius!==void 0&&n.push(`wander_radius=${h.wander_radius}`);for(const[p,b]of Object.entries(h.properties))n.push(`${p}=${b}`);n.push("")}return n.join(`
`)}generateFlareTilesetDef(e={}){const n=[],r=this.collectGlobalTilesets().filter(l=>l.fileName&&!this.isInternalTilesetFile(l.fileName));if(r.length===0)return`# No tilesets found - please load tilesets before exporting
`;for(const l of r){if(!l.fileName)continue;const c=`images/tilesets/${l.fileName}`;n.push(`img=${c}`)}n.push("");const i=new Map;if(this.detectedTileData&&this.detectedTileData.size>0)for(const[l,c]of this.detectedTileData.entries())i.set(l,{sourceX:c.sourceX,sourceY:c.sourceY,width:c.width,height:c.height});const a=new Map;for(const l of r)l.fileName&&!a.has(l.fileName)&&a.set(l.fileName,l.offset);for(const[l,c]of this.layerTileData.entries()){const u=this.getLayerTilesetOrFallback(l),f=(u==null?void 0:u.fileName)??null;if(!f||this.isInternalTilesetFile(f))continue;const h=a.get(f);for(const[p,b]of c.entries()){const y=h!==void 0?h+p-1:p;i.has(y)||i.set(y,{sourceX:b.sourceX,sourceY:b.sourceY,width:b.width,height:b.height})}}for(const l of r){const c=Math.max(1,l.columns),u=l.tileWidth||this.tileSizeX,f=l.tileHeight||this.tileSizeY;for(let h=0;h<l.count;h++){const p=l.offset+h,b=i.get(p)||i.get(h+1);let y,S,j,v,g,x;b?(y=b.sourceX,S=b.sourceY,j=b.width,v=b.height,g=Math.floor(j/2),x=v):(y=h%c*u,S=Math.floor(h/c)*f,j=u,v=f,g=Math.floor(j/2),x=v),n.push(`tile=${p},${y},${S},${j},${v},${g},${x}`)}}return n.join(`
`)}getTilesetExportInfo(){return this.collectGlobalTilesets().map(e=>({id:e.id,fileName:e.fileName,sourcePath:e.sourcePath,tileWidth:e.tileWidth,tileHeight:e.tileHeight,spacing:e.spacing,margin:e.margin}))}parseTilesetDefContent(e,n){if(!e)return;const s=e.split(/\r?\n/).map(i=>i.trim()).filter(Boolean),r=new Map;for(const i of s)if(!i.startsWith("#")&&!i.startsWith("img=")&&i.startsWith("tile=")){const l=i.substring(5).split(",").map(c=>c.trim());if(l.length>=5){const c=parseInt(l[0],10),u=parseInt(l[1],10),f=parseInt(l[2],10),h=parseInt(l[3],10),p=parseInt(l[4],10),b=l[5]!==void 0?parseInt(l[5],10):Math.floor(h/2),y=l[6]!==void 0?parseInt(l[6],10):p;!Number.isNaN(c)&&!Number.isNaN(u)&&!Number.isNaN(f)&&!Number.isNaN(h)&&!Number.isNaN(p)&&r.set(c,{sourceX:u,sourceY:f,width:h,height:p,originX:b,originY:y})}}if(r.size>0){this.detectedTileData.clear();for(const[a,l]of r.entries())this.detectedTileData.set(a,l);const i=n||this.getCurrentLayerType();if(i){const a=new Map;for(const[l,c]of r.entries())a.set(l,{sourceX:c.sourceX,sourceY:c.sourceY,width:c.width,height:c.height,originX:c.originX,originY:c.originY});this.layerTileData.set(i,a)}this.createTilePalette(!0),this.draw()}}parseAndExportTileset(e,n,s=64,r=32){if(!e)return;const i=Math.max(1,Math.floor(e.width/s)),a=Math.max(1,Math.floor(e.height/r)),l=[],c=this.guessFileNameFromImage(e);l.push(`img=images/tilesets/${c}`),l.push(""),this.detectedTileData.clear();const u=this.detectVariableSizedTiles();if(u.length>0){let y=1;for(const S of u){const j=S.sourceX,v=S.sourceY,g=S.width,x=S.height,w=Math.floor(g/2),N=x;this.detectedTileData.set(y,{sourceX:j,sourceY:v,width:g,height:x,originX:w,originY:N}),l.push(`tile=${y},${j},${v},${g},${x},${w},${N}`),y++}}else{let y=1;for(let S=0;S<a;S++)for(let j=0;j<i;j++){const v=j*s,g=S*r,x=s,w=r,N=Math.floor(x/2),T=w;this.detectedTileData.set(y,{sourceX:v,sourceY:g,width:x,height:w,originX:N,originY:T}),l.push(`tile=${y},${v},${g},${x},${w},${N},${T}`),y++}}const h=`tileset_${(n||"tileset").replace(/[<>:"/\\|?*]/g,"_").trim()}.txt`,p=l.join(`
`);try{const y=window.require;if(typeof y=="function"){const S=y("fs"),j=y("path");let v=null;if(e.dataset&&e.dataset.sourcePath?v=e.dataset.sourcePath:typeof e.src=="string"&&e.src.startsWith("file://")?v=e.src.replace("file://",""):this.tilesetSourcePath&&(v=this.tilesetSourcePath),v)if(j&&typeof j.dirname=="function"&&typeof j.join=="function"&&S&&typeof S.writeFileSync=="function"){const g=j.dirname(v),x=j.join(g,h);S.writeFileSync(x,p,"utf8"),console.log("Tileset defs saved to",x)}else this.downloadFile(p,h,"text/plain");else this.downloadFile(p,h,"text/plain")}else this.downloadFile(p,h,"text/plain")}catch(y){console.warn("Could not write tilesetdefs to disk, falling back to download:",y),this.downloadFile(p,h,"text/plain")}const b=this.tileLayers.find(y=>y.id===this.activeLayerId);if(b){const y=new Map;for(const[S,j]of this.detectedTileData.entries())y.set(S,{sourceX:j.sourceX,sourceY:j.sourceY,width:j.width,height:j.height,originX:j.originX,originY:j.originY});this.layerTileData.set(b.type,y)}this.createTilePalette(!0)}guessFileNameFromImage(e){try{const n=e.src||"",s=e.dataset;if(s&&typeof s.filename=="string"&&s.filename.length>0)return s.filename;const r=n.match(/[^/\\]+\.(png|jpg|jpeg|webp)$/i);return r?r[0]:`tileset_${Date.now()}.png`}catch{return`tileset_${Date.now()}.png`}}downloadFile(e,n,s){const r=new Blob([e],{type:s}),i=URL.createObjectURL(r),a=document.createElement("a");a.href=i,a.download=n,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(i)}saveState(){if(this.isApplyingHistory)return;const e={layers:this.tileLayers.map(n=>({...n,data:[...n.data]})),objects:this.objects.map(n=>({...n}))};this.history=this.history.slice(0,this.historyIndex+1),this.history.push(e),this.historyIndex=this.history.length-1,this.history.length>this.maxHistorySize&&(this.history.shift(),this.historyIndex--),this.markAsChanged(!1)}deepCopyLayers(e){return e.map(n=>({...n,data:[...n.data]}))}deepCopyObjects(e){return e.map(n=>({...n}))}undo(){this.historyIndex>0&&(this.historyIndex--,this.applyHistoryState())}redo(){this.historyIndex<this.history.length-1&&(this.historyIndex++,this.applyHistoryState())}applyHistoryState(){if(this.historyIndex>=0&&this.historyIndex<this.history.length){this.isApplyingHistory=!0;const e=this.history[this.historyIndex];this.tileLayers=this.deepCopyLayers(e.layers),this.objects=this.deepCopyObjects(e.objects),this.notifyObjectsChanged(),this.draw(),this.isApplyingHistory=!1}}setAutoSaveCallback(e){this.autoSaveCallback=e}setSaveStatusCallback(e){this.saveStatusCallback=e}setAutoSaveEnabled(e){this.autoSaveEnabled=e,!e&&this.autoSaveTimeout&&(clearTimeout(this.autoSaveTimeout),this.autoSaveTimeout=null)}setDarkMode(e){this.isDarkMode=e,this.draw()}markAsChanged(e=!1){if(!this.autoSaveEnabled)return;this.hasUnsavedChanges=!0,this.updateSaveStatus("unsaved"),this.autoSaveTimeout&&clearTimeout(this.autoSaveTimeout);const n=e?this.IMMEDIATE_SAVE_DELAY:this.AUTO_SAVE_DELAY;this.autoSaveTimeout=window.setTimeout(()=>{this.performAutoSave()},n)}async performAutoSave(){if(this.hasUnsavedChanges)try{this.updateSaveStatus("saving"),this.autoSaveExport()?(this.autoSaveCallback&&await this.autoSaveCallback(),this.hasUnsavedChanges=!1,this.lastSaveTimestamp=Date.now(),this.updateSaveStatus("saved")):this.updateSaveStatus("saved"),this.autoSaveTimeout=null}catch(e){console.error("Auto-save failed:",e),this.updateSaveStatus("error"),this.autoSaveTimeout=window.setTimeout(()=>{this.performAutoSave()},15e3)}}saveToLocalStorage(){try{const e={timestamp:Date.now(),mapWidth:this.mapWidth,mapHeight:this.mapHeight,layers:this.tileLayers,objects:this.objects,heroX:this.heroX,heroY:this.heroY,tilesetFileName:this.tilesetFileName,tilesetImage:this.tilesetImage?this.canvasToDataURL(this.tilesetImage):null,tileSizeX:this.tileSizeX,tileSizeY:this.tileSizeY,mapName:this.mapName,detectedTileData:Array.from(this.detectedTileData.entries()),tileContentThreshold:this.tileContentThreshold,objectSeparationSensitivity:this.objectSeparationSensitivity};localStorage.setItem("tilemap_autosave_backup",JSON.stringify(e))}catch(e){console.warn("Failed to save to localStorage:",e)}}canvasToDataURL(e){const n=document.createElement("canvas");n.width=e.width,n.height=e.height;const s=n.getContext("2d");return s?(s.drawImage(e,0,0),n.toDataURL("image/png")):""}generateMinimapDataUrl(){try{const s=Math.max(1,Math.floor(Math.min(160/Math.max(1,this.mapWidth),120/Math.max(1,this.mapHeight)))),r=this.mapWidth*s,i=this.mapHeight*s,a=document.createElement("canvas");a.width=r,a.height=i;const l=a.getContext("2d");if(!l)return"";l.imageSmoothingEnabled=!1,l.fillStyle="#ffffff",l.fillRect(0,0,r,i);for(let c=0;c<this.tileLayers.length;c++){const u=this.tileLayers[c];if(u.visible)for(let f=0;f<this.mapHeight;f++)for(let h=0;h<this.mapWidth;h++){const p=f*this.mapWidth+h,b=u.data[p];if(b>0){const y=b*137.5%360;l.fillStyle=`hsl(${y},55%,${c===0?"45%":"60%"})`,l.fillRect(h*s,f*s,s,s)}}}return a.toDataURL("image/png")}catch(e){return console.warn("generateMinimapDataUrl failed",e),""}}loadFromLocalStorage(){try{const e=localStorage.getItem("tilemap_autosave_backup");if(!e)return!1;const n=JSON.parse(e);if(Date.now()-n.timestamp>24*60*60*1e3)return!1;this.mapWidth=n.mapWidth,this.mapHeight=n.mapHeight,this.tileLayers=n.layers;const r=this.normalizeLoadedObjects(n.objects);if(this.objects=r,this.nextObjectId=this.calculateNextObjectId(r),this.notifyObjectsChanged(),this.tilesetFileName=n.tilesetFileName,typeof n.mapName=="string"?this.setMapName(n.mapName):this.tilesetFileName?this.setMapName(this.tilesetFileName.replace(/\.[^/.]+$/,"")):this.setMapName("Untitled Map"),n.heroX!==void 0&&n.heroY!==void 0?(this.heroX=Math.max(0,Math.min(n.heroX,this.mapWidth-1)),this.heroY=Math.max(0,Math.min(n.heroY,this.mapHeight-1))):(this.heroX=0,this.heroY=0),n.tileContentThreshold!==void 0&&(this.tileContentThreshold=n.tileContentThreshold),n.objectSeparationSensitivity!==void 0&&(this.objectSeparationSensitivity=n.objectSeparationSensitivity),n.detectedTileData){this.detectedTileData.clear();for(const[i,a]of n.detectedTileData)this.detectedTileData.set(i,a)}if(n.tilesetImage){const i=new Image;i.onload=()=>{this.tilesetImage=i,this.tilesetColumns=Math.floor(i.width/this.tileSizeX),this.tilesetRows=Math.floor(i.height/this.tileSizeY),this.tileCount=this.tilesetColumns*this.tilesetRows,n.detectedTileData&&n.detectedTileData.length>0?this.createTilePalette(!0):this.createTilePalette(),this.updateActiveTile(),this.draw()},i.src=n.tilesetImage}return this.ensureCollisionTileset(),this.draw(),!0}catch(e){return console.error("Failed to load from localStorage:",e),!1}}clearLocalStorageBackup(){localStorage.removeItem("tilemap_autosave_backup")}async saveProjectData(e){var n;try{console.log("=== SAVE PROJECT DATA DEBUG ==="),console.log("Project path:",e),console.log("Number of layer tilesets:",this.layerTilesets.size);const s={},r=[];console.log("=== SAVING LAYER TILESETS ===");for(const[a,l]of this.layerTilesets.entries()){if(!l.image||!l.fileName){console.log(`No tileset image for layer ${a}`);continue}if(this.isInternalTilesetFile(l.fileName)){console.log(`Skipping internal tileset for layer ${a}: ${l.fileName}`);continue}console.log(`Saving tileset for layer ${a}: ${l.fileName}`);const c=this.canvasToDataURL(l.image);s[l.fileName]=c,r.push({layerType:a,fileName:l.fileName,name:l.fileName.replace(/\.[^/.]+$/,""),columns:l.columns,rows:l.rows,count:l.count,tileWidth:l.tileWidth??this.tileSizeX,tileHeight:l.tileHeight??this.tileSizeY,spacing:l.spacing??0,margin:l.margin??0,sourcePath:l.sourcePath??null,detectedTiles:this.getDetectedTilesForLayer(a)}),console.log(`Saved tileset: ${l.fileName} (${c.length} bytes)`)}if(this.layerTilesets.size===0&&this.tilesetImage&&this.tilesetFileName){console.log("Saving legacy tileset:",this.tilesetFileName);const a=this.canvasToDataURL(this.tilesetImage);s[this.tilesetFileName]=a,r.push({fileName:this.tilesetFileName,name:this.tilesetFileName.replace(/\.[^/.]+$/,""),tileWidth:this.tilesetTileWidth??this.tileSizeX,tileHeight:this.tilesetTileHeight??this.tileSizeY,spacing:this.tilesetSpacing??0,margin:this.tilesetMargin??0,sourcePath:this.tilesetSourcePath,detectedTiles:Array.from(this.detectedTileData.entries())})}const i={name:this.mapName||(this.tilesetFileName?this.tilesetFileName.replace(/\.[^/.]+$/,""):"Untitled Map"),width:this.mapWidth,height:this.mapHeight,tileSize:64,layers:this.tileLayers,objects:this.objects,heroX:this.heroX,heroY:this.heroY,tilesets:r,tilesetImages:s,minimap:this.generateMinimapDataUrl(),version:"1.0",tileContentThreshold:this.tileContentThreshold,objectSeparationSensitivity:this.objectSeparationSensitivity};if(console.log("Project data prepared:",{name:i.name,tilesetCount:Object.keys(i.tilesetImages||{}).length,layerCount:(i.layers||[]).length,layerTilesetCount:r.length}),(n=window.electronAPI)!=null&&n.saveMapProject){console.log("Saving via Electron API...");const a={...i,name:i.name||"Untitled Map",width:i.width??20,height:i.height??15,tileSize:i.tileSize??32,layers:i.layers||[],objects:i.objects||[],tilesets:i.tilesets||[],tilesetImages:i.tilesetImages||{},version:i.version||"1.0"},l=await window.electronAPI.saveMapProject(e,a);return console.log("Electron save result:",l),l}else return console.log("Falling back to localStorage save..."),this.saveToLocalStorage(),!0}catch(s){return console.error("Error saving project data:",s),!1}}updateSaveStatus(e){this.saveStatusCallback&&this.saveStatusCallback(e)}getUnsavedChanges(){return this.hasUnsavedChanges}getLastSaveTime(){return this.lastSaveTimestamp}forceSave(){this.autoSaveTimeout&&clearTimeout(this.autoSaveTimeout),this.performAutoSave()}notifyObjectsChanged(){this.objectsChangedCallback&&this.objectsChangedCallback(this.getMapObjects())}calculateNextObjectId(e){return e.length?e.reduce((n,s)=>Math.max(n,typeof s.id=="number"?s.id:0),0)+1:1}normalizeLoadedObjects(e){return Array.isArray(e)?e.map((n,s)=>{const r={...n,id:typeof n.id=="number"&&!Number.isNaN(n.id)?n.id:s+1,width:typeof n.width=="number"&&n.width>0?n.width:1,height:typeof n.height=="number"&&n.height>0?n.height:1,properties:n.properties||{}};return r.category==="npc"||r.type==="npc"?(r.category="npc",r.type="npc",r.wander_radius=0):(r.category==="enemy"||r.category==="creature"||r.type==="enemy")&&(r.type="enemy",r.category=r.category||"enemy"),r}):[]}addMapObject(e,n,s,r=1,i=1){const a={id:this.nextObjectId++,name:`${e}_${this.nextObjectId-1}`,type:e,x:n,y:s,width:r,height:i,properties:{}};return e==="event"?(a.activate="on_trigger",a.hotspot="location",a.tooltip="Event"):e==="enemy"&&(a.category="enemy",a.level=1,a.number=1,a.wander_radius=4),this.objects.push(a),this.saveState(),this.notifyObjectsChanged(),a}removeMapObject(e){var s;const n=this.objects.findIndex(r=>r.id===e);return n>=0?(this.objects.splice(n,1),((s=this.selectedObject)==null?void 0:s.id)===e&&(this.selectedObject=null),this.saveState(),this.notifyObjectsChanged(),!0):!1}updateMapObject(e,n){const s=this.objects.find(r=>r.id===e);return s?(Object.assign(s,n),this.saveState(),this.notifyObjectsChanged(),!0):!1}getMapObjects(){return[...this.objects]}getObjectsAtPosition(e,n){return this.objects.filter(s=>s.x===e&&s.y===n)}isHeroAtPosition(e,n){return this.heroX===e&&this.heroY===n}setHeroPosition(e,n){this.heroX=Math.max(0,Math.min(e,this.mapWidth-1)),this.heroY=Math.max(0,Math.min(n,this.mapHeight-1)),this.saveState(),this.draw()}getHeroPosition(){return{x:this.heroX,y:this.heroY}}updateCursorForHover(){if(this.isHeroAtPosition(this.hoverX,this.hoverY)){this.mapCanvas.style.cursor="move",this.showHeroTooltip();return}const e=this.getDraggableActorAt(this.hoverX,this.hoverY);if(e){const r=this.getActorLayerType(e);if(r){this.mapCanvas.style.cursor="move",this.showActorTooltip(e,r);return}}const n=this.getActiveLayer();if(n&&["enemy","npc","object","event","background"].includes(n.type)){const r=this.getObjectsAtPosition(this.hoverX,this.hoverY);if(r.length>0){this.mapCanvas.style.cursor="pointer",this.showObjectTooltip(r[0]);return}}this.spacePressed?this.mapCanvas.style.cursor=this.isPanning?"grabbing":"grab":this.mapCanvas.style.cursor="crosshair",this.hideObjectTooltip()}showObjectTooltip(e){let n=document.getElementById("object-tooltip");n||(n=document.createElement("div"),n.id="object-tooltip",n.style.position="absolute",n.style.background="rgba(0, 0, 0, 0.35)",n.style.color="white",n.style.padding="4px 6px",n.style.borderRadius="3px",n.style.fontSize="11px",n.style.fontFamily='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',n.style.lineHeight="1.2",n.style.pointerEvents="none",n.style.zIndex="1000",n.style.border="1px solid rgba(255, 107, 0, 0.8)",n.style.boxShadow="0 1px 4px rgba(0,0,0,0.3)",n.style.backdropFilter="blur(2px)",document.body.appendChild(n));const s=`
      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle; margin-right: 4px;">
        <rect x="5" y="2" width="14" height="20" rx="7"/>
        <path d="M12 6v4"/>
      </svg>
    `,r=e.type==="enemy"?e.category||"enemy":e.type;n.innerHTML=`
      <div style="font-weight: bold; margin-bottom: 2px; color: #ff6b00; font-size: 10px;">
        ${s}Double click to edit
      </div>
      <div style="font-weight: bold; margin-bottom: 1px;">${e.name||"Unnamed"}</div>
      <div style="font-size: 10px; color: rgba(255,255,255,0.9);">Type: ${r}</div>
    `;const i=this.mapCanvas.getBoundingClientRect(),a=this.mapToScreen(this.hoverX,this.hoverY);n.style.left=`${i.left+a.x+20}px`,n.style.top=`${i.top+a.y-10}px`,n.style.display="block"}showActorTooltip(e,n){let s=document.getElementById("object-tooltip");s||(s=document.createElement("div"),s.id="object-tooltip",s.style.position="absolute",s.style.background="rgba(0, 0, 0, 0.35)",s.style.color="white",s.style.padding="4px 6px",s.style.borderRadius="3px",s.style.fontSize="11px",s.style.fontFamily='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',s.style.lineHeight="1.2",s.style.pointerEvents="none",s.style.zIndex="1000",s.style.border="1px solid rgba(255, 107, 0, 0.8)",s.style.boxShadow="0 1px 4px rgba(0,0,0,0.3)",s.style.backdropFilter="blur(2px)",document.body.appendChild(s));const r=`
      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle; margin-right: 4px;">
        <rect x="5" y="2" width="14" height="20" rx="7"/>
        <path d="M12 6v4"/>
      </svg>
    `,i=n==="npc"?"NPC":"Enemy",a=e.name||i;s.innerHTML=`
      <div style="font-weight: bold; margin-bottom: 2px; color: #ff6b00; font-size: 10px;">
        ${r}Drag to move
      </div>
      <div style="font-weight: bold; margin-bottom: 1px;">${a}</div>
      <div style="font-size: 10px; color: rgba(255,255,255,0.9);">Type: ${i}</div>
      <div style="font-size: 10px; color: rgba(255,255,255,0.9);">Double click to edit</div>
    `;const l=this.mapCanvas.getBoundingClientRect(),c=this.mapToScreen(this.hoverX,this.hoverY);s.style.left=`${l.left+c.x+20}px`,s.style.top=`${l.top+c.y-10}px`,s.style.display="block"}hideObjectTooltip(){const e=document.getElementById("object-tooltip");e&&(e.style.display="none")}showHeroTooltip(){let e=document.getElementById("object-tooltip");e||(e=document.createElement("div"),e.id="object-tooltip",e.style.position="absolute",e.style.background="rgba(0, 0, 0, 0.35)",e.style.color="white",e.style.padding="4px 6px",e.style.borderRadius="3px",e.style.fontSize="11px",e.style.fontFamily='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',e.style.lineHeight="1.2",e.style.pointerEvents="none",e.style.zIndex="1000",e.style.border="1px solid rgba(255, 107, 0, 0.8)",e.style.boxShadow="0 1px 4px rgba(0,0,0,0.3)",e.style.backdropFilter="blur(2px)",document.body.appendChild(e));const n=`
      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle; margin-right: 4px;">
        <rect x="5" y="2" width="14" height="20" rx="7"/>
        <path d="M12 6v4"/>
      </svg>
    `;e.innerHTML=`
      <div style="font-weight: bold; margin-bottom: 2px; color: #ff6b00; font-size: 10px;">
        ${n}Double click to edit or drag to move
      </div>
      <div style="font-weight: bold; margin-bottom: 1px;">Hero Position</div>
      <div style="font-size: 10px; color: rgba(255,255,255,0.9);">Position: (${this.heroX}, ${this.heroY})</div>
    `;const s=this.mapCanvas.getBoundingClientRect(),r=this.mapToScreen(this.hoverX,this.hoverY);e.style.left=`${s.left+r.x+20}px`,e.style.top=`${s.top+r.y-10}px`,e.style.display="block"}createObjectFromTile(e,n,s,r){console.log(`Creating object from tile at (${e}, ${n}) for layer type: ${s}`);const i=this.objects.find(u=>u.x===e&&u.y===n);if(i){console.log(`Found existing object at (${e}, ${n}), updating instead of creating new one`);const u={name:`${s}_${e}_${n}`,type:s==="npc"?"npc":s};this.updateMapObject(i.id,u);return}let a;if(s==="event")a="event";else if(s==="enemy"||s==="npc"||s==="object")a="enemy";else{console.log(`Unsupported layer type: ${s}`);return}console.log(`Creating new ${a} object at (${e}, ${n})`);const l=this.addMapObject(a,e,n,1,1);console.log(`Created object with ID: ${l.id}`);const c={name:`${s}_${e}_${n}`,category:a==="event"?"block":s==="npc"?"npc":s==="object"?"object":"creature"};s==="npc"?c.type="npc":s==="enemy"&&(c.type="enemy"),a==="enemy"?(c.level=1,c.number=1,c.wander_radius=s==="npc"||s==="object"?0:4):(c.activate="on_trigger",c.hotspot="0,0,1,1"),this.updateMapObject(l.id,c)}removeObjectAtPosition(e,n){const s=this.objects.find(r=>r.x===e&&r.y===n);s&&this.removeMapObject(s.id)}selectObject(e){const n=this.objects.find(s=>s.id===e);return this.selectedObject=n||null,this.selectedObject}getSelectedObject(){return this.selectedObject}resetForNewProject(){this.clearLocalStorageBackup(),this.tilesetImage=null,this.tilesetFileName=null,this.mapName="Untitled Map",this.tilesetColumns=0,this.tilesetRows=0,this.tileCount=0,this.detectedTileData.clear(),this.clearTilePalette(),this.tileLayers=[],this.activeLayerId=null,this.nextLayerId=1,this.objects=[],this.nextObjectId=1,this.selectedObjectId=null,this.notifyObjectsChanged(),this.heroX=0,this.heroY=0,this.isDraggingHero=!1,this.layerTilesets.clear(),this.tilesets=[],this.collisionData=[],this.selection={active:!1,startX:-1,startY:-1,endX:-1,endY:-1,tiles:[]},this.isSelecting=!1,this.shapeDrawing={active:!1,startX:-1,startY:-1,endX:-1,endY:-1,preview:[]},this.isDrawingShape=!1,this.stamps.clear(),this.activeStamp=null,this.stampPreview={x:0,y:0,visible:!1},this.hasUnsavedChanges=!1,this.lastSaveTimestamp=0,this.autoSaveTimeout&&(clearTimeout(this.autoSaveTimeout),this.autoSaveTimeout=null),this.createDefaultLayers(),this.history=[],this.historyIndex=-1,this.saveState(),this.ctx.clearRect(0,0,this.mapCanvas.width,this.mapCanvas.height),this.draw()}loadProjectData(e){try{if(this.setMapName(typeof e.name=="string"?e.name:"Untitled Map"),console.log("=== LOADING PROJECT DATA IN EDITOR ==="),console.log("Project data:",{hasLayers:!!(e.layers&&e.layers.length>0),layerCount:e.layers?e.layers.length:0,hasObjects:!!(e.objects&&e.objects.length>0),objectCount:e.objects?e.objects.length:0,width:e.width,height:e.height,hasTilesets:!!(e.tilesets&&e.tilesets.length>0),tilesetCount:e.tilesets?e.tilesets.length:0}),e.tileContentThreshold!==void 0&&(this.tileContentThreshold=e.tileContentThreshold),e.objectSeparationSensitivity!==void 0&&(this.objectSeparationSensitivity=e.objectSeparationSensitivity),this.layerTilesets.clear(),e.tilesets&&Array.isArray(e.tilesets)){console.log("Loading tilesets:",e.tilesets.length);let s=0;const r=e.tilesets.length;for(const i of e.tilesets)if(i.fileName&&e.tilesetImages&&e.tilesetImages[i.fileName]){const a=e.tilesetImages[i.fileName],l=new Image;l.onload=()=>{console.log(`Tileset ${i.fileName} loaded for layer: ${i.layerType||"legacy"}`);const c=i.columns||Math.max(1,Math.floor(l.width/this.tileSizeX)),u=i.rows||Math.max(1,Math.floor(l.height/this.tileSizeY)),f=i.count||Math.max(1,c*u),h=i.tileWidth||Math.round(l.width/Math.max(c,1)),p=i.tileHeight||Math.round(l.height/Math.max(u,1)),b={image:l,fileName:i.fileName,columns:c,rows:u,count:f,tileWidth:h,tileHeight:p,spacing:i.spacing??0,margin:i.margin??0,sourcePath:i.sourcePath??null};if(i.layerType)this.layerTilesets.set(i.layerType,b),console.log(`Set tileset for layer type ${i.layerType}`);else{this.tilesetImage=l,this.tilesetFileName=i.fileName,this.tilesetColumns=b.columns,this.tilesetRows=b.rows,this.tileCount=b.count,this.tilesetTileWidth=b.tileWidth,this.tilesetTileHeight=b.tileHeight,this.tilesetSpacing=b.spacing??0,this.tilesetMargin=b.margin??0,this.tilesetSourcePath=b.sourcePath??this.tilesetSourcePath;const y=this.tileLayers.find(S=>S.id===this.activeLayerId);y&&!this.layerTilesets.has(y.type)&&(this.layerTilesets.set(y.type,b),console.log(`Assigned legacy tileset to active layer: ${y.type}`))}if(i.detectedTiles&&Array.isArray(i.detectedTiles))if(console.log(`Restoring ${i.detectedTiles.length} detected tiles for ${i.layerType||"legacy"}`),i.layerType){const y=new Map;for(const[S,j]of i.detectedTiles){const v=j;y.set(S,{sourceX:v.sourceX,sourceY:v.sourceY,width:v.width,height:v.height,originX:v.originX,originY:v.originY})}this.layerTileData.set(i.layerType,y),console.log(`Stored ${y.size} tiles for layer type: ${i.layerType}`)}else{this.detectedTileData.clear();for(const[S,j]of i.detectedTiles){const v=j;this.detectedTileData.set(S,{sourceX:v.sourceX,sourceY:v.sourceY,width:v.width,height:v.height,originX:v.originX,originY:v.originY})}const y=this.tileLayers.find(S=>S.id===this.activeLayerId);if(y){const S=new Map;for(const[j,v]of i.detectedTiles){const g=v;S.set(j,{sourceX:g.sourceX,sourceY:g.sourceY,width:g.width,height:g.height,originX:g.originX,originY:g.originY})}this.layerTileData.set(y.type,S)}}if(s++,s===r){console.log("All tilesets loaded, updating UI for active layer");const y=this.tileLayers.find(S=>S.id===this.activeLayerId);y&&this.updateCurrentTileset(y.type)}},l.src=a}else if(s++,s===r){console.log("All tilesets processed, updating UI for active layer");const a=this.tileLayers.find(l=>l.id===this.activeLayerId);a&&this.updateCurrentTileset(a.type)}}if(e.detectedTileData&&Array.isArray(e.detectedTileData)){this.detectedTileData.clear();for(const[s,r]of e.detectedTileData)this.detectedTileData.set(s,r)}e.layers&&e.layers.length>0?(console.log("Loading layers:",e.layers.length),this.tileLayers=[...e.layers],this.tileLayers.length>0&&(!this.activeLayerId||!this.tileLayers.find(s=>s.id===this.activeLayerId))&&(this.activeLayerId=this.tileLayers[0].id,console.log("Set active layer to:",this.activeLayerId))):(console.log("No layers found in project data, creating default layers"),this.createDefaultLayers());const n=this.normalizeLoadedObjects(e.objects);console.log("Loading objects:",n.length),this.objects=n,this.nextObjectId=this.calculateNextObjectId(n),this.notifyObjectsChanged(),e.width&&e.height&&(console.log("Setting map dimensions:",e.width,"x",e.height),this.mapWidth=e.width,this.mapHeight=e.height),e.heroX!==void 0&&e.heroY!==void 0?(console.log("Loading hero position:",e.heroX,",",e.heroY),this.heroX=Math.max(0,Math.min(e.heroX,this.mapWidth-1)),this.heroY=Math.max(0,Math.min(e.heroY,this.mapHeight-1))):(console.log("No hero position found, defaulting to (0,0)"),this.heroX=0,this.heroY=0),this.ensureCollisionTileset(),console.log("Project data loaded successfully"),this.draw()}catch(n){console.error("Error loading project data:",n)}}async loadTilesetFromDataURL(e,n){return new Promise((s,r)=>{console.log("Loading tileset from dataURL:",n,"Length:",e.length);const i=new Image;i.onload=()=>{console.log("Tileset image loaded successfully:",i.width,"x",i.height),this.tilesetImage=i,this.tilesetFileName=n,this.tilesetColumns=Math.floor(i.width/this.tileSizeX),this.tilesetRows=Math.floor(i.height/this.tileSizeY),this.tileCount=this.tilesetColumns*this.tilesetRows,console.log("Tileset properties:",{columns:this.tilesetColumns,rows:this.tilesetRows,tileCount:this.tileCount});const a=this.tileLayers.find(c=>c.id===this.activeLayerId);if(a){console.log("Setting tileset for active layer type:",a.type),this.layerTilesets.set(a.type,{image:i,fileName:n,columns:this.tilesetColumns,rows:this.tilesetRows,count:this.tileCount});const c=this.layerTileData.has(a.type);if(console.log(`Layer ${a.type} has existing tile data:`,c),!c)this.detectedTileData.clear();else{const u=this.layerTileData.get(a.type);if(this.detectedTileData.clear(),u)for(const[f,h]of u.entries())this.detectedTileData.set(f,h)}}else console.log("No active layer found, storing as global tileset");const l=a?this.layerTileData.has(a.type):!1;this.createTilePalette(l),console.log("Tile detection completed, detected tiles:",this.detectedTileData.size),this.draw(),console.log("Tileset loaded and palette created"),s()},i.onerror=a=>{console.error("Failed to load tileset image:",a),r(new Error("Failed to load tileset from data URL"))},i.src=e})}debugLayerData(){console.log("=== LAYER DATA DEBUG ===");for(const e of this.tileLayers){const n=e.data.filter(r=>r>0).length,s=this.layerTilesets.get(e.type);console.log(`Layer ${e.name} (${e.type}): ${n} painted tiles, has tileset: ${!!(s!=null&&s.image)}`)}}redraw(){this.draw()}getMapWidth(){return this.mapWidth}getMapHeight(){return this.mapHeight}updateCanvas(e){console.log("TileMapEditor: Updating canvas reference and rebinding events"),this.cleanupCanvasObservers(),this.cleanupCanvasEvents(),this.mapCanvas=e,this.initializeCanvas(),this.bindEvents(),this.refreshTilePalette(!0),this.draw(),console.log("TileMapEditor: Canvas update complete - events rebound")}}const u1=1,d1=1e6;let Pl=0;function h1(){return Pl=(Pl+1)%Number.MAX_SAFE_INTEGER,Pl.toString()}const Ll=new Map,Vh=t=>{if(Ll.has(t))return;const e=setTimeout(()=>{Ll.delete(t),Qr({type:"REMOVE_TOAST",toastId:t})},d1);Ll.set(t,e)},f1=(t,e)=>{switch(e.type){case"ADD_TOAST":return{...t,toasts:[e.toast,...t.toasts].slice(0,u1)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(n=>n.id===e.toast.id?{...n,...e.toast}:n)};case"DISMISS_TOAST":{const{toastId:n}=e;return n?Vh(n):t.toasts.forEach(s=>{Vh(s.id)}),{...t,toasts:t.toasts.map(s=>s.id===n||n===void 0?{...s,open:!1}:s)}}case"REMOVE_TOAST":return e.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(n=>n.id!==e.toastId)}}},_o=[];let Io={toasts:[]};function Qr(t){Io=f1(Io,t),_o.forEach(e=>{e(Io)})}function m1({...t}){const e=h1(),n=r=>Qr({type:"UPDATE_TOAST",toast:{...r,id:e}}),s=()=>Qr({type:"DISMISS_TOAST",toastId:e});return Qr({type:"ADD_TOAST",toast:{...t,id:e,open:!0,onOpenChange:r=>{r||s()}}}),{id:e,dismiss:s,update:n}}function Sp(){const[t,e]=m.useState(Io);return m.useEffect(()=>(_o.push(e),()=>{const n=_o.indexOf(e);n>-1&&_o.splice(n,1)}),[t]),{...t,toast:m1,dismiss:n=>Qr({type:"DISMISS_TOAST",toastId:n})}}function ht(t,e,{checkForDefaultPrevented:n=!0}={}){return function(r){if(t==null||t(r),n===!1||!r.defaultPrevented)return e==null?void 0:e(r)}}function jp(t,e=[]){let n=[];function s(i,a){const l=m.createContext(a),c=n.length;n=[...n,a];const u=h=>{var v;const{scope:p,children:b,...y}=h,S=((v=p==null?void 0:p[t])==null?void 0:v[c])||l,j=m.useMemo(()=>y,Object.values(y));return o.jsx(S.Provider,{value:j,children:b})};u.displayName=i+"Provider";function f(h,p){var S;const b=((S=p==null?void 0:p[t])==null?void 0:S[c])||l,y=m.useContext(b);if(y)return y;if(a!==void 0)return a;throw new Error(`\`${h}\` must be used within \`${i}\``)}return[u,f]}const r=()=>{const i=n.map(a=>m.createContext(a));return function(l){const c=(l==null?void 0:l[t])||i;return m.useMemo(()=>({[`__scope${t}`]:{...l,[t]:c}}),[l,c])}};return r.scopeName=t,[s,p1(r,...e)]}function p1(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const s=t.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(i){const a=s.reduce((l,{useScope:c,scopeName:u})=>{const h=c(i)[`__scope${u}`];return{...l,...h}},{});return m.useMemo(()=>({[`__scope${e.scopeName}`]:a}),[a])}};return n.scopeName=e.scopeName,n}function g1(t){const e=t+"CollectionProvider",[n,s]=jp(e),[r,i]=n(e,{collectionRef:{current:null},itemMap:new Map}),a=S=>{const{scope:j,children:v}=S,g=ye.useRef(null),x=ye.useRef(new Map).current;return o.jsx(r,{scope:j,itemMap:x,collectionRef:g,children:v})};a.displayName=e;const l=t+"CollectionSlot",c=ra(l),u=ye.forwardRef((S,j)=>{const{scope:v,children:g}=S,x=i(l,v),w=es(j,x.collectionRef);return o.jsx(c,{ref:w,children:g})});u.displayName=l;const f=t+"CollectionItemSlot",h="data-radix-collection-item",p=ra(f),b=ye.forwardRef((S,j)=>{const{scope:v,children:g,...x}=S,w=ye.useRef(null),N=es(j,w),T=i(f,v);return ye.useEffect(()=>(T.itemMap.set(w,{ref:w,...x}),()=>void T.itemMap.delete(w))),o.jsx(p,{[h]:"",ref:N,children:g})});b.displayName=f;function y(S){const j=i(t+"CollectionConsumer",S);return ye.useCallback(()=>{const g=j.collectionRef.current;if(!g)return[];const x=Array.from(g.querySelectorAll(`[${h}]`));return Array.from(j.itemMap.values()).sort((T,P)=>x.indexOf(T.ref.current)-x.indexOf(P.ref.current))},[j.collectionRef,j.itemMap])}return[{Provider:a,Slot:u,ItemSlot:b},y,s]}var x1=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Wt=x1.reduce((t,e)=>{const n=ra(`Primitive.${e}`),s=m.forwardRef((r,i)=>{const{asChild:a,...l}=r,c=a?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),o.jsx(c,{...l,ref:i})});return s.displayName=`Primitive.${e}`,{...t,[e]:s}},{});function Np(t,e){t&&Jn.flushSync(()=>t.dispatchEvent(e))}function ts(t){const e=m.useRef(t);return m.useEffect(()=>{e.current=t}),m.useMemo(()=>(...n)=>{var s;return(s=e.current)==null?void 0:s.call(e,...n)},[])}function y1(t,e=globalThis==null?void 0:globalThis.document){const n=ts(t);m.useEffect(()=>{const s=r=>{r.key==="Escape"&&n(r)};return e.addEventListener("keydown",s,{capture:!0}),()=>e.removeEventListener("keydown",s,{capture:!0})},[n,e])}var v1="DismissableLayer",Pc="dismissableLayer.update",w1="dismissableLayer.pointerDownOutside",b1="dismissableLayer.focusOutside",Gh,Cp=m.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Tp=m.forwardRef((t,e)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:s,onPointerDownOutside:r,onFocusOutside:i,onInteractOutside:a,onDismiss:l,...c}=t,u=m.useContext(Cp),[f,h]=m.useState(null),p=(f==null?void 0:f.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,b]=m.useState({}),y=es(e,P=>h(P)),S=Array.from(u.layers),[j]=[...u.layersWithOutsidePointerEventsDisabled].slice(-1),v=S.indexOf(j),g=f?S.indexOf(f):-1,x=u.layersWithOutsidePointerEventsDisabled.size>0,w=g>=v,N=S1(P=>{const E=P.target,$=[...u.branches].some(D=>D.contains(E));!w||$||(r==null||r(P),a==null||a(P),P.defaultPrevented||l==null||l())},p),T=j1(P=>{const E=P.target;[...u.branches].some(D=>D.contains(E))||(i==null||i(P),a==null||a(P),P.defaultPrevented||l==null||l())},p);return y1(P=>{g===u.layers.size-1&&(s==null||s(P),!P.defaultPrevented&&l&&(P.preventDefault(),l()))},p),m.useEffect(()=>{if(f)return n&&(u.layersWithOutsidePointerEventsDisabled.size===0&&(Gh=p.body.style.pointerEvents,p.body.style.pointerEvents="none"),u.layersWithOutsidePointerEventsDisabled.add(f)),u.layers.add(f),qh(),()=>{n&&u.layersWithOutsidePointerEventsDisabled.size===1&&(p.body.style.pointerEvents=Gh)}},[f,p,n,u]),m.useEffect(()=>()=>{f&&(u.layers.delete(f),u.layersWithOutsidePointerEventsDisabled.delete(f),qh())},[f,u]),m.useEffect(()=>{const P=()=>b({});return document.addEventListener(Pc,P),()=>document.removeEventListener(Pc,P)},[]),o.jsx(Wt.div,{...c,ref:y,style:{pointerEvents:x?w?"auto":"none":void 0,...t.style},onFocusCapture:ht(t.onFocusCapture,T.onFocusCapture),onBlurCapture:ht(t.onBlurCapture,T.onBlurCapture),onPointerDownCapture:ht(t.onPointerDownCapture,N.onPointerDownCapture)})});Tp.displayName=v1;var k1="DismissableLayerBranch",Mp=m.forwardRef((t,e)=>{const n=m.useContext(Cp),s=m.useRef(null),r=es(e,s);return m.useEffect(()=>{const i=s.current;if(i)return n.branches.add(i),()=>{n.branches.delete(i)}},[n.branches]),o.jsx(Wt.div,{...t,ref:r})});Mp.displayName=k1;function S1(t,e=globalThis==null?void 0:globalThis.document){const n=ts(t),s=m.useRef(!1),r=m.useRef(()=>{});return m.useEffect(()=>{const i=l=>{if(l.target&&!s.current){let c=function(){Ep(w1,n,u,{discrete:!0})};const u={originalEvent:l};l.pointerType==="touch"?(e.removeEventListener("click",r.current),r.current=c,e.addEventListener("click",r.current,{once:!0})):c()}else e.removeEventListener("click",r.current);s.current=!1},a=window.setTimeout(()=>{e.addEventListener("pointerdown",i)},0);return()=>{window.clearTimeout(a),e.removeEventListener("pointerdown",i),e.removeEventListener("click",r.current)}},[e,n]),{onPointerDownCapture:()=>s.current=!0}}function j1(t,e=globalThis==null?void 0:globalThis.document){const n=ts(t),s=m.useRef(!1);return m.useEffect(()=>{const r=i=>{i.target&&!s.current&&Ep(b1,n,{originalEvent:i},{discrete:!1})};return e.addEventListener("focusin",r),()=>e.removeEventListener("focusin",r)},[e,n]),{onFocusCapture:()=>s.current=!0,onBlurCapture:()=>s.current=!1}}function qh(){const t=new CustomEvent(Pc);document.dispatchEvent(t)}function Ep(t,e,n,{discrete:s}){const r=n.originalEvent.target,i=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&r.addEventListener(t,e,{once:!0}),s?Np(r,i):r.dispatchEvent(i)}var N1=Tp,C1=Mp,pi=globalThis!=null&&globalThis.document?m.useLayoutEffect:()=>{},T1="Portal",Pp=m.forwardRef((t,e)=>{var l;const{container:n,...s}=t,[r,i]=m.useState(!1);pi(()=>i(!0),[]);const a=n||r&&((l=globalThis==null?void 0:globalThis.document)==null?void 0:l.body);return a?Uv.createPortal(o.jsx(Wt.div,{...s,ref:e}),a):null});Pp.displayName=T1;function M1(t,e){return m.useReducer((n,s)=>e[n][s]??n,t)}var Lp=t=>{const{present:e,children:n}=t,s=E1(e),r=typeof n=="function"?n({present:s.isPresent}):m.Children.only(n),i=es(s.ref,P1(r));return typeof n=="function"||s.isPresent?m.cloneElement(r,{ref:i}):null};Lp.displayName="Presence";function E1(t){const[e,n]=m.useState(),s=m.useRef(null),r=m.useRef(t),i=m.useRef("none"),a=t?"mounted":"unmounted",[l,c]=M1(a,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return m.useEffect(()=>{const u=po(s.current);i.current=l==="mounted"?u:"none"},[l]),pi(()=>{const u=s.current,f=r.current;if(f!==t){const p=i.current,b=po(u);t?c("MOUNT"):b==="none"||(u==null?void 0:u.display)==="none"?c("UNMOUNT"):c(f&&p!==b?"ANIMATION_OUT":"UNMOUNT"),r.current=t}},[t,c]),pi(()=>{if(e){let u;const f=e.ownerDocument.defaultView??window,h=b=>{const S=po(s.current).includes(CSS.escape(b.animationName));if(b.target===e&&S&&(c("ANIMATION_END"),!r.current)){const j=e.style.animationFillMode;e.style.animationFillMode="forwards",u=f.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=j)})}},p=b=>{b.target===e&&(i.current=po(s.current))};return e.addEventListener("animationstart",p),e.addEventListener("animationcancel",h),e.addEventListener("animationend",h),()=>{f.clearTimeout(u),e.removeEventListener("animationstart",p),e.removeEventListener("animationcancel",h),e.removeEventListener("animationend",h)}}else c("ANIMATION_END")},[e,c]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:m.useCallback(u=>{s.current=u?getComputedStyle(u):null,n(u)},[])}}function po(t){return(t==null?void 0:t.animationName)||"none"}function P1(t){var s,r;let e=(s=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:s.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=(r=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:r.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var L1=Ax[" useInsertionEffect ".trim().toString()]||pi;function _1({prop:t,defaultProp:e,onChange:n=()=>{},caller:s}){const[r,i,a]=I1({defaultProp:e,onChange:n}),l=t!==void 0,c=l?t:r;{const f=m.useRef(t!==void 0);m.useEffect(()=>{const h=f.current;h!==l&&console.warn(`${s} is changing from ${h?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),f.current=l},[l,s])}const u=m.useCallback(f=>{var h;if(l){const p=z1(f)?f(t):f;p!==t&&((h=a.current)==null||h.call(a,p))}else i(f)},[l,t,i,a]);return[c,u]}function I1({defaultProp:t,onChange:e}){const[n,s]=m.useState(t),r=m.useRef(n),i=m.useRef(e);return L1(()=>{i.current=e},[e]),m.useEffect(()=>{var a;r.current!==n&&((a=i.current)==null||a.call(i,n),r.current=n)},[n,r]),[n,s,i]}function z1(t){return typeof t=="function"}var A1=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),D1="VisuallyHidden",Eu=m.forwardRef((t,e)=>o.jsx(Wt.span,{...t,ref:e,style:{...A1,...t.style}}));Eu.displayName=D1;var Pu="ToastProvider",[Lu,R1,O1]=g1("Toast"),[_p,gb]=jp("Toast",[O1]),[$1,ba]=_p(Pu),Ip=t=>{const{__scopeToast:e,label:n="Notification",duration:s=5e3,swipeDirection:r="right",swipeThreshold:i=50,children:a}=t,[l,c]=m.useState(null),[u,f]=m.useState(0),h=m.useRef(!1),p=m.useRef(!1);return n.trim()||console.error(`Invalid prop \`label\` supplied to \`${Pu}\`. Expected non-empty \`string\`.`),o.jsx(Lu.Provider,{scope:e,children:o.jsx($1,{scope:e,label:n,duration:s,swipeDirection:r,swipeThreshold:i,toastCount:u,viewport:l,onViewportChange:c,onToastAdd:m.useCallback(()=>f(b=>b+1),[]),onToastRemove:m.useCallback(()=>f(b=>b-1),[]),isFocusedToastEscapeKeyDownRef:h,isClosePausedRef:p,children:a})})};Ip.displayName=Pu;var zp="ToastViewport",F1=["F8"],Lc="toast.viewportPause",_c="toast.viewportResume",Ap=m.forwardRef((t,e)=>{const{__scopeToast:n,hotkey:s=F1,label:r="Notifications ({hotkey})",...i}=t,a=ba(zp,n),l=R1(n),c=m.useRef(null),u=m.useRef(null),f=m.useRef(null),h=m.useRef(null),p=es(e,h,a.onViewportChange),b=s.join("+").replace(/Key/g,"").replace(/Digit/g,""),y=a.toastCount>0;m.useEffect(()=>{const j=v=>{var x;s.length!==0&&s.every(w=>v[w]||v.code===w)&&((x=h.current)==null||x.focus())};return document.addEventListener("keydown",j),()=>document.removeEventListener("keydown",j)},[s]),m.useEffect(()=>{const j=c.current,v=h.current;if(y&&j&&v){const g=()=>{if(!a.isClosePausedRef.current){const T=new CustomEvent(Lc);v.dispatchEvent(T),a.isClosePausedRef.current=!0}},x=()=>{if(a.isClosePausedRef.current){const T=new CustomEvent(_c);v.dispatchEvent(T),a.isClosePausedRef.current=!1}},w=T=>{!j.contains(T.relatedTarget)&&x()},N=()=>{j.contains(document.activeElement)||x()};return j.addEventListener("focusin",g),j.addEventListener("focusout",w),j.addEventListener("pointermove",g),j.addEventListener("pointerleave",N),window.addEventListener("blur",g),window.addEventListener("focus",x),()=>{j.removeEventListener("focusin",g),j.removeEventListener("focusout",w),j.removeEventListener("pointermove",g),j.removeEventListener("pointerleave",N),window.removeEventListener("blur",g),window.removeEventListener("focus",x)}}},[y,a.isClosePausedRef]);const S=m.useCallback(({tabbingDirection:j})=>{const g=l().map(x=>{const w=x.ref.current,N=[w,...J1(w)];return j==="forwards"?N:N.reverse()});return(j==="forwards"?g.reverse():g).flat()},[l]);return m.useEffect(()=>{const j=h.current;if(j){const v=g=>{var N,T,P;const x=g.altKey||g.ctrlKey||g.metaKey;if(g.key==="Tab"&&!x){const E=document.activeElement,$=g.shiftKey;if(g.target===j&&$){(N=u.current)==null||N.focus();return}const q=S({tabbingDirection:$?"backwards":"forwards"}),re=q.findIndex(X=>X===E);_l(q.slice(re+1))?g.preventDefault():$?(T=u.current)==null||T.focus():(P=f.current)==null||P.focus()}};return j.addEventListener("keydown",v),()=>j.removeEventListener("keydown",v)}},[l,S]),o.jsxs(C1,{ref:c,role:"region","aria-label":r.replace("{hotkey}",b),tabIndex:-1,style:{pointerEvents:y?void 0:"none"},children:[y&&o.jsx(Ic,{ref:u,onFocusFromOutsideViewport:()=>{const j=S({tabbingDirection:"forwards"});_l(j)}}),o.jsx(Lu.Slot,{scope:n,children:o.jsx(Wt.ol,{tabIndex:-1,...i,ref:p})}),y&&o.jsx(Ic,{ref:f,onFocusFromOutsideViewport:()=>{const j=S({tabbingDirection:"backwards"});_l(j)}})]})});Ap.displayName=zp;var Dp="ToastFocusProxy",Ic=m.forwardRef((t,e)=>{const{__scopeToast:n,onFocusFromOutsideViewport:s,...r}=t,i=ba(Dp,n);return o.jsx(Eu,{tabIndex:0,...r,ref:e,style:{position:"fixed"},onFocus:a=>{var u;const l=a.relatedTarget;!((u=i.viewport)!=null&&u.contains(l))&&s()}})});Ic.displayName=Dp;var bi="Toast",H1="toast.swipeStart",B1="toast.swipeMove",Y1="toast.swipeCancel",W1="toast.swipeEnd",Rp=m.forwardRef((t,e)=>{const{forceMount:n,open:s,defaultOpen:r,onOpenChange:i,...a}=t,[l,c]=_1({prop:s,defaultProp:r??!0,onChange:i,caller:bi});return o.jsx(Lp,{present:n||l,children:o.jsx(V1,{open:l,...a,ref:e,onClose:()=>c(!1),onPause:ts(t.onPause),onResume:ts(t.onResume),onSwipeStart:ht(t.onSwipeStart,u=>{u.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:ht(t.onSwipeMove,u=>{const{x:f,y:h}=u.detail.delta;u.currentTarget.setAttribute("data-swipe","move"),u.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${f}px`),u.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${h}px`)}),onSwipeCancel:ht(t.onSwipeCancel,u=>{u.currentTarget.setAttribute("data-swipe","cancel"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),u.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),u.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:ht(t.onSwipeEnd,u=>{const{x:f,y:h}=u.detail.delta;u.currentTarget.setAttribute("data-swipe","end"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),u.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${f}px`),u.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${h}px`),c(!1)})})})});Rp.displayName=bi;var[X1,U1]=_p(bi,{onClose(){}}),V1=m.forwardRef((t,e)=>{const{__scopeToast:n,type:s="foreground",duration:r,open:i,onClose:a,onEscapeKeyDown:l,onPause:c,onResume:u,onSwipeStart:f,onSwipeMove:h,onSwipeCancel:p,onSwipeEnd:b,...y}=t,S=ba(bi,n),[j,v]=m.useState(null),g=es(e,X=>v(X)),x=m.useRef(null),w=m.useRef(null),N=r||S.duration,T=m.useRef(0),P=m.useRef(N),E=m.useRef(0),{onToastAdd:$,onToastRemove:D}=S,G=ts(()=>{var ae;(j==null?void 0:j.contains(document.activeElement))&&((ae=S.viewport)==null||ae.focus()),a()}),q=m.useCallback(X=>{!X||X===1/0||(window.clearTimeout(E.current),T.current=new Date().getTime(),E.current=window.setTimeout(G,X))},[G]);m.useEffect(()=>{const X=S.viewport;if(X){const ae=()=>{q(P.current),u==null||u()},je=()=>{const Qe=new Date().getTime()-T.current;P.current=P.current-Qe,window.clearTimeout(E.current),c==null||c()};return X.addEventListener(Lc,je),X.addEventListener(_c,ae),()=>{X.removeEventListener(Lc,je),X.removeEventListener(_c,ae)}}},[S.viewport,N,c,u,q]),m.useEffect(()=>{i&&!S.isClosePausedRef.current&&q(N)},[i,N,S.isClosePausedRef,q]),m.useEffect(()=>($(),()=>D()),[$,D]);const re=m.useMemo(()=>j?Wp(j):null,[j]);return S.viewport?o.jsxs(o.Fragment,{children:[re&&o.jsx(G1,{__scopeToast:n,role:"status","aria-live":s==="foreground"?"assertive":"polite",children:re}),o.jsx(X1,{scope:n,onClose:G,children:Jn.createPortal(o.jsx(Lu.ItemSlot,{scope:n,children:o.jsx(N1,{asChild:!0,onEscapeKeyDown:ht(l,()=>{S.isFocusedToastEscapeKeyDownRef.current||G(),S.isFocusedToastEscapeKeyDownRef.current=!1}),children:o.jsx(Wt.li,{tabIndex:0,"data-state":i?"open":"closed","data-swipe-direction":S.swipeDirection,...y,ref:g,style:{userSelect:"none",touchAction:"none",...t.style},onKeyDown:ht(t.onKeyDown,X=>{X.key==="Escape"&&(l==null||l(X.nativeEvent),X.nativeEvent.defaultPrevented||(S.isFocusedToastEscapeKeyDownRef.current=!0,G()))}),onPointerDown:ht(t.onPointerDown,X=>{X.button===0&&(x.current={x:X.clientX,y:X.clientY})}),onPointerMove:ht(t.onPointerMove,X=>{if(!x.current)return;const ae=X.clientX-x.current.x,je=X.clientY-x.current.y,Qe=!!w.current,z=["left","right"].includes(S.swipeDirection),B=["left","up"].includes(S.swipeDirection)?Math.min:Math.max,W=z?B(0,ae):0,te=z?0:B(0,je),ne=X.pointerType==="touch"?10:2,ue={x:W,y:te},yt={originalEvent:X,delta:ue};Qe?(w.current=ue,go(B1,h,yt,{discrete:!1})):Kh(ue,S.swipeDirection,ne)?(w.current=ue,go(H1,f,yt,{discrete:!1}),X.target.setPointerCapture(X.pointerId)):(Math.abs(ae)>ne||Math.abs(je)>ne)&&(x.current=null)}),onPointerUp:ht(t.onPointerUp,X=>{const ae=w.current,je=X.target;if(je.hasPointerCapture(X.pointerId)&&je.releasePointerCapture(X.pointerId),w.current=null,x.current=null,ae){const Qe=X.currentTarget,z={originalEvent:X,delta:ae};Kh(ae,S.swipeDirection,S.swipeThreshold)?go(W1,b,z,{discrete:!0}):go(Y1,p,z,{discrete:!0}),Qe.addEventListener("click",B=>B.preventDefault(),{once:!0})}})})})}),S.viewport)})]}):null}),G1=t=>{const{__scopeToast:e,children:n,...s}=t,r=ba(bi,e),[i,a]=m.useState(!1),[l,c]=m.useState(!1);return Q1(()=>a(!0)),m.useEffect(()=>{const u=window.setTimeout(()=>c(!0),1e3);return()=>window.clearTimeout(u)},[]),l?null:o.jsx(Pp,{asChild:!0,children:o.jsx(Eu,{...s,children:i&&o.jsxs(o.Fragment,{children:[r.label," ",n]})})})},q1="ToastTitle",Op=m.forwardRef((t,e)=>{const{__scopeToast:n,...s}=t;return o.jsx(Wt.div,{...s,ref:e})});Op.displayName=q1;var K1="ToastDescription",$p=m.forwardRef((t,e)=>{const{__scopeToast:n,...s}=t;return o.jsx(Wt.div,{...s,ref:e})});$p.displayName=K1;var Fp="ToastAction",Hp=m.forwardRef((t,e)=>{const{altText:n,...s}=t;return n.trim()?o.jsx(Yp,{altText:n,asChild:!0,children:o.jsx(_u,{...s,ref:e})}):(console.error(`Invalid prop \`altText\` supplied to \`${Fp}\`. Expected non-empty \`string\`.`),null)});Hp.displayName=Fp;var Bp="ToastClose",_u=m.forwardRef((t,e)=>{const{__scopeToast:n,...s}=t,r=U1(Bp,n);return o.jsx(Yp,{asChild:!0,children:o.jsx(Wt.button,{type:"button",...s,ref:e,onClick:ht(t.onClick,r.onClose)})})});_u.displayName=Bp;var Yp=m.forwardRef((t,e)=>{const{__scopeToast:n,altText:s,...r}=t;return o.jsx(Wt.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":s||void 0,...r,ref:e})});function Wp(t){const e=[];return Array.from(t.childNodes).forEach(s=>{if(s.nodeType===s.TEXT_NODE&&s.textContent&&e.push(s.textContent),Z1(s)){const r=s.ariaHidden||s.hidden||s.style.display==="none",i=s.dataset.radixToastAnnounceExclude==="";if(!r)if(i){const a=s.dataset.radixToastAnnounceAlt;a&&e.push(a)}else e.push(...Wp(s))}}),e}function go(t,e,n,{discrete:s}){const r=n.originalEvent.currentTarget,i=new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:n});e&&r.addEventListener(t,e,{once:!0}),s?Np(r,i):r.dispatchEvent(i)}var Kh=(t,e,n=0)=>{const s=Math.abs(t.x),r=Math.abs(t.y),i=s>r;return e==="left"||e==="right"?i&&s>n:!i&&r>n};function Q1(t=()=>{}){const e=ts(t);pi(()=>{let n=0,s=0;return n=window.requestAnimationFrame(()=>s=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(n),window.cancelAnimationFrame(s)}},[e])}function Z1(t){return t.nodeType===t.ELEMENT_NODE}function J1(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const r=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||r?NodeFilter.FILTER_SKIP:s.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function _l(t){const e=document.activeElement;return t.some(n=>n===e?!0:(n.focus(),document.activeElement!==e))}var eb=Ip,Xp=Ap,Up=Rp,Vp=Op,Gp=$p,qp=Hp,Kp=_u;const tb=eb,Qp=m.forwardRef(({className:t,...e},n)=>o.jsx(Xp,{ref:n,className:lt("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",t),...e}));Qp.displayName=Xp.displayName;const nb=gp("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Zp=m.forwardRef(({className:t,variant:e,...n},s)=>o.jsx(Up,{ref:s,className:lt(nb({variant:e}),t),...n}));Zp.displayName=Up.displayName;const sb=m.forwardRef(({className:t,...e},n)=>o.jsx(qp,{ref:n,className:lt("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",t),...e}));sb.displayName=qp.displayName;const Jp=m.forwardRef(({className:t,...e},n)=>o.jsx(Kp,{ref:n,className:lt("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...e,children:o.jsx(Ue,{className:"h-4 w-4"})}));Jp.displayName=Kp.displayName;const eg=m.forwardRef(({className:t,...e},n)=>o.jsx(Vp,{ref:n,className:lt("text-sm font-semibold",t),...e}));eg.displayName=Vp.displayName;const tg=m.forwardRef(({className:t,...e},n)=>o.jsx(Gp,{ref:n,className:lt("text-sm opacity-90",t),...e}));tg.displayName=Gp.displayName;function rb(){const{toasts:t}=Sp();return o.jsxs(tb,{children:[t.map(function({id:e,title:n,description:s,action:r,...i}){return o.jsxs(Zp,{...i,children:[o.jsxs("div",{className:"grid gap-1",children:[n&&o.jsx(eg,{children:n}),s&&o.jsx(tg,{children:s})]}),r,o.jsx(Jp,{})]},e)}),o.jsx(Qp,{})]})}var ib={};const ob=({onCreateNewMap:t,onOpenMap:e,isDarkMode:n})=>{const[s,r]=m.useState(!1),[i,a]=m.useState([]),[l,c]=m.useState({}),[u,f]=m.useState({name:"ProjectName",width:20,height:15,tileSize:64,location:"",isStartingMap:!1});m.useEffect(()=>{(async()=>{const w=localStorage.getItem("recentMaps");if(!w)return;let N=JSON.parse(w);const T=window.electronAPI;if(T&&typeof T.checkProjectExists=="function")try{const E=(await Promise.all(N.map(async $=>{try{return await T.checkProjectExists($.path)?$:null}catch{return $}}))).filter(Boolean);N=E,E.length!==JSON.parse(w).length&&localStorage.setItem("recentMaps",JSON.stringify(E))}catch(P){console.warn("Prune recent maps failed:",P)}a(N)})()},[]),m.useEffect(()=>{if(!i||i.length===0)return;const x=async w=>{const N=w;if(N.thumbnailDataUrl){c(T=>({...T,[w.id]:N.thumbnailDataUrl}));return}try{const T=window.electronAPI;if(T&&typeof T.getProjectThumbnail=="function"){const P=await T.getProjectThumbnail(w.path);if(P){c(E=>({...E,[w.id]:P}));return}}if(!(T&&typeof T.getProjectThumbnail=="function")){c(P=>({...P,[w.id]:null}));return}}catch(T){console.error("Failed to load thumbnail for",w.path,T)}c(T=>({...T,[w.id]:null}))};return i.forEach(w=>{x(w)}),()=>{Object.values(l).forEach(w=>{w&&w.startsWith("blob:")&&URL.revokeObjectURL(w)})}},[i]);const h=x=>{localStorage.setItem("recentMaps",JSON.stringify(x)),a(x)},p=async()=>{var x;try{if((x=window.electronAPI)!=null&&x.selectDirectory){const w=await window.electronAPI.selectDirectory();w&&f({...u,location:w})}else if("showDirectoryPicker"in window){const w=await window.showDirectoryPicker();f({...u,location:w.name})}else{const w="C:\\Users\\"+(navigator.userAgent.includes("Windows")&&ib.USERNAME||"User")+"\\Documents\\TileMaps";f({...u,location:w})}}catch(w){console.error("Error selecting directory:",w)}},b=async()=>{var w;if(!u.location){alert("Please select a location for your map project");return}const x=u.name.trim().toLowerCase();if(i.some(N=>N.name.trim().toLowerCase()===x)){alert("There can't be maps that have the same name. Please type another name.");return}try{const N=`${u.location}\\${u.name}`;if((w=window.electronAPI)!=null&&w.createMapProject){if(await window.electronAPI.createMapProject(u)){const E=[{id:Date.now().toString(),name:u.name,lastModified:"Just now",path:N},...i.slice(0,9)];h(E),t(u,N)}}else console.log("Creating map project:",u),t(u)}catch(N){console.error("Error creating map project:",N),alert("Error creating map project. Please try again.")}},y=x=>{e(x.path)},S=async()=>{var x;try{if((x=window.electronAPI)!=null&&x.selectDirectory){const w=await window.electronAPI.selectDirectory();w&&e(w)}else alert("Open Map Project functionality requires the desktop app")}catch(w){console.error("Error opening map project:",w)}},j=()=>{var x;(x=window.electronAPI)!=null&&x.minimize?window.electronAPI.minimize():console.log("Minimize clicked - Electron API not available")},v=()=>{var x;(x=window.electronAPI)!=null&&x.maximize?window.electronAPI.maximize():console.log("Maximize clicked - Electron API not available")},g=()=>{var x;(x=window.electronAPI)!=null&&x.close?window.electronAPI.close():console.log("Close clicked - Electron API not available")};return s?o.jsxs("div",{className:`min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-neutral-900 dark:to-neutral-800 flex flex-col ${n?"dark":""}`,children:[o.jsxs("div",{className:"bg-gray-100 dark:bg-neutral-900 text-orange-600 dark:text-orange-400 flex justify-between items-center px-4 py-1 select-none drag-region border-b border-gray-200 dark:border-neutral-700",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("img",{src:"/flare-ico.png",alt:"Flare Studio Logo",className:"w-6 h-6"}),o.jsx("span",{className:"text-sm font-semibold",children:"Flare Studio"})]}),o.jsxs("div",{className:"flex no-drag",children:[o.jsx(Q,{content:"Minimize",children:o.jsx("button",{onClick:j,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-200 dark:hover:bg-neutral-700 px-3 py-1 text-sm rounded transition-colors",children:o.jsx(Ec,{className:"w-4 h-4"})})}),o.jsx(Q,{content:"Maximize",children:o.jsx("button",{onClick:v,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-200 dark:hover:bg-neutral-700 px-3 py-1 text-sm rounded transition-colors",children:o.jsx(Hn,{className:"w-4 h-4"})})}),o.jsx(Q,{content:"Close",children:o.jsx("button",{onClick:g,className:"text-gray-500 hover:text-red-600 dark:text-gray-400 dark:hover:text-red-400 hover:bg-gray-200 dark:hover:bg-neutral-700 px-3 py-1 text-sm rounded transition-colors",children:o.jsx(Ue,{className:"w-4 h-4"})})})]})]}),o.jsx("div",{className:"flex-1 flex items-center justify-center p-4",children:o.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg shadow-xl p-8 w-full max-w-md",children:[o.jsxs("div",{className:"text-center mb-6",children:[o.jsx("div",{className:"inline-flex items-center justify-center",children:o.jsx("img",{src:"/flare-logo.png",alt:"Flare Logo",className:"w-40 h-40 object-contain"})}),o.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Create a New Flare Project"})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Project Name"}),o.jsx(F,{value:u.name,onChange:x=>f({...u,name:x.target.value}),placeholder:"Enter map name"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Project Location"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(F,{value:u.location,onChange:x=>f({...u,location:x.target.value}),placeholder:"Select folder for your project",readOnly:!0}),o.jsx(I,{type:"button",variant:"outline",onClick:p,children:o.jsx(Po,{className:"w-4 h-4"})})]})]})]}),o.jsxs("div",{className:"flex gap-3 mt-6",children:[o.jsx(I,{variant:"outline",onClick:()=>r(!1),className:"flex-1",children:"Back"}),o.jsx(I,{onClick:b,className:"flex-1",children:"Confirm"})]})]})})]}):o.jsxs("div",{className:`h-screen overflow-hidden bg-gradient-to-br from-slate-50 to-slate-100 dark:from-neutral-900 dark:to-neutral-800 flex flex-col ${n?"dark":""}`,children:[o.jsxs("div",{className:"bg-gray-100 dark:bg-neutral-900 text-orange-600 dark:text-orange-400 flex justify-between items-center px-4 py-1 select-none drag-region border-b border-gray-200 dark:border-neutral-700",children:[o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx("img",{src:"/flare-ico.png",alt:"Flare Studio Logo",className:"w-4 h-6"}),o.jsx("span",{className:"text-sm font-semibold",children:"Flare Studio"})]}),o.jsxs("div",{className:"flex no-drag",children:[o.jsx(Q,{content:"Minimize",children:o.jsx("button",{onClick:j,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-200 dark:hover:bg-neutral-700 px-3 py-1 text-sm rounded transition-colors",children:o.jsx(Ec,{className:"w-4 h-4"})})}),o.jsx(Q,{content:"Maximize",children:o.jsx("button",{onClick:v,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-200 dark:hover:bg-neutral-700 px-3 py-1 text-sm rounded transition-colors",children:o.jsx(Hn,{className:"w-4 h-4"})})}),o.jsx(Q,{content:"Close",children:o.jsx("button",{onClick:g,className:"text-gray-500 hover:text-red-600 dark:text-gray-400 dark:hover:text-red-400 hover:bg-gray-200 dark:hover:bg-neutral-700 px-3 py-1 text-sm rounded transition-colors",children:o.jsx(Ue,{className:"w-4 h-4"})})})]})]}),o.jsxs("div",{className:"flex flex-1 min-h-0 overflow-hidden",children:[o.jsxs("div",{className:"w-80 bg-white dark:bg-neutral-900 border-r border-slate-200 dark:border-neutral-700 p-6 flex flex-col h-full",children:[o.jsx("div",{className:"mb-4 flex items-center justify-between",children:o.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Recent Projects"})}),o.jsxs("div",{className:"flex-1 min-h-0 h-full",children:[o.jsx("div",{className:"space-y-2 overflow-y-auto minimal-scroll px-1 py-1 h-full",children:i.map(x=>o.jsx("div",{className:"p-3 rounded-lg border border-slate-200 dark:border-neutral-700 hover:bg-slate-50 dark:hover:bg-neutral-800 cursor-pointer transition-colors",onClick:()=>y(x),children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-20 h-20 bg-orange-100 dark:bg-orange-900 rounded overflow-hidden flex items-center justify-center",children:l[x.id]?o.jsx("img",{src:l[x.id]||"",alt:`${x.name} thumbnail`,className:"w-full h-full object-cover"}):o.jsx("div",{className:"w-full h-full flex items-center justify-center",children:o.jsx(Mc,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})})}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:x.name}),o.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:x.lastModified})]})]})},x.id))}),i.length===0&&o.jsxs("div",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:[o.jsx(Mc,{className:"w-20 h-20 mx-auto mb-3 text-gray-300 dark:text-gray-600"}),o.jsx("p",{children:"No recent project"}),o.jsx("p",{className:"text-sm",children:"Create your first projet to get started"})]})]})]}),o.jsx("div",{className:"flex-1 flex items-center justify-center p-8",children:o.jsxs("div",{className:"text-center max-w-md",children:[o.jsxs("div",{className:"mb-3",children:[o.jsx("div",{className:"inline-flex items-center justify-center w-50 h-20",children:o.jsx("img",{src:"/flare-logo.png",alt:"Flare Logo",className:"w-100 h-100 object-contain"})}),o.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-lg",children:"Flare Studio is an unofficial, community-made editor inspired by the Flare engine. It is not affiliated with the official Flare developers."})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs(I,{onClick:()=>r(!0),className:"w-full h-12 text-lg",size:"lg",children:[o.jsx(Lo,{className:"w-5 h-5 mr-2"}),"Create New Projet"]}),o.jsxs(I,{variant:"outline",onClick:S,className:"w-full h-12 text-lg",size:"lg",children:[o.jsx(nw,{className:"w-5 h-5 mr-2"}),"Open Existing Project"]})]})]})})]})]})};function ab({open:t,onConfirm:e,onCancel:n}){return o.jsx(Cs,{open:t,onOpenChange:n,children:o.jsxs(Ts,{className:"max-w-md bg-red-50 dark:bg-red-900 border-red-400 dark:border-red-700 animate-shake",children:[o.jsxs(Ms,{children:[o.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[o.jsx(Kw,{className:"w-8 h-8 text-red-600 dark:text-red-400 animate-pulse"}),o.jsx(Es,{className:"text-red-700 dark:text-red-300 text-xl font-bold",children:"Danger: Overwrite Export"})]}),o.jsxs(Ps,{className:"text-red-700 dark:text-red-300 font-semibold text-base",children:["Older export detected inside project folder.",o.jsx("br",{}),o.jsxs("span",{className:"font-bold",children:["This process will ",o.jsx("span",{className:"underline",children:"replace your older files"}),"."]})]})]}),o.jsxs("div",{className:"flex flex-col gap-4 mt-4",children:[o.jsx(I,{variant:"destructive",className:"w-full text-lg font-bold py-3 animate-pulse",onClick:e,children:"Yes, Overwrite Old Export"}),o.jsx(I,{variant:"outline",className:"w-full text-lg font-bold py-3",onClick:n,children:"Cancel"})]})]})})}const lb={xp:{type:"int",min:0},xp_scaling:{type:"filename"},defeat_status:{type:"string"},convert_status:{type:"string"},first_defeat_loot:{type:"int",min:1},animations:{type:"filename"},loot:{type:"list"},loot_count:{type:"intPair",min:0},threat_range:{type:"floatPair",min:0},flee_range:{type:"float",min:0},chance_pursue:{type:"float",min:0},chance_flee:{type:"float",min:0},waypoint_pause:{type:"duration"},turn_delay:{type:"duration"},combat_style:{type:"predefined",options:["default","aggressive","passive"]},power:{type:"list"},passive_powers:{type:"list"},quest_loot:{type:"list"},flee_duration:{type:"duration"},flee_cooldown:{type:"duration"},humanoid:{type:"bool"},lifeform:{type:"bool"},flying:{type:"bool"},intangible:{type:"bool"}},ng=new Set(["N","NE","E","SE","S","SW","W","NW"]),cb=new Set(["true","false","1","0"]),sg=new Set(["","untitled map","map name","untitled_map"]),ub=t=>t.replace(/[<>:"/|?*]/g,"_").trim().replace(/\s+/g,"_").replace(/_{2,}/g,"_")||"Untitled_Map",xo=(t,e)=>{if(!t)return null;const n=(e??"").trim();return!n||sg.has(n.toLowerCase())?null:`maps/${ub(n)}.txt`},Qh=t=>["# this file is automatically loaded when a New Game starts.","# it's a dummy map to send the player to the actual starting point.","","[header]","width=1","height=1","hero_pos=0,0","","[event]","type=event","location=0,0,1,1","activate=on_load",`intermap=${t??""}`,""].join(`
`),Zh=t=>{if(!t)return null;const e=t.match(/^\s*intermap\s*=\s*(.*)$/m);if(!e)return null;const n=e[1].trim();return n||null};function db(t,e,n){switch(n.type){case"int":{const s=Number.parseInt(e,10);return Number.isNaN(s)?`${t} must be an integer.`:n.min!==void 0&&s<n.min?`${t} must be greater than or equal to ${n.min}.`:n.max!==void 0&&s>n.max?`${t} must be less than or equal to ${n.max}.`:null}case"float":{const s=Number.parseFloat(e);return Number.isNaN(s)?`${t} must be a number.`:n.min!==void 0&&s<n.min?`${t} must be greater than or equal to ${n.min}.`:n.max!==void 0&&s>n.max?`${t} must be less than or equal to ${n.max}.`:null}case"bool":return cb.has(e.toLowerCase())?null:`${t} must be true or false.`;case"filename":return e?null:`${t} cannot be empty.`;case"duration":return/^\d+(ms|s)?$/i.test(e)?null:`${t} must be a duration such as 200ms or 2s.`;case"intPair":{const s=e.split(",").map(r=>r.trim()).filter(Boolean);if(s.length===0||s.length>2)return`${t} must contain one or two comma-separated integers.`;for(const r of s){if(!/^-?\d+$/.test(r))return`${t} must contain valid integers.`;const i=Number.parseInt(r,10);if(n.min!==void 0&&i<n.min)return`${t} values must be greater than or equal to ${n.min}.`;if(n.max!==void 0&&i>n.max)return`${t} values must be less than or equal to ${n.max}.`}return null}case"floatPair":{const s=e.split(",").map(r=>r.trim()).filter(Boolean);if(s.length===0||s.length>2)return`${t} must contain one or two comma-separated numbers.`;for(const r of s){const i=Number.parseFloat(r);if(Number.isNaN(i))return`${t} must contain valid numbers.`;if(n.min!==void 0&&i<n.min)return`${t} values must be greater than or equal to ${n.min}.`;if(n.max!==void 0&&i>n.max)return`${t} values must be less than or equal to ${n.max}.`}return null}case"direction":{const s=e.toUpperCase();if(ng.has(s))return null;const r=Number.parseInt(e,10);return!Number.isNaN(r)&&r>=0&&r<=7?null:`${t} must be a direction (N, NE, ... , NW) or a number between 0 and 7.`}case"point":{const s=e.split(",").map(r=>r.trim());return s.length!==2||!s.every(r=>/^-?\d+$/.test(r))?`${t} must be two comma-separated integers.`:null}case"predefined":return n.options&&!n.options.includes(e)?`${t} must be one of: ${n.options.join(", ")}.`:null;case"list":case"string":default:return null}}const hb={};function fb(t){const e=t.type==="enemy"?lb:t.type==="npc"?hb:{},n={},s=[],r=t.properties||{};for(const[i,a]of Object.entries(r)){const c=(a??"").toString().trim(),u=e[i];if(u){const f=db(i,c,u);f&&s.push(f),u.type==="bool"?n[i]=c.toLowerCase():u.type==="direction"&&ng.has(c.toUpperCase())?n[i]=c.toUpperCase():n[i]=c}else n[i]=c}return{errors:s,sanitized:n}}function mb(){const[t,e]=m.useState(!0),[n,s]=m.useState(null),r=m.useRef(null),[i,a]=m.useState(0),[l,c]=m.useState(0),[u,f]=m.useState(!1),[h,p]=m.useState(!1),[b,y]=m.useState(20),[S,j]=m.useState(15),[v,g]=m.useState("Untitled Map"),[x,w]=m.useState(null),[N,T]=m.useState([]),[P,E]=m.useState(!1),[$,D]=m.useState("(none)"),[G,q]=m.useState(!0),[re,X]=m.useState(!0),[ae,je]=m.useState(!1),[Qe,z]=m.useState(!1),[B,W]=m.useState([]),[te,ne]=m.useState(null),[ue,yt]=m.useState(!1),[ir,Ze]=m.useState(!1),[is,Iu]=m.useState(!1),[rg,zu]=m.useState(!1),[ki,Au]=m.useState("engine"),[Du,ig]=m.useState(!0),[og,or]=m.useState(0),[Si,ar]=m.useState(!0),ji=m.useRef(null),ka=m.useRef(null),[Ln,lr]=m.useState(!0),Ni=m.useRef(null),Ru=m.useRef(null),[Ci,Ou]=m.useState(!0),Sa=m.useRef(null),ag=m.useRef(null),[Nt,cr]=m.useState(null),At=m.useCallback(()=>{ji.current!==null&&(window.clearTimeout(ji.current),ji.current=null)},[]),os=m.useCallback(()=>{At(),ji.current=window.setTimeout(()=>{ar(!1)},500)},[At]),Ti=m.useCallback(()=>{ar(!0),os()},[os]),lg=m.useCallback(()=>{At(),ar(!0)},[At]),cg=m.useCallback(()=>{var k;const d=typeof document<"u"?document.activeElement:null;d&&((k=ka.current)!=null&&k.contains(d))||os()},[os,ka]),ug=m.useCallback(()=>{At(),ar(!0)},[At]),dg=m.useCallback(d=>{const k=d.relatedTarget;d.currentTarget.contains(k)||os()},[os]),Dt=m.useCallback(()=>{Ni.current!==null&&(window.clearTimeout(Ni.current),Ni.current=null)},[]),as=m.useCallback(()=>{Dt(),Ni.current=window.setTimeout(()=>{lr(!1)},500)},[Dt]),ls=m.useCallback(()=>{lr(!0),as()},[as]),hg=m.useCallback(()=>{Dt(),lr(!0)},[Dt]),fg=m.useCallback(()=>{var k;const d=typeof document<"u"?document.activeElement:null;d&&((k=Ru.current)!=null&&k.contains(d))||as()},[as]),mg=m.useCallback(()=>{Dt(),lr(!0)},[Dt]),pg=m.useCallback(d=>{const k=d.relatedTarget;d.currentTarget.contains(k)||as()},[as]),cs=m.useCallback(()=>{Sa.current!==null&&(window.clearTimeout(Sa.current),Sa.current=null)},[]),$u=m.useCallback(()=>{cs()},[cs]),ur=m.useCallback(()=>{Ou(!0),$u()},[$u]),gg=m.useCallback(d=>{ag.current=d},[]),xg=m.useCallback(d=>{Aa.current=d,Ru.current=d},[]),_n=m.useCallback(d=>{yg(d),ls()},[ls]),Mi=m.useCallback(d=>{Na(k=>k===d?"none":d),ur()},[ur]),us=m.useMemo(()=>{var d;return typeof window<"u"&&!!((d=window.electronAPI)!=null&&d.selectTilesetFile)},[]),[Ne,yg]=m.useState("brush"),[vg,Ei]=m.useState(!1),[wg,Pi]=m.useState(!1),[bg,Li]=m.useState(!1),[In,dr]=m.useState("brush"),[zn,_i]=m.useState("rectangular"),[ds,ja]=m.useState("rectangle"),[Je,Na]=m.useState("none"),[kg,hr]=m.useState(!1),[Ii,Ca]=m.useState(null),[Fu,zi]=m.useState([]),[fr,Ta]=m.useState(null),[hs,mr]=m.useState("select"),[pb,Ma]=m.useState(!1),[pr,Hu]=m.useState(""),[Sg,Ai]=m.useState(!1),[Xt,gr]=m.useState(null),[jg,Bu]=m.useState(null),Ea=ye.useRef(null),[Me,xr]=m.useState("Untitled Map"),[fs,Ng]=m.useState(!1),[ie,Yu]=m.useState(null),[yr,Ut]=m.useState(null),Wu=m.useRef(Me),Xu=m.useCallback(async(d,k)=>{var A;const M=xo(d,k??Me);if(!ie||!((A=window.electronAPI)!=null&&A.updateSpawnFile)){Ut(M);return}const _=Qh(M);try{await window.electronAPI.updateSpawnFile(ie,_)&&Ut(M)}catch(V){console.error("Failed to update spawn file:",V)}},[Me,ie]),an=m.useCallback((d,k)=>{Ng(d),(k==null?void 0:k.propagate)!==!1&&Xu(d,k==null?void 0:k.mapNameOverride)},[Xu]),[et,Cg]=m.useState(()=>{const d=localStorage.getItem("isDarkMode");return d?JSON.parse(d):!1}),[ms,Tg]=m.useState(()=>{const d=localStorage.getItem("showSidebarToggle");return d?JSON.parse(d):!0});m.useEffect(()=>{try{localStorage.setItem("showSidebarToggle",JSON.stringify(ms))}catch{}},[ms]);const[Di,Pa]=m.useState("saved"),[vr,Mg]=m.useState(!0),[Eg,Uu]=m.useState(0),[La,Vu]=m.useState(!1),[ps,_a]=m.useState(!1);m.useEffect(()=>{let d=!1;return(async()=>{var C;if(!ie||!((C=window.electronAPI)!=null&&C.readSpawnFile)){d||Ut(null);return}try{const M=await window.electronAPI.readSpawnFile(ie);d||Ut(Zh(M))}catch(M){console.warn("Failed to read spawn file:",M),d||Ut(null)}})(),()=>{d=!0}},[ie]),m.useEffect(()=>{const d=Wu.current;if(d===Me||(Wu.current=Me,!fs))return;const k=xo(!0,d),C=xo(!0,Me);k!==C&&an(!0,{mapNameOverride:Me})},[Me,fs,an]),m.useEffect(()=>{n&&n.setMapName(Me)},[n,Me]);const[Gu,qu]=m.useState(!1),[Ku,Qu]=m.useState(!1),[Pg,An]=m.useState(0),[Lg,Zu]=m.useState(!1),[gs,Ju]=m.useState(!1),[xs,wr]=m.useState(null),Dn=m.useRef(null),[_g,Ri]=m.useState(!1),[K,Ye]=m.useState(null),[ed,br]=m.useState([]),[Ia,ys]=m.useState([]),[le,za]=m.useState(null),[td,ln]=m.useState(null),[Ig,Oi]=m.useState(!1),[Pe,kr]=m.useState(null),Vt=m.useRef(null),Gt=m.useRef(null),qt=m.useRef(null),Aa=m.useRef(null),[ct,$i]=m.useState(null),[zg,Fi]=m.useState(0),[Da,Hi]=m.useState(!1),{toast:ke}=Sp(),[nd,Sr]=m.useState([]),[vs,cn]=m.useState(!1),Ra=m.useRef(null),[Oa,sd]=m.useState(null),$a=m.useRef(null),rd=m.useRef(null),[Fa,id]=m.useState(null),[Bi,Yi]=m.useState(!1);m.useEffect(()=>{if(!vs)return;const d=()=>{const k=Ra.current;if(!k)return sd(null);const C=k.getBoundingClientRect();sd({left:C.left,top:C.top-8})};return d(),window.addEventListener("resize",d),window.addEventListener("scroll",d,!0),()=>{window.removeEventListener("resize",d),window.removeEventListener("scroll",d,!0)}},[vs]),m.useEffect(()=>{if(!Bi)return;const d=()=>{const k=$a.current;if(!k)return id(null);const C=k.getBoundingClientRect();id({left:C.right+8,top:C.top})};return d(),window.addEventListener("resize",d),window.addEventListener("scroll",d,!0),()=>{window.removeEventListener("resize",d),window.removeEventListener("scroll",d,!0)}},[Bi]),m.useEffect(()=>{if(!vs)return;const d=C=>{C.key==="Escape"&&(cn(!1),Yi(!1))},k=C=>{const M=$a.current,_=rd.current,A=Ra.current,V=C.target;M&&(M.contains(V)||_&&_.contains(V)||A&&A.contains(V)||(cn(!1),Yi(!1)))};return window.addEventListener("keydown",d),window.addEventListener("mousedown",k),()=>{window.removeEventListener("keydown",d),window.removeEventListener("mousedown",k)}},[vs]);const Ae=m.useCallback(()=>{ys(n?n.getMapObjects():[])},[n]);m.useEffect(()=>()=>{},[ke]),m.useEffect(()=>{et?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),n&&n.setDarkMode(et),localStorage.setItem("isDarkMode",JSON.stringify(et))},[et,n]),m.useEffect(()=>{if(!n)return;const d=k=>{D(k>0?k.toString():"(none)")};return n.setActiveGidCallback(d),()=>{n.setActiveGidCallback(null)}},[n]);const ws=m.useCallback(d=>{d.setAutoSaveCallback(async()=>{try{window.electronAPI&&ie&&await d.saveProjectData(ie)}catch(k){console.warn("Auto-save to disk failed:",k)}Uu(Date.now())}),d.setSaveStatusCallback(k=>{Pa(k),_a(k==="unsaved"||k==="error")}),d.setAutoSaveEnabled(vr),d.setEyedropperCallback(()=>{_n("brush"),dr("brush")}),d.setStampCallback(k=>{zi(k)}),d.setObjectsChangedCallback(k=>{ys(k)}),d.setHeroEditCallback((k,C,M,_,A)=>{kr({currentX:k,currentY:C,mapWidth:M,mapHeight:_,onConfirm:A}),Oi(!0)})},[vr,ie,_n]);m.useEffect(()=>()=>{At()},[At]),m.useEffect(()=>{!t&&u&&Ti()},[t,u,Ti]),m.useEffect(()=>{(t||!u)&&(ar(!0),At())},[t,u,At]),m.useEffect(()=>()=>{cs()},[cs]),m.useEffect(()=>{!t&&u&&ur()},[t,u,ur]),m.useEffect(()=>{(t||!u)&&(Ou(!0),cs())},[t,u,cs]),m.useEffect(()=>()=>{Dt()},[Dt]),m.useEffect(()=>{!t&&u&&ls()},[t,u,ls]),m.useEffect(()=>{(t||!u)&&(lr(!0),Dt())},[t,u,Dt]),m.useEffect(()=>{if(r.current&&!t&&!n&&!Gu&&!Nt){const d=new El(r.current);d.setDarkMode(et),ws(d),d.resetForNewProject(),u&&i>0&&l>0?d.setMapSize(i,l):d.setMapSize(0,0),s(d)}},[t,n,ws,Gu,et,Nt,u,i,l]),m.useEffect(()=>{if(!n)return;const d=()=>{const M=n.getHoverCoordinates();$i(M)};let k;const C=()=>{d(),k=requestAnimationFrame(C)};return C(),()=>{k&&cancelAnimationFrame(k)}},[n]),m.useEffect(()=>{if(n&&Ne==="brush"){const k={brush:"brush",bucket:"bucket",eraser:"eraser"}[In]||"brush";n.setCurrentTool(k)}else if(n&&Ne==="selection"){const k={rectangular:"rectangular","magic-wand":"magic-wand","same-tile":"same-tile",circular:"circular"}[zn]||"rectangular";n.setCurrentSelectionTool(k)}else if(n&&Ne==="shape"){const k={rectangle:"rectangle",circle:"circle",line:"line"}[ds]||"rectangle";n.setCurrentShapeTool(k)}else n&&Ne==="eyedropper"?n.setEyedropperTool():n&&Ne==="stamp"&&n.setStampTool()},[n,Ne,In,zn,ds]),m.useEffect(()=>{!n||Ne!=="stamp"||n.setCurrentStampMode(hs)},[n,Ne,hs]),m.useEffect(()=>{!n||Ne!=="stamp"||n.setActiveStamp(fr)},[n,Ne,fr]),m.useEffect(()=>{if(!n)return;const k=setInterval(()=>{const C=n.getSelection(),M=n.hasActiveSelection();Fi(C.length),Hi(M)},100);return()=>clearInterval(k)},[n]);const ut=m.useCallback(()=>{if(n){const d=n.getLayers();W([...d]);const k=n.getActiveLayerId();ne(k),Ae()}},[n,Ae]);m.useEffect(()=>{n&&ut()},[n,ut]),m.useEffect(()=>{Ae()},[Ae]),m.useEffect(()=>{const d=k=>{ue&&yt(!1)};return ue&&document.addEventListener("click",d),()=>{document.removeEventListener("click",d)}},[ue]);const We=m.useCallback((d,k)=>{if(Aa.current){const C=Aa.current.getBoundingClientRect();let M=window.innerWidth/2;if(r&&r.current){const A=r.current.getBoundingClientRect();M=A.left+A.width/2}const _=Math.max(8,C.top-60);wr({content:d,x:M,y:_,visible:!0,fadeOut:!1})}else{const C=k.getBoundingClientRect(),M=C.left+C.width/2,_=C.top-10;wr({content:d,x:M,y:_,visible:!0,fadeOut:!1})}Dn.current&&clearTimeout(Dn.current),Dn.current=setTimeout(()=>{wr(C=>C?{...C,fadeOut:!0}:null),setTimeout(()=>{wr(null)},300)},1e3)},[]),tt=m.useCallback(()=>{Dn.current&&clearTimeout(Dn.current),wr(null)},[]);m.useEffect(()=>()=>{Dn.current&&clearTimeout(Dn.current),Vt.current&&clearTimeout(Vt.current),Gt.current&&clearTimeout(Gt.current),qt.current&&clearTimeout(qt.current)},[]);const od=m.useCallback(()=>{Vt.current&&clearTimeout(Vt.current),Gt.current&&clearTimeout(Gt.current),qt.current&&clearTimeout(qt.current),Pi(!1),Li(!1),Ma(!1),Ei(!0)},[]),ad=m.useCallback(()=>{Vt.current=setTimeout(()=>{Ei(!1)},1e3)},[]),ld=m.useCallback(()=>{Vt.current&&clearTimeout(Vt.current),Gt.current&&clearTimeout(Gt.current),qt.current&&clearTimeout(qt.current),Ei(!1),Li(!1),Ma(!1),Pi(!0)},[]),cd=m.useCallback(()=>{Gt.current=setTimeout(()=>{Pi(!1)},1e3)},[]),ud=m.useCallback(()=>{Vt.current&&clearTimeout(Vt.current),Gt.current&&clearTimeout(Gt.current),qt.current&&clearTimeout(qt.current),Ei(!1),Pi(!1),Li(!0)},[]),dd=m.useCallback(()=>{qt.current=setTimeout(()=>{Li(!1)},1e3)},[]),hd=m.useCallback(()=>{if(!n||!pr.trim())return;n.createStampFromSelection(pr.trim())&&(Hu(""),Ma(!1),mr("select"))},[n,pr]),Ag=m.useCallback(d=>{Ta(d),mr("place")},[]),Dg=m.useCallback(d=>{n&&(n.deleteStamp(d),fr===d&&(Ta(null),mr("select")))},[n,fr]),Rg=()=>{switch(In){case"bucket":return o.jsx(Cl,{className:"w-4 h-4"});case"eraser":return o.jsx(jl,{className:"w-4 h-4"});default:return o.jsx(fo,{className:"w-4 h-4"})}},Og=()=>{switch(zn){case"magic-wand":return o.jsx(Ml,{className:"w-4 h-4"});case"same-tile":return o.jsx(js,{className:"w-4 h-4"});case"circular":return o.jsx(Rr,{className:"w-4 h-4"});default:return o.jsx(bw,{className:"w-4 h-4"})}},$g=()=>{switch(ds){case"circle":return o.jsx(Rr,{className:"w-4 h-4"});case"line":return o.jsx(Hh,{className:"w-4 h-4"});default:return o.jsx($w,{className:"w-4 h-4"})}},fd=m.useCallback(d=>{Ca(d),hr(!0)},[]),Fg=m.useCallback(()=>{if(!(!n||Ii===null)){try{n.separateBrush(Ii),console.log(`Separated brush with ID: ${Ii}`)}catch(d){console.error("Failed to separate brush:",d)}hr(!1),Ca(null),Na("none")}},[n,Ii]),md=m.useCallback(d=>{n&&(console.log(`handleRemoveBrush called with brushId: ${d}`),gr({type:"removeBrush",payload:d}))},[n]),pd=m.useCallback((d,k)=>{if(n)try{const C=n.getDetectedTileInfo(),M=C.findIndex(A=>A.gid===d),_=C.findIndex(A=>A.gid===k);M!==-1&&_!==-1&&(n.reorderBrush(M,_),console.log(`Reordered brush ${d} to position of ${k}`))}catch(C){console.error("Failed to reorder brush:",C)}},[n]),Ha=m.useCallback(d=>{if(!n)return;br([]);const k=n.getMapObjects().find(C=>C.id===d);k&&(Ye(k),Ri(!0))},[n]),gd=m.useCallback(d=>{n&&(n.updateMapObject(d.id,d),Ye(null),Ri(!1),Ae(),br([]))},[n,Ae]),Hg=m.useCallback(d=>{const k=(ct==null?void 0:ct.x)??0,C=(ct==null?void 0:ct.y)??0;za({type:d,name:"",x:k.toString(),y:C.toString(),tilesetPath:""}),ln(null)},[ct]),bs=m.useCallback((d,k)=>{za(C=>C&&{...C,[d]:k}),ln(null)},[]),xd=m.useCallback(async()=>{var d;if(!(typeof window>"u"||!((d=window.electronAPI)!=null&&d.selectTilesetFile)))try{const k=await window.electronAPI.selectTilesetFile();k&&bs("tilesetPath",k)}catch(k){console.error("Failed to select tileset file for actor:",k)}},[bs]),Wi=m.useCallback(()=>{za(null),ln(null)},[]),Bg=m.useCallback(d=>{n&&(n.removeMapObject(d),Ae())},[n,Ae]),Yg=m.useCallback(()=>{if(!n||!le)return;const d=parseInt(le.x,10),k=parseInt(le.y,10);if(!le.name.trim()){ln("Name is required.");return}if(Number.isNaN(d)||Number.isNaN(k)){ln("Position must be whole numbers.");return}if(d<0||d>=n.getMapWidth()||k<0||k>=n.getMapHeight()){ln("Position is outside of the map bounds.");return}if(!le.tilesetPath.trim()){ln("Tileset location is required.");return}const C=le.tilesetPath.trim(),M=le.name.trim();if(n.getObjectsAtPosition(d,k).find(V=>V.type===le.type)){ln(`There is already a ${le.type==="npc"?"NPC":"enemy"} at that position.`);return}const A=n.addMapObject("enemy",d,k,1,1);n.updateMapObject(A.id,{name:M,x:d,y:k,type:le.type,category:le.type==="npc"?"npc":"enemy",wander_radius:le.type==="npc"?0:A.wander_radius,properties:{...A.properties||{},tilesetPath:C}}),Ae(),Wi()},[le,n,Wi,Ae]),yd=m.useCallback(()=>{Ri(!1),Ye(null),br([])},[]),Wg=m.useCallback(()=>{if(!K)return;const{errors:d,sanitized:k}=fb(K);if(d.length>0){br(d);return}br([]),gd({...K,properties:k})},[K,gd]),R=m.useCallback((d,k)=>{Ye(C=>{if(!C)return C;const M={...C.properties||{}};return k===null||k===""?delete M[d]:M[d]=k,{...C,properties:M}})},[]),Ba=m.useCallback((d,k)=>{Ye(C=>{if(!C)return C;const M={...C.properties||{}};return M[d]=k?"true":"false",{...C,properties:M}})},[]),H=m.useCallback((d,k="")=>!K||!K.properties?k:K.properties[d]??k,[K]),vd=m.useCallback(async()=>{var d;if(!(typeof window>"u"||!((d=window.electronAPI)!=null&&d.selectTilesetFile)))try{const k=await window.electronAPI.selectTilesetFile();k&&R("tilesetPath",k)}catch(k){console.error("Failed to select tileset for editing object:",k)}},[R]),Xg=m.useCallback((d,k)=>{Pe!=null&&Pe.onConfirm&&Pe.onConfirm(d,k),Oi(!1),kr(null)},[Pe]),Ug=m.useCallback(()=>{Oi(!1),kr(null)},[]);m.useEffect(()=>{if(!n||!r.current)return;const d=C=>{console.log("Double-click detected on canvas");const M=n.getActiveLayer();if(console.log("Active layer:",M),!M){console.log("No active layer found");return}if(!["enemy","npc","object","event","background"].includes(M.type)){console.log(`Layer type '${M.type}' is not interactive, skipping double-click`);return}const A=n.getHoverCoordinates();if(console.log("Hover coordinates:",A),A){const V=n.getMapObjects(),U=n.getObjectsAtPosition(A.x,A.y);console.log("All objects:",V.length),console.log("Objects at hover position:",U);const oe=V.find(he=>he.x===A.x&&he.y===A.y);console.log("Object at position (find method):",oe),oe?(console.log(`Opening edit dialog for object ID: ${oe.id}`),Ha(oe.id)):console.log("No object found at hover position")}},k=r.current;return k.addEventListener("dblclick",d),()=>{k.removeEventListener("dblclick",d)}},[n,Ha]),m.useEffect(()=>{console.log(`Brush tool changed to: ${Je}`);const d=document.querySelector("[data-brush-tool]");if(d)d.setAttribute("data-brush-tool",Je),console.log(`Updated existing data-brush-tool attribute to: ${Je}`);else{const k=document.createElement("div");k.setAttribute("data-brush-tool",Je),k.style.display="none",document.body.appendChild(k),console.log(`Created new data-brush-tool element with value: ${Je}`)}},[Je]),m.useEffect(()=>{const d=k=>{const{action:C,tileIndex:M}=k.detail;switch(C){case"separate":fd(M);break;case"remove":md(M);break;case"drop":k.detail.from&&k.detail.to&&pd(k.detail.from,k.detail.to);break}};return document.addEventListener("brushAction",d),()=>{document.removeEventListener("brushAction",d)}},[fd,md,pd]);const Vg=m.useCallback(async(d,k)=>{try{k.name&&(d.projectName=k.name),console.log("=== LOAD PROJECT DATA DEBUG ==="),console.log("Map config received:",{name:k.name,tilesets:k.tilesets?k.tilesets.length:0,tilesetImages:k.tilesetImages?Object.keys(k.tilesetImages).length:0,layers:k.layers?k.layers.length:0}),console.log("Map config full structure:",k),console.log("Creating layers from config...");const C=k.layers||[];console.log("Layers from config:",C);for(const M of C)if(console.log("Processing layer:",M),d.addLayer(M.name,M.type)){console.log(`Created layer: ${M.type} - ${M.name}`);const A=d.getLayers().find(V=>V.type===M.type);A&&M.data&&Array.isArray(M.data)&&(console.log(`Setting data for layer ${A.id} with ${M.data.length} tiles`),A.data=M.data)}else console.log(`Failed to create layer: ${M.type} - ${M.name}`);return console.log("=== CALLING EDITOR loadProjectData ==="),d.loadProjectData(k),console.log("Project data loading completed"),!0}catch(C){return console.error("Error loading project data:",C),!1}},[]);m.useEffect(()=>{Nt&&r.current&&!t&&(console.log("Canvas available and map config pending, creating editor..."),(async()=>{var k;try{console.log("Creating new editor with pending config...");const C=new El(r.current);Nt.name?C.setMapName(Nt.name):C.setMapName("Untitled Map"),console.log("Clearing local storage backup..."),C.clearLocalStorageBackup(),console.log("Setting map size..."),C.setMapSize(Nt.width??20,Nt.height??15),console.log("Loading project data...");const M=await Vg(C,Nt);if(console.log("Project data loading result:",M),console.log("=== EDITOR STATE AFTER loadProjectData ==="),console.log("Tile count after loadProjectData:",C.getTileCount()),console.log("Active layer after loadProjectData:",C.getActiveLayerId()),console.log("Layers after loadProjectData:",C.getLayers().map(_=>({id:_.id,name:_.name,type:_.type}))),(k=window.electronAPI)!=null&&k.discoverTilesetImages&&ie){console.log("Calling discoverTilesetImages for path:",ie);const _=await window.electronAPI.discoverTilesetImages(ie),A=(_==null?void 0:_.tilesetImages)||{},V=Object.keys(A),U=Array.isArray(Nt.tilesets)&&Nt.tilesets.some(oe=>!!(oe!=null&&oe.layerType));if(console.log("Has per-layer tilesets in project:",U),console.log("Available discovered images:",V),!U&&V.length>0){console.log("No per-layer tilesets found, using fallback assignment");const oe=Ce=>(Ce||"").toLowerCase().replace(/\.[^/.]+$/,"").replace(/[^a-z0-9]+/g," ").trim(),he=C.getActiveLayerId(),xe=C.getLayers();let Xe=!1;for(const Ce of xe){const Rt=[oe(Ce.type),oe(Ce.name)];let nt=null;for(const Ct of V){const ks=oe(Ct);if(Rt.includes(ks)){nt=Ct;break}}if(!nt){const Ct=V.find(ks=>{const Ot=oe(ks);return Rt.some(On=>On&&Ot.includes(On))});Ct&&(nt=Ct)}!nt&&V.length===1&&(nt=V[0]),nt?(console.log(`Assigning tileset '${nt}' to layer ${Ce.id} (${Ce.type})`),C.setActiveLayer(Ce.id),await C.loadTilesetFromDataURL(A[nt],nt),Xe=!0):console.log(`No matching tileset found for layer ${Ce.id} (${Ce.type})`)}he!==null&&C.setActiveLayer(he),Xe&&C.forceSave()}else console.log("Per-layer tilesets already loaded, skipping fallback assignment")}console.log("Setting up autosave and updating UI..."),C.setDarkMode(et),ws(C),s(C),f(!0),p(!1),setTimeout(()=>{ut();const _=C.getActiveLayerId(),A=C.getLayers().find(V=>V.id===_);console.log("Final UI update - checking active layer:",_,A==null?void 0:A.type),C.redraw()},150),cr(null)}catch(C){if(console.error("Failed to create editor with pending config:",C),cr(null),f(!1),typeof ke=="function"){const M=C instanceof Error?C.message:"An error occurred while loading the project.";ke({title:"Failed to open project",description:M,variant:"destructive"})}}})())},[Nt,t,ie,ws,ut]);const Gg=(d,k)=>{var M;const C=(M=d.target.files)==null?void 0:M[0];C&&(n!=null&&n.handleFileUpload)&&n.handleFileUpload(C,k)},qg=d=>{n&&(n.setActiveLayer(d),ne(d))},Kg=d=>{if(n){n.toggleLayerVisibility(d);const k=n.getLayers();W([...k])}},Qg=(d,k)=>{if(n){const C=B.find(M=>M.id===d);if(C){const M=C.transparency||0,_=Math.max(0,Math.min(1,M+k));n.setLayerTransparency(d,_),ut()}}},Zg=()=>{n!=null&&n.resizeMap&&n.resizeMap(i,l)},Jg=()=>{n!=null&&n.zoomIn&&n.zoomIn()},ex=()=>{n!=null&&n.zoomOut&&n.zoomOut()},tx=()=>{n!=null&&n.resetZoom&&n.resetZoom()},nx=m.useCallback(d=>{const k=d.trim().toLowerCase();if(!k)return!1;const C=new Set;N.forEach(M=>{M&&C.add(M)}),Me.trim()&&C.add(Me.trim().toLowerCase());try{const M=localStorage.getItem("recentMaps");if(M){const _=JSON.parse(M);Array.isArray(_)&&_.forEach(A=>{if(A&&typeof A.name=="string"){const V=A.name.trim().toLowerCase();V&&C.add(V)}})}}catch(M){console.warn("Failed to read recent map names for duplicate check:",M)}return C.has(k)},[Me,N]),Ya=m.useCallback(()=>{y(i>0?i:20),j(l>0?l:15),E(fs),w(null),p(!0)},[i,l,fs]),Wa=m.useRef(!1);m.useEffect(()=>{h&&!Wa.current&&(g("Map Name"),Wa.current=!0),h||(Wa.current=!1)},[h,Me]);const sx=async()=>{if(gs)return;const d=Math.max(1,Math.floor(b)||0),k=Math.max(1,Math.floor(S)||0),C=v.trim(),M=C||"Untitled Map";if(nx(M)){w("There can't be maps that have the same name. Please type another name.");return}w(null),Ju(!0);try{T(A=>{const V=M.trim().toLowerCase();return!V||A.includes(V)?A:[...A,V]}),W([]),ne(null),zi([]),Ta(null),ys([]),$i(null),Na("none"),hr(!1),Ca(null),Pa("saved"),_a(!1);let _=n;!_&&r.current&&(_=new El(r.current),_.setDarkMode(et),ws(_)),_&&(_.projectName=M,_.resetForNewProject(),_.setMapName(M),_.setMapSize(d,k),_.setDarkMode(et),n||s(_),ut(),Ae()),a(d),c(k),f(!0),Ti(),ls(),xr(M),an(P,{mapNameOverride:M}),E(P),Hi(!1),Fi(0),w(null),p(!1)}finally{Ju(!1)}},Xa=m.useCallback(()=>{n!=null&&n.undo&&(n.undo(),ut(),Ae())},[n,ut,Ae]),Ua=m.useCallback(()=>{n!=null&&n.redo&&(n.redo(),ut(),Ae())},[n,ut,Ae]),[rx,Va]=m.useState(!1),[Ga,qa]=m.useState(null),wd=m.useCallback(async d=>{var _,A,V,U,oe;if(!((_=window.electronAPI)!=null&&_.resolvePathRelative)||!ie)return!1;const k=d.replace(/[<>:"/\\|?*]/g,"_").trim().replace(/\s+/g,"_").replace(/_{2,}/g,"_")||"Map_Name",C=`${ie}/maps/${k}.txt`,M=`${ie}/tilesetdefs/tileset_${k}.txt`;try{const he=await((V=(A=window.electronAPI).fileExists)==null?void 0:V.call(A,C)),xe=await((oe=(U=window.electronAPI).fileExists)==null?void 0:oe.call(U,M));return!!he||!!xe}catch{return!1}},[ie]),jr=m.useCallback(async({silent:d=!1,forceOverwrite:k=!1}={})=>{var V,U;if(!n||!ie)return ke({title:"Export Failed",description:"No project loaded or editor not initialized.",variant:"destructive"}),!1;const C=Me.trim();if(!C||sg.has(C.toLowerCase()))return d||ke({title:"Export Skipped",description:"Please create and name your map before exporting.",variant:"destructive"}),!1;if(!yr)return d||ke({title:"Export Failed",description:"No starting map selected.",variant:"destructive"}),!1;d||(Qu(!0),An(0));const M=Qh(yr),_=n.getTilesetExportInfo();let A;if(_.length>0){const oe={};for(const he of _){const xe=[he.id];he.sourcePath&&xe.push(he.sourcePath),he.fileName&&xe.push(he.fileName);let Xe=he.sourcePath??null;if(ie&&he.sourcePath&&((V=window.electronAPI)!=null&&V.resolvePathRelative))try{const Ce=await window.electronAPI.resolvePathRelative(ie,he.sourcePath);Ce&&Ce.trim()&&(Xe=Ce)}catch(Ce){console.warn("Failed to resolve tileset path relative to project:",Ce)}if(!Xe&&he.fileName&&(Xe=he.fileName),Xe){const Ce=Xe.replace(/\\/g,"/");for(const Rt of xe)Rt&&(oe[Rt]=Ce)}}Object.keys(oe).length>0&&(A=oe)}try{if(!k&&!d&&await wd(Me))return qa(()=>()=>jr({silent:d,forceOverwrite:!0})),Va(!0),!1;d||An(25);const oe=n.generateFlareMapTxt({pathOverrides:A,mapName:Me});d||An(50);const he=n.generateFlareTilesetDef({pathOverrides:A});if(d||An(75),(U=window.electronAPI)!=null&&U.saveExportFiles){const xe={};try{const Ce=n.getTilesetExportInfo();for(const Rt of Ce){let nt;n.layerTilesets&&typeof n.layerTilesets.forEach=="function"&&n.layerTilesets.forEach(Ot=>{const On=Ot;(On==null?void 0:On.fileName)===Rt.fileName&&(nt=On)});let Ct=null;const ks=(nt==null?void 0:nt.image)??null;if(ks&&(Ct=ks),!Ct&&n.tilesetFileName===Rt.fileName){const Ot=n.tilesetImage;Ot&&(Ct=Ot)}if(Ct)try{const Ot=n.canvasToDataURL(Ct);xe[Rt.fileName]=Ot}catch(Ot){console.warn("Failed to serialize tileset image",Rt.fileName,Ot)}}}catch(Ce){console.warn("Failed to collect tileset images for export:",Ce)}if(!await window.electronAPI.saveExportFiles(ie,Me,oe,he,{spawn:{enabled:!0,content:M,filename:"spawn.txt"},tilesetImages:xe}))throw new Error("Failed to save export files");d||(An(100),setTimeout(()=>{Zu(!0)},1500))}else n.exportFlareMap(),console.warn("Spawn file creation skipped: Electron API unavailable."),d||An(100);return!0}catch(oe){return console.error("Export failed:",oe),ke({title:"Export Failed",description:"An error occurred while exporting the map.",variant:"destructive"}),!1}finally{d||setTimeout(()=>{Qu(!1),An(0)},1e3)}},[n,ie,Me,yr,ke,wd]),ix=m.useCallback(async()=>{await jr()},[jr]),ox=m.useCallback(()=>{Va(!1),Ga&&(Ga(),qa(null))},[Ga]),ax=m.useCallback(()=>{Va(!1),qa(null)},[]),Rn=m.useCallback(async()=>{if(n){Vu(!0);try{if(window.electronAPI&&ie){const d=await n.saveProjectData(ie);await new Promise(k=>setTimeout(k,300)),d&&Uu(Date.now())}else n.forceSave(),await new Promise(d=>setTimeout(d,500))}catch(d){console.error("Save error:",d)}finally{Vu(!1)}}},[n,ie]),lx=m.useCallback(async()=>{var d;if(!ie||!((d=window.electronAPI)!=null&&d.listMaps)){Sr([]);return}try{const k=await window.electronAPI.listMaps(ie);Sr([...k])}catch(k){console.warn("Failed to list maps:",k),Sr([])}},[ie]),cx=m.useCallback(async d=>{if(ie)try{if(!await jr({silent:!0})){ke({title:"Export failed",description:"Failed to export current map before opening a new one.",variant:"destructive"});return}await Rn();const C=await window.electronAPI.readMapFile(ie,d);if(!C){ke({title:"Open failed",description:`Failed to read map file ${d}`,variant:"destructive"});return}n&&typeof n.loadFlareMapTxt=="function"?(n.loadFlareMapTxt(C),n.setMapName(d.replace(/\.txt$/i,"")),ut(),Ae(),f(!0),xr(d.replace(/\.txt$/i,"")),ke({title:"Map opened",description:`Opened ${d}`})):ke({title:"Map loaded (raw)",description:"Map content loaded but no parser available in the editor. Implement loadFlareMapTxt to parse it."})}catch(k){console.error("Open map error:",k),ke({title:"Open failed",description:"An unexpected error occurred while opening the map.",variant:"destructive"})}},[ie,jr,Rn,n,ut,Ae,ke]),ux=()=>{n!=null&&n.toggleMinimap&&n.toggleMinimap(),q(!G)},dx=(d,k)=>{localStorage.removeItem("tilemap_autosave_backup"),Yu(k??null),an(!!d.isStartingMap,{propagate:!1}),g("Map Name"),E(!!d.isStartingMap),a(0),c(0),y(d.width),j(d.height),f(!1),W([]),ne(null),zi([]),ys([]),$i(null),Hi(!1),Fi(0),cr(null),s(null),w(null),p(!1),e(!1)},Xi=m.useCallback(async d=>{var k,C,M,_;console.log("=== HANDLE OPEN MAP CALLED ===",d),console.log("Project path details:",{path:d,timestamp:new Date().toISOString()});try{qu(!0),Yu(d);let A=yr;if((k=window.electronAPI)!=null&&k.readSpawnFile)try{const U=await window.electronAPI.readSpawnFile(d);A=Zh(U),Ut(A)}catch(U){console.warn("Failed to read spawn file:",U),A=null,Ut(null)}else A=null,Ut(null);let V=[];if((C=window.electronAPI)!=null&&C.listMaps)try{V=[...await window.electronAPI.listMaps(d)]}catch(U){console.warn("Failed to list maps:",U),V=[]}if(V.length===0){Sr([]),f(!1),s(null),cr(null),xr(""),g(U=>typeof U=="string"&&U.trim()?U:"Map Name"),an(!1),E(!1),a(0),c(0),ne(null),W([]),zi([]),ys([]),$i(null),T([]),Hi(!1),Fi(0),_a(!1),Pa("saved"),w(null),y(U=>typeof U=="number"&&U>0?U:20),j(U=>typeof U=="number"&&U>0?U:15),e(!1),p(!0);return}if(Sr([...V]),(M=window.electronAPI)!=null&&M.openMapProject){const U=await window.electronAPI.openMapProject(d);if(U){const oe=(_=U.name)!=null&&_.trim()?U.name.trim():"Untitled Map",he=!!U.isStartingMap;xr(oe),g(oe);const xe=xo(!0,oe),Xe=A?xe===A:he;an(Xe,{propagate:!1}),E(Xe),Xe&&xe&&A!==xe&&(Ut(xe),A=xe),a(U.width??20),c(U.height??15),f(!0),Ti(),ls(),e(!1),p(!1),n&&s(null),cr(U)}}else console.log("Opening map project:",d)}catch(A){console.error("Error opening map project:",A)}finally{qu(!1)}},[n,ws,ut,yr,an]);m.useEffect(()=>{window.electronAPI&&(window.electronAPI.onMenuSaveMap(async()=>{await Rn()}),window.electronAPI.onMenuOpenMap(async()=>{const d=await window.electronAPI.selectDirectory();d&&await Xi(d)}),window.electronAPI.onMenuNewMap(()=>{e(!0),f(!1),s(null),a(0),c(0),p(!1)}),window.electronAPI.onMenuUndo(()=>{Xa()}),window.electronAPI.onMenuRedo(()=>{Ua()}))},[Rn,Xi,Xa,Ua]),m.useEffect(()=>{window.electronAPI&&(window.electronAPI.onBeforeClose(async()=>{await window.electronAPI.confirmClose(ps)}),window.electronAPI.onSaveAndClose(async()=>{try{await Rn(),window.electronAPI.closeAfterSave()}catch(d){console.error("Failed to save before close:",d),window.electronAPI.closeAfterSave()}}))},[ps,Rn]),m.useEffect(()=>{const d=k=>{if(ps)return k.preventDefault(),k.returnValue="",""};return window.addEventListener("beforeunload",d),()=>{window.removeEventListener("beforeunload",d)}},[ps]);const hx=()=>{var d;(d=window.electronAPI)!=null&&d.minimize?window.electronAPI.minimize():console.log("Minimize clicked - Electron API not available")},fx=()=>{var d;(d=window.electronAPI)!=null&&d.maximize?window.electronAPI.maximize():console.log("Maximize clicked - Electron API not available")},mx=()=>{var d;(d=window.electronAPI)!=null&&d.close?window.electronAPI.close():console.log("Close clicked - Electron API not available")},px=()=>{n&&n.fillSelection()},gx=()=>{n&&n.clearSelection()},xx=()=>{n&&n.deleteSelection()},Z=m.useMemo(()=>B.find(d=>d.id===te)??null,[B,te]),yx=(Z==null?void 0:Z.type)==="collision",Nr=(Z==null?void 0:Z.type)==="npc",Ui=(Z==null?void 0:Z.type)==="enemy",bd=m.useMemo(()=>Nr?Ia.filter(d=>d.type==="npc"):Ui?Ia.filter(d=>d.type==="enemy"):[],[Ia,Nr,Ui]),[Ka,kd]=m.useState("map");return o.jsx(o.Fragment,{children:t?o.jsx(ob,{onCreateNewMap:dx,onOpenMap:Xi,isDarkMode:et}):o.jsxs("div",{className:"h-screen bg-background text-foreground flex flex-col overflow-hidden",children:[o.jsxs("div",{className:"bg-gray-100 dark:bg-neutral-900 text-orange-600 dark:text-orange-400 flex justify-between items-center px-4 py-1 select-none drag-region border-b border-gray-200 dark:border-neutral-700",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx("img",{src:"/flare-ico.png",alt:"Flare Studio Logo",className:"w-4 h-6"}),o.jsx("span",{className:"text-sm font-semibold text-orange-600 dark:text-orange-400",children:"Flare Studio"})]}),o.jsx("div",{className:"text-sm font-medium"}),o.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[Di==="saving"&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full animate-pulse"}),o.jsx("span",{className:"text-orange-600",children:"Saving..."})]}),Di==="saved"&&Eg>0&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),o.jsx("span",{className:"text-green-600",children:"Saved"})]}),Di==="error"&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),o.jsx("span",{className:"text-red-600",children:"Save Error"})]}),Di==="unsaved"&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full"}),o.jsx("span",{className:"text-yellow-600",children:"Unsaved"})]})]})]}),o.jsxs("div",{className:"flex no-drag",children:[o.jsx(Q,{content:"Minimize",children:o.jsx("button",{onClick:hx,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-700 p-1 rounded transition-colors",children:o.jsx(Ec,{className:"w-4 h-4"})})}),o.jsx(Q,{content:"Maximize",children:o.jsx("button",{onClick:fx,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-700 p-1 rounded transition-colors",children:o.jsx(Hn,{className:"w-4 h-4"})})}),o.jsx(Q,{content:"Close",children:o.jsx("button",{onClick:mx,className:"text-gray-500 hover:text-red-600 dark:text-gray-400 dark:hover:text-red-400 hover:bg-gray-200 dark:hover:bg-gray-700 p-1 rounded transition-colors",children:o.jsx(Ue,{className:"w-4 h-4"})})})]})]}),ms&&o.jsx("button",{onClick:()=>{if(z(!0),n&&typeof n.setSidebarTransitioning=="function")try{n.setSidebarTransitioning(!0)}catch{}je(d=>!d),window.setTimeout(()=>{if(z(!1),n&&typeof n.setSidebarTransitioning=="function")try{n.setSidebarTransitioning(!1)}catch{}},380)},"aria-label":ae?"Show sidebar":"Hide sidebar",style:{left:ae?0:224},className:"no-drag no-press-shift press-fill-effect fixed top-1/2 transform -translate-y-1/2 z-50 bg-white/90 dark:bg-neutral-900/90 border border-border rounded-l-md p-1 shadow-md hover:bg-white dark:hover:bg-neutral-800",children:ae?o.jsx(Y0,{className:"w-4 h-4"}):o.jsx(H0,{className:"w-4 h-4"})}),o.jsxs("main",{className:"flex flex-1 min-h-0",children:[o.jsxs("aside",{className:"relative border-r border-border bg-muted/30 p-2 overflow-visible flex flex-col transition-all duration-200 ease-in-out app-sidebar "+(ae?"sidebar-collapsed":""),"aria-hidden":ae,children:[o.jsxs("div",{className:"sidebar-inner flex flex-col h-full",children:[o.jsxs("section",{className:"flex flex-col flex-1",children:[(()=>{const d=(Z==null?void 0:Z.type)==="event";return Nr||Ui||d?o.jsx(o.Fragment,{children:(Nr||Ui)&&o.jsx("div",{className:"flex-1 min-h-0",children:bd.length===0?o.jsx("div",{className:"h-full border border-dashed border-border rounded-md flex items-center justify-center text-sm text-muted-foreground px-4 text-center",children:Nr?"No NPCs added yet. Use the Add control to place your first NPC.":"No enemies added yet. Use the Add control to place an enemy."}):o.jsx("div",{className:"space-y-2 overflow-y-auto pr-1",children:bd.map(k=>{var C;return o.jsx("div",{className:"border border-border rounded-md px-3 py-2 bg-background/50 hover:bg-background transition-colors cursor-pointer",onClick:()=>Ha(k.id),children:o.jsxs("div",{className:"flex items-start justify-between gap-2",children:[o.jsxs("div",{className:"space-y-1 text-sm",children:[o.jsxs("div",{className:"font-medium text-foreground",title:k.name||`${k.type==="npc"?"NPC":"Enemy"} #${k.id}`,children:[o.jsx("span",{className:ae?"sr-only":"",children:k.name||`${k.type==="npc"?"NPC":"Enemy"} #${k.id}`}),!k.name&&ae&&o.jsxs("span",{className:"text-xs text-muted-foreground",children:["#",k.id]})]}),o.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[o.jsx(Fh,{className:"w-3 h-3"}),o.jsxs("span",{className:ae?"sr-only":"",children:["(",k.x,", ",k.y,")"]})]}),((C=k.properties)==null?void 0:C.tilesetPath)&&o.jsx("div",{className:"text-xs text-muted-foreground break-all",children:k.properties.tilesetPath})]}),o.jsx(Q,{content:"Remove",children:o.jsx(I,{variant:"ghost",size:"sm",className:"w-6 h-6 p-0 text-red-500 hover:text-red-600",onClick:M=>{M.stopPropagation(),Bg(k.id)},children:o.jsx(Ue,{className:"w-3 h-3"})})})]})},k.id)})})})}):null})(),o.jsxs("div",{className:"flex-1 flex flex-col min-h-0 overflow-hidden p-0 m-0",children:[(()=>{const d=Z==null?void 0:Z.type;return d==="background"||d==="object"?o.jsx("div",{className:"flex items-center gap-2 px-2 pb-2",children:o.jsx("div",{className:`flex-1 flex items-center gap-1 overflow-x-auto tabs-scroll ${(()=>{try{const C=n&&d?n.getLayerTabs?n.getLayerTabs(d):[]:[];return C&&C.length>7?"tabs-limited":""}catch{return""}})()}`,onWheel:C=>{const M=C.currentTarget;M.scrollWidth>M.clientWidth&&(C.preventDefault(),M.scrollLeft+=C.deltaY)},children:n?(n.getLayerTabs?n.getLayerTabs(d):[]).map((C,M)=>o.jsx("button",{className:`w-5 h-5 flex items-center justify-center rounded-full text-white text-xs font-medium transition-colors shadow-sm ${n&&n.getCurrentLayerType()===d&&n.getActiveLayerTabId&&n.getActiveLayerTabId(d)===C.id?"opacity-100 scale-100 ring-2 ring-offset-1":"opacity-90 scale-95"}`,onClick:()=>{if(n){n.setActiveLayerTab(d,C.id);try{n.refreshTilePalette(!0)}catch{}or(_=>_+1)}},style:{background:n&&n.getActiveLayerTabId&&n.getActiveLayerTabId(d)===C.id?"#ea580c":"#f97316"},children:M+1},C.id)):o.jsx("div",{className:"text-xs text-muted-foreground",children:"No tabs"})})},og):null})(),o.jsxs("div",{className:"relative flex-1 min-h-0 overflow-auto flex flex-col",children:[o.jsx("div",{id:"tilesContainer",className:"tile-palette flex flex-col flex-1 min-h-0 overflow-y-auto p-0 m-0 justify-start pb-12",onWheel:d=>{const k=d.currentTarget;k.scrollWidth>k.clientWidth&&(d.preventDefault(),k.scrollLeft+=d.deltaY)}}),o.jsx("div",{"data-brush-tool":Je,className:"hidden"})]})]}),o.jsxs("div",{className:"sticky bottom-0 z-10 bg-transparent py-2",children:[o.jsx("div",{className:"text-xs text-muted-foreground"}),o.jsx("div",{className:"w-full flex justify-center",children:o.jsx("div",{ref:gg,className:"flex items-center transition-all duration-300 ease-in-out gap-1 transform -translate-x-1 mt-2 mb-2",children:!yx&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex-shrink-0 flex items-center gap-1",children:[((Z==null?void 0:Z.type)==="background"||(Z==null?void 0:Z.type)==="object")&&o.jsx(Q,{content:"Add tab",side:"bottom",children:o.jsx(I,{variant:"outline",size:"sm",className:"text-xs px-1 py-1 h-6",onClick:()=>{if(!n||!Z)return;const d=n.getLayerTabs?n.getLayerTabs(Z.type):[];if(d&&d.length>=8){ke({title:"Maximum tabs reached",description:"You can have up to 8 tabs per layer.",variant:"destructive"});return}const k=n.createLayerTab(Z.type);n.setActiveLayerTab(Z.type,k),or(C=>C+1)},children:"+"})}),(()=>{const d=(Z==null?void 0:Z.type)==="npc",k=(Z==null?void 0:Z.type)==="enemy",C=(Z==null?void 0:Z.type)==="event",_=d||k||C?`Add ${C?"Event":d?"NPC":"Enemy"}`:"Import a PNG tileset or brush for the active layer tab";return d||k||C?o.jsx(Q,{content:_,side:"bottom",children:o.jsx(I,{variant:"default",size:"sm","aria-label":_,className:"relative z-20 text-xs px-1 py-1 h-6 shadow-sm bg-orange-500 hover:bg-orange-600 text-white border-orange-500",onClick:A=>{A.stopPropagation(),A.preventDefault(),d||k?Hg(d?"npc":"enemy"):ke({title:"Not implemented",description:"Create Event will be implemented later."})},role:"button",children:o.jsx(mo,{className:"w-3 h-3 text-white"})})}):o.jsx(Q,{content:_,side:"bottom",children:o.jsxs(I,{variant:"default",size:"sm","aria-label":_,className:"relative text-xs px-1 py-1 h-6 shadow-sm bg-orange-500 hover:bg-orange-600 text-white border-orange-500",children:[o.jsx(mo,{className:"w-3 h-3 text-white"}),o.jsx("input",{type:"file",accept:"image/png",className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",onChange:async A=>{var oe;if(!n||!Z)return;const V=(oe=A.target.files)==null?void 0:oe[0];if(!V)return;const U=Z.type;if(U==="background"||U==="object"){const he=n.getLayerTabs?n.getLayerTabs(U):[];let xe=n.getActiveLayerTabId?n.getActiveLayerTabId(U):null;if(typeof xe!="number"||xe===null){if(he&&he.length>=8){ke({title:"Maximum tabs reached",description:"You can have up to 8 tabs per layer.",variant:"destructive"});return}xe=n.createLayerTab(U),n.setActiveLayerTab(U,xe)}await n.importBrushImageToLayerTab(U,xe,V),n.refreshTilePalette(!0),or(Xe=>Xe+1)}else Gg(A,"layerTileset")}})]})})})()]}),o.jsx("div",{className:"flex-shrink-0 overflow-visible transition-all duration-300 ease-out opacity-100 scale-100 max-w-[2.5rem] w-auto",children:o.jsx(Q,{content:"Move/Reorder brushes",children:o.jsx(I,{variant:Je==="move"?"default":"outline",size:"sm",className:"text-xs px-1 py-1 h-6 shadow-sm",onClick:()=>Mi("move"),children:o.jsx(Wh,{className:"w-3 h-3"})})})}),o.jsx("div",{className:`flex-shrink-0 overflow-hidden transition-all duration-300 ease-out ${Ci||Je==="merge"?"opacity-100 scale-100 max-w-[2.5rem] w-auto":"opacity-0 scale-90 max-w-0 w-0 pointer-events-none"}`,children:o.jsx(Q,{content:"Merge brushes",children:o.jsx(I,{variant:Je==="merge"?"default":"outline",size:"sm",className:"text-xs px-1 py-1 h-6 shadow-sm",onClick:()=>Mi("merge"),children:o.jsx($h,{className:"w-3 h-3"})})})}),o.jsx("div",{className:`flex-shrink-0 overflow-hidden transition-all duration-300 ease-out ${Ci||Je==="separate"?"opacity-100 scale-100 max-w-[2.5rem] w-auto":"opacity-0 scale-90 max-w-0 w-0 pointer-events-none"}`,children:o.jsx(Q,{content:"Separate brushes",children:o.jsx(I,{variant:Je==="separate"?"default":"outline",size:"sm",className:"text-xs px-1 py-1 h-6 shadow-sm",onClick:()=>Mi("separate"),children:o.jsx(Dw,{className:"w-3 h-3"})})})}),o.jsx("div",{className:`flex-shrink-0 overflow-hidden transition-all duration-300 ease-out ${Ci||Je==="remove"?"opacity-100 scale-100 max-w-[2.5rem] w-auto":"opacity-0 scale-90 max-w-0 w-0 pointer-events-none"}`,children:o.jsx(Q,{content:"Remove brushes",children:o.jsx(I,{variant:Je==="remove"?"default":"outline",size:"sm",className:"text-xs px-1 py-1 h-6 shadow-sm",onClick:()=>Mi("remove"),children:o.jsx(Gw,{className:"w-3 h-3"})})})}),o.jsx("div",{className:`flex-shrink-0 overflow-hidden transition-all duration-300 ease-out ${Ci?"opacity-100 scale-100 max-w-[2.5rem] w-auto":"opacity-0 scale-90 max-w-0 w-0 pointer-events-none"}`,children:o.jsx(Q,{content:"Delete tileset tab",children:o.jsx(I,{variant:"outline",size:"sm",className:"text-xs px-1 py-1 h-6 border-red-500 hover:border-red-600 hover:bg-red-50 shadow-sm",onClick:()=>{if(ur(),!n){ke({title:"No editor",description:"Editor is not initialized yet.",variant:"destructive"});return}const d=Z==null?void 0:Z.type;if(!d){ke({title:"No active layer",description:"Please select a layer first.",variant:"destructive"});return}const k=n.getActiveLayerTabId?n.getActiveLayerTabId(d):null;if(typeof k!="number"||k===null){ke({title:"No tab selected",description:"There is no active tileset tab to delete for this layer.",variant:"destructive"});return}const C={layerType:d,tabId:k};Ea.current=C,Bu(C),gr({type:"removeTab",payload:C})},children:o.jsx(Ue,{className:"w-3 h-3 text-red-500"})})})})]})})})]})]}),o.jsx("section",{className:"mb-0 flex-shrink-0 flex flex-col justify-center h-40",onMouseEnter:()=>Iu(!0),onMouseLeave:()=>Iu(!1),tabIndex:0,children:o.jsx("div",{className:"mb-2 w-full flex flex-col justify-center h-full",children:o.jsx("div",{className:"h-48 overflow-hidden flex flex-col justify-center w-full",children:o.jsx("div",{className:"space-y-0.5 h-full overflow-y-auto flex flex-col justify-center w-full",children:B.map(d=>{const k=te===d.id,C=is||k;return o.jsx("div",{className:`block w-full max-w-xs px-2 py-1 rounded transition-all text-xs transform-gpu ${k?"bg-orange-50 dark:bg-orange-900/20 border-orange-400":"bg-transparent border-transparent"}`,style:{opacity:C?1:.65,transform:C?"scaleY(1) translateY(0)":"scaleY(0.98) translateY(0)",transformOrigin:"top",pointerEvents:C?"auto":"none",transition:"transform 400ms cubic-bezier(.2,.9,.2,1), opacity 400ms ease, box-shadow 300ms ease",boxShadow:k?"0 6px 12px rgba(15,23,42,0.06)":"none",zIndex:k?30:10},children:o.jsx("div",{className:"cursor-pointer w-full flex items-center",onClick:()=>qg(d.id),children:o.jsxs("div",{className:`flex items-center gap-2 w-full ${k?"opacity-100":"opacity-80"}`,children:[o.jsx(Q,{content:d.visible?"Hide layer":"Show layer",children:o.jsx(I,{variant:"ghost",size:"sm",onClick:M=>{M.stopPropagation(),Kg(d.id)},className:"w-4 h-4 p-0 hover:bg-gray-200 dark:hover:bg-gray-700",children:d.visible?o.jsx(ew,{className:"w-2.5 h-2.5"}):o.jsx(Z0,{className:"w-2.5 h-2.5 text-gray-400 dark:text-gray-500"})})}),o.jsx(I,{variant:"ghost",size:"sm",className:"w-4 h-4 p-0 hover:bg-gray-200 dark:hover:bg-gray-700",onMouseEnter:M=>{const _=Math.round((d.transparency||0)*100);We(o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx(ho,{className:"w-3 h-3"}),"Transparency (",_,"%)"]}),M.currentTarget)},onMouseLeave:tt,onWheel:M=>{M.preventDefault();const _=M.deltaY>0?.1:-.1;Qg(d.id,_);const A=d.transparency||0,V=Math.max(0,Math.min(1,A+_)),U=Math.round(V*100);We(o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx(ho,{className:"w-3 h-3"}),"Transparency (",U,"%)"]}),M.currentTarget)},children:o.jsx(A0,{className:"w-2.5 h-2.5"})}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Q,{content:d.name,children:o.jsx("span",{className:"text-xs font-medium truncate flex items-center gap-2",children:(()=>{switch((d.type||"").toLowerCase()){case"background":case"bg":return o.jsx(ow,{className:"w-4 h-4"});case"collision":case"collision layer":return o.jsx(Mc,{className:"w-4 h-4"});case"objects":case"object":return o.jsx(R0,{className:"w-4 h-4"});case"npc":return o.jsx(t1,{className:"w-4 h-4"});case"enemy":return o.jsx(cw,{className:"w-4 h-4"});case"event":return o.jsx(V0,{className:"w-4 h-4"});default:return o.jsx(Nl,{className:"w-4 h-4"})}})()})}),o.jsx("span",{className:ae?"sr-only text-xs font-medium":"text-xs font-medium truncate",title:d.name,children:d.name})]})]})})},d.id)})})})})})]}),o.jsxs("section",{className:"flex-shrink-0 mt-auto mb-2",children:[o.jsx("div",{className:"w-full h-1.5 mb-2",children:Ku?o.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-full overflow-hidden",children:o.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-orange-600 h-full transition-all duration-1000 ease-out rounded-full",style:{width:`${Pg}%`}})}):o.jsx("div",{className:"w-full h-full"})}),o.jsxs("div",{className:"flex gap-2 justify-center",children:[o.jsxs("div",{children:[o.jsx(I,{ref:Ra,size:"sm",className:"w-7 h-7 p-0 shadow-sm",onClick:async()=>{vs||await lx(),cn(d=>!d)},disabled:Ku||gs,children:o.jsx(fw,{className:"w-3 h-3"})}),vs&&Oa&&Jn.createPortal(o.jsx("div",{ref:$a,style:{left:Oa.left,top:Oa.top,position:"absolute",transform:"translateY(-100%)"},className:"w-56 bg-background border border-border rounded shadow-lg z-[9999]",children:o.jsx("div",{className:"max-h-60 overflow-y-auto minimal-scroll",children:ie?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"relative",children:[o.jsxs("button",{className:"w-full text-left p-2 hover:bg-gray-100 dark:hover:bg-neutral-800 text-xs flex items-center justify-between gap-2",onClick:()=>Yi(d=>!d),children:[o.jsxs("span",{className:"flex items-center gap-2",children:[o.jsx(Po,{className:"w-3 h-3"}),o.jsx("span",{children:"Open map"})]}),o.jsx("svg",{className:`w-3 h-3 transition-transform ${Bi?"transform rotate-90":""}`,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",children:o.jsx("path",{d:"M9 18l6-6-6-6"})})]}),Bi&&Fa&&Jn.createPortal(o.jsx("div",{ref:rd,style:{left:Fa.left,top:Fa.top,position:"absolute"},className:"w-48 bg-background border border-border rounded shadow-md z-[10000] max-h-60 overflow-y-auto minimal-scroll",children:nd.length===0?o.jsx("div",{className:"p-2 text-xs text-muted-foreground",children:"No maps found"}):nd.map(d=>o.jsx("button",{className:"w-full text-left p-2 hover:bg-gray-100 dark:hover:bg-neutral-800 text-xs",onClick:()=>{cn(!1),Yi(!1),cx(d)},children:d},d))}),document.body)]}),o.jsx("div",{className:"border-t border-border"}),o.jsxs("button",{className:"w-full text-left p-2 hover:bg-gray-100 dark:hover:bg-neutral-800 text-xs flex items-center gap-2",onClick:async()=>{cn(!1),await ix()},children:[o.jsx(q0,{className:"w-3 h-3"}),o.jsx("span",{children:"Export map"})]}),o.jsx("div",{className:"border-t border-border"}),o.jsxs("button",{className:"w-full text-left p-2 hover:bg-gray-100 dark:hover:bg-neutral-800 text-xs flex items-center gap-2",onClick:()=>{cn(!1),Ya()},children:[o.jsx(Lo,{className:"w-3 h-3"}),o.jsx("span",{children:"Create new map"})]})]}):o.jsxs(o.Fragment,{children:[o.jsxs("button",{className:"w-full text-left p-2 hover:bg-gray-100 dark:hover:bg-neutral-800 text-xs flex items-center gap-2",onClick:async()=>{var d;if(cn(!1),(d=window.electronAPI)!=null&&d.selectDirectory)try{const k=await window.electronAPI.selectDirectory();k&&await Xi(k)}catch(k){console.error("Failed to select directory:",k),ke({title:"Open failed",description:"Unable to open project directory.",variant:"destructive"})}else ke({title:"Open unavailable",description:"Open project requires the desktop app.",variant:"destructive"})},children:[o.jsx(Po,{className:"w-3 h-3"}),o.jsx("span",{children:"Open project..."})]}),o.jsx("div",{className:"border-t border-border"}),o.jsx("div",{className:"p-2 text-xs",children:"No project is currently open. Open a project to list maps and enable Export."}),o.jsx("div",{className:"border-t border-border"}),o.jsxs("button",{className:"w-full text-left p-2 hover:bg-gray-100 dark:hover:bg-neutral-800 text-xs flex items-center gap-2",onClick:()=>{cn(!1),Ya()},children:[o.jsx(Lo,{className:"w-3 h-3"}),o.jsx("span",{children:"Create new map"})]})]})})}),document.body)]}),o.jsx(Q,{content:ps?"Save changes":"All changes saved",children:o.jsx(I,{onClick:Rn,className:`w-7 h-7 p-0 shadow-sm transition-colors ${La?"bg-blue-500 hover:bg-blue-600":ps?"bg-orange-500 hover:bg-orange-600 text-white":"bg-green-500 hover:bg-green-600 text-white"}`,disabled:La||gs,size:"sm",children:La?o.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}):o.jsx(Yh,{className:"w-3 h-3"})})}),o.jsx(Q,{content:"Map Settings",children:o.jsx(I,{onClick:()=>Ze(!0),className:"w-7 h-7 p-0 shadow-sm",variant:"outline",size:"sm",children:o.jsx(Xh,{className:"w-3 h-3"})})})]})]})]}),ir&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-background border border-border rounded-lg p-6 w-96",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsx("h3",{className:"text-lg font-semibold",children:"Settings"}),o.jsx(I,{variant:"ghost",size:"sm",onClick:()=>Ze(!1),className:"w-8 h-8 p-0",children:o.jsx(Ue,{className:"w-4 h-4"})})]}),o.jsxs("div",{className:"flex border-b mb-4",children:[o.jsx("button",{className:`flex-1 py-2 text-sm font-medium border-b-2 transition-colors ${Ka==="map"?"border-orange-500 text-orange-600":"border-transparent text-gray-500"}`,onClick:()=>kd("map"),children:"Current Map Settings"}),o.jsx("button",{className:`flex-1 py-2 text-sm font-medium border-b-2 transition-colors ${Ka==="other"?"border-orange-500 text-orange-600":"border-transparent text-gray-500"}`,onClick:()=>kd("other"),children:"Other Options"})]}),Ka==="map"?o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",children:"Map Name"}),o.jsx(F,{type:"text",value:Me,onChange:d=>xr(d.target.value),placeholder:"Enter map name",className:"w-full"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",children:"Map Width"}),o.jsx(F,{type:"number",value:i,onChange:d=>a(Number(d.target.value)),min:"1",max:"100",className:"w-full"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",children:"Map Height"}),o.jsx(F,{type:"number",value:l,onChange:d=>c(Number(d.target.value)),min:"1",max:"100",className:"w-full"})]}),o.jsxs("div",{className:"flex items-center justify-between rounded-md border border-border px-3 py-2",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("label",{htmlFor:"starting-map-checkbox",className:"text-sm font-medium text-muted-foreground",children:"Starting Map"}),o.jsx(Q,{content:"If this map is the map that players will start the game then mark this option",children:o.jsx(Sl,{className:"h-4 w-4 text-muted-foreground","aria-hidden":!0})})]}),o.jsx("input",{id:"starting-map-checkbox",type:"checkbox",className:"h-4 w-4 rounded border border-border accent-orange-500",checked:fs,onChange:d=>an(d.target.checked),"aria-checked":fs,"aria-label":"Set this map as the starting map"})]}),o.jsxs("div",{className:"flex gap-2 mt-6",children:[o.jsx(I,{variant:"outline",onClick:()=>Ze(!1),className:"flex-1",children:"Cancel"}),o.jsx(I,{onClick:()=>{Zg(),Ze(!1)},className:"flex-1",children:"Apply Changes"})]})]}):o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",children:"Theme (Experimental)"}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-sm",children:"Light Mode"}),o.jsxs("button",{onClick:()=>Cg(!et),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${et?"bg-orange-600":"bg-gray-200"}`,children:[o.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${et?"translate-x-6":"translate-x-1"}`}),o.jsx("span",{className:"sr-only",children:"Toggle dark mode"})]}),o.jsxs("span",{className:"text-sm flex items-center gap-1",children:[et?o.jsx(gw,{className:"w-4 h-4"}):o.jsx(Xw,{className:"w-4 h-4"}),"Dark Mode"]})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",children:"Debug Mode"}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-sm",children:"Disabled"}),o.jsxs("button",{onClick:()=>{n&&n.toggleDebugMode()},className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${n!=null&&n.getDebugMode()?"bg-orange-600":"bg-gray-200"}`,children:[o.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${n!=null&&n.getDebugMode()?"translate-x-6":"translate-x-1"}`}),o.jsx("span",{className:"sr-only",children:"Toggle debug mode"})]}),o.jsxs("span",{className:"text-sm flex items-center gap-1",children:[o.jsx(js,{className:"w-4 h-4"}),"Debug Tiles"]})]}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Shows tile boundaries and coordinates for debugging"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",children:"Auto-Save"}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-sm",children:"Disabled"}),o.jsxs("button",{onClick:()=>{const d=!vr;Mg(d),n&&n.setAutoSaveEnabled(d)},className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${vr?"bg-orange-600":"bg-gray-200"}`,children:[o.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${vr?"translate-x-6":"translate-x-1"}`}),o.jsx("span",{className:"sr-only",children:"Toggle auto-save"})]}),o.jsx("span",{className:"text-sm",children:"Enabled"})]}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Automatically saves your work every 8 seconds"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",children:"Active GID Indicator"}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-sm",children:"Show"}),o.jsxs("button",{onClick:()=>{X(!re)},className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${re?"bg-orange-600":"bg-gray-200"}`,children:[o.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${re?"translate-x-6":"translate-x-1"}`}),o.jsx("span",{className:"sr-only",children:"Toggle Active GID Indicator"})]}),o.jsx("span",{className:"text-sm",children:re?"Shown":"Hidden"})]}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Toggle whether the Active GID badge is visible next to the hover coordinates."})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",children:"Sidebar Collapse Button"}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-sm",children:"Show toggle"}),o.jsxs("button",{onClick:()=>Tg(d=>!d),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${ms?"bg-orange-600":"bg-gray-200"}`,children:[o.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${ms?"translate-x-6":"translate-x-1"}`}),o.jsx("span",{className:"sr-only",children:"Toggle sidebar collapse button"})]}),o.jsx("span",{className:"text-sm",children:ms?"Shown":"Hidden"})]}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Show or hide the left-edge sidebar collapse/expand toggle."})]}),o.jsxs("div",{className:"flex gap-2 mt-6",children:[o.jsx(I,{variant:"outline",onClick:()=>Ze(!1),className:"flex-1",children:"Close"}),o.jsxs(I,{onClick:()=>{zu(!0),Ze(!1)},className:"flex-1 flex items-center justify-center gap-2",children:[o.jsx(Sl,{className:"w-4 h-4"}),o.jsx("span",{children:"Help & Docs"})]})]})]})]})}),Sg&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-background border border-border rounded-lg p-6 w-80",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsx("h3",{className:"text-lg font-semibold",children:"Clear Layer"}),o.jsx(I,{variant:"ghost",size:"sm",onClick:()=>Ai(!1),className:"w-8 h-8 p-0",children:o.jsx(Ue,{className:"w-4 h-4"})})]}),o.jsx("div",{className:"text-sm text-foreground mb-4",children:"Are you sure you want to clear all tiles from the current layer? This action cannot be undone."}),o.jsxs("div",{className:"flex gap-2 justify-end",children:[o.jsx(I,{variant:"outline",onClick:()=>Ai(!1),children:"Cancel"}),o.jsx(I,{onClick:()=>{n&&n.clearLayer(),dr("brush"),Ai(!1)},children:"Clear"})]})]})}),Xt&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-background border border-border rounded-lg p-6 w-80",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsx("h3",{className:"text-lg font-semibold",children:"Confirm"}),o.jsx(I,{variant:"ghost",size:"sm",onClick:()=>gr(null),className:"w-8 h-8 p-0",children:o.jsx(Ue,{className:"w-4 h-4"})})]}),o.jsxs("div",{className:"text-sm text-foreground mb-4",children:[Xt.type==="removeBrush"&&"Are you sure you want to remove this brush?",Xt.type==="removeTileset"&&"Are you sure you want to remove the tileset for this layer? This will clear the tileset but keep any placed tiles.",Xt.type==="removeTab"&&"Are you sure you want to remove this tileset tab?"]}),o.jsxs("div",{className:"flex gap-2 justify-end",children:[o.jsx(I,{variant:"outline",onClick:()=>gr(null),children:"Cancel"}),o.jsx(I,{onClick:()=>{try{if(Xt.type==="removeBrush"){const d=Xt.payload;n&&n.removeBrush(d)}else if(Xt.type==="removeTileset")n&&n.removeLayerTileset();else if(Xt.type==="removeTab"){const d=jg??Ea.current??Xt.payload;if(n&&d&&d.layerType){const k=n.getActiveLayerTabId?n.getActiveLayerTabId(d.layerType):null,C=typeof k=="number"&&k!==null?k:d.tabId;if(console.info("Confirm removeTab: requested=",d,"liveActive=",k,"using=",C),typeof C=="number"){n.removeLayerTab(d.layerType,C),or(M=>M+1);try{n.refreshTilePalette(!0)}catch(M){console.warn("refreshTilePalette failed",M)}try{const M=n.getActiveLayerTabId?n.getActiveLayerTabId(d.layerType):null;if(typeof M=="number"){n.setActiveLayerTab(d.layerType,M),or(_=>_+1);try{n.refreshTilePalette(!0)}catch(_){console.warn("refreshTilePalette failed",_)}}}catch(M){console.warn("Post-remove setActiveLayerTab safeguard failed",M)}}else console.warn("Confirm removeTab: no finalTabId available, aborting",d)}Bu(null),Ea.current=null}}catch(d){console.error("Confirm action failed:",d)}finally{gr(null)}},children:"Confirm"})]})]})}),rg&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-background border border-border rounded-lg p-0 w-[800px] max-h-[80vh] overflow-y-auto help-modal relative",children:[o.jsxs("div",{className:"sticky top-0 z-20 bg-background/95 backdrop-blur-sm border-b border-border py-3 px-4 rounded-t-lg",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("h3",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:"Help & Documentation"}),o.jsx(I,{variant:"ghost",size:"sm",onClick:()=>zu(!1),className:"w-8 h-8 p-0 rounded-full","aria-label":"Close Help",children:o.jsx(Ue,{className:"w-4 h-4"})})]}),o.jsxs("div",{className:"flex space-x-1 mt-3 bg-gray-100 dark:bg-neutral-800 rounded-lg p-1",children:[o.jsxs("button",{onClick:()=>Au("engine"),className:`px-3 py-2 rounded-md text-sm font-medium transition-all ${ki==="engine"?"bg-white dark:bg-neutral-700 text-gray-900 dark:text-gray-100 shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,children:[o.jsx(js,{className:"w-4 h-4 inline mr-2"}),"Engine"]}),o.jsxs("button",{onClick:()=>Au("collisions"),className:`px-3 py-2 rounded-md text-sm font-medium transition-all ${ki==="collisions"?"bg-white dark:bg-neutral-700 text-gray-900 dark:text-gray-100 shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,children:[o.jsx(Tl,{className:"w-4 h-4 inline mr-2"}),"Collisions"]})]})]}),o.jsxs("div",{className:"p-6 space-y-6",children:[ki==="engine"&&o.jsxs(o.Fragment,{children:[o.jsxs("section",{children:[o.jsxs("h4",{className:"text-xl font-semibold mb-3 flex items-center gap-2 text-gray-800 dark:text-gray-100",children:[o.jsx(js,{className:"w-5 h-5 text-orange-500"}),"Getting Started"]}),o.jsxs("div",{className:"space-y-2 text-gray-700 dark:text-gray-400",children:[o.jsx("p",{children:"Welcome to the Isometric Tile Map Editor! This tool allows you to create beautiful isometric tile-based maps."}),o.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4 text-gray-700 dark:text-gray-400",children:[o.jsx("li",{children:"Start by creating a new map or loading an existing one"}),o.jsx("li",{children:"Import tilesets to begin designing"}),o.jsx("li",{children:"Use layers to organize different elements of your map"}),o.jsx("li",{children:"Export your finished map for use in your projects"})]})]})]}),o.jsxs("section",{children:[o.jsxs("h4",{className:"text-xl font-semibold mb-3 flex items-center gap-2 text-gray-800 dark:text-gray-100",children:[o.jsx(Nl,{className:"w-5 h-5 text-orange-500"}),"Map Management"]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("p",{className:"text-gray-700 dark:text-gray-400",children:"Layers help organize your map content. Each layer can have its own tileset and transparency."}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx(Yh,{className:"w-4 h-4 mt-1 text-orange-500"}),o.jsxs("div",{children:[o.jsx("h5",{className:"font-medium text-gray-800 dark:text-gray-100",children:"Save/Export"}),o.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Save your map as JSON or export as PNG image"})]})]}),o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx(mo,{className:"w-4 h-4 mt-1 text-orange-500"}),o.jsxs("div",{children:[o.jsx("h5",{className:"font-medium text-gray-800 dark:text-gray-100",children:"Load Map"}),o.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Load previously saved JSON map files"})]})]}),o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx(Xh,{className:"w-4 h-4 mt-1 text-orange-500"}),o.jsxs("div",{children:[o.jsx("h5",{className:"font-medium text-gray-800 dark:text-gray-100",children:"Map Settings"}),o.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Configure map dimensions, tile size, and other properties"})]})]}),o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx($h,{className:"w-4 h-4 mt-1 text-orange-500"}),o.jsxs("div",{children:[o.jsx("h5",{className:"font-medium text-gray-800 dark:text-gray-100",children:"Lock/Unlock"}),o.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Prevent accidental edits to completed layers"})]})]})]})]})]}),o.jsxs("section",{children:[o.jsxs("h4",{className:"text-xl font-semibold mb-3 flex items-center gap-2 text-gray-800 dark:text-gray-100",children:[o.jsx(fo,{className:"w-5 h-5 text-orange-500"}),"Drawing Tools"]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx(fo,{className:"w-4 h-4 mt-1 text-orange-500"}),o.jsxs("div",{children:[o.jsx("h5",{className:"font-medium text-gray-800 dark:text-gray-100",children:"Brush Tool"}),o.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Paint individual tiles by clicking"})]})]}),o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx(Cl,{className:"w-4 h-4 mt-1 text-orange-500"}),o.jsxs("div",{children:[o.jsx("h5",{className:"font-medium text-gray-800 dark:text-gray-100",children:"Bucket Fill"}),o.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Fill connected areas with the same tile"})]})]}),o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx(jl,{className:"w-4 h-4 mt-1 text-orange-500"}),o.jsxs("div",{children:[o.jsx("h5",{className:"font-medium text-gray-800 dark:text-gray-100",children:"Eraser"}),o.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Remove tiles from the map"})]})]}),o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx(Bh,{className:"w-4 h-4 mt-1 text-orange-500"}),o.jsxs("div",{children:[o.jsx("h5",{className:"font-medium text-gray-800 dark:text-gray-100",children:"Eyedropper"}),o.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Select a tile from the map to use as brush"})]})]})]})]}),o.jsxs("section",{children:[o.jsxs("h4",{className:"text-xl font-semibold mb-3 flex items-center gap-2 text-gray-800 dark:text-gray-100",children:[o.jsx(Hn,{className:"w-5 h-5 text-orange-500"}),"Tileset Management"]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("p",{className:"text-gray-700 dark:text-gray-400",children:"Each layer can have its own tileset. Import PNG images to use as tilesets."}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx(mo,{className:"w-4 h-4 mt-1 text-orange-500"}),o.jsxs("div",{children:[o.jsx("h5",{className:"font-medium text-gray-800 dark:text-gray-100",children:"Import Tileset"}),o.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Click the upload button for each layer to import a tileset image"})]})]}),o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx(Ue,{className:"w-4 h-4 mt-1 text-orange-500"}),o.jsxs("div",{children:[o.jsx("h5",{className:"font-medium text-gray-800 dark:text-gray-100",children:"Remove Tileset"}),o.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Use the red X button to remove a tileset from a layer"})]})]})]})]})]}),o.jsxs("section",{children:[o.jsxs("h4",{className:"text-xl font-semibold mb-3 flex items-center gap-2",children:[o.jsx(js,{className:"w-5 h-5 text-orange-500"}),"Keyboard Shortcuts"]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 bg-gray-50 dark:bg-neutral-900 p-4 rounded-lg",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"font-mono text-sm bg-gray-200 dark:bg-neutral-800 px-2 py-1 rounded",children:"Ctrl+Z"}),o.jsx("span",{className:"text-sm text-gray-400",children:"Undo"})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"font-mono text-sm bg-gray-200 dark:bg-neutral-800 px-2 py-1 rounded",children:"Ctrl+Y"}),o.jsx("span",{className:"text-sm text-gray-400",children:"Redo"})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"font-mono text-sm bg-gray-200 dark:bg-neutral-800 px-2 py-1 rounded",children:"Ctrl+S"}),o.jsx("span",{className:"text-sm text-gray-400",children:"Save Map"})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"font-mono text-sm bg-gray-200 dark:bg-neutral-800 px-2 py-1 rounded",children:"Mouse Wheel"}),o.jsx("span",{className:"text-sm text-gray-400",children:"Zoom"})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"font-mono text-sm bg-gray-200 dark:bg-neutral-800 px-2 py-1 rounded",children:"Middle Click + Drag"}),o.jsx("span",{className:"text-sm text-gray-400",children:"Pan"})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"font-mono text-sm bg-gray-200 dark:bg-neutral-800 px-2 py-1 rounded",children:"Hover + Wheel"}),o.jsx("span",{className:"text-sm text-gray-400",children:"Layer Transparency"})]})]})]})]}),o.jsxs("section",{children:[o.jsxs("h4",{className:"text-xl font-semibold mb-3 flex items-center gap-2",children:[o.jsx(Ml,{className:"w-5 h-5 text-orange-500"}),"Tips & Best Practices"]}),o.jsx("div",{className:"space-y-2 text-gray-700 dark:text-gray-400",children:o.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4 text-gray-700 dark:text-gray-400",children:[o.jsx("li",{children:"Use separate layers for different map elements (background, objects, decorations)"}),o.jsx("li",{children:"Name your layers descriptively for better organization"}),o.jsx("li",{children:"Lock completed layers to prevent accidental changes"}),o.jsx("li",{children:"Adjust layer transparency to see underlying elements while editing"}),o.jsx("li",{children:"Use the eyedropper tool to quickly select tiles from existing map areas"}),o.jsx("li",{children:"Save frequently to avoid losing work"}),o.jsx("li",{children:"Test your map export to ensure it looks correct in your target application"})]})})]})]}),ki==="collisions"&&o.jsx(o.Fragment,{children:o.jsxs("section",{children:[o.jsxs("h4",{className:"text-xl font-semibold mb-3 flex items-center gap-2 text-gray-800 dark:text-gray-100",children:[o.jsx(Tl,{className:"w-5 h-5 text-orange-500"}),"Summary of Collision Values for Flare"]}),o.jsxs("div",{className:"space-y-4",children:[o.jsx("p",{className:"text-gray-700 dark:text-gray-400",children:"Collision values in Flare Engine determine how entities interact with map tiles. Each value has specific behavior that affects movement and visibility."}),o.jsx("div",{className:"overflow-x-auto",children:o.jsxs("table",{className:"w-full border-collapse border border-gray-300 dark:border-gray-600",children:[o.jsx("thead",{className:"bg-gray-100 dark:bg-gray-800",children:o.jsxs("tr",{children:[o.jsx("th",{className:"border border-gray-300 dark:border-gray-600 px-4 py-2 text-left font-semibold text-gray-800 dark:text-gray-100",children:"Value"}),o.jsx("th",{className:"border border-gray-300 dark:border-gray-600 px-4 py-2 text-left font-semibold text-gray-800 dark:text-gray-100",children:"Type"}),o.jsx("th",{className:"border border-gray-300 dark:border-gray-600 px-4 py-2 text-left font-semibold text-gray-800 dark:text-gray-100",children:"Behavior"})]})}),o.jsxs("tbody",{className:"text-gray-700 dark:text-gray-300",children:[o.jsxs("tr",{children:[o.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-4 py-2 font-mono bg-red-50 dark:bg-red-900/20",children:"1"}),o.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-4 py-2 font-medium text-red-600 dark:text-red-400",children:"Red Block"}),o.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-4 py-2",children:"Impassable wall, visible on minimap"})]}),o.jsxs("tr",{children:[o.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-4 py-2 font-mono bg-red-50 dark:bg-red-900/20",children:"2"}),o.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-4 py-2 font-medium text-red-600 dark:text-red-400",children:"Dithered Red"}),o.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-4 py-2",children:"Still blocks entities, minimap shows dithered tile"})]}),o.jsxs("tr",{children:[o.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-4 py-2 font-mono bg-blue-50 dark:bg-blue-900/20",children:"3"}),o.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-4 py-2 font-medium text-blue-600 dark:text-blue-400",children:"Pit (Blue)"}),o.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-4 py-2",children:"Ground entities blocked; air can pass"})]}),o.jsxs("tr",{children:[o.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-4 py-2 font-mono bg-blue-50 dark:bg-blue-900/20",children:"4"}),o.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-4 py-2 font-medium text-blue-600 dark:text-blue-400",children:"Dithered Pit"}),o.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-4 py-2",children:"Same as 3, but minimap shows dithered"})]})]})]})}),o.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800",children:[o.jsxs("h5",{className:"font-medium text-blue-800 dark:text-blue-200 mb-2 flex items-center gap-2",children:[o.jsx(Tl,{className:"w-4 h-4"}),"Usage Guidelines"]}),o.jsxs("ul",{className:"text-blue-700 dark:text-blue-300 text-sm space-y-1 list-disc list-inside",children:[o.jsxs("li",{children:[o.jsx("strong",{children:"Value 1 (Red Block):"})," Use for walls, buildings, and solid obstacles that should be clearly visible on the minimap"]}),o.jsxs("li",{children:[o.jsx("strong",{children:"Value 2 (Dithered Red):"})," Use for partial barriers or decorative walls that still block movement"]}),o.jsxs("li",{children:[o.jsx("strong",{children:"Value 3 (Pit):"})," Use for water, lava, or ground hazards that flying entities can cross"]}),o.jsxs("li",{children:[o.jsx("strong",{children:"Value 4 (Dithered Pit):"})," Use for shallow water or transitional pit areas"]})]})]}),o.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 p-4 rounded-lg border border-amber-200 dark:border-amber-800",children:[o.jsx("h5",{className:"font-medium text-amber-800 dark:text-amber-200 mb-2",children:"⚠️ Important Notes"}),o.jsxs("ul",{className:"text-amber-700 dark:text-amber-300 text-sm space-y-1 list-disc list-inside",children:[o.jsxs("li",{children:["Collision values are set in the ",o.jsx("strong",{children:"Collision Layer"})," of your map"]}),o.jsx("li",{children:"Each tile position can only have one collision value"}),o.jsx("li",{children:"Collision affects AI pathfinding and player movement"}),o.jsx("li",{children:"Minimap visualization helps players understand map layout"})]})]})]})]})}),o.jsx("div",{className:"pt-4 border-t border-gray-200 text-center",children:o.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Flare Studio | GUI for Flare Engine by ism."})})]})]})}),o.jsxs("section",{className:"flex-1 min-w-0 flex flex-col relative",children:[o.jsx("div",{ref:ka,className:"absolute top-2 right-2 z-10",onMouseEnter:lg,onMouseLeave:cg,onFocus:ug,onBlur:dg,tabIndex:Si?-1:0,"aria-label":"Map controls",children:o.jsxs("div",{className:`flex items-center bg-white/90 dark:bg-neutral-900/90 border border-border rounded-full shadow-lg transition-all duration-300 ease-in-out ${Si?"px-2 py-1":"px-1 py-1"}`,children:[o.jsxs("div",{className:`flex items-center gap-1 overflow-hidden transition-all duration-300 ease-out ${Si?"opacity-100 scale-100 max-w-[420px]":"opacity-0 scale-95 max-w-0 pointer-events-none"}`,children:[o.jsx(Q,{content:"Undo (Ctrl+Z)",side:"bottom",children:o.jsx(I,{size:"sm",variant:"outline",className:"w-8 h-8 p-0 rounded-full",onClick:Xa,children:o.jsx(Zw,{className:"w-4 h-4"})})}),o.jsx(Q,{content:"Redo (Ctrl+Y)",side:"bottom",children:o.jsx(I,{size:"sm",variant:"outline",className:"w-8 h-8 p-0 rounded-full",onClick:Ua,children:o.jsx(Pw,{className:"w-4 h-4"})})}),o.jsx(Q,{content:"Zoom In",side:"bottom",children:o.jsx(I,{size:"sm",variant:"outline",className:"w-8 h-8 p-0 rounded-full",onClick:Jg,children:o.jsx(i1,{className:"w-4 h-4"})})}),o.jsx(Q,{content:"Zoom Out",side:"bottom",children:o.jsx(I,{size:"sm",variant:"outline",className:"w-8 h-8 p-0 rounded-full",onClick:ex,children:o.jsx(a1,{className:"w-4 h-4"})})}),o.jsx(Q,{content:"Reset View",side:"bottom",children:o.jsx(I,{size:"sm",variant:"outline",className:"w-8 h-8 p-0 rounded-full",onClick:tx,children:o.jsx(_w,{className:"w-4 h-4"})})}),o.jsx(Q,{content:"Toggle Minimap",side:"bottom",children:o.jsx(I,{size:"sm",variant:"outline",className:"w-8 h-8 p-0 rounded-full",onClick:ux,children:o.jsx(Nl,{className:"w-4 h-4"})})})]}),o.jsx("div",{className:`flex items-center justify-center w-8 h-8 transition-all duration-300 ease-out ${Si?"opacity-50 scale-90":"opacity-100 scale-100"}`,"aria-hidden":!0,children:o.jsx(Wh,{className:"w-4 h-4 text-muted-foreground"})})]})}),o.jsxs("div",{className:"bg-gray-100 flex-1 min-h-0 flex items-center justify-center overflow-hidden relative",children:[o.jsxs("div",{className:`absolute top-4 left-4 z-20 p-3 bg-white/90 dark:bg-neutral-900/90 backdrop-blur-sm rounded-lg border border-border shadow-lg transition-opacity duration-300 ${Du?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"}`,"aria-hidden":!Du,children:[o.jsx(I,{variant:"ghost",size:"sm",className:"absolute top-1 right-1 w-6 h-6 p-0",onClick:()=>ig(!1),children:o.jsx(Ue,{className:"w-3 h-3"})}),o.jsxs("div",{className:"space-y-2 pr-6",children:[o.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-700 dark:text-gray-300",children:[o.jsx(yw,{className:"w-4 h-4"}),o.jsx("span",{children:"Left Click to Paint"})]}),o.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-700 dark:text-gray-300",children:[o.jsx(ho,{className:"w-4 h-4"}),o.jsx("span",{children:"Right Click to Delete"})]}),o.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-700 dark:text-gray-300",children:[o.jsx(Sw,{className:"w-4 h-4"}),o.jsx("span",{children:"Spacebar + Mouse to Pan"})]}),o.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-700 dark:text-gray-300",children:[o.jsxs("div",{className:"relative",children:[o.jsx(ho,{className:"w-4 h-4"}),o.jsx(Rr,{className:"w-2 h-2 absolute top-1 left-1.5 opacity-60"})]}),o.jsx("span",{children:"Mouse Wheel to Zoom In-Out"})]})]})]}),o.jsx("canvas",{ref:r,id:"mapCanvas",className:`tile-canvas w-full h-full max-w-full max-h-full canvas-fade ${Qe?"during-sidebar-transition":""}`}),o.jsx("div",{className:`absolute inset-0 flex items-center justify-center transition-opacity duration-200 ${u?"opacity-0 pointer-events-none":"opacity-100 pointer-events-auto bg-background/80 backdrop-blur-sm"}`,"aria-hidden":u,children:o.jsxs("div",{className:`flex items-center gap-3 px-4 py-2 rounded-full border-2 border-orange-500/80 bg-background/95 shadow-lg backdrop-blur-sm transition-opacity duration-200 ${u?"opacity-0":"opacity-100"}`,children:[o.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Create a map"}),o.jsx(I,{size:"sm",variant:"default",className:"w-9 h-9 p-0 rounded-full bg-orange-500 text-white shadow-sm transition-all duration-150 hover:bg-orange-600 hover:shadow-md hover:-translate-y-0.5 focus-visible:ring-2 focus-visible:ring-orange-500 focus-visible:ring-offset-2",onClick:Ya,disabled:gs,children:o.jsx(Lo,{className:"w-4 h-4"})})]})}),o.jsxs("div",{className:`absolute bottom-4 left-4 z-10 p-2 rounded-md text-xs font-mono flex items-center gap-2 transition-opacity duration-200 ${ct?"opacity-100 pointer-events-auto bg-white/90 dark:bg-neutral-900/90 border border-gray-200 dark:border-neutral-600 text-gray-800 dark:text-white shadow-sm":"opacity-0 pointer-events-none"}`,"aria-hidden":!ct,children:[o.jsx(Fh,{className:"w-4 h-4 text-gray-500 dark:text-gray-400"}),o.jsx("span",{children:ct?`${ct.x}, ${ct.y}`:""}),o.jsx("div",{className:`ml-2 transition-opacity duration-200 ${ct&&re?"opacity-100":"opacity-0 pointer-events-none"}`,children:o.jsx(Q,{content:"Active GID number of selected tilebrush",children:o.jsx(M0,{variant:"secondary",className:"text-xs px-2 py-1 bg-black/80 text-white border-gray-600 hover:bg-black/90",children:o.jsx("span",{id:"activeGid",children:$})})})})]}),o.jsxs("div",{className:`absolute bottom-4 left-32 z-10 p-2 rounded-md text-xs flex items-center gap-3 transition-opacity duration-200 ${Da?"opacity-100 pointer-events-auto bg-orange-600/90 border border-orange-500 text-white":"opacity-0 pointer-events-none"}`,children:[o.jsxs("div",{className:"flex items-center gap-2 font-mono",children:[o.jsx(Hn,{className:"w-4 h-4 text-orange-200"}),o.jsx("span",{children:Da?`${zg} tiles selected`:""})]}),o.jsxs("div",{className:`flex items-center gap-1 ${Da?"":"pointer-events-none"}`,children:[o.jsx(Q,{content:"Fill selection with active tile",children:o.jsx(I,{size:"sm",variant:"ghost",className:"h-6 px-2 text-xs text-white hover:bg-orange-500/50",onClick:px,children:"Fill"})}),o.jsx(Q,{content:"Delete selected tiles (DEL)",children:o.jsx(I,{size:"sm",variant:"ghost",className:"h-6 px-2 text-xs text-white hover:bg-orange-500/50",onClick:xx,children:"Delete"})}),o.jsx(Q,{content:"Clear selection (ESC)",children:o.jsx(I,{size:"sm",variant:"ghost",className:"h-6 px-2 text-xs text-white hover:bg-orange-500/50",onClick:gx,children:"Clear"})})]})]}),o.jsx("div",{ref:xg,className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 z-30",onMouseEnter:hg,onMouseLeave:fg,onFocus:mg,onBlur:pg,tabIndex:Ln?-1:0,"aria-label":"Tool selection",children:o.jsxs("div",{className:`flex items-center bg-white/90 dark:bg-neutral-900/90 border border-border rounded-full shadow-md transition-all duration-300 ease-in-out ${Ln?"gap-1 px-2 py-1":"gap-0 px-1 py-1"}`,children:[o.jsxs("div",{className:`relative flex-shrink-0 transition-all duration-300 ease-out ${Ln||Ne==="brush"?"opacity-100 scale-100 max-w-[3rem] w-auto":"opacity-0 scale-90 max-w-0 w-0 pointer-events-none"}`,children:[o.jsx(I,{variant:Ne==="brush"?"default":"ghost",size:"sm",className:"w-7 h-7 p-1 rounded-full tool-button",onClick:()=>_n("brush"),onMouseEnter:d=>{od(),We("Brush Tool",d.currentTarget)},onMouseLeave:()=>{ad(),tt()},children:Rg()}),vg&&o.jsxs("div",{className:"absolute bottom-full left-0 mb-1 bg-white dark:bg-neutral-900 border border-border rounded shadow-lg p-1 flex gap-1 min-w-max z-50",onMouseEnter:od,onMouseLeave:ad,children:[o.jsx(I,{variant:In==="brush"?"default":"ghost",size:"sm",className:"w-6 h-6 p-1 rounded-full sub-tool-button",onClick:()=>dr("brush"),onMouseEnter:d=>We("Brush Tool",d.currentTarget),onMouseLeave:tt,children:o.jsx(fo,{className:"w-3 h-3"})}),o.jsx(I,{variant:In==="bucket"?"default":"ghost",size:"sm",className:"w-6 h-6 p-1 rounded-full sub-tool-button",onClick:()=>dr("bucket"),onMouseEnter:d=>We("Bucket Fill",d.currentTarget),onMouseLeave:tt,children:o.jsx(Cl,{className:"w-3 h-3"})}),o.jsx(I,{variant:In==="eraser"?"default":"ghost",size:"sm",className:"w-6 h-6 p-1 rounded-full sub-tool-button",onClick:()=>dr("eraser"),onMouseEnter:d=>We("Eraser",d.currentTarget),onMouseLeave:tt,children:o.jsx(jl,{className:"w-3 h-3"})}),o.jsx(I,{variant:In==="clear"?"default":"ghost",size:"sm",className:"w-6 h-6 p-1 rounded-full sub-tool-button border-red-500 hover:border-red-600 hover:bg-red-50",onClick:()=>Ai(!0),onMouseEnter:d=>We("Clear Layer",d.currentTarget),onMouseLeave:tt,children:o.jsx(Ue,{className:"w-3 h-3 text-red-500"})})]})]}),o.jsxs("div",{className:`relative flex-shrink-0 transition-all duration-300 ease-out ${Ln||Ne==="selection"?"opacity-100 scale-100 max-w-[3rem] w-auto":"opacity-0 scale-90 max-w-0 w-0 pointer-events-none"}`,children:[o.jsx(I,{variant:Ne==="selection"?"default":"ghost",size:"sm",className:"w-7 h-7 p-1 rounded-full tool-button",onClick:()=>_n("selection"),onMouseEnter:d=>{ld(),We("Selection Tool",d.currentTarget)},onMouseLeave:()=>{cd(),tt()},children:Og()}),wg&&o.jsxs("div",{className:"absolute bottom-full left-0 mb-1 bg-white dark:bg-neutral-900 border border-border rounded shadow-lg p-1 flex gap-1 min-w-max z-50",onMouseEnter:ld,onMouseLeave:cd,children:[o.jsx(I,{variant:zn==="rectangular"?"default":"ghost",size:"sm",className:"w-6 h-6 p-1 rounded-full sub-tool-button",onClick:()=>_i("rectangular"),onMouseEnter:d=>We("Rectangular Selection",d.currentTarget),onMouseLeave:tt,children:o.jsx(Hn,{className:"w-3 h-3"})}),o.jsx(I,{variant:zn==="magic-wand"?"default":"ghost",size:"sm",className:"w-6 h-6 p-1 rounded-full sub-tool-button",onClick:()=>_i("magic-wand"),onMouseEnter:d=>We("Magic Wand",d.currentTarget),onMouseLeave:tt,children:o.jsx(Ml,{className:"w-3 h-3"})}),o.jsx(I,{variant:zn==="same-tile"?"default":"ghost",size:"sm",className:"w-6 h-6 p-1 rounded-full sub-tool-button",onClick:()=>_i("same-tile"),onMouseEnter:d=>We("Select Same Tile",d.currentTarget),onMouseLeave:tt,children:o.jsx(js,{className:"w-3 h-3"})}),o.jsx(I,{variant:zn==="circular"?"default":"ghost",size:"sm",className:"w-6 h-6 p-1 rounded-full sub-tool-button",onClick:()=>_i("circular"),onMouseEnter:d=>We("Circular Select",d.currentTarget),onMouseLeave:tt,children:o.jsx(Rr,{className:"w-3 h-3"})})]})]}),o.jsxs("div",{className:`relative flex-shrink-0 transition-all duration-300 ease-out ${Ln||Ne==="shape"?"opacity-100 scale-100 max-w-[3rem] w-auto":"opacity-0 scale-90 max-w-0 w-0 pointer-events-none"}`,children:[o.jsx(I,{variant:Ne==="shape"?"default":"ghost",size:"sm",className:"w-7 h-7 p-1 rounded-full tool-button",onClick:()=>_n("shape"),onMouseEnter:d=>{ud(),We("Shape Tool",d.currentTarget)},onMouseLeave:()=>{dd(),tt()},children:$g()}),bg&&o.jsxs("div",{className:"absolute bottom-full left-0 mb-1 bg-white dark:bg-neutral-900 border border-border rounded shadow-lg p-1 flex gap-1 min-w-max z-50",onMouseEnter:ud,onMouseLeave:dd,children:[o.jsx(Q,{content:"Rectangle Shape",children:o.jsx(I,{variant:ds==="rectangle"?"default":"ghost",size:"sm",className:"w-6 h-6 p-1 rounded-full sub-tool-button",onClick:()=>ja("rectangle"),children:o.jsx(Hn,{className:"w-3 h-3"})})}),o.jsx(Q,{content:"Circle Shape",children:o.jsx(I,{variant:ds==="circle"?"default":"ghost",size:"sm",className:"w-6 h-6 p-1 rounded-full sub-tool-button",onClick:()=>ja("circle"),children:o.jsx(Rr,{className:"w-3 h-3"})})}),o.jsx(Q,{content:"Line Shape",children:o.jsx(I,{variant:ds==="line"?"default":"ghost",size:"sm",className:"w-6 h-6 p-1 rounded-full sub-tool-button",onClick:()=>ja("line"),children:o.jsx(Hh,{className:"w-3 h-3"})})})]})]}),o.jsxs("div",{className:`relative flex-shrink-0 transition-all duration-300 ease-out ${Ln||Ne==="stamp"?"opacity-100 scale-100 max-w-[3rem] w-auto":"opacity-0 scale-90 max-w-0 w-0 pointer-events-none"}`,children:[o.jsx(I,{variant:Ne==="stamp"?"default":"ghost",size:"sm",className:"w-7 h-7 p-1 rounded-full tool-button",onClick:()=>_n("stamp"),onMouseEnter:d=>We("Stamp Tool - Group tiles into a stamp and place them together",d.currentTarget),onMouseLeave:tt,children:o.jsx(Yw,{className:"w-3 h-3"})}),Ne==="stamp"&&o.jsx("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-md shadow-lg p-2 min-w-[200px] z-10",children:o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsxs("div",{className:"flex gap-1",children:[o.jsx(Q,{content:"Select and place existing stamps",children:o.jsx(I,{variant:hs==="select"?"default":"ghost",size:"sm",className:"flex-1 text-xs",onClick:()=>mr("select"),children:"Select"})}),o.jsx(Q,{content:"Create stamp from selection",children:o.jsx(I,{variant:hs==="create"?"default":"ghost",size:"sm",className:"flex-1 text-xs",onClick:()=>mr("create"),children:"Create"})})]}),hs==="create"&&o.jsxs("div",{className:"border-t pt-2",children:[o.jsx("div",{className:"text-xs font-medium mb-1",children:"Create New Stamp"}),o.jsxs("div",{className:"flex gap-1",children:[o.jsx("input",{type:"text",placeholder:"Stamp name",value:pr,onChange:d=>Hu(d.target.value),className:"flex-1 text-xs px-2 py-1 border rounded",onKeyDown:d=>{d.key==="Enter"&&hd()}}),o.jsx(I,{size:"sm",className:"text-xs",onClick:hd,disabled:!pr.trim(),children:"Create"})]}),o.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"First select tiles, then create stamp"})]}),hs==="select"&&o.jsxs("div",{className:"border-t pt-2 max-h-32 overflow-y-auto",children:[o.jsx("div",{className:"text-xs font-medium mb-1",children:"Available Stamps"}),Fu.length===0?o.jsx("div",{className:"text-xs text-gray-500",children:"No stamps created yet"}):o.jsx("div",{className:"flex flex-col gap-1",children:Fu.map(d=>o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx(Q,{content:`${d.name} (${d.width}x${d.height})`,children:o.jsx(I,{variant:fr===d.id?"default":"ghost",size:"sm",className:"flex-1 text-xs justify-start",onClick:()=>Ag(d.id),children:d.name})}),o.jsx(Q,{content:"Delete stamp",children:o.jsx(I,{variant:"ghost",size:"sm",className:"w-6 h-6 p-0 text-red-500",onClick:()=>Dg(d.id),children:o.jsx(Ue,{className:"w-3 h-3"})})})]},d.id))})]})]})})]}),o.jsx("div",{className:`flex-shrink-0 transition-all duration-300 ease-out ${Ln||Ne==="eyedropper"?"opacity-100 scale-100 max-w-[3rem] w-auto":"opacity-0 scale-90 max-w-0 w-0 pointer-events-none"}`,children:o.jsx(I,{variant:Ne==="eyedropper"?"default":"ghost",size:"sm",className:"w-7 h-7 p-1 rounded-full tool-button",onClick:()=>_n("eyedropper"),onMouseEnter:d=>We("Eyedropper Tool - Pick a tile from the map to reuse",d.currentTarget),onMouseLeave:tt,children:o.jsx(Bh,{className:"w-3 h-3"})})})]})})]})]})]}),o.jsx(rb,{}),o.jsx(Cs,{open:kg,onOpenChange:hr,children:o.jsxs(Ts,{children:[o.jsxs(Ms,{children:[o.jsx(Es,{children:"Separate Brush"}),o.jsx(Ps,{children:"Are you sure you want to separate this brush?"})]}),o.jsxs(Dr,{children:[o.jsx(I,{variant:"outline",onClick:()=>hr(!1),children:"Cancel"}),o.jsx(I,{onClick:Fg,children:"Separate"})]})]})}),o.jsx(Cs,{open:le!==null,onOpenChange:d=>d?void 0:Wi(),children:o.jsxs(Ts,{className:"max-w-md",children:[o.jsxs(Ms,{children:[o.jsx(Es,{children:(le==null?void 0:le.type)==="npc"?"Add NPC":"Add Enemy"}),o.jsxs(Ps,{children:["Define the placement details for this ",(le==null?void 0:le.type)==="npc"?"NPC":"enemy","."]})]}),le&&o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Name"}),o.jsx(F,{value:le.name,onChange:d=>bs("name",d.target.value),placeholder:le.type==="npc"?"Village Elder":"Goblin Scout"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"X Position"}),o.jsx(F,{type:"number",value:le.x,onChange:d=>bs("x",d.target.value),min:0,max:(n==null?void 0:n.getMapWidth())??void 0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Y Position"}),o.jsx(F,{type:"number",value:le.y,onChange:d=>bs("y",d.target.value),min:0,max:(n==null?void 0:n.getMapHeight())??void 0})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tileset Location"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(F,{className:"flex-1",value:le.tilesetPath,onChange:d=>bs("tilesetPath",d.target.value),placeholder:"Desktop/mytilesets/npcs/mynpc.png",readOnly:us,onClick:us?()=>{xd()}:void 0}),o.jsx(I,{type:"button",variant:"outline",size:"sm",onClick:()=>{xd()},disabled:!us,children:"Browse"})]})]}),td&&o.jsx("div",{className:"text-sm text-red-500",children:td})]}),o.jsxs(Dr,{children:[o.jsx(I,{variant:"outline",onClick:Wi,children:"Cancel"}),o.jsx(I,{onClick:Yg,children:(le==null?void 0:le.type)==="npc"?"Add NPC":"Add Enemy"})]})]})}),o.jsx(Cs,{open:_g,onOpenChange:d=>{d?Ri(!0):yd()},children:o.jsxs(Ts,{className:"max-w-5xl w-full h-[90vh] flex flex-col",children:[o.jsxs(Ms,{children:[o.jsx(Es,{children:K?`Edit ${K.type}`:"Add Object"}),o.jsxs(Ps,{children:["Configure ",(K==null?void 0:K.type)||"object"," properties for Flare engine compatibility."]})]}),ed.length>0&&o.jsxs("div",{className:"mb-3 rounded-md border border-destructive/40 bg-destructive/10 p-3 text-sm text-destructive",children:[o.jsx("p",{className:"font-semibold mb-1",children:"Please fix the following:"}),o.jsx("ul",{className:"ml-4 list-disc space-y-1",children:ed.map((d,k)=>o.jsx("li",{children:d},`${d}-${k}`))})]}),o.jsx("div",{className:"flex-1 overflow-y-auto pr-2 minimal-scroll",children:K&&o.jsxs("div",{className:"space-y-4 pb-4",children:[o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Name"}),o.jsx(F,{value:K.name||"",onChange:d=>Ye({...K,name:d.target.value}),placeholder:"Object name"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Category"}),o.jsx(F,{value:K.category||"",onChange:d=>Ye({...K,category:d.target.value}),placeholder:K.type==="enemy"?"creature":"block"})]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"X Position"}),o.jsx(F,{type:"number",value:K.x,onChange:d=>Ye({...K,x:Number(d.target.value)})})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Y Position"}),o.jsx(F,{type:"number",value:K.y,onChange:d=>Ye({...K,y:Number(d.target.value)})})]})]}),(K.type==="npc"||K.type==="enemy")&&o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tileset Location"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(F,{className:"flex-1",value:H("tilesetPath",""),onChange:d=>R("tilesetPath",d.target.value),placeholder:"Desktop/mytilesets/npcs/mynpc.png",readOnly:us,onClick:us?()=>{vd()}:void 0}),o.jsx(I,{type:"button",variant:"outline",size:"sm",onClick:()=>{vd()},disabled:!us,children:"Browse"})]})]}),K.type==="enemy"&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Level"}),o.jsx(F,{type:"number",value:K.level||1,onChange:d=>Ye({...K,level:Number(d.target.value)}),min:"1"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Number"}),o.jsx(F,{type:"number",value:K.number||1,onChange:d=>Ye({...K,number:Number(d.target.value)}),min:"1"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Wander Radius"}),o.jsx(F,{type:"number",value:K.wander_radius||4,onChange:d=>Ye({...K,wander_radius:Number(d.target.value)}),min:"0"})]}),o.jsxs("div",{className:"space-y-3 border border-border rounded-md p-3 bg-muted/20",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"text-sm font-semibold",children:"Enemy Specifications"}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"Configure Flare StatBlock-compatible values."})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"XP"}),o.jsx(F,{type:"number",value:H("xp",""),onChange:d=>R("xp",d.target.value),min:"0"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"XP Scaling Table"}),o.jsx(F,{value:H("xp_scaling",""),onChange:d=>R("xp_scaling",d.target.value),placeholder:"tables/xp_scaling.txt"})]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Defeat Status"}),o.jsx(F,{value:H("defeat_status",""),onChange:d=>R("defeat_status",d.target.value),placeholder:"campaign_status_id"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Convert Status"}),o.jsx(F,{value:H("convert_status",""),onChange:d=>R("convert_status",d.target.value),placeholder:"campaign_status_id"})]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"First Defeat Loot"}),o.jsx(F,{value:H("first_defeat_loot",""),onChange:d=>R("first_defeat_loot",d.target.value),placeholder:"items/id.txt"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Animations Definition"}),o.jsx(F,{value:H("animations",""),onChange:d=>R("animations",d.target.value),placeholder:"animations/enemies/foo.txt"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Loot Entries (one per line)"}),o.jsx("textarea",{className:"w-full min-h-[80px] text-sm rounded-md border border-border bg-background px-2 py-1",value:H("loot",""),onChange:d=>R("loot",d.target.value),placeholder:"item_id, chance"})]}),(()=>{const d=H("loot_count",""),[k="",C=""]=d.split(",").map(M=>M.trim());return o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Loot Count Min"}),o.jsx(F,{type:"number",value:k,min:"0",onChange:M=>{const _=M.target.value;_?R("loot_count",C?`${_},${C}`:_):R("loot_count","")}})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Loot Count Max"}),o.jsx(F,{type:"number",value:C,min:"0",onChange:M=>{const _=M.target.value;k?R("loot_count",_?`${k},${_}`:k):R("loot_count","")}})]})]})})(),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Threat Range (engage, stop)"}),(()=>{const d=H("threat_range",""),[k="",C=""]=d.split(",").map(M=>M.trim());return o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsx(F,{type:"number",value:k,onChange:M=>{const _=M.target.value;_?R("threat_range",C?`${_},${C}`:_):R("threat_range",C?`0,${C}`:"")}}),o.jsx(F,{type:"number",value:C,onChange:M=>{const _=M.target.value;k?R("threat_range",_?`${k},${_}`:k):R("threat_range","")}})]})})()]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Flee Range"}),o.jsx(F,{type:"number",value:H("flee_range",""),onChange:d=>R("flee_range",d.target.value)})]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Chance Pursue (%)"}),o.jsx(F,{type:"number",value:H("chance_pursue",""),onChange:d=>R("chance_pursue",d.target.value),min:"0",max:"100",step:"0.1"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Chance Flee (%)"}),o.jsx(F,{type:"number",value:H("chance_flee",""),onChange:d=>R("chance_flee",d.target.value),min:"0",max:"100",step:"0.1"})]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Waypoint Pause"}),o.jsx(F,{value:H("waypoint_pause",""),onChange:d=>R("waypoint_pause",d.target.value),placeholder:"250ms"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Turn Delay"}),o.jsx(F,{value:H("turn_delay",""),onChange:d=>R("turn_delay",d.target.value),placeholder:"100ms"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Combat Style"}),o.jsxs("select",{className:"w-full rounded-md border border-border bg-background px-2 py-1 text-sm",value:H("combat_style",""),onChange:d=>R("combat_style",d.target.value),children:[o.jsx("option",{value:"",children:"Default"}),o.jsx("option",{value:"default",children:"default"}),o.jsx("option",{value:"aggressive",children:"aggressive"}),o.jsx("option",{value:"passive",children:"passive"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Triggered Powers (state,power,chance per line)"}),o.jsx("textarea",{className:"w-full min-h-[60px] text-sm rounded-md border border-border bg-background px-2 py-1",value:H("power",""),onChange:d=>R("power",d.target.value),placeholder:"melee,power/melee_slash,25"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Passive Powers (one power id per line)"}),o.jsx("textarea",{className:"w-full min-h-[60px] text-sm rounded-md border border-border bg-background px-2 py-1",value:H("passive_powers",""),onChange:d=>R("passive_powers",d.target.value),placeholder:"power_id"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Quest Loot (one per line: status,not_status,item_id)"}),o.jsx("textarea",{className:"w-full min-h-[60px] text-sm rounded-md border border-border bg-background px-2 py-1",value:H("quest_loot",""),onChange:d=>R("quest_loot",d.target.value),placeholder:"status_required,status_block,item_id"})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Flee Duration"}),o.jsx(F,{value:H("flee_duration",""),onChange:d=>R("flee_duration",d.target.value),placeholder:"1.5s"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Flee Cooldown"}),o.jsx(F,{value:H("flee_cooldown",""),onChange:d=>R("flee_cooldown",d.target.value),placeholder:"5s"})]})]}),o.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{key:"humanoid",label:"Humanoid"},{key:"lifeform",label:"Lifeform"},{key:"flying",label:"Flying"},{key:"intangible",label:"Intangible"},{key:"facing",label:"Facing"},{key:"suppress_hp",label:"Hide HP Bar"}].map(d=>o.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[o.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:H(d.key,"false")==="true",onChange:k=>Ba(d.key,k.target.checked)}),d.label]},d.key))})]})]}),K.type==="npc"&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"space-y-3 border border-border rounded-md p-3 bg-muted/20",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"text-sm font-semibold",children:"Dialog"}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"Configure dialog tree content and metadata."})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Dialog ID"}),o.jsx(F,{value:H("dialog.id",""),onChange:d=>R("dialog.id",d.target.value),placeholder:"villager_intro"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Topic"}),o.jsx(F,{value:H("dialog.topic",""),onChange:d=>R("dialog.topic",d.target.value),placeholder:"Greetings"})]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Group"}),o.jsx(F,{value:H("dialog.group",""),onChange:d=>R("dialog.group",d.target.value),placeholder:"main_story"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Voice File(s)"}),o.jsx("textarea",{className:"w-full min-h-[60px] text-sm rounded-md border border-border bg-background px-2 py-1",value:H("dialog.voice",""),onChange:d=>R("dialog.voice",d.target.value),placeholder:"voice/npcs/intro.ogg"})]})]}),o.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Lines (Him)"}),o.jsx("textarea",{className:"w-full min-h-[80px] text-sm rounded-md border border-border bg-background px-2 py-1",value:H("dialog.him",""),onChange:d=>R("dialog.him",d.target.value),placeholder:"Hello there!"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Lines (Her)"}),o.jsx("textarea",{className:"w-full min-h-[80px] text-sm rounded-md border border-border bg-background px-2 py-1",value:H("dialog.her",""),onChange:d=>R("dialog.her",d.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Lines (You)"}),o.jsx("textarea",{className:"w-full min-h-[80px] text-sm rounded-md border border-border bg-background px-2 py-1",value:H("dialog.you",""),onChange:d=>R("dialog.you",d.target.value),placeholder:"What brings you here?"})]})]}),o.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Portrait (Him)"}),o.jsx("textarea",{className:"w-full min-h-[60px] text-sm rounded-md border border-border bg-background px-2 py-1",value:H("dialog.portrait_him",""),onChange:d=>R("dialog.portrait_him",d.target.value),placeholder:"portraits/npcs/villager.png"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Portrait (Her)"}),o.jsx("textarea",{className:"w-full min-h-[60px] text-sm rounded-md border border-border bg-background px-2 py-1",value:H("dialog.portrait_her",""),onChange:d=>R("dialog.portrait_her",d.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Portrait (You)"}),o.jsx("textarea",{className:"w-full min-h-[60px] text-sm rounded-md border border-border bg-background px-2 py-1",value:H("dialog.portrait_you",""),onChange:d=>R("dialog.portrait_you",d.target.value)})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Response IDs (one per line, must precede dialog text)"}),o.jsx("textarea",{className:"w-full min-h-[60px] text-sm rounded-md border border-border bg-background px-2 py-1",value:H("dialog.response",""),onChange:d=>R("dialog.response",d.target.value)})]}),o.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{key:"dialog.allow_movement",label:"Allow Movement",defaultValue:"false"},{key:"dialog.take_a_party",label:"Take/Release Party",defaultValue:"false"},{key:"dialog.response_only",label:"Response Only",defaultValue:"false"}].map(d=>o.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[o.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:H(d.key,d.defaultValue||"false")==="true",onChange:k=>Ba(d.key,k.target.checked)}),d.label]},d.key))})]}),o.jsxs("div",{className:"space-y-3 border border-border rounded-md p-3 bg-muted/20",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"text-sm font-semibold",children:"NPC Details"}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"Configure appearance, behavior, and requirements."})]}),o.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"NPC Name"}),o.jsx(F,{value:H("npc.name",K.name||""),onChange:d=>R("npc.name",d.target.value),placeholder:"Villager"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Portrait"}),o.jsx(F,{value:H("npc.portrait",""),onChange:d=>R("npc.portrait",d.target.value),placeholder:"portraits/npcs/villager.png"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Definition File"}),o.jsx(F,{value:H("npc.filename",""),onChange:d=>R("npc.filename",d.target.value),placeholder:"npcs/villager.txt"})]})]}),o.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Direction"}),o.jsx(F,{value:H("npc.direction",""),onChange:d=>R("npc.direction",d.target.value),placeholder:"south"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Waypoints (x,y per line)"}),o.jsx("textarea",{className:"w-full min-h-[60px] text-sm rounded-md border border-border bg-background px-2 py-1",value:H("npc.waypoints",""),onChange:d=>R("npc.waypoints",d.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Wander Radius"}),o.jsx(F,{type:"number",value:H("npc.wander_radius",""),onChange:d=>R("npc.wander_radius",d.target.value),min:"0"})]})]}),o.jsx("div",{className:"grid grid-cols-4 gap-3",children:[{key:"npc.show_on_minimap",label:"Show on Minimap",defaultValue:"true"},{key:"npc.talker",label:"Talkable",defaultValue:"true"},{key:"npc.vendor",label:"Vendor",defaultValue:"false"}].map(d=>o.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[o.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:H(d.key,d.defaultValue||"false")==="true",onChange:k=>Ba(d.key,k.target.checked)}),d.label]},d.key))}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Requires Status (one per line)"}),o.jsx("textarea",{className:"w-full min-h-[60px] text-sm rounded-md border border-border bg-background px-2 py-1",value:H("npc.requires_status",""),onChange:d=>R("npc.requires_status",d.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Requires Not Status"}),o.jsx("textarea",{className:"w-full min-h-[60px] text-sm rounded-md border border-border bg-background px-2 py-1",value:H("npc.requires_not_status",""),onChange:d=>R("npc.requires_not_status",d.target.value)})]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Requires Item (one per line)"}),o.jsx("textarea",{className:"w-full min-h-[60px] text-sm rounded-md border border-border bg-background px-2 py-1",value:H("npc.requires_item",""),onChange:d=>R("npc.requires_item",d.target.value),placeholder:"items/potion:2"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Requires Not Item"}),o.jsx("textarea",{className:"w-full min-h-[60px] text-sm rounded-md border border-border bg-background px-2 py-1",value:H("npc.requires_not_item",""),onChange:d=>R("npc.requires_not_item",d.target.value)})]})]}),o.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Requires Level ≥"}),o.jsx(F,{type:"number",value:H("npc.requires_level",""),onChange:d=>R("npc.requires_level",d.target.value),min:"0"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Requires Level <"}),o.jsx(F,{type:"number",value:H("npc.requires_not_level",""),onChange:d=>R("npc.requires_not_level",d.target.value),min:"0"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Requires Class"}),o.jsx(F,{value:H("npc.requires_class",""),onChange:d=>R("npc.requires_class",d.target.value),placeholder:"warrior"})]})]}),o.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Requires Currency ≥"}),o.jsx(F,{type:"number",value:H("npc.requires_currency",""),onChange:d=>R("npc.requires_currency",d.target.value),min:"0"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Requires Currency <"}),o.jsx(F,{type:"number",value:H("npc.requires_not_currency",""),onChange:d=>R("npc.requires_not_currency",d.target.value),min:"0"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Requires Not Class"}),o.jsx(F,{value:H("npc.requires_not_class",""),onChange:d=>R("npc.requires_not_class",d.target.value)})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("h5",{className:"text-sm font-semibold",children:"Vendor Options"}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Vendor Requires Status"}),o.jsx("textarea",{className:"w-full min-h-[60px] text-sm rounded-md border border-border bg-background px-2 py-1",value:H("npc.vendor_requires_status",""),onChange:d=>R("npc.vendor_requires_status",d.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Vendor Requires Not Status"}),o.jsx("textarea",{className:"w-full min-h-[60px] text-sm rounded-md border border-border bg-background px-2 py-1",value:H("npc.vendor_requires_not_status",""),onChange:d=>R("npc.vendor_requires_not_status",d.target.value)})]})]}),o.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Constant Stock (items per line)"}),o.jsx("textarea",{className:"w-full min-h-[80px] text-sm rounded-md border border-border bg-background px-2 py-1",value:H("npc.constant_stock",""),onChange:d=>R("npc.constant_stock",d.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Status Stock (status: items)"}),o.jsx("textarea",{className:"w-full min-h-[80px] text-sm rounded-md border border-border bg-background px-2 py-1",value:H("npc.status_stock",""),onChange:d=>R("npc.status_stock",d.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Random Stock (loot definitions)"}),o.jsx("textarea",{className:"w-full min-h-[80px] text-sm rounded-md border border-border bg-background px-2 py-1",value:H("npc.random_stock",""),onChange:d=>R("npc.random_stock",d.target.value)})]})]}),(()=>{const d=H("npc.random_stock_count",""),[k="",C=""]=d.split(",").map(M=>M.trim());return o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Random Stock Min"}),o.jsx(F,{type:"number",value:k,min:"0",onChange:M=>{const _=M.target.value;_?R("npc.random_stock_count",C?`${_},${C}`:_):R("npc.random_stock_count",C?`0,${C}`:"")}})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Random Stock Max"}),o.jsx(F,{type:"number",value:C,min:"0",onChange:M=>{const _=M.target.value;k?R("npc.random_stock_count",_?`${k},${_}`:k):R("npc.random_stock_count","")}})]})]})})(),o.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Buy Ratio"}),o.jsx(F,{type:"number",value:H("npc.vendor_ratio_buy",""),onChange:d=>R("npc.vendor_ratio_buy",d.target.value),step:"0.01"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Sell Ratio"}),o.jsx(F,{type:"number",value:H("npc.vendor_ratio_sell",""),onChange:d=>R("npc.vendor_ratio_sell",d.target.value),step:"0.01"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Sell Ratio (Old)"}),o.jsx(F,{type:"number",value:H("npc.vendor_ratio_sell_old",""),onChange:d=>R("npc.vendor_ratio_sell_old",d.target.value),step:"0.01"})]})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Vox Intro (one file per line)"}),o.jsx("textarea",{className:"w-full min-h-[60px] text-sm rounded-md border border-border bg-background px-2 py-1",value:H("npc.vox_intro",""),onChange:d=>R("npc.vox_intro",d.target.value)})]})]})]}),K.type==="event"&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Activate"}),o.jsx(F,{value:K.activate||"on_trigger",onChange:d=>Ye({...K,activate:d.target.value}),placeholder:"on_trigger, on_load, etc."})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Hotspot"}),o.jsx(F,{value:K.hotspot||"0,0,1,1",onChange:d=>Ye({...K,hotspot:d.target.value}),placeholder:"x,y,width,height"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tooltip"}),o.jsx(F,{value:K.tooltip||"",onChange:d=>Ye({...K,tooltip:d.target.value}),placeholder:"Hover text"})]})]})]})}),o.jsxs(Dr,{className:"mt-4 flex-shrink-0",children:[o.jsx(I,{variant:"outline",onClick:yd,children:"Cancel"}),o.jsx(I,{onClick:Wg,children:"Save"})]})]})}),o.jsx(Cs,{open:h,onOpenChange:d=>{p(d),d||w(null)},children:o.jsxs(Ts,{className:"max-w-md",children:[o.jsxs(Ms,{children:[o.jsx(Es,{children:"Create Map"}),o.jsx(Ps,{children:"Set the name, dimensions, and starting status for your new map."})]}),o.jsxs("div",{className:"space-y-4 py-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-1",children:"Map Name"}),o.jsx(F,{value:v,onChange:d=>{g(d.target.value),x&&w(null)},onKeyDown:d=>{d.stopPropagation()},placeholder:"Enter map name",autoFocus:!0}),x&&o.jsx("p",{className:"mt-1 text-xs text-red-500",children:x})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-1",children:"Width (tiles)"}),o.jsx(F,{type:"number",min:1,max:100,value:b,onChange:d=>y(Math.max(1,Number.parseInt(d.target.value,10)||0))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-1",children:"Height (tiles)"}),o.jsx(F,{type:"number",min:1,max:100,value:S,onChange:d=>j(Math.max(1,Number.parseInt(d.target.value,10)||0))})]})]}),o.jsxs("div",{className:"flex items-center justify-between rounded-md border border-border px-3 py-2",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("label",{htmlFor:"starting-map-checkbox",className:"text-sm font-medium text-muted-foreground",children:"Starting Map"}),o.jsx(Q,{content:"If this map is the map that players will start the game then mark this option",children:o.jsx(Sl,{className:"h-4 w-4 text-muted-foreground","aria-hidden":!0})})]}),o.jsx("input",{id:"starting-map-checkbox",type:"checkbox",className:"h-4 w-4 rounded border border-border accent-orange-500",checked:P,onChange:d=>E(d.target.checked),"aria-checked":P,"aria-label":"Set this map as the starting map"})]})]}),o.jsxs(Dr,{children:[o.jsx(I,{variant:"outline",onClick:()=>{p(!1),w(null)},children:"Cancel"}),o.jsx(I,{onClick:sx,disabled:gs,className:"flex items-center gap-2",children:gs?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),o.jsx("span",{children:"Creating..."})]}):o.jsx("span",{children:"Create"})})]})]})}),o.jsx(Cs,{open:Ig,onOpenChange:Oi,children:o.jsxs(Ts,{className:"max-w-md",children:[o.jsxs(Ms,{children:[o.jsx(Es,{children:"Edit Hero Position"}),o.jsx(Ps,{children:"Set the hero spawn position on the map."})]}),Pe&&o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"X Position"}),o.jsx(F,{type:"number",min:0,max:Pe.mapWidth-1,defaultValue:Pe.currentX,onChange:d=>{const k=parseInt(d.target.value);isNaN(k)||kr({...Pe,currentX:k})}}),o.jsxs("span",{className:"text-xs text-gray-500",children:["(0 - ",Pe.mapWidth-1,")"]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-1",children:"Y Position"}),o.jsx(F,{type:"number",min:0,max:Pe.mapHeight-1,defaultValue:Pe.currentY,onChange:d=>{const k=parseInt(d.target.value);isNaN(k)||kr({...Pe,currentY:k})}}),o.jsxs("span",{className:"text-xs text-gray-500",children:["(0 - ",Pe.mapHeight-1,")"]})]})]}),o.jsxs("div",{className:"text-sm text-gray-600",children:["Current position: (",Pe.currentX,", ",Pe.currentY,")"]})]}),o.jsxs(Dr,{children:[o.jsx(I,{variant:"outline",onClick:Ug,children:"Cancel"}),o.jsx(I,{onClick:()=>Pe&&Xg(Pe.currentX,Pe.currentY),children:"Confirm"})]})]})}),o.jsx(ab,{open:rx,onConfirm:ox,onCancel:ax}),Lg&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-black rounded-lg shadow-xl p-6 max-w-md mx-4 relative",children:[o.jsx("button",{onClick:()=>Zu(!1),className:"absolute top-3 right-3 text-gray-400 hover:text-gray-200 transition-colors",children:o.jsx(Ue,{className:"w-5 h-5"})}),o.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[o.jsx("div",{className:"w-10 h-10 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center",children:o.jsx($0,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),o.jsx("h3",{className:"text-lg font-semibold text-white",children:"Export Successful"})]}),o.jsxs("p",{className:"text-gray-300 flex items-center gap-2",children:[o.jsx("span",{className:"inline-flex items-center gap-1 font-medium text-white",children:o.jsx(Po,{className:"w-4 h-4"})}),"Project exported to project folder."]})]})}),xs&&o.jsx("div",{className:`custom-tooltip ${xs.visible?"visible":""} ${xs.fadeOut?"fade-out":""}`,style:{left:xs.x,top:xs.y},children:xs.content})]})})}Il.createRoot(document.getElementById("root")).render(o.jsx(ye.StrictMode,{children:o.jsx(mb,{})}));
